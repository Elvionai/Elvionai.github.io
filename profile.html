<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Profile â€” Elvion AI</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Chat with Elvion AI â€” your account and multi-chat interface.">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Orbitron:wght@700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --cyan: #00ffff;
      --blue: #0090ff;
      --bg: #191a26;
      --card: #181e2e;
      --radius: 18px;
      --input-glow: 0 1.5px 8px #00ffff48;
      --text: #e0e0e0;
      --muted: #b3b3b3;
    }
    html, body {height:100%;margin:0;padding:0;}
    body {
      font-family:'Inter',sans-serif; background:radial-gradient(circle, #23233a 68%, #0a1128 100%); color:var(--text);
      min-height:100vh; display:flex; align-items:center; justify-content:center; overflow-x:hidden;
    }
    #stars-container {position:fixed;width:100vw;height:100vh;top:0;left:0;z-index:0;}
    .star { position: absolute; background: rgba(255,255,255,0.7); border-radius: 50%; opacity:.17; animation:twinkle 4.6s infinite linear;}
    @keyframes twinkle {0%,100%{opacity:.17;}50%{opacity:.95;}}
    .profile-container {
      background:var(--card);box-shadow:0 0 14px #00fff2aa,0 0 24px #2323ff44;border-radius:var(--radius);max-width:440px;width:99vw;min-height:93vh;
      margin:0 auto;display:flex;flex-direction:column;align-items:center;gap:0.75em;position:relative;z-index:2;padding:14px 0 0 0;
    }
    .menu-bar {
      width:96%;display:flex;justify-content:space-between;align-items:center;
    }
    .menu-btn {background:none;border:none;color:var(--cyan);font-size:2em;cursor:pointer;padding:2px 10px;border-radius:13px;transition:background .15s,color .13s;}
    .menu-btn:hover {background:var(--cyan);color:#23233a;}
    .profile-header {display:flex;flex-direction:column;align-items:center;gap:.5em;}
    .logo-img {width:53px;height:53px;border-radius:50%;background:#fff;object-fit:cover;animation:logoPulse 3.2s infinite alternate,floatLogo 3.3s infinite alternate;}
    @keyframes logoPulse {0%{box-shadow:0 0 12px #00e2ff,0 0 24px #70fff7;}100%{box-shadow:0 0 14px #007c97,0 0 28px #00ceff60;}}
    @keyframes floatLogo {0%{transform:translateY(0);}100%{transform:translateY(-7px);}}
    .site-heading {font-family:'Orbitron',sans-serif;font-size:1.13em;font-weight:800;letter-spacing:.5px;background:linear-gradient(90deg,#00ffff,#fff,#0090ff);background-size:200% auto;-webkit-background-clip:text;-webkit-text-fill-color:transparent;animation:shine 4s linear infinite;text-shadow:0 0 18px #00ffff44;}
    @keyframes shine {to{background-position:200% center;}}
    .profile-greet{color:#aee;font-size:.93em;text-align:center;}
    /* Chat */
    .chat-area{background:var(--bg);border-radius:var(--radius);padding:8px 0 14px 0;width:99%;display:flex;flex-direction:column;align-items:center;}
    #chatSwitchBar{width:99%;margin:.4em 0 .3em 0;display:flex;gap:4px;align-items:center;}
    #chatSelector{padding:7px 10px;border-radius:8px 13px 13px 8px;border:1.3px solid #00ffff;font-size:.97em;background:var(--card);color:var(--text);}
    #newChatBtn{padding:5px 15px 5.5px 15px;border:none;border-radius:13px;background:linear-gradient(95deg,#00ffff 65%,#0090ff 100%);font-family:'Orbitron';font-size:.99em;color:#23233a;font-weight:600;box-shadow:0 0 13px #00fff2c7;}
    .chat-box{width:99%;min-height:98px;max-height:235px;background:transparent;border-radius:15px;padding:11px 9px 7px 9px;overflow-y:auto;display:flex;flex-direction:column;gap:9px;}
    .chat-message{display:flex;align-items:flex-end;gap:10px;}
    .chat-message.user{justify-content:flex-end;}
    .chat-message .msg{background:linear-gradient(90deg,#23233a 75%,#222 100%);color:#e0e0e0;padding:8px 15px;border-radius:12px 14px 7px 14px;max-width:75%;font-size:.98em;}
    .chat-message.user .msg{background:linear-gradient(90deg,#00ffff 70%,#0090ff 100%);color:#23233a;border-radius:14px 12px 14px 6px;font-weight:700;}
    .chat-message img,.chat-message video{max-width:88px;max-height:88px;border-radius:8px;margin-top:2px;background:#fff;}
    .chat-typing{color:#00ffff;font-size:.98em;margin-top:1px;margin-bottom:2px;display:flex;align-items:center;}
    .typing-dots{margin-left:8px;display:inline-block;}
    .typing-dot{width:6px;height:6px;background:#00ffff;border-radius:50%;margin-right:2px;animation:dotBlink 1.2s infinite;}
    .typing-dot:nth-child(2){animation-delay:.25s;}
    .typing-dot:nth-child(3){animation-delay:.5s;}
    @keyframes dotBlink{0%,100%{opacity:.13;}50%{opacity:.93;}}
    .file-preview{max-width:99vw;margin:8px 0 0 2px;border-radius:9px;overflow:hidden;background:rgba(35,35,58,.6);border:1px solid rgba(255,255,255,0.13);}
    .file-preview img,.file-preview video{max-width:93%;max-height:92px;display:block;margin:0 auto;}
    .file-preview .file-info{padding:7px;display:flex;align-items:center;font-size:.88em;color:var(--muted);}
    .file-preview .file-info i{margin-right:8px;}
    .chat-input-row{width:97%;display:flex;gap:7px;align-items:center;background:#23233a;border-radius:12px;padding:8px 8px;border:1.2px solid rgba(0,255,255,.12);box-shadow:var(--input-glow);}
    .chat-input-row input[type="file"]{display:none;}
    .chat-input-row label{cursor:pointer;color:var(--cyan);font-size:1.2em;padding:0 6px;transition:color .13s;}
    .chat-input-row label:hover{color:var(--blue);}
    .chat-input-row input[type="text"]{flex:1;padding:8px 8px;border-radius:13px;border:1.1px solid #23233a;background:#23233a;color:#e0e0e0;font-size:.99em;outline:none;}
    .chat-input-row input[type="text"]:focus{border:1.3px solid var(--cyan);box-shadow:var(--input-glow);}
    .chat-input-row button{background:linear-gradient(90deg,#00ffff,#0090ff);color:#23233a;border:none;border-radius:11px;padding:8px 15px;font-size:1em;font-weight:700;cursor:pointer;box-shadow:0 2px 8px #00ffff33;margin-left:2px;transition:background .12s;}
    .chat-input-row button:hover{background:#0090ff;color:#fff;}
    .status-message{color:#ffd700;font-size:.93em;text-align:center;min-height:16px;}
    /* Modal panels */
    .panel-bg{display:none;position:fixed;z-index:200;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.57);}
    .panel-bg.active{display:flex;}
    .side-panel{background:var(--card);width:99vw;max-width:337px;height:100vh;box-shadow:-2px 0 32px #00ffffef;display:flex;flex-direction:column;transition:transform .18s cubic-bezier(.61,-0.01,.48,1.01);overflow-y:auto;transform:translateX(340px);}
    .side-panel.active{transform:translateX(0);}
    .panel-header{display:flex;flex-direction:column;align-items:center;padding:24px 0 11px 0;}
    .panel-header img{width:42px;height:42px;border-radius:55%;object-fit:cover;}
    .panel-header .username{font-weight:800;font-size:1em;color:var(--cyan);}
    .panel-header .email{font-size:.93em;color:var(--muted);}
    .edit-form{display:flex;flex-direction:column;gap:10px;}
    .edit-form label{color:#00ffff;font-size:.93em;margin-bottom:2px;}
    .edit-form input{border:none;border-bottom:2px solid #23233a;background:#181d2c;color:#eee;font-size:.98em;padding:6px 4px 6px 10px;margin-bottom:3px;border-radius:7px;}
    .edit-form input:focus{border-color:#00ffff;background:#23233a;}
    .profile-photo-tip{color:#b3b3b3;font-size:.91em;margin-bottom:5px;}
    .panel-links{display:flex;flex-direction:column;gap:1px;margin-bottom:18px;margin-top:9px;align-items:flex-start;}
    .panel-links a{color:var(--text);text-decoration:none;font-weight:700;font-size:1.02em;padding:10px 15px 10px 13px;border-radius:0 13px 13px 0;transition:background .1s,color .12s;background:#1d2031;}
    .panel-links a:hover{background:var(--cyan);color:#23233a;}
    @media(max-width:520px){.profile-container{max-width:99vw;width:99vw;padding:0 1vw;}}
  </style>
</head>
<body>
<div id="stars-container"></div>
<div class="profile-container">
  <div class="menu-bar">
    <button class="menu-btn" id="openProfileMenu" title="Profile"><i class="fa-solid fa-user"></i></button>
    <button class="menu-btn" id="openLinksMenu" title="Links"><i class="fa-solid fa-link"></i></button>
  </div>
  <div class="profile-header">
    <img id="profilePic" src="https://i.ibb.co/YTkKPfvf/IMG-20250715-102103-129.jpg" class="logo-img" alt="Elvion AI logo">
    <div class="site-heading">Elvion AI</div>
    <div class="profile-greet" id="greetMsg">Welcome!</div>
  </div>
  <section class="chat-area">
    <div id="chatSwitchBar">
      <select id="chatSelector"></select>
      <button id="newChatBtn">New Chat</button>
    </div>
    <div class="chat-box" id="chatBox"></div>
    <div id="typingMsg" class="chat-typing" style="display:none;">Elvion AI is typing <span class="typing-dots"><span class="typing-dot"></span><span class="typing-dot"></span><span class="typing-dot"></span></span></div>
    <div id="filePreview" class="file-preview" style="display:none;"></div>
    <form class="chat-input-row" id="chatForm" autocomplete="off">
      <label for="chatFile"><i class="fa-solid fa-paperclip"></i></label>
      <input type="file" id="chatFile" accept="*">
      <input type="text" id="chatInput" placeholder="Type a message or record voice...">
      <button type="submit"><i class="fa-solid fa-paper-plane"></i></button>
      <button type="button" id="voiceInputBtn" title="Record voice" style="margin-left:7px;"><i class="fa-solid fa-microphone"></i></button>
    </form>
    <div class="status-message" id="statusMsg"></div>
  </section>
</div>

<!-- Profile Menu Modal -->
<div class="panel-bg" id="profileMenuBg">
  <nav class="side-panel" id="profileMenu">
    <div class="panel-header">
      <img id="profilePicPreview" src="https://i.ibb.co/YTkKPfvf/IMG-20250715-102103-129.jpg" alt="Profile photo">
      <div class="username" id="profileMenuUser">User</div>
      <div class="email" id="profileMenuEmail">Email@example.com</div>
    </div>
    <form class="edit-form" id="profileForm" autocomplete="off" style="padding:0 18px;">
      <label for="edit-name">Name</label>
      <input type="text" id="edit-name" required>
      <label for="edit-photo">Photo URL</label>
      <input type="url" id="edit-photo" placeholder="Paste image link">
      <span class="profile-photo-tip">Upload at <a href="https://postimg.cc/" target="_blank" style="color:#00ffff;">postimg.cc</a> and paste link here.</span>
      <button type="submit" class="submit-btn">Save</button>
      <div class="status-message" id="profileStatusMsg"></div>
    </form>
    <button class="submit-btn" id="logoutBtn" style="background:#19192a;color:#00ffff;">Logout</button>
  </nav>
</div>
<!-- Link Menu Modal -->
<div class="panel-bg" id="linkMenuBg">
  <nav class="side-panel" id="linkMenu">
    <div class="panel-header">
      <img src="https://i.ibb.co/YTkKPfvf/IMG-20250715-102103-129.jpg" alt="Elvion logo">
      <div class="username">Elvion Links</div>
    </div>
    <div class="panel-links">
      <a href="index.html"><i class="fa-solid fa-home"></i> Home</a>
      <a href="about.html"><i class="fa-solid fa-circle-info"></i> About</a>
      <a href="privacy.html"><i class="fa-solid fa-shield-halved"></i> Privacy Policy</a>
      <a href="terms.html"><i class="fa-solid fa-file-contract"></i> Terms</a>
      <a href="https://t.me/writingurubot" target="_blank"><i class="fab fa-telegram"></i> Telegram Bot</a>
    </div>
  </nav>
</div>
<script type="module">
  // STAR BG
  document.addEventListener('DOMContentLoaded',()=>{
    const starsContainer=document.getElementById('stars-container');
    for(let i=0;i<47;i++){const s=document.createElement('div');s.className='star';
      const z=Math.random()*2.15+1; s.style.width=z+'px'; s.style.height=z+'px'; s.style.left=Math.random()*100+'%'; s.style.top=Math.random()*100+'%';
      s.style.animationDelay=(Math.random()*3.7)+'s'; s.style.animationDuration=(2+Math.random()*1.7)+'s';
      starsContainer.appendChild(s);}
  });
  // MODALS
  function openModal(bg,panel){bg.classList.add('active');setTimeout(()=>panel.classList.add('active'),12);}
  function closeModal(bg,panel){panel.classList.remove('active');setTimeout(()=>bg.classList.remove('active'),180);}
  document.getElementById('openProfileMenu').onclick=()=>openModal(profileMenuBg,profileMenu);
  profileMenuBg.onclick=e=>{if(e.target===profileMenuBg)closeModal(profileMenuBg,profileMenu);}
  document.getElementById('openLinksMenu').onclick=()=>openModal(linkMenuBg,linkMenu);
  linkMenuBg.onclick=e=>{if(e.target===linkMenuBg)closeModal(linkMenuBg,linkMenu);}
  document.getElementById('logoutBtn').onclick=()=>window.location.href='signup-login.html';

  // Firebase auth/profile
  import {initializeApp} from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
  import {getAuth,onAuthStateChanged,updateProfile} from "https://www.gstatic.com/firebasejs/10.12.4/firebase-auth.js";
  const firebaseConfig={apiKey:"AIzaSyAyROm0aBGjry6NUfhNM3e0qwPcCDoIqSk",authDomain:"elvionai.firebaseapp.com",projectId:"elvionai",storageBucket:"elvionai.firebasestorage.app",messagingSenderId:"161078300830",appId:"1:161078300830:web:f460df8591704eb0e96b8f"};
  const app=initializeApp(firebaseConfig);const auth=getAuth(app);
  let currentUser;
  onAuthStateChanged(auth, user=>{
    if(!user)window.location.href="signup-login.html";
    else{
      currentUser=user;
      document.getElementById("greetMsg").textContent="Welcome, "+(user.displayName||user.email.split('@')[0])+"!";
      document.getElementById("profilePic").src=user.photoURL||"https://i.ibb.co/YTkKPfvf/IMG-20250715-102103-129.jpg";
      document.getElementById("profileMenuUser").textContent=user.displayName||"User";
      document.getElementById("profileMenuEmail").textContent=user.email;
      document.getElementById("edit-name").value=user.displayName||"";
      document.getElementById("edit-photo").value=user.photoURL||"";
      document.getElementById("profilePicPreview").src=user.photoURL||"https://i.ibb.co/YTkKPfvf/IMG-20250715-102103-129.jpg";
    }
  });
  document.getElementById("edit-photo").oninput=function(){
    document.getElementById("profilePicPreview").src=this.value||"https://i.ibb.co/YTkKPfvf/IMG-20250715-102103-129.jpg";
  };
  document.getElementById("profileForm").onsubmit=async function(e){
    e.preventDefault();
    if(!currentUser)return;
    const status=document.getElementById("profileStatusMsg"); status.textContent='';
    const name=document.getElementById("edit-name").value.trim();
    const photoURL=document.getElementById("edit-photo").value.trim();
    try{
      await updateProfile(currentUser,{displayName:name,photoURL});
      await auth.currentUser.reload();
      document.getElementById("profilePic").src=auth.currentUser.photoURL||"https://i.ibb.co/YTkKPfvf/IMG-20250715-102103-129.jpg";
      status.textContent="Profile updated!";
      status.style.color="#00ffff";
      setTimeout(()=>closeModal(profileMenuBg,profileMenu),650);
      document.getElementById("greetMsg").textContent="Welcome, "+(auth.currentUser.displayName||auth.currentUser.email.split('@')[0])+"!";
    }catch(err){
      status.textContent=err.message||"Update failed";
      status.style.color="#ffd700";
    }
  };

  // Multi-chat management
  let chats=JSON.parse(localStorage.getItem("elvion_chats")||"[]");
  let currentChatIdx=chats.length-1>=0?chats.length-1:0;
  function saveChats(){localStorage.setItem("elvion_chats",JSON.stringify(chats));}
  function renderChatSelector(){
    const chatSelector=document.getElementById("chatSelector");
    chatSelector.innerHTML="";
    chats.forEach((chat,idx)=>{
      const option=document.createElement("option");
      option.value=idx;option.textContent=chat.name||(chat.history?.[0]?.text?.slice(0,16)||"Untitled");
      chatSelector.appendChild(option);
    });
    chatSelector.value=currentChatIdx;
  }
  document.getElementById("chatSelector").onchange=function(){currentChatIdx=parseInt(this.value)||0;renderChatBox(chats[currentChatIdx]?.history);}
  function loadChat(idx){currentChatIdx=idx||0;renderChatBox(chats[idx]?.history);}
  function renderChatBox(messages){
    const chatBox=document.getElementById("chatBox");chatBox.innerHTML="";
    (messages||[]).forEach(msg=>{
      const div=document.createElement('div');
      div.className="chat-message "+(msg.role==="user"?"user":"ai");
      div.innerHTML=`<div class="msg">${msg.text}</div>`;
      chatBox.appendChild(div);
    });
    chatBox.scrollTop=chatBox.scrollHeight;
  }
  document.getElementById("newChatBtn").onclick=function(){
    const name="Chat "+(chats.length+1); chats.push({name,history:[]}); currentChatIdx=chats.length-1;
    saveChats();renderChatSelector();loadChat(currentChatIdx);
  };

  // Typing anim
  function showTyping(waiting){document.getElementById("typingMsg").style.display=waiting?"":"none";}
  // Chat send: POST to backend. File if present, otherwise text.
  document.getElementById("chatForm").onsubmit=async function(e){
    e.preventDefault();
    const chatInput=document.getElementById("chatInput");
    const file=document.getElementById("chatFile").files[0];
    const msgText=chatInput.value.trim();
    if(currentChatIdx<0){chats.push({name:"Chat 1",history:[]});currentChatIdx=0;}
    if(file){
      showTyping(true);
      // File POST
      const formData=new FormData();
      formData.append("file",file);
      formData.append("message",msgText);
      formData.append("user_id","user");
      const res=await fetch("https://web-production-9a18.up.railway.app/upload-file",{method:"POST",body:formData});
      const data=await res.json();
      chats[currentChatIdx].history.push({role:"user",text:"[File] "+(msgText||file.name)});
      chats[currentChatIdx].history.push({role:"ai",text:data.response||"ðŸ¤– Bot responded (file)."});
      chatInput.value="";
      document.getElementById("chatFile").value="";
      document.getElementById("filePreview").style.display="none";
      saveChats();renderChatSelector();renderChatBox(chats[currentChatIdx].history);
      showTyping(false);
      return;
    }
    if(msgText){
      chats[currentChatIdx].history.push({role:"user",text:msgText});
      if(chats[currentChatIdx].history.length===1){
        chats[currentChatIdx].name=msgText.slice(0,22)+"...";
        renderChatSelector();
      }
      renderChatBox(chats[currentChatIdx].history);saveChats();showTyping(true);
      // Text POST
      try{
        const history=chats[currentChatIdx].history.map(m=>({role:m.role,content:m.text}));
        const res=await fetch("https://web-production-9a18.up.railway.app/chat",{method:"POST",headers:{'Content-Type':'application/json'},body:JSON.stringify({message:msgText,user_id:"user",history})});
        const data=await res.json();
        chats[currentChatIdx].history.push({role:"ai",text:data.response||"ðŸ¤– Bot replied."});
        saveChats();renderChatSelector();renderChatBox(chats[currentChatIdx].history);showTyping(false);
      }catch(err){
        showTyping(false);
        chats[currentChatIdx].history.push({role:"ai",text:"Sorry, bot error: "+err.message});
        renderChatBox(chats[currentChatIdx].history);saveChats();
      }
    }
    chatInput.value="";
  };
  // File preview
  document.getElementById("chatFile").onchange=function(){
    const file=this.files[0], fp=document.getElementById("filePreview");
    if(!file){fp.style.display="none";fp.innerHTML="";return;}
    fp.style.display='block';
    if(file.type.startsWith("image/")){
      const reader=new FileReader();
      reader.onload=e=>{fp.innerHTML=`<img src="${e.target.result}">`;};
      reader.readAsDataURL(file);
    }else if(file.type.startsWith("video/")){
      const reader=new FileReader();
      reader.onload=e=>{fp.innerHTML=`<video src="${e.target.result}" controls></video>`;};
      reader.readAsDataURL(file);
    }else{
      fp.innerHTML=`<div class="file-info"><i class="fa-solid fa-file"></i> ${file.name}</div>`;
    }
  };
  // Voice input (speech-to-text)
  let recognition;
  document.getElementById("voiceInputBtn").onclick=function(){
    if('webkitSpeechRecognition'in window){
      recognition=new webkitSpeechRecognition();
      recognition.continuous=false;recognition.interimResults=false;recognition.lang='en-US';
      document.getElementById("voiceInputBtn").innerHTML='<i class="fa-solid fa-microphone-lines"></i>';
      recognition.onresult=function(e){
        document.getElementById('chatInput').value+=e.results[0][0].transcript;
        document.getElementById("voiceInputBtn").innerHTML='<i class="fa-solid fa-microphone"></i>';
      };
      recognition.onend=function(){document.getElementById("voiceInputBtn").innerHTML='<i class="fa-solid fa-microphone"></i>';};
      recognition.onerror=function(){document.getElementById("voiceInputBtn").innerHTML='<i class="fa-solid fa-microphone"></i>';};
      recognition.start();
    }else{
      alert("Speech recognition is not supported in your browser.");
    }
  };

  // Initial render
  renderChatSelector();loadChat(currentChatIdx);
</script>
</body>
</html>
