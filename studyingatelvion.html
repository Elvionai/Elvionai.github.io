<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Dashboard | Elvion Learning Path</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Your Elvion University sequential learning dashboard. Track course progress." />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Orbitron:wght@700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    /* ---------------------- 1. THEME & GLOBALS ---------------------- */
    :root {
      --cyan: #00ffff;
      --blue: #0090ff;
      --card-bg: rgba(18,26,48,0.97);
      --border-glow: 0 0 11px var(--cyan), 0 0 24px var(--blue);
      --radius: 15px;
      --text: #e0e0e0;
      --muted: #a7b2c3;
    }
    *, *::before, *::after { box-sizing: border-box; }
    body {
      margin: 0; min-height: 100vh;
      background: linear-gradient(120deg, #181d32 50%, #132142 100%);
      color: var(--text); font-family: 'Inter', sans-serif;
    }
    
    /* ---------------------- 2. HEADER & PROFILE ---------------------- */
    header {
      display: flex; align-items: center; justify-content: space-between;
      padding: 24px 4vw 8px 4vw; background:rgba(18,26,48,0.97); box-shadow: var(--border-glow); border-radius:0 0 28px 28px;
    }
    .title { font-family:Orbitron,sans-serif; font-size:1.63em; color:var(--cyan); text-shadow:var(--border-glow);}
    .profile { display:flex; align-items:center; gap:13px; background: #181e36; border-radius:12px; padding:8px 17px; box-shadow: 0 0 16px 2px #00ffff07;}
    .profile-img { width:52px; height:52px; border-radius:50%; background:#232857; object-fit:cover; border:2px solid var(--cyan);}
    .profile-info b { color:var(--cyan);}
    .prof-actions { margin-left:14px; display: flex; gap: 7px;}
    .prof-actions button { background: none; border:none; color:var(--cyan); cursor:pointer; font-size:1.25em; opacity:.85; transition: opacity .2s; vertical-align: middle;}
    .prof-actions button:hover { opacity: 1; text-shadow: 0 0 5px var(--cyan);}

    /* ---------------------- 3. MAIN CONTENT & GRID ---------------------- */
    main { max-width:1060px; margin:28px auto 0 auto; padding:20px;}
    h2 { font-family:Orbitron,sans-serif; color:var(--cyan); margin-bottom:20px; }
    .courses-grid { 
        display:grid; grid-template-columns: repeat(auto-fit, minmax(280px,1fr)); gap:2em; margin-bottom:28px;
    }
    .course-card {
      background: var(--card-bg); border-radius:var(--radius); padding:20px 16px;
      box-shadow: var(--border-glow); cursor: pointer; transition: box-shadow .17s, transform .19s, border .17s;
      border:2.1px solid #131b30; position: relative;
      display: flex; flex-direction: column; gap: 5px;
    }
    .course-card:hover { box-shadow: 0 0 22px var(--cyan),0 0 44px #00c2ff49; border:2.1px solid var(--cyan); transform: scale(1.02); z-index:4; }
    .course-header { display: flex; align-items: center; justify-content: space-between; }
    .course-title {font-size:1.19em; font-weight:700; color:#fff; font-family:Orbitron,sans-serif; }
    .course-icon { font-size: 1.5em; color: var(--cyan); }
    .course-meta { font-size:.92em; color:var(--cyan); margin-top: -5px;}
    .course-intro {font-size:.97em; color:var(--muted); margin-top: 10px; flex-grow: 1;}

    /* PROGRESS BAR STYLES */
    .progress-container { height: 7px; background: rgba(255, 255, 255, 0.1); border-radius: 5px; margin-top: 5px; overflow: hidden; margin-bottom: 7px; }
    .progress-bar { height: 100%; width: 0%; background: linear-gradient(90deg, var(--cyan), var(--blue)); transition: width 0.5s ease-out; box-shadow: 0 0 5px var(--cyan); }
    .progress-text { font-size: 0.9em; font-weight: 600; color: var(--cyan); text-align: right; font-family: Orbitron, sans-serif; }
    .start-btn {
      margin-top:15px; background: linear-gradient(90deg, var(--cyan), var(--blue)); color: #161d28; border: none; border-radius: 12px; padding: 10px 0;
      font-size: 1em; font-family:'Orbitron',sans-serif; font-weight:700; cursor:pointer; box-shadow: 0 0 13px #00c3ff99; text-transform:uppercase;
      letter-spacing:.04em; transition: background .11s, transform .10s;
    }
    .start-btn:hover { background: var(--blue); color:#fff; transform:scale(1.02);}
    .course-details { 
        padding:23px 19px 11px 19px; margin:20px auto; background:rgba(15,32,60,0.91); 
        border-radius:14px; box-shadow:0 0 19px #0090ff18; max-width:600px;
    }
    
    /* Star BG Styles */
    #stars-container {position: fixed; width: 100%; height: 100%; top: 0; left: 0; z-index: -1;}
    .star {
      position: absolute; background: #fff; border-radius: 50%; 
      box-shadow: 0 0 4px 1px var(--cyan); opacity: 0; animation: blink 2s infinite alternate;
    }
    @keyframes blink { 0% { opacity: 0; } 50% { opacity: 1; } 100% { opacity: 0; }}
  </style>
</head>
<body>
<div id="stars-container"></div>
<header>
  <span class="title">ELVION LEARNING PATH</span>
  <div class="profile">
    <img id="profile-img" src="https://i.pravatar.cc/150?img=12" class="profile-img" alt="profile image" />
    <div class="profile-info">
      <div><b id="displayName">A. Student</b></div>
      <small style="color:#aee;" id="user-email">a.student@elvion.edu</small>
    </div>
    <div class="prof-actions">
      <button title="Notifications"><i class="fa fa-bell"></i></button>
      <button title="Edit profile" id="edit-profile-btn"><i class="fa fa-user-edit"></i></button>
      <button title="Logout" id="logout-btn"><i class="fa fa-sign-out-alt"></i></button>
    </div>
  </div>
</header>
<main>
  <h2 id="main-heading">Your Active Learning Path</h2>
  <div class="courses-grid" id="courses-grid">
    </div>
  <div class="course-details" id="course-details">
    </div>
</main>

<div class="edit-modal-bg" id="edit-modal-bg" style="display: none;">
  <form class="edit-modal" id="edit-modal" onsubmit="return false;">
    <span class="edit-close" id="modal-close-btn">&times;</span>
    <h3 style="color:var(--cyan);text-align:center;margin-top:0">Edit Profile</h3>
    <label for="edit-name">Name</label>
    <input type="text" id="edit-name" required>
    <label for="edit-photo">Photo URL</label>
    <input type="url" id="edit-photo" placeholder="https://link.to/photo.jpg">
    <label for="edit-dob">Date of Birth</label>
    <input type="date" id="edit-dob">
    <label for="edit-bio">Bio/About Me</label>
    <textarea id="edit-bio" rows="2" placeholder="A few words about you"></textarea>
    <div class="btns">
      <button type="button" id="save-profile-btn" style="background:var(--cyan); color:#222; border:none; border-radius:7px; font-family:Orbitron,sans-serif; padding:7.2px 26px; font-weight:700;">Save</button>
      <button type="button" class="cancel" id="cancel-profile-btn" style="background:#19243c; color:#aee; border:none; border-radius:7px; font-family:Orbitron,sans-serif; padding:7.2px 26px;">Cancel</button>
    </div>
  </form>
</div>

<script type="module">
  // --- STAR BG INIT ---
  document.addEventListener('DOMContentLoaded', () => {
    const starsContainer = document.getElementById('stars-container');
    const numStars = 45, minSize = 1, maxSize = 2.5;
    for (let i = 0; i < numStars; i++) {
      const star = document.createElement('div');
      star.className = 'star';
      const size = Math.random() * (maxSize - minSize) + minSize;
      star.style.width = size + 'px';
      star.style.height = size + 'px';
      star.style.left = Math.random() * 100 + '%';
      star.style.top = Math.random() * 100 + '%';
      star.style.animationDelay = (Math.random() * 4) + 's';
      star.style.animationDuration = (2.4 + Math.random() * 1.8) + 's';
      starsContainer.appendChild(star);
    }
  });

  // --- 1. COURSE DEFINITIONS: Sequential Computer Science Path ---
  // Each course is treated as 4 'weeks' (or modules) of learning.
  const csCourses = [
    { key: "cs-intro", title: "Introduction to Programming", code: "CSC 101", icon: "fa-terminal", weeks: 4, prerequisite: null, intro: "Learn fundamental logic, variables, control flow, and basic algorithm design." },
    { key: "cs-data", title: "Data Structures", code: "CSC 102", icon: "fa-database", weeks: 4, prerequisite: "cs-intro", intro: "Explore arrays, linked lists, stacks, queues, trees, and hashing techniques." },
    { key: "cs-oop", title: "Object-Oriented Programming", code: "CSC 201", icon: "fa-cube", weeks: 4, prerequisite: "cs-data", intro: "Master OOP principles: encapsulation, inheritance, polymorphism, and design patterns." },
    { key: "cs-db", title: "Database Systems", code: "CSC 202", icon: "fa-server", weeks: 4, prerequisite: "cs-oop", intro: "Study relational databases, SQL, database design, and normalization." },
    { key: "cs-se", title: "Software Engineering", code: "CSC 301", icon: "fa-cogs", weeks: 4, prerequisite: "cs-db", intro: "Cover the software development lifecycle, requirements analysis, and testing." },
    { key: "cs-net", title: "Computer Networks", code: "CSC 302", icon: "fa-network-wired", weeks: 4, prerequisite: "cs-se", intro: "Understand the OSI model, TCP/IP, routing, and network security protocols." },
    { key: "cs-ai", title: "Artificial Intelligence", code: "CSC 401", icon: "fa-robot", weeks: 4, prerequisite: "cs-net", intro: "Introduction to search algorithms, machine learning concepts, and knowledge representation." },
    { key: "cs-final", title: "Final Year Project", code: "CSC 402", icon: "fa-graduation-cap", weeks: 4, prerequisite: "cs-ai", intro: "Independent research and development of a significant software project." }
  ];

  // --- 2. SIMULATED USER PROGRESS & AUTH ---
  // This simulation replaces the need for Firebase for this single file demo.
  let currentUser = { displayName: "Student Alpha", email: "alpha@elvion.edu", photoURL: 'https://i.pravatar.cc/150?img=12' }; 
  
  // SCENARIO: User has completed 2 weeks of CSC 101. They are starting Week 3 (index 2).
  // The progress is (2 / 4) * 100 = 50%.
  let userProgress = {
      activeCourseKey: "cs-intro",
      currentWeekIndex: 2, // The 0-indexed week/module to start next (Week 3)
      courseStatuses: {
          // Status of CSC 101
          "cs-intro": { completed: false, progressPercent: 50 }, 
          // Status of other courses (locked/not started)
          "cs-data": { completed: false, progressPercent: 0 },
      }
  };
  
  // Update UI with simulated user data
  document.getElementById("displayName").textContent = currentUser.displayName;
  document.getElementById("user-email").textContent = currentUser.email;
  document.getElementById("profile-img").src = currentUser.photoURL;


  // --- 3. RENDERING LOGIC: Focus on Next Action ---

  function calculateOverallProgress() {
    const totalCourses = csCourses.length;
    let completedCourses = 0;
    let activeCourseWeight = 0;

    csCourses.forEach(c => {
        const status = userProgress.courseStatuses[c.key];
        if (status && status.completed) {
            completedCourses++;
        } else if (c.key === userProgress.activeCourseKey) {
            // Calculate the relative weight of the active course's progress (e.g., 50% of 1 course)
            activeCourseWeight = (status?.progressPercent || 0) / 100;
        }
    });

    // Overall Path Progress: ((Completed Courses + Active Course Weight) / Total Courses) * 100
    return Math.floor(((completedCourses + activeCourseWeight) / totalCourses) * 100);
  }

  function renderLearningPath() {
    const grid = document.getElementById("courses-grid");
    const details = document.getElementById("course-details");
    const activeCourse = csCourses.find(c => c.key === userProgress.activeCourseKey);
    const overallProgress = calculateOverallProgress();

    details.style.display = "block"; // Always show the details panel for the path status

    if (!activeCourse) {
      // Scenario: All courses completed
      grid.innerHTML = `<div style="text-align:center; padding: 40px;"><p style="color:#00ff88; font-size:1.2em; font-family:Orbitron, sans-serif;">✅ Congratulations! You have completed the entire Computer Science path!</p></div>`;
      details.innerHTML = `<h3 style="color:var(--cyan);margin-top:0">Path Status: Complete!</h3><p>Your dedication has paid off. Total progress: 100%. Contact your advisor for your next steps.</p>`;
      return;
    }

    const { currentWeekIndex } = userProgress;
    const currentWeekNumber = currentWeekIndex + 1; 
    const totalWeeks = activeCourse.weeks;
    const activeStatus = userProgress.courseStatuses[activeCourse.key];
    const progressPercent = activeStatus ? activeStatus.progressPercent : 0;
    
    const isCompleted = progressPercent >= 100;
    const buttonText = isCompleted ? 'Review Course' : `Continue: Week ${currentWeekNumber} of ${totalWeeks}`;
    const actionKey = isCompleted ? 0 : currentWeekIndex; 

    // 1. Render the Active Course Card
    grid.innerHTML = `
      <div class="course-card active" data-key="${activeCourse.key}" onclick="startStudying('${activeCourse.key}', ${actionKey})">
        <div class="course-header">
          <div class="course-title">${activeCourse.title}</div>
          <i class="fa ${activeCourse.icon} course-icon" title="${activeCourse.code}"></i>
        </div>
        <div class="course-meta">${activeCourse.code} &middot; Overall Path: ${overallProgress}%</div>
        <div class="progress-text">${progressPercent}% Course Progress</div>
        <div class="progress-container">
          <div class="progress-bar" style="width: ${progressPercent}%;"></div>
        </div>
        <div class="course-intro">${activeCourse.intro}</div>
        <button class="start-btn" onclick="event.stopPropagation(); startStudying('${activeCourse.key}', ${actionKey})">${buttonText}</button>
      </div>
    `;
    
    // 2. Render the Course Details/Status Panel
    renderDetails(activeCourse, currentWeekNumber, progressPercent, overallProgress);
  }

  function renderDetails(course, currentWeekNumber, courseProgress, overallProgress) {
    const details = document.getElementById("course-details");
    const nextCourseIndex = csCourses.findIndex(c => c.key === course.key) + 1;
    const nextCourse = csCourses[nextCourseIndex];

    details.innerHTML = `
      <h3 style="color:var(--cyan);margin-top:0">${course.title} Syllabus Status</h3>
      <p style="font-size:1.1em; color: ${courseProgress >= 100 ? '#00ff88' : 'var(--cyan)'};">
        ${courseProgress >= 100 
          ? `<i class="fa fa-check-circle"></i> Course Completed! Total Path Progress: ${overallProgress}%` 
          : `<i class="fa fa-arrow-right"></i> Current Focus: **Week ${currentWeekNumber}** (${course.weeks} Weeks Total)`}
      </p>

      <div style="margin-top: 20px; border-top: 1px solid #00ffff10; padding-top: 15px;">
        <h4 style="color:var(--text); margin: 0 0 10px 0; font-family:Orbitron,sans-serif;">Computer Science Learning Sequence</h4>
        <ul style="list-style: none; padding: 0; font-size: 0.95em;">
          ${csCourses.map((c, index) => {
              // Determine status and style for each course in the sequence
              const isActive = c.key === course.key && courseProgress < 100;
              // A course is considered completed if its status is marked completed OR if it is the current course and 100% progress
              const isCompleted = userProgress.courseStatuses[c.key]?.completed || (c.key === course.key && courseProgress >= 100);
              const isLocked = !isCompleted && !isActive;

              let statusIcon = isCompleted ? `<i class="fa fa-check-circle" style="color:#00ff88;"></i>` : (isActive ? `<i class="fa fa-arrow-right" style="color:var(--cyan);"></i>` : `<i class="fa fa-lock" style="color:var(--muted);"></i>`);
              let statusStyle = isCompleted ? 'color: #00ff88;' : (isActive ? 'font-weight: 700; color: #fff;' : 'color: var(--muted);');
              
              return `<li style="margin-bottom: 8px; ${statusStyle}">${statusIcon} ${c.code}: ${c.title}</li>`;
          }).join('')}
        </ul>
      </div>

      ${nextCourse && courseProgress >= 100 ? 
        `<button class="start-btn" style="margin-top:2em; background: #00ff88; color: #222; box-shadow: 0 0 13px #00ff8899;" 
               onclick="startStudying('${nextCourse.key}', 0)">Proceed to ${nextCourse.code}</button>` 
        : ''
      }
    `;
  }

  // --- 4. ACTION FUNCTIONS ---
  // Redirects to the lesson viewer template with course/week parameters
  window.startStudying = function(courseKey, weekIndex) {
    // NOTE: This assumes you have created the 'lesson.html' file provided previously.
    window.location.href = `lesson.html?course=${courseKey}&week=${weekIndex + 1}`;
  };

  // Initial load
  renderLearningPath();
  
  // --- Profile/Auth Modal Functions (Simplified/Placeholders) ---
  const modalBg = document.getElementById('edit-modal-bg');
  const editName = document.getElementById('edit-name');
  const editPhoto = document.getElementById('edit-photo');

  function openEditModal() {
    modalBg.style.display = "flex";
    editName.value = currentUser.displayName || "";
    editPhoto.value = currentUser.photoURL || "";
    // Note: Firebase placeholder functions for saving are omitted for a pure HTML/JS demo
  }
  function closeEditModal() {
    modalBg.style.display = "none";
  }
  document.getElementById('edit-profile-btn').addEventListener('click', openEditModal);
  document.getElementById('modal-close-btn').addEventListener('click', closeEditModal);
  document.getElementById('cancel-profile-btn').addEventListener('click', closeEditModal);
  document.getElementById('save-profile-btn').addEventListener('click', () => {
      // Demo save logic
      const name = editName.value.trim();
      const photo = editPhoto.value.trim();
      currentUser.displayName = name;
      currentUser.photoURL = photo;
      document.getElementById('displayName').textContent = name;
      document.getElementById('profile-img').src = photo || document.getElementById('profile-img').src;
      closeEditModal();
      alert('Profile saved successfully! (Demo)');
  });
  document.getElementById('logout-btn').addEventListener('click', () => {
    alert("Logged out! (Demo mode)");
    location.reload(); 
  });
</script>
</body>
</html>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-J1YTKP10ZX"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date()); 

  gtag('config', 'G-J1YTKP10ZX');
</script>
