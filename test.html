<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>How to Craft Unforgettable Characters: A Writer's Guide | Elvion AI Blog</title>
    <meta name="description" content="Master the art of character creation with proven techniques to build compelling, three-dimensional characters that readers will love.">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Orbitron:wght@600;700;800;900&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* --- DUAL THEME VARIABLES (Default: DARK MODE) --- */
        :root {
            /* Elvion AI Cyan/Blue Theme */
            --bg-color: #0d1117; 
            --text-color: #e6edf3;
            --heading-color: #ffffff;
            --cyan-glow: #00ffff;
            --light-blue-glow: #00aaff; 
            --link-color: var(--cyan-glow);
            --link-hover-color: var(--light-blue-glow);
            --border-color: #21262d;
            --card-bg: #161b22; 
            --button-bg: linear-gradient(45deg, var(--cyan-glow), var(--light-blue-glow));
            --button-text-color: #0d1117; 
            --button-hover-bg: linear-gradient(45deg, #00d4d4, #0077ff);
            --navbar-bg: rgba(13, 17, 23, 0.95);
            --footer-bg: #0a0e14;
            --highlight-color: rgba(0, 255, 255, 0.3); /* For word highlight */
            --comment-bg: #0d1117;
            --shadow-glow: 0 0 10px rgba(0, 255, 255, 0.15);
            --main-headline-color: #ffffff; /* White in dark mode */
            --section-headline-color: var(--light-blue-glow);
        }

        /* LIGHT MODE VARIABLES (Refined to be less harsh white) */
        body.light-theme {
            --bg-color: #f1f4f8; /* Soft background */
            --text-color: #333333;
            --heading-color: #111111;
            --link-color: #0056b3;
            --link-hover-color: #003d80;
            --border-color: #e0e0e0;
            --card-bg: #ffffff;
            --button-bg: #0056b3;
            --button-text-color: #ffffff;
            --button-hover-bg: #003d80;
            --navbar-bg: #ffffff;
            --footer-bg: #e5e5e5;
            --highlight-color: #fff176; /* Soft yellow highlight */
            --comment-bg: #ffffff;
            --shadow-glow: none;
            --main-headline-color: #111111; /* Black in light mode */
            --section-headline-color: #0056b3;
        }

        /* --- GLOBAL STYLES --- */
        html { scroll-behavior: smooth; }

        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding-top: 60px;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.8;
            font-size: 1.1rem;
            overflow-x: hidden;
            transition: background-color 0.3s, color 0.3s;
        }

        h1, h2, h3, h4 {
            font-family: 'Orbitron', sans-serif;
            margin-top: 0;
            line-height: 1.3;
        }
        
        /* Specific Headline Coloring */
        h1 { color: var(--main-headline-color); text-shadow: var(--shadow-glow); }
        h2 { color: var(--section-headline-color); }
        h3 { color: var(--heading-color); }
        
        a { color: var(--link-color); text-decoration: none; transition: color 0.3s ease; }
        a:hover { color: var(--link-hover-color); text-decoration: underline; }

        .container { max-width: 1200px; margin: 0 auto; padding: 0 2rem; }
        .post-container { max-width: 800px; margin: 0 auto; padding: 0 1rem; }

        /* --- Navbar Styles --- */
        .navbar { /* ... (Same as previous draft) ... */ }
        .navbar-brand { /* ... (Same as previous draft) ... */ }
        .nav-links { /* ... (Same as previous draft) ... */ }
        .nav-links .active-link { /* ... (Same as previous draft) ... */ }
        .hamburger { /* ... (Same as previous draft) ... */ }
        
        /* --- Footer Styles --- */
        .footer { /* ... (Same as previous draft) ... */ }

        /* --- Single Post Styles --- */
        .post-header { border-bottom: 1px solid var(--border-color); padding-bottom: 1.5rem; margin-bottom: 2rem; }
        .post-tag { background-image: var(--button-bg); color: var(--button-text-color); }
        
        .article-content blockquote {
            border-left: 4px solid var(--link-color);
            background: var(--card-bg);
            padding: 1.5rem; margin: 2rem 0; border-radius: 4px;
        }
        .article-content ul, .article-content ol { padding-left: 1.5rem; margin-bottom: 1.5rem; }
        
        /* --- Audio Player (Custom Aesthetic) --- */
        .audio-player-container {
            background: var(--card-bg); border: 1px solid var(--border-color);
            padding: 1.25rem; border-radius: 8px; margin-bottom: 2.5rem;
            display: flex; flex-direction: column; gap: 1rem;
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.1);
        }
        .audio-controls-row {
            display: flex; align-items: center; justify-content: space-between; gap: 1rem;
        }
        .custom-audio-bar {
            flex-grow: 1; height: 10px; background: var(--border-color); border-radius: 5px; cursor: pointer;
            position: relative; overflow: hidden;
        }
        .progress-indicator {
            height: 100%; width: 0; background: var(--link-color); transition: none;
        }
        .time-display {
            font-size: 0.9rem; color: #aaa; min-width: 100px; text-align: right;
        }
        .audio-play-btn {
            background: var(--button-bg); color: var(--button-text-color); border: none;
            padding: 0.8rem 1.5rem; border-radius: 25px; cursor: pointer; font-weight: 700;
            font-family: 'Orbitron', sans-serif; font-size: 1rem; transition: all 0.3s ease;
            text-transform: uppercase;
        }
        .audio-play-btn:hover { box-shadow: 0 0 10px var(--cyan-glow); }
        
        /* --- Word Highlighting --- */
        .word-highlight {
            background-color: var(--highlight-color);
            padding: 0 1px; border-radius: 2px;
            transition: background-color 0.1s;
        }

        /* --- Authentication and Comment Styles --- */
        .comments-wrapper { margin-top: 4rem; padding-top: 2rem; border-top: 1px solid var(--border-color); }
        .auth-container, .comment-form-container {
            background: var(--card-bg); border: 1px solid var(--border-color);
            padding: 2rem; border-radius: 8px; margin-bottom: 3rem;
        }
        .auth-toggle-btn { /* ... (Styled as secondary button) ... */ }
        .auth-form { margin-top: 1rem; }
        .auth-form button { margin-top: 1rem; }
        .auth-notice { background: var(--link-color); color: var(--button-text-color); padding: 1rem; border-radius: 4px; text-align: center; font-weight: 600; }
        .google-signin-btn {
            background-color: #4285F4; color: white; border: none;
            padding: 0.8rem 1.5rem; border-radius: 25px; cursor: pointer; margin-top: 1rem;
            width: 100%; font-weight: 600;
        }
        
        .comment { /* ... (Same as previous draft) ... */ }
        .comment-user { color: var(--link-color); font-weight: 600; display: flex; align-items: center; gap: 0.5rem; }
        .comment-avatar { 
            background: var(--link-color); color: var(--button-text-color); flex-shrink: 0; 
            width: 45px; height: 45px; border-radius: 50%; object-fit: cover;
        }
        .verified-badge { 
            color: var(--cyan-glow); font-size: 0.9em; margin-left: 5px;
            background: var(--card-bg); padding: 2px 5px; border-radius: 4px;
            border: 1px solid var(--cyan-glow);
        }
        .admin-badge {
            color: gold; font-size: 0.9em; margin-left: 5px;
            background: #444; padding: 2px 5px; border-radius: 4px;
            border: 1px solid gold;
        }
        .comment-actions button {
            background: var(--card-bg); border: 1px solid var(--border-color);
            color: var(--text-color); padding: 0.3rem 0.8rem; border-radius: 15px;
            cursor: pointer; margin-right: 0.5rem; transition: all 0.2s;
        }
        .comment-actions button.active { background: var(--link-color); color: var(--button-text-color); border-color: var(--link-color); }
        .reply-box { margin-top: 1rem; padding-left: 1rem; }
        .replies-container { border-left: 2px solid var(--border-color); padding-left: 1.5rem; margin-top: 1.5rem; }
        .reply { margin-bottom: 1rem; display: flex; gap: 1rem; }
        .reply img { width: 30px; height: 30px; border-radius: 50%; }
    </style>
</head>
<body>
    
    <header class="navbar">
        <div class="container">
            <a href="index.html" class="navbar-brand">Elvion AI</a>
            
            <div class="nav-controls">
                <nav class="nav-links">
                    <li><a href="university.html">University</a></li>
                    <li><a href="blog.html" class="active-link">Blog</a></li>
                    <li><a href="about.html">About Us</a></li>
                </nav>
                <button id="theme-toggle" aria-label="Toggle theme">
                    <i class="fas fa-sun"></i> 
                </button>
                <button class="hamburger" aria-label="Toggle navigation">
                    <span class="bar"></span>
                    <span class="bar"></span>
                    <span class="bar"></span>
                </button>
            </div>
        </div>
    </header>

    <main class="post-main">
        <div class="post-container">

            <header class="post-header">
                <span class="post-tag">Creative Writing</span>
                <h1>How to Craft Unforgettable Characters: A Writer's Guide</h1>
                <div class="post-meta">
                    <span><i class="fas fa-user-edit"></i> By Elvion AI Staff</span>
                    <span><i class="fas fa-calendar-alt"></i> Nov 5, 2025</span>
                    <span id="estimated-time"><i class="fas fa-clock"></i> 8 min read</span>
                </div>
            </header>

            <div class="post-thumbnail-placeholder">
                <i class="fas fa-feather-pointed"></i>
            </div>
            
            <section class="audio-player-container">
                <div style="display: flex; align-items: center; justify-content: space-between;">
                    <span id="reading-time" style="color: var(--link-color);">Duration: 8:00</span>
                    <select id="voice-select" class="form-input" style="width: 250px; margin: 0; flex-grow: 0;">
                        <option value="audios/a5cae336-01dd-431b-b388-9a319258d85f.wav" selected>Philadelphia AI (Female) ‚ôÄÔ∏è</option>
                        <option value="audios/c72d8fbf-8a99-451d-b94c-8d7c8ffef5e5.wav">Funny Daddy (Male) ‚ôÇÔ∏è</option>
                    </select>
                </div>

                <div class="audio-controls-row">
                    <button id="audio-play-pause-btn" class="audio-play-btn">
                        <i class="fas fa-play"></i>
                    </button>
                    <div class="custom-audio-bar" id="audio-bar">
                        <div class="progress-indicator" id="progress-indicator"></div>
                    </div>
                    <span class="time-display" id="current-time">0:00 / 8:00</span>
                </div>
                
                <audio id="article-audio" preload="auto" style="display:none;"></audio>
            </section>
            <article class="article-content" id="article-content">
                <p>Your characters are the <b>heart</b> of your story. They are the vessels through which your reader experiences the world you've built, the conflicts you've crafted, and the emotions you want to evoke. A weak plot can sometimes be saved by compelling characters, but even the most brilliant plot will fall flat if the characters feel like cardboard cutouts. So, how do you create three-dimensional, <b>unforgettable characters</b> that leap off the page? üöÄ</p>

                <h2>1. Beyond the Surface: The Iceberg Method üßä</h2>
                <p>What we see of a character‚Äîtheir appearance, their job, their actions‚Äîis just the tip of the iceberg. The real substance lies beneath the surface. This is their <b>backstory</b>. You don't need to dump all of this information on the reader (in fact, please don't!) ü§£ü§£ü§£, but <i>you</i> need to know it. What was their childhood like? What's their biggest regret? What is the secret they've never told anyone? This hidden weight informs their every decision, fear, and desire.</p>

                <blockquote>
                    <b>Pro-Tip:</b> Ask yourself: What is the single most important event that shaped my character into who they are today? How does it affect their behavior in Chapter 1? ü§î
                </blockquote>

                <h2>2. Give Them Flaws (Real Ones) üíî</h2>
                <p>Perfection is boring. A character who is always right, always strong, and always kind is not relatable‚Äîthey're annoying. Real people are messy. They are impatient, they are selfish, they are afraid of spiders, they procrastinate. A flaw makes a character human. More importantly, a a character's <b>fatal flaw</b> is often the engine of the plot. It's the internal obstacle they must overcome to achieve their external goal. Is your hero brave? Make them reckless. Is your heroine brilliant? Make her arrogant. ‚ú®</p>

                <h2>3. Wants vs. Needs üéØ</h2>
                <p>This is a classic writing technique for a reason. Every compelling character has two goals:</p>
                
                <ul>
                    <li><b>The Want:</b> This is the external, conscious goal. It's what the character <i>thinks</i> they need to be happy. (e.g., "I want to win the championship.") üèÜ</li>
                    <li><b>The Need:</b> This is the internal, often subconscious truth. It's what the character <i>actually</i> needs to grow as a person. (e.g., "I need to learn to trust my teammates.") ü§ù</li>
                </ul>

                <p>The best stories create conflict by putting the Want and the Need at odds. The character's journey (their "arc") is complete when they either sacrifice their Want to achieve their Need, or finally realize that what they Needed was the key to getting what they Wanted all along.</p>
                
                <h2>4. Let Their Voice Be Heard üó£Ô∏è</h2>
                <p>How does your character speak? Their <b>dialogue</b> is a window into their soul. A character's voice is more than just an accent; it's their word choice, their sentence structure, their rhythm, and what they choose to say (or not say).</p>
                
                <h3>Quick Voice Tips:</h3>
                <ul>
                    <li>An educated professor might use complex sentences and precise vocabulary. üßê</li>
                    <li>A nervous teenager might speak in short, halting sentences, using a lot of "like" or "um." üò¨</li>
                    <li>A cynical detective might use dry, sarcastic wit. ‚òï</li>
                </ul>
                <p>Try this exercise: Write a scene with two characters arguing, but remove all dialogue tags ("he said," "she yelled"). Can you tell who is speaking just by their words and rhythm? If so, you're on the right track.</p>

                <h2>5. Make Them Act: Decisions Define Character üé¨</h2>
                <p>Don't just <i>tell</i> us your character is brave; put them in a situation where they must <b>choose</b> to be brave, especially when it's hard. Character is revealed through <b>action and choice</b>, especially choices made under pressure. The harder the choice, the more we learn about who they really are. A character who chooses to run into a burning building is defined by that action in a way no amount of descriptive prose ever could. üî•ü¶∏</p>
                
                <p>Ultimately, an unforgettable character feels <b>real</b>. They are a bundle of contradictions, flaws, desires, and secrets, just like us. By digging deep into their past, understanding their internal conflicts, and letting them express themselves through a unique voice, you can create characters that readers will carry with them long after the final page. üíñ</p>
            </article>

            <section class="comments-wrapper" id="comments">
                <h2>üí¨ Join the Conversation (<span id="comment-count">0</span>)</h2>

                <div class="auth-container" id="auth-container">
                    <div class="auth-toggle" style="display: flex; justify-content: center; gap: 1rem; margin-bottom: 1.5rem;">
                        <button id="auth-toggle-login" class="btn-primary" style="width: 150px;">Login</button>
                        <button id="auth-toggle-signup" class="btn-primary" style="width: 150px;">Sign Up</button>
                    </div>

                    <form id="auth-form" class="auth-form">
                        <div id="auth-username-group" style="display:none;">
                            <label for="auth-username" class="form-label">Username</label>
                            <input type="text" id="auth-username" class="form-input" placeholder="Choose a display name">
                        </div>
                        <div>
                            <label for="auth-email" class="form-label">Email</label>
                            <input type="email" id="auth-email" class="form-input" placeholder="you@example.com" required>
                        </div>
                        <div>
                            <label for="auth-password" class="form-label">Password</label>
                            <input type="password" id="auth-password" class="form-input" placeholder="Min. 6 characters" required>
                        </div>
                        <button type="submit" id="auth-submit-button" class="btn-primary">Login</button>
                        <p id="auth-error" style="color: red; margin-top: 1rem;"></p>
                    </form>
                    
                    <button id="google-signin-btn" class="google-signin-btn">
                        <i class="fab fa-google"></i> Sign in with Google
                    </button>
                </div>
                
                <div class="comment-form-container" id="comment-form-container" style="display: none;">
                    <div class="auth-notice" id="signed-in-as"></div>
                    <h3>Leave a Comment</h3>
                    <textarea id="comment-input" class="form-input" placeholder="Share your thoughts... You can use HTML links like <a href='...'>link</a>"></textarea>
                    <button id="comment-button" class="btn-primary" style="width: 100%;">Post Comment</button>
                    <button id="sign-out-btn" class="btn-primary" style="background: #a00; margin-top: 0.5rem; width: 100%;">Sign Out</button>
                </div>

                <div id="comment-list-container">
                    <div id="comment-list">
                        <p class="loading-message" style="text-align: center; color: #777;">Loading comments...</p>
                    </div>
                </div>

            </section>

        </div>
    </main>

    <footer class="footer">
        <div class="container">
            <div class="col">
                <span class="brand-info">Elvion AI</span>
                <p>Where Assistance Meets Excellence.</p>
            </div>
            <div class="col">
                <h4>Quick Links</h4>
                <ul>
                    <li><a href="index.html#hero">Home</a></li>
                    <li><a href="blog.html">Blog</a></li>
                    <li><a href="university.html">University</a></li>
                </ul>
            </div>
            <div class="col">
                <h4>Company</h4>
                <ul>
                    <li><a href="about.html">About Us</a></li>
                    <li><a href="mailto:contact@elvionai.com">Contact Us</a></li>
                </ul>
            </div>
            <div class="col">
                <h4>Legal</h4>
                <ul>
                    <li><a href="privacy.html">Privacy Policy</a></li>
                    <li><a href="terms.html">Terms of Service</a></li>
                </ul>
            </div>
            <div class="legal-info">
                &copy; <span id="current-year-footer"></span> Elvion AI. All rights reserved.
            </div>
        </div>
    </footer>

    <script>
        // --- Theme Toggle Script & Hamburger ---
        document.addEventListener('DOMContentLoaded', () => {
            const body = document.body;
            const toggleButton = document.getElementById('theme-toggle');
            const hamburger = document.querySelector('.hamburger');
            const navLinks = document.querySelector('.nav-links');

            const savedTheme = localStorage.getItem('theme') || 'dark';

            function applyTheme(theme) {
                if (theme === 'light') {
                    body.classList.add('light-theme');
                    toggleButton.innerHTML = '<i class="fas fa-moon"></i>';
                } else {
                    body.classList.remove('light-theme');
                    toggleButton.innerHTML = '<i class="fas fa-sun"></i>';
                }
                localStorage.setItem('theme', theme);
            }

            applyTheme(savedTheme);

            toggleButton.addEventListener('click', () => {
                const currentTheme = body.classList.contains('light-theme') ? 'light' : 'dark';
                const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
                applyTheme(newTheme);
            });

            hamburger.addEventListener('click', () => {
                hamburger.classList.toggle('active');
                navLinks.classList.toggle('active');
            });
            navLinks.querySelectorAll('a').forEach(link => {
                link.addEventListener('click', () => {
                    if (window.innerWidth <= 992) {
                        hamburger.classList.remove('active');
                        navLinks.classList.remove('active');
                    }
                });
            });

            document.getElementById('current-year-footer').textContent = new Date().getFullYear();
        });
    </script>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const audio = document.getElementById('article-audio');
            const playPauseBtn = document.getElementById('audio-play-pause-btn');
            const voiceSelect = document.getElementById('voice-select');
            const progressBar = document.getElementById('progress-indicator');
            const audioBar = document.getElementById('audio-bar');
            const currentTimeEl = document.getElementById('current-time');
            const readTimeEl = document.getElementById('reading-time');
            
            // Initial setup
            const initialVoice = voiceSelect.value;
            audio.src = initialVoice;
            audio.load();

            // --- Time Formatting ---
            const formatTime = (seconds) => {
                const min = Math.floor(seconds / 60);
                const sec = Math.floor(seconds % 60);
                return `${min}:${sec.toString().padStart(2, '0')}`;
            };

            // --- Player Controls ---
            playPauseBtn.addEventListener('click', () => {
                if (audio.paused || audio.ended) {
                    audio.play();
                    playPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
                } else {
                    audio.pause();
                    playPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
                }
            });

            voiceSelect.addEventListener('change', () => {
                audio.src = voiceSelect.value;
                audio.load();
                if (!audio.paused) {
                    audio.play(); // Resume playback with new voice
                }
            });

            // --- Progress Updates (Simulated Highlighting) ---
            audio.addEventListener('loadedmetadata', () => {
                const duration = audio.duration;
                readTimeEl.textContent = `Duration: ${formatTime(duration)}`;
                currentTimeEl.textContent = `0:00 / ${formatTime(duration)}`;
            });

            audio.addEventListener('timeupdate', () => {
                const duration = audio.duration;
                const currentTime = audio.currentTime;
                
                // Update progress bar
                const progressPercent = (currentTime / duration) * 100;
                progressBar.style.width = `${progressPercent}%`;
                
                // Update time display
                currentTimeEl.textContent = `${formatTime(currentTime)} / ${formatTime(duration)}`;

                // --- Simulated Highlighting Logic ---
                // NOTE: Since Web Audio API doesn't provide word boundaries, 
                // this is a simulated function. You would replace this with actual 
                // data from your audio/transcript service (like AWS Polly, Google TTS).
                // Example: Divide the article text into 50 major chunks and highlight 
                // one chunk every (Duration / 50) seconds.
                
                const articleWords = articleContent.textContent.trim().split(/\s+/).filter(w => w.length > 0);
                const totalWords = articleWords.length;
                const wordsPerSecond = totalWords / duration;
                
                // Estimate which word index we're currently on
                const estimatedWordIndex = Math.floor(currentTime * wordsPerSecond);

                // Simple highligting: wrap the current estimated word
                if (estimatedWordIndex < totalWords) {
                    const allText = articleContent.innerHTML;
                    
                    // Cleanup previous highlights
                    articleContent.innerHTML = allText.replace(/<span class="word-highlight">([^<]+)<\/span>/g, '$1');
                    
                    // Get text node content to highlight the target word
                    const p = articleContent.querySelector('p'); // Simplified to first paragraph
                    if (p) {
                         const targetWord = articleWords[estimatedWordIndex];
                         const regex = new RegExp(`(?<!<[^>]*>)(\\b${targetWord.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')}\\b)`, 'i');
                         
                         // Re-highlight the estimated word in the current visible element
                         p.innerHTML = p.innerHTML.replace(regex, `<span class="word-highlight">${targetWord}</span>`);
                    }
                }
            });

            audio.addEventListener('ended', () => {
                playPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
                progressBar.style.width = '0%';
                currentTimeEl.textContent = `0:00 / ${formatTime(audio.duration)}`;
            });

            // Seek functionality
            audioBar.addEventListener('click', (e) => {
                const clickPosition = (e.offsetX / audioBar.offsetWidth);
                audio.currentTime = audio.duration * clickPosition;
            });
        });
    </script>


    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <script>
        // --- 1. CONFIGURATION & INIT ---
        const firebaseConfig = {
            apiKey: "AIzaSyAyROm0aBGjry6NUfhNM3e0qwPcCDoIqSk",
            authDomain: "elvionai.firebaseapp.com",
            projectId: "elvionai",
            storageBucket: "elvionai.firebasestorage.app",
            messagingSenderId: "161078300830",
            appId: "1:161078300830:web:f460df8591704eb0e96b8f"
        };
        
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        let currentUser = null;
        const ARTICLE_ID = 'crafting-characters-01';
        const ADMIN_EMAIL = 'koladhino@gmail.com';

        // --- 2. DOM ELEMENTS ---
        const authContainer = document.getElementById('auth-container');
        const authForm = document.getElementById('auth-form');
        const commentFormContainer = document.getElementById('comment-form-container');
        const commentList = document.getElementById('comment-list');
        const commentCountEl = document.getElementById('comment-count');
        const signedInAsEl = document.getElementById('signed-in-as');
        const googleSignInBtn = document.getElementById('google-signin-btn');
        const signOutBtn = document.getElementById('sign-out-btn');

        // --- 3. AUTH LOGIC ---
        
        function toggleAuthForm(isLogin) {
            document.getElementById('auth-error').textContent = '';
            document.getElementById('auth-toggle-login').style.backgroundColor = isLogin ? 'var(--link-color)' : 'var(--card-bg)';
            document.getElementById('auth-toggle-signup').style.backgroundColor = !isLogin ? 'var(--link-color)' : 'var(--card-bg)';
            document.getElementById('auth-username-group').style.display = isLogin ? 'none' : 'block';
            document.getElementById('auth-submit-button').textContent = isLogin ? 'Login' : 'Sign Up';
        }

        auth.onAuthStateChanged(user => {
            currentUser = user;
            if (user) {
                authContainer.style.display = 'none';
                commentFormContainer.style.display = 'block';
                signedInAsEl.innerHTML = `<i class="fas fa-user-check"></i> Signed in as <strong>${user.displayName || user.email}</strong>.`;
            } else {
                authContainer.style.display = 'block';
                commentFormContainer.style.display = 'none';
                toggleAuthForm(true);
            }
        });

        authForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = authForm['auth-email'].value;
            const password = authForm['auth-password'].value;
            const isLogin = authForm['auth-submit-button'].textContent === 'Login';
            const authError = document.getElementById('auth-error');
            authError.textContent = '';

            try {
                if (isLogin) {
                    await auth.signInWithEmailAndPassword(email, password);
                } else {
                    const username = authForm['auth-username'].value;
                    if (!username) { authError.textContent = 'Please enter a username.'; return; }

                    const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                    await userCredential.user.updateProfile({ 
                        displayName: username, 
                        photoURL: `https://api.dicebear.com/8.x/initials/svg?seed=${username}`
                    });
                }
            } catch (error) {
                authError.textContent = error.message;
            }
        });
        
        googleSignInBtn.addEventListener('click', async () => {
            const provider = new firebase.auth.GoogleAuthProvider();
            try {
                await auth.signInWithPopup(provider);
            } catch (error) {
                document.getElementById('auth-error').textContent = error.message;
            }
        });
        
        signOutBtn.addEventListener('click', () => {
            auth.signOut();
        });

        document.getElementById('auth-toggle-login').addEventListener('click', () => toggleAuthForm(true));
        document.getElementById('auth-toggle-signup').addEventListener('click', () => toggleAuthForm(false));

        // --- 4. COMMENT SUBMISSION ---
        document.getElementById('comment-button').addEventListener('click', async () => {
            if (!currentUser) { alert("Please sign in to comment."); return; }

            const commentText = document.getElementById('comment-input').value.trim();
            if (!commentText) return;
            
            const submitBtn = document.getElementById('comment-button');
            submitBtn.disabled = true;

            const commentData = {
                text: commentText,
                userName: currentUser.displayName || currentUser.email.split('@')[0],
                userProfilePic: currentUser.photoURL || `https://api.dicebear.com/8.x/initials/svg?seed=${currentUser.displayName || currentUser.email}`,
                userId: currentUser.uid,
                timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                articleId: ARTICLE_ID,
                replies: [],
                likes: [],
            };

            try {
                await db.collection('comments').add(commentData);
                document.getElementById('comment-input').value = '';
            } catch (error) {
                console.error("Error posting comment: ", error);
                alert('Failed to post comment. Check console.');
            } finally {
                submitBtn.disabled = false;
            }
        });

        // --- 5. COMMENT RENDERING & REALTIME ---

        function setupRealtimeComments() {
            db.collection('comments')
                .where("articleId", "==", ARTICLE_ID)
                .orderBy("timestamp", "desc")
                .onSnapshot(snapshot => {
                    commentList.innerHTML = '';
                    const size = snapshot.size;
                    commentCountEl.textContent = size;

                    if (size === 0) {
                        commentList.innerHTML = `<p class="loading-message">No comments yet. Be the first!</p>`;
                        return;
                    }
                    
                    snapshot.forEach((doc) => {
                        commentList.appendChild(renderComment(doc));
                    });
                }, error => {
                    console.error("Error fetching comments:", error);
                    commentList.innerHTML = `<p class="loading-message" style="color: red;">Failed to load comments. Check Firestore Rules.</p>`;
                });
        }

        function renderComment(doc) {
            const comment = doc.data();
            const commentId = doc.id;
            const li = document.createElement('li');
            li.className = 'comment';
            
            const isCurrentUser = currentUser && currentUser.uid === comment.userId;
            const isAdmin = comment.userName === 'koladhino' || comment.email === ADMIN_EMAIL || comment.userId === 'ADMIN_UID_PLACEHOLDER';
            const hasLiked = currentUser && comment.likes && comment.likes.includes(currentUser.uid);
            
            const defaultAvatar = `https://api.dicebear.com/8.x/initials/svg?seed=${comment.userName}`;
            
            let badges = '';
            if (isAdmin) {
                badges += `<span class="admin-badge" title="Admin">üëë Admin</span>`;
            } else if (isCurrentUser) {
                 badges += `<span class="verified-badge" title="Verified User">‚úî</span>`;
            } else if (comment.userId !== 'guest') {
                 badges += `<span class="verified-badge" title="Verified User">‚úî</span>`;
            }

            let repliesHtml = '';
            if (comment.replies && comment.replies.length > 0) {
                comment.replies.forEach(reply => {
                    const replyTimestamp = reply.timestamp ? new Date(reply.timestamp.toDate()).toLocaleString() : 'Just now';
                    const replyAvatar = reply.userProfilePic || `https://api.dicebear.com/8.x/initials/svg?seed=${reply.userName}`;
                    const replyIsAdmin = reply.userName === 'koladhino'; // Simplified check
                    
                    repliesHtml += `
                        <div class="reply">
                            <img src="${replyAvatar}" alt="Reply Avatar" class="comment-avatar" style="width: 30px; height: 30px;" />
                            <div style="flex-grow: 1;">
                                <span class="comment-user" style="font-size: 0.9rem;">
                                    ${escapeHtml(reply.userName)}
                                    ${replyIsAdmin ? '<span class="admin-badge">üëë Admin</span>' : ''}
                                </span>
                                <p class="comment-text" style="font-size: 0.95rem;">${cleanAndLinkify(reply.text)}</p>
                                <div class="comment-meta">${replyTimestamp}</div>
                            </div>
                        </div>
                    `;
                });
            }

            li.innerHTML = `
                <img src="${comment.userProfilePic || defaultAvatar}" alt="Profile Pic" class="comment-avatar" />
                <div style="flex-grow: 1;">
                    <span class="comment-user">
                        ${escapeHtml(comment.userName)} ${badges}
                    </span>
                    <p class="comment-text">${cleanAndLinkify(comment.text)}</p>
                    <div class="comment-meta">
                        ${new Date(comment.timestamp.toDate()).toLocaleString()}
                    </div>
                    <div class="comment-actions" data-id="${commentId}">
                        <button class="like-button ${hasLiked ? 'active' : ''}">
                            <i class="fas fa-thumbs-up"></i> (${comment.likes ? comment.likes.length : 0})
                        </button>
                        <button class="reply-button">
                            <i class="fas fa-reply"></i> Reply
                        </button>
                    </div>
                    
                    <div class="reply-box" id="reply-box-${commentId}" style="display: none;">
                        <textarea class="form-input" placeholder="Write a reply..."></textarea>
                        <button class="submit-reply-button btn-primary" style="padding: 0.5rem 1rem; margin-top: 0.5rem; font-size: 0.85rem;">Submit Reply</button>
                    </div>

                    ${repliesHtml ? `<div class="replies-container">${repliesHtml}</div>` : ''}
                </div>
            `;
            return li;
        }

        // --- 6. EVENT DELEGATION (Actions) ---
        commentList.addEventListener('click', async (e) => {
            if (!currentUser) { alert("Please log in to interact."); return; }

            const button = e.target.closest('button');
            if (!button) return;
            
            const commentActions = e.target.closest('.comment-actions');
            const commentContent = e.target.closest('li.comment'); // Get the whole comment item

            if (commentActions) {
                const commentId = commentActions.dataset.id;
                const commentRef = db.collection('comments').doc(commentId);

                if (button.classList.contains('like-button')) {
                    toggleArrayVote(commentRef, 'likes', currentUser.uid);
                } else if (button.classList.contains('reply-button')) {
                    const replyBox = commentContent.querySelector(`#reply-box-${commentId}`);
                    replyBox.style.display = replyBox.style.display === 'none' ? 'block' : 'none';
                }
            }
            
            if (button.classList.contains('submit-reply-button')) {
                const replyBox = e.target.closest('.reply-box');
                const commentId = e.target.closest('li.comment').querySelector('.comment-actions').dataset.id;
                const commentRef = db.collection('comments').doc(commentId);
                const replyTextarea = replyBox.querySelector('textarea');
                const replyText = replyTextarea.value.trim();
                
                if (!replyText) return;
                
                const replyData = {
                    text: replyText,
                    userName: currentUser.displayName || currentUser.email.split('@')[0],
                    userProfilePic: currentUser.photoURL || `https://api.dicebear.com/8.x/initials/svg?seed=${currentUser.displayName || currentUser.email}`,
                    userId: currentUser.uid,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                };

                try {
                    await commentRef.update({
                        replies: firebase.firestore.FieldValue.arrayUnion(replyData)
                    });
                    replyTextarea.value = '';
                    replyBox.style.display = 'none';
                } catch (error) {
                    console.error("Error adding reply: ", error);
                }
            }
        });
        
        async function toggleArrayVote(docRef, fieldName, userId) {
            const docSnap = await docRef.get();
            if (!docSnap.exists) return;
            
            const data = docSnap.data();
            const array = data[fieldName] || [];
            
            const updateData = array.includes(userId) ? { [fieldName]: firebase.firestore.FieldValue.arrayRemove(userId) }
                                                    : { [fieldName]: firebase.firestore.FieldValue.arrayUnion(userId) };
            
            await docRef.update(updateData);
        }

        // --- 7. UTILITIES ---
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Allows basic HTML (like <a>) but sanitizes dangerous tags/attributes
        function cleanAndLinkify(text) {
            // Basic linkify for demonstration (better to use a dedicated library)
            let linkedText = text.replace(/(https?:\/\/[^\s]+)/g, (url) => {
                return `<a href="${url}" target="_blank">${url}</a>`;
            });

            // Basic HTML sanitization (allow only <b>, <i>, <a>)
            const allowedTags = ['b', 'i', 'a'];
            const temp = document.createElement('div');
            temp.innerHTML = linkedText;

            Array.from(temp.querySelectorAll('*')).forEach(node => {
                if (!allowedTags.includes(node.tagName.toLowerCase())) {
                    node.remove();
                } else if (node.tagName.toLowerCase() === 'a') {
                    // Only allow safe attributes on links
                    Array.from(node.attributes).forEach(attr => {
                        if (attr.name !== 'href' && attr.name !== 'target') {
                            node.removeAttribute(attr.name);
                        }
                    });
                }
            });

            return temp.innerHTML;
        }

        // Initial setup calls
        document.addEventListener('DOMContentLoaded', () => {
            setupRealtimeComments();
        });
    </script>
</body>
</html>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-J1YTKP10ZX"></script>
<script>
¬† window.dataLayer = window.dataLayer || [];
¬† function gtag(){dataLayer.push(arguments);}
¬† gtag('js', new Date()); 

¬† gtag('config', 'G-J1YTKP10ZX');
</script>
