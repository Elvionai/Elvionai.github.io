<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>User Profile â€” Elvion AI</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Edit your profile, upload a new picture, and update personal details.">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Orbitron:wght@700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    body {
      background: radial-gradient(circle at 60% 20%, #23233a 60%, #0a1128 100%);
      min-height: 100vh;
      font-family: 'Inter', sans-serif;
      color: #e0e0e0;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    #stars-container {
      position: fixed; width: 100vw; height: 100vh; top: 0; left: 0; z-index: 0; pointer-events: none;
    }
    .star { position: absolute; background: rgba(255,255,255,0.7); border-radius: 50%; opacity: 0; animation: twinkle 4.9s infinite linear;}
    @keyframes twinkle { 0%,100%{opacity:.18;} 52%{opacity:1;}}
    .profile-card {
      background: rgba(18,26,48,0.97); border-radius: 18px;
      box-shadow: 0 0 13px #00fff2bb, 0 0 18px #2323ff22;
      padding: 32px 28px 22px 28px;
      max-width: 340px; width:100%; margin:30px auto 0 auto;
      display: flex; flex-direction: column; gap: 1.3em; z-index: 2;
      position: relative; animation: fadeIn .7s;
    }
    @keyframes fadeIn {from{opacity:0;transform:translateY(20px);} to{opacity:1;transform:translateY(0);}}
    .profile-top {
      text-align: center; display: flex; flex-direction:column; align-items:center; gap:8px; margin-bottom:4px;
    }
    .logo-img {
      width: 56px; height: 56px; border-radius: 50%;
      background: #fff; object-fit:cover;
      animation: logoPulse 3.3s infinite alternate, floatLogo 3.4s infinite alternate;
      box-shadow: 0 0 17px #00ffff66;
      margin:0 auto 10px auto;
    }
    @keyframes logoPulse {0%{box-shadow: 0 0 11px #00e2ff,0 0 24px #70fff7;}100%{box-shadow:0 0 19px #007c97,0 0 33px #00ceff60;}}
    @keyframes floatLogo {0%{transform:translateY(0);}100%{transform:translateY(-7px);}}
    .site-heading {
      font-family:'Orbitron',sans-serif;font-size:1.25em;font-weight:800;letter-spacing:.03em;
      background: linear-gradient(90deg, #00ffff, #fff, #0090ff);
      background-size:200% auto; -webkit-background-clip:text; -webkit-text-fill-color:transparent;
      animation: shine 4s linear infinite;
      text-shadow: 0 0 17px #00ffff24; margin-bottom:0;
    }
    @keyframes shine {to{background-position:200% center;}}
    .profile-msg { color: #aee; font-size: .97em; margin-bottom: 10px;}
    .edit-form { display: flex; flex-direction: column; gap: 12px;}
    label { color: #00ffff; font-size: .99em; margin-bottom: 2px;}
    input, select {
      padding: 9px; border-radius: 8px; border: 1px solid #213; background: #181d2c;
      color: #eee; font-size: 1em; outline: none; font-weight:550; transition: border 0.13s;
    }
    input:focus, select:focus { border-color: #00ffff;}
    .submit-btn {
      width:100%; background: linear-gradient(97deg, #00ffff, #0090ff);
      color: #102040; border: none; border-radius: 10px; padding: 10px 0;
      font-size: 1.07em; font-family: 'Orbitron',sans-serif; font-weight: bold; margin-top: 2px; cursor: pointer;
      box-shadow: 0 0 13px #00fff2bb, 0 0 18px #2323ff22;
      text-transform:uppercase; letter-spacing:.02em; margin-top:4px;
    }
    .submit-btn:hover { background: #0090ff; color: #fff;}
    .status-message { color: #ffd700; font-size: 1em; min-height: 18px; margin-top: 2px; text-align:center;}
    .profile-photo-tip {
      color: #b3b3b3; font-size: .93em; margin-bottom: 8px; text-align: center;
    }
    @media (max-width:440px) {.profile-card{padding:10vw 2vw;} .site-heading{font-size:1em;}}
  </style>
</head>
<body>
<div id="stars-container"></div>
<div class="profile-card">
  <div class="profile-top">
    <img id="profilePic" src="https://i.ibb.co/YTkKPfvf/IMG-20250715-102103-129.jpg" class="logo-img" alt="Profile photo">
    <div class="site-heading">Elvion AI</div>
    <div class="profile-msg">Edit your profile below.<br>
      <span class="profile-photo-tip">Want to change profile photo? Upload to <a href="https://postimg.cc/" target="_blank" style="color: #00ffff;">postimg.cc</a> and paste the direct image link!</span>
    </div>
  </div>
  <form class="edit-form" id="profileForm" autocomplete="off">
    <label for="edit-name">Full Name</label>
    <input type="text" id="edit-name" placeholder="Full Name">
    <label for="edit-photo">Profile Photo URL</label>
    <input type="url" id="edit-photo" placeholder="Paste image link">
    <label for="edit-country">Country</label>
    <input type="text" id="edit-country" placeholder="Country">
    <label for="edit-dob">Date of Birth</label>
    <input type="date" id="edit-dob">
    <label for="edit-hobby">Hobby</label>
    <input type="text" id="edit-hobby" placeholder="e.g. Reading, Coding">
    <button type="submit" class="submit-btn">Save Profile</button>
    <div class="status-message" id="statusMsg"></div>
  </form>
</div>
<script type="module">
  // Animated background
  document.addEventListener('DOMContentLoaded',()=>{
    const starsContainer = document.getElementById('stars-container');
    const numStars = 49, minSize=1, maxSize=2.2;
    for(let i=0; i<numStars; i++) {
      const star=document.createElement('div');
      star.className='star';
      const size = Math.random()*(maxSize-minSize)+minSize;
      star.style.width=size+'px';
      star.style.height=size+'px';
      star.style.left=Math.random()*100+'%';
      star.style.top=Math.random()*100+'%';
      star.style.animationDelay=(Math.random()*3.8)+'s';
      star.style.animationDuration=(2.4+Math.random()*1.5)+'s';
      starsContainer.appendChild(star);
    }
  });

  // Firebase User/Profile Logic
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
  import { getAuth, onAuthStateChanged, updateProfile } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-auth.js";
  import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAyROm0aBGjry6NUfhNM3e0qwPcCDoIqSk",
    authDomain: "elvionai.firebaseapp.com",
    projectId: "elvionai",
    storageBucket: "elvionai.firebasestorage.app",
    messagingSenderId: "161078300830",
    appId: "1:161078300830:web:f460df8591704eb0e96b8f"
  };
  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  let currentUser;
  // Load profile and Firestore data
  onAuthStateChanged(auth, async (user) => {
    if (!user) window.location.href = "signup-login.html";
    currentUser = user;
    // Fill fields from Auth
    document.getElementById("edit-name").value = user.displayName || "";
    document.getElementById("edit-photo").value = user.photoURL || "";
    document.getElementById("profilePic").src = user.photoURL || "https://i.ibb.co/YTkKPfvf/IMG-20250715-102103-129.jpg";
    // Load Firestore custom fields
    const userDoc = await getDoc(doc(db, "users", user.uid));
    if (userDoc.exists()) {
      const data = userDoc.data();
      document.getElementById("edit-country").value = data.country || "";
      document.getElementById("edit-dob").value = data.dob || "";
      document.getElementById("edit-hobby").value = data.hobby || "";
    }
  });

  // Enable photo preview on typing
  document.getElementById("edit-photo").addEventListener("input", function() {
    document.getElementById("profilePic").src = this.value || "https://i.ibb.co/YTkKPfvf/IMG-20250715-102103-129.jpg";
  });

  // Save changes
  document.getElementById("profileForm").onsubmit = async function(e) {
    e.preventDefault();
    if (!currentUser) return;
    const status = document.getElementById("statusMsg");
    status.textContent = '';
    const name = document.getElementById("edit-name").value.trim();
    const photoURL = document.getElementById("edit-photo").value.trim();
    const country = document.getElementById("edit-country").value.trim();
    const dob = document.getElementById("edit-dob").value;
    const hobby = document.getElementById("edit-hobby").value.trim();
    try {
      // Update Firebase Auth (displayName, photoURL)
      await updateProfile(currentUser, {displayName: name, photoURL});
      // Force reload, update UI
      await auth.currentUser.reload();
      document.getElementById("profilePic").src = auth.currentUser.photoURL || "https://i.ibb.co/YTkKPfvf/IMG-20250715-102103-129.jpg";
      document.getElementById("edit-name").value = auth.currentUser.displayName || "";
      // Update Firestore fields
      await setDoc(doc(db, "users", currentUser.uid), { country, dob, hobby }, { merge: true });
      status.textContent = "Profile updated successfully!";
      status.style.color = "#00ffff";
    } catch (err) {
      status.textContent = err.message || "Update failed";
      status.style.color = "#ffd700";
    }
  };
</script>
</body>
</html>
