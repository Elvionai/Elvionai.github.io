<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Profile â€” Elvion AI</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Elvion AI profile and chat with a beautiful glitter blue interface.">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Orbitron:wght@700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --cyan: #00ffff;
      --blue: #0090ff;
      --card-bg: rgba(18,26,48,0.97);
      --border-glow: 0 0 11px var(--cyan), 0 0 24px var(--blue);
      --radius: 16px;
      --text: #e0e0e0;
      --muted: #b3b3b3;
      --white: #fff;
      --chat-bg: rgba(24,32,58,.95);
      --input-glow: 0 2px 10px #00ffff55;
    }
    html, body { height: 100%; margin: 0; }
    body {
      min-height: 100vh; font-family: 'Inter', sans-serif;
      background: radial-gradient(circle, #23233a 66%, #0a1128 100%);
      color: var(--text); display: flex; align-items: center; justify-content: center;
      position: relative;
    }
    #stars-container {
      position: fixed; width: 100vw; height: 100vh; top: 0; left: 0; z-index: 0; pointer-events: none;
    }
    .star { position: absolute; background: rgba(255,255,255,0.7); border-radius: 50%; opacity: 0; animation: twinkle 4.9s infinite linear;}
    @keyframes twinkle {0%,100%{opacity:.18;}52%{opacity:1;}}
    .profile-container {
      background: var(--card-bg); box-shadow: var(--border-glow);
      border-radius: var(--radius); padding: 34px 16px 18px 16px;
      max-width: 400px; width: 100%; margin:32px auto 0 auto;
      display: flex; flex-direction: column; gap: 1.1em; z-index: 2; position: relative;
      animation: fadeIn .78s;
    }
    @keyframes fadeIn {from{opacity:0;transform:translateY(12px);} to{opacity:1;transform:translateY(0);}}
    .profile-header {display: flex;flex-direction:column;align-items:center;gap:0.65em;margin-bottom:7px;}
    .logo-img {
      width: 55px; height: 55px; border-radius: 50%;
      background: #fff; object-fit:cover; animation: logoPulse 3.2s infinite alternate, floatLogo 3.3s infinite alternate; box-shadow: 0 0 14px #00ffff47; margin-bottom:8px;
    }
    @keyframes logoPulse {0%{box-shadow: 0 0 11px #00e2ff,0 0 24px #70fff7;}100%{box-shadow:0 0 19px #007c97,0 0 33px #00ceff60;}}
    @keyframes floatLogo {0%{transform:translateY(0);}100%{transform:translateY(-7px);}}
    .site-heading {font-family:'Orbitron',sans-serif;font-size:1.18em;font-weight:800;letter-spacing:.5px;background:linear-gradient(90deg,var(--cyan),#fff,var(--blue));background-size:200% auto;-webkit-background-clip:text;-webkit-text-fill-color:transparent;animation:shine 4s linear infinite;text-shadow:var(--border-glow);text-align:center;margin-bottom:0;}
    @keyframes shine {to{background-position:200% center;}}
    .profile-greet { color: #aee; font-size: .95em; text-align:center;}
    .menu-bar {
      display: flex; justify-content: space-between; align-items: center;margin-bottom: 6px;gap:15px;
    }
    .menu-btn {
      background: none; border:none; color: var(--cyan); font-size: 2em; cursor:pointer;
      padding:2px 10px; border-radius:12px; box-shadow: 0 1px 8px #00ffff19; transition: background .15s, color .14s;
    }
    .menu-btn:hover { background: var(--cyan); color: #222;}
    .edit-btn { background:#23233a; border:none; color:var(--cyan); border-radius:9px;padding:3px 10px;cursor:pointer;font-size:.97em;transition:background .12s;}
    .edit-btn:hover{background:var(--cyan);color:#23233a;}
    .panel-bg {
      display: none; position: fixed; z-index: 200; top:0; left:0; width:100vw;height:100vh;background: rgba(0,0,0,0.56);align-items:flex-start;justify-content:flex-end;
    }
    .panel-bg.active { display: flex; }
    .side-panel {
      background: var(--chat-bg); width: 100vw; max-width: 360px; height: 100vh;
      box-shadow: -2px 0 32px #00ffffef; display: flex; flex-direction: column; padding: 0; position: relative; transition: transform .27s cubic-bezier(.61,-0.01,.48,1.01); overflow-y: auto; transform: translateX(390px);
    }
    .side-panel.active { transform: translateX(0);}
    .panel-header { display:flex;flex-direction:column;align-items:center; padding:34px 0 12px 0;}
    .panel-header img { width: 54px; height: 54px; border-radius:50%;object-fit:cover;}
    .panel-header .username { font-weight: 800;font-size: 1.1em;color:var(--cyan);margin-bottom:2px;}
    .panel-header .email { font-size: 0.97em; color: var(--muted);}
    .panel-links, .panel-chats {
      display: flex; flex-direction: column; gap: 1px; margin-bottom: 18px; margin-top: 9px; align-items: flex-start;
    }
    .panel-links a, .panel-chats a {
      color: var(--text); text-decoration: none; font-weight: 700; font-size: 1.13em;
      padding: 13px 23px 13px 23px; border-radius: 0 18px 18px 0; transition: background 0.13s, color 0.13s;
      background: #23233a;
    }
    .panel-links a:hover,.panel-chats a:hover { background: var(--cyan); color: #23233a;}
    /* Chat Section */
    .chat-area { background: var(--chat-bg); border-radius: var(--radius); box-shadow: 0 6px 20px rgba(0,0,0,0.18); padding: 0 0 17px 0; display: flex; flex-direction: column; align-items: center; position: relative; margin-bottom: 8px;margin-top:0px;}
    .chat-box { width: 97%; min-height: 110px; max-height: 320px; background: transparent; border-radius: 16px; padding: 13px 10px 10px 10px; margin-bottom: 7px; overflow-y: auto; display: flex; flex-direction: column; gap: 13px; transition: all .2s;}
    .chat-message { display: flex; align-items: flex-end; gap: 10px; margin-bottom: 2px; animation: fadeIn .16s;}
    .chat-message.user { justify-content: flex-end;}
    .chat-message .msg { background: linear-gradient(90deg, #23233a 63%, #222 100%); color: #e0e0e0; padding: 8px 15px; border-radius: 15px 15px 5px 15px; max-width: 74%; font-size: 1.01em; word-break: break-word; font-family:'Inter', Arial, sans-serif; font-weight: 500; box-shadow: 0 1px 3px #0002; text-shadow: 0 1px 8px #0005;}
    .chat-message.user .msg { background: linear-gradient(90deg, #00ffff 64%, #0090ff 100%); color: #23233a; border-radius: 15px 15px 15px 5px; font-weight: 700;}
    .chat-message img, .chat-message video { max-width: 96px; max-height: 96px; border-radius: 10px; margin-top:3px; background:#fff; }
    .chat-typing {color:#00ffff;font-size:.99em;margin-bottom:3px;display:flex;align-items:center;font-family:'Orbitron';font-weight:600;}
    .typing-dots{margin-left:8px;display:inline-block;}
    .typing-dot{width:7px;height:7px;background:#00ffff;border-radius:50%;margin-right:2px;animation:dotBlink 1.2s infinite;}
    .typing-dot:nth-child(2){animation-delay:.25s;}
    .typing-dot:nth-child(3){animation-delay:.5s;}
    @keyframes dotBlink{0%,100%{opacity:.15;}50%{opacity:.9;}}
    .file-preview {max-width:100%;margin:10px 0;border-radius:12px;overflow:hidden;background:rgba(35,35,58,0.6);border:1px solid rgba(255,255,255,0.1);}
    .file-preview img, .file-preview video{max-width:100%;max-height:140px;display:block;margin:0 auto;}
    .file-preview .file-info{padding:7px;display:flex;align-items:center;font-size:.9em;color:var(--muted);}
    .file-preview .file-info i{margin-right:8px;}
    .chat-input-row { width: 98%; display: flex; gap: 7px; align-items: center; margin-top: 0; background: #19192a;
      border-radius: 12px; padding: 8px 9px; border: 1px solid rgba(0,255,255,.12); box-shadow: var(--input-glow);}
    .chat-input-row input[type="file"] { display: none; }
    .chat-input-row label { cursor: pointer; color: var(--cyan); font-size: 1.2em; padding: 0 6px; transition: color .14s; }
    .chat-input-row label:hover { color: var(--blue);}
    .chat-input-row input[type="text"] { flex: 1; padding: 9px 8px; border-radius: 14px; border: 1px solid #23233a; background: #23233a; color: #e0e0e0; font-size: 1em; outline: none; font-family: 'Inter', Arial, sans-serif; transition: border .13s, box-shadow .13s;}
    .chat-input-row input[type="text"]:focus { border: 1px solid var(--cyan); box-shadow: var(--input-glow);}
    .chat-input-row button { background: linear-gradient(90deg,#00ffff,#0090ff); color: #23233a; border: none; border-radius: 12px; padding: 7.5px 15px; font-size: 1.04em; font-weight: 700; cursor: pointer; box-shadow: 0 2px 11px #00ffff33; margin-left: 2px; transition: background .12s;}
    .chat-input-row button:hover { background: #0090ff; color: #fff;}
    .submit-btn {background:linear-gradient(90deg,#00ffff,#0090ff);color:#23233a;border:none;border-radius:13px;padding:8px 0;margin-top:3px;font-family:'Orbitron';font-size:1em;letter-spacing:.04em;width:98%;box-shadow:var(--border-glow);}
    .submit-btn:hover{background:#0090ff;color:#fff;}
    @media (max-width: 430px) { .profile-container { padding:8px 2vw; } .site-heading{font-size:1em;} .logo-img{width:36px;height:36px;} .chat-area{padding:0;}.chat-input-row{padding:4px;} }
    .status-message { color: #ffd700; font-size: .97em; text-align:center; min-height:18px; }
  </style>
</head>
<body>
<div id="stars-container"></div>
<div class="profile-container">
  <div class="menu-bar">
    <button class="menu-btn" id="openProfileMenu" title="Profile"><i class="fa-solid fa-user"></i></button>
    <button class="menu-btn" id="openLinksMenu" title="Links"><i class="fa-solid fa-link"></i></button>
  </div>
  <div class="profile-header">
    <img id="profilePic" src="https://i.ibb.co/YTkKPfvf/IMG-20250715-102103-129.jpg" class="logo-img" alt="Elvion AI logo">
    <div class="site-heading">Elvion AI</div>
    <div class="profile-greet" id="greetMsg">Welcome!</div>
  </div>
  <section class="chat-area">
    <div class="chat-box" id="chatBox"></div>
    <div id="typingMsg" class="chat-typing" style="display:none;">Elvion AI is typing <span class="typing-dots"><span class="typing-dot"></span><span class="typing-dot"></span><span class="typing-dot"></span></span></div>
    <div id="filePreview" class="file-preview" style="display:none;"></div>
    <form class="chat-input-row" id="chatForm" autocomplete="off">
      <label for="chatFile" title="Upload file" id="fileLabel"><i class="fa-solid fa-paperclip"></i></label>
      <input type="file" id="chatFile" accept="image/*,video/*,application/pdf,.doc,.docx,.txt">
      <input type="text" id="chatInput" placeholder="Type a message or record voice..." autocomplete="off">
      <button type="submit"><i class="fa-solid fa-paper-plane"></i></button>
      <button type="button" id="voiceInputBtn" title="Record voice" style="margin-left:7px;"><i class="fa-solid fa-microphone"></i></button>
    </form>
    <button id="newChatBtn" class="submit-btn" style="margin:8px 0 0 0;">New Chat</button>
    <div class="status-message" id="statusMsg"></div>
  </section>
</div>

<!-- Profile Menu Modal -->
<div class="panel-bg" id="profileMenuBg">
  <nav class="side-panel" id="profileMenu">
    <div class="panel-header">
      <img id="profilePicPreview" src="https://i.ibb.co/YTkKPfvf/IMG-20250715-102103-129.jpg" alt="Profile photo">
      <div class="username" id="profileMenuUser">User</div>
      <div class="email" id="profileMenuEmail">Email@example.com</div>
    </div>
    <form class="edit-form" id="profileForm" autocomplete="off" style="padding:9px 22px;">
      <label for="edit-name">Full Name</label>
      <input type="text" id="edit-name" required>
      <label for="edit-photo">Profile Photo URL</label>
      <input type="url" id="edit-photo" placeholder="Paste image link">
      <span class="profile-photo-tip">Change your photo? Upload at <a href="https://postimg.cc/" target="_blank" style="color:#00ffff;">postimg.cc</a>, paste the link here.</span>
      <label for="edit-country">Country</label>
      <input type="text" id="edit-country">
      <label for="edit-dob">Date of Birth</label>
      <input type="date" id="edit-dob">
      <label for="edit-hobby">Hobby</label>
      <input type="text" id="edit-hobby" placeholder="e.g. Reading, Coding">
      <button type="submit" class="submit-btn">Save Profile</button>
      <div class="status-message" id="profileStatusMsg"></div>
    </form>
    <button class="submit-btn" id="logoutBtn" style="background:#23233a;color:#00ffff;">Logout</button>
  </nav>
</div>
<!-- Link Menu Modal -->
<div class="panel-bg" id="linkMenuBg">
  <nav class="side-panel" id="linkMenu">
    <div class="panel-header">
      <img src="https://i.ibb.co/YTkKPfvf/IMG-20250715-102103-129.jpg" alt="Elvion logo">
      <div class="username">Elvion AI Links</div>
    </div>
    <div class="panel-links">
      <a href="index.html"><i class="fa-solid fa-home"></i> Home</a>
      <a href="about.html"><i class="fa-solid fa-circle-info"></i> About</a>
      <a href="privacy.html"><i class="fa-solid fa-shield-halved"></i> Privacy Policy</a>
      <a href="terms.html"><i class="fa-solid fa-file-contract"></i> Terms</a>
      <a href="https://t.me/writingurubot" target="_blank"><i class="fab fa-telegram"></i> Telegram Bot</a>
    </div>
  </nav>
</div>
<script type="module">
  // STAR ANIMATION
  document.addEventListener('DOMContentLoaded', () => {
    const starsContainer = document.getElementById('stars-container');
    const numStars=51,minSize=1,maxSize=2.3;
    for(let i=0;i<numStars;i++){
      const star=document.createElement('div');
      star.className='star';
      const size=Math.random()*(maxSize-minSize)+minSize;
      star.style.width=size+'px'; star.style.height=size+'px';
      star.style.left=Math.random()*100+'%'; star.style.top=Math.random()*100+'%';
      star.style.animationDelay=(Math.random()*3.7)+'s'; star.style.animationDuration=(2+Math.random()*1.7)+'s';
      starsContainer.appendChild(star);
    }
  });

  // MENU MODALS
  function openModal(bg,panel){bg.classList.add('active');setTimeout(()=>panel.classList.add('active'),30);}
  function closeModal(bg,panel){panel.classList.remove('active');setTimeout(()=>bg.classList.remove('active'),240);}
  document.getElementById('openProfileMenu').onclick=()=>openModal(profileMenuBg,profileMenu);
  profileMenuBg.onclick=e=>{if(e.target===profileMenuBg)closeModal(profileMenuBg,profileMenu);}
  document.getElementById('openLinksMenu').onclick=()=>openModal(linkMenuBg,linkMenu);
  linkMenuBg.onclick=e=>{if(e.target===linkMenuBg)closeModal(linkMenuBg,linkMenu);}
  document.getElementById('logoutBtn').onclick=()=>window.location.href='signup-login.html';

  // FIREBASE PROFILE
  import {initializeApp} from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
  import {getAuth,onAuthStateChanged,updateProfile} from "https://www.gstatic.com/firebasejs/10.12.4/firebase-auth.js";
  import {getFirestore,doc,setDoc,getDoc} from "https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore.js";
  const firebaseConfig={apiKey:"AIzaSyAyROm0aBGjry6NUfhNM3e0qwPcCDoIqSk",authDomain:"elvionai.firebaseapp.com",projectId:"elvionai",storageBucket:"elvionai.firebasestorage.app",messagingSenderId:"161078300830",appId:"1:161078300830:web:f460df8591704eb0e96b8f"};
  const app=initializeApp(firebaseConfig);const auth=getAuth(app);const db=getFirestore(app);
  let currentUser;
  onAuthStateChanged(auth, async user=>{
    if(!user)window.location.href="signup-login.html";
    else{
      currentUser=user;
      document.getElementById("greetMsg").textContent="Welcome, "+(user.displayName||user.email.split('@')[0])+"!";
      document.getElementById("profilePic").src=user.photoURL||"https://i.ibb.co/YTkKPfvf/IMG-20250715-102103-129.jpg";
      document.getElementById("profileMenuUser").textContent=user.displayName||"User";
      document.getElementById("profileMenuEmail").textContent=user.email;
      document.getElementById("edit-name").value=user.displayName||"";
      document.getElementById("edit-photo").value=user.photoURL||"";
      document.getElementById("profilePicPreview").src=user.photoURL||"https://i.ibb.co/YTkKPfvf/IMG-20250715-102103-129.jpg";
      // Load Firestore custom fields
      const userDoc = await getDoc(doc(db,"users",user.uid));
      if(userDoc.exists()){
        const data=userDoc.data();
        document.getElementById("edit-country").value=data.country||"";
        document.getElementById("edit-dob").value=data.dob||"";
        document.getElementById("edit-hobby").value=data.hobby||"";
      }
    }
  });
  document.getElementById("edit-photo").oninput=function(){
    document.getElementById("profilePicPreview").src=this.value||"https://i.ibb.co/YTkKPfvf/IMG-20250715-102103-129.jpg";
  };
  document.getElementById("profileForm").onsubmit=async function(e){
    e.preventDefault();
    if(!currentUser)return;
    const status=document.getElementById("profileStatusMsg"); status.textContent='';
    const name=document.getElementById("edit-name").value.trim();
    const photoURL=document.getElementById("edit-photo").value.trim();
    const country=document.getElementById("edit-country").value.trim();
    const dob=document.getElementById("edit-dob").value;
    const hobby=document.getElementById("edit-hobby").value.trim();
    try{
      await updateProfile(currentUser,{displayName:name,photoURL});
      await setDoc(doc(db,"users",currentUser.uid),{country,dob,hobby},{merge:true});
      await auth.currentUser.reload();
      document.getElementById("profilePic").src=auth.currentUser.photoURL||"https://i.ibb.co/YTkKPfvf/IMG-20250715-102103-129.jpg";
      status.textContent="Profile updated!";
      status.style.color="#00ffff";
    }catch(err){
      status.textContent=err.message||"Update failed";
      status.style.color="#ffd700";
    }
  };

  // MULTI-CHAT via localStorage
  let chats=JSON.parse(localStorage.getItem("elvion_chats")||"[]");
  let currentChatIdx=chats.length-1;
  function saveChats(){localStorage.setItem("elvion_chats",JSON.stringify(chats));}
  function renderChats(){
    // For real chat menu: add a modal for viewing previous chats, currentChatIdx
  }
  function loadChat(idx){currentChatIdx=idx||0;renderChatBox(chats[idx]?chats[idx].history:[]);}
  function renderChatBox(messages){
    const chatBox=document.getElementById("chatBox");chatBox.innerHTML="";
    messages.forEach((msg,idx)=>{
      const div=document.createElement('div');
      div.className="chat-message "+(msg.role==="user"?"user":"ai");
      div.innerHTML=`<div class="msg">${msg.text}</div>`;
      chatBox.appendChild(div);
    });
    chatBox.scrollTop=chatBox.scrollHeight;
  }
  document.getElementById("newChatBtn").onclick=function(){
    const name="Chat "+(chats.length+1);
    chats.push({name,history:[]}); currentChatIdx=chats.length-1;
    saveChats();loadChat(currentChatIdx);
  };

  // AI BOT CHAT with typing animation, POST to railway backend
  async function showTyping(waiting){
    document.getElementById("typingMsg").style.display=waiting?"":"none";
  }
  document.getElementById("chatForm").onsubmit=async function(e){
    e.preventDefault();
    const chatInput=document.getElementById("chatInput");
    const file=document.getElementById("chatFile").files[0];
    const msgText=chatInput.value.trim();
    if(!msgText&&!file)return;
    if(currentChatIdx<0){chats.push({name:"Chat 1",history:[]});currentChatIdx=0;}
    chats[currentChatIdx].history.push({role:"user",text:msgText});
    renderChatBox(chats[currentChatIdx].history);
    chatInput.value="";document.getElementById("filePreview").style.display="none";document.getElementById("filePreview").innerHTML="";
    saveChats();
    showTyping(true);
    let reply="",status=document.getElementById("statusMsg");
    status.textContent="";
    try{
      const history=chats[currentChatIdx].history.map(m=>({role:m.role,content:m.text}));
      const res=await fetch("https://web-production-9a18.up.railway.app/chat",{method:"POST",headers:{'Content-Type':'application/json'},body:JSON.stringify({message:msgText,user_id:"user",history})});
      const data=await res.json();
      reply=data.response||"ðŸ¤– Bot replied, but empty!";
      chats[currentChatIdx].history.push({role:"ai",text:reply});
      renderChatBox(chats[currentChatIdx].history);
      saveChats();
      showTyping(false);
    }catch(err){
      showTyping(false);status.textContent="Bot error: "+err.message;
    }
  };

  // File upload preview
  document.getElementById("chatFile").onchange=function(){
    const file=this.files[0];
    const filePreview=document.getElementById("filePreview");
    if(!file){filePreview.style.display="none";filePreview.innerHTML="";return;}
    filePreview.style.display='block';
    if(file.type.startsWith("image/")){
      const reader=new FileReader();
      reader.onload=e=>{filePreview.innerHTML=`<img src="${e.target.result}">`;};
      reader.readAsDataURL(file);
    }else if(file.type.startsWith("video/")){
      const reader=new FileReader();
      reader.onload=e=>{filePreview.innerHTML=`<video src="${e.target.result}" controls></video>`;};
      reader.readAsDataURL(file);
    }else{
      filePreview.innerHTML=`<div class="file-info"><i class="fa-solid fa-file"></i> ${file.name}</div>`;
    }
  };

  // VOICE INPUT BUTTON (speech-to-text)
  let recognition;
  document.getElementById("voiceInputBtn").onclick=function(){
    if('webkitSpeechRecognition'in window){
      recognition=new webkitSpeechRecognition();
      recognition.continuous=false;recognition.interimResults=false;recognition.lang='en-US';
      let timer=0;
      document.getElementById("voiceInputBtn").innerHTML='<i class="fa-solid fa-microphone-lines"></i>';
      recognition.onresult=function(e){
        document.getElementById('chatInput').value=e.results[0][0].transcript;
        document.getElementById("voiceInputBtn").innerHTML='<i class="fa-solid fa-microphone"></i>';
      };
      recognition.onend=function(){document.getElementById("voiceInputBtn").innerHTML='<i class="fa-solid fa-microphone"></i>';};
      recognition.onerror=function(){document.getElementById("voiceInputBtn").innerHTML='<i class="fa-solid fa-microphone"></i>';};
      recognition.start();
    }else{
      alert("Speech recognition not supported in your browser.");
    }
  };

  // Initial render
  loadChat(chats.length-1);
</script>
</body>
</html>
