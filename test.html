<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>How to Craft Unforgettable Characters | Elvion AI Blog</title>
    <meta name="description" content="Learn proven techniques to create compelling, three-dimensional characters that readers will remember long after the final page.">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Orbitron:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* --- GLOBAL STYLES (FROM INDEX) --- */
        :root {
            --dark-navy: #00001a;
            --black-bg: #000000;
            --cyan-glow: #00ffff;
            --light-blue-glow: #00aaff;
            --text-color: #e0e0e0;
            --heading-color: #ffffff;
            --gradient-start: #0a1128;
            --gradient-end: #121a30;
            --card-bg: rgba(18, 26, 48, 0.7);
            --border-glow: 0 0 10px var(--cyan-glow), 0 0 20px var(--light-blue-glow);
            --hover-glow: 0 0 15px var(--cyan-glow), 0 0 30px var(--light-blue-glow);
            --button-bg: linear-gradient(45deg, var(--cyan-glow), var(--light-blue-glow));
            --button-text-color: var(--black-bg);
            --star-color: rgba(255, 255, 255, 0.7);
        }

        html { scroll-behavior: smooth; }
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding-top: 60px;
            background-color: var(--black-bg);
            color: var(--text-color);
            line-height: 1.8; /* Increased line-height for better readability */
            overflow-x: hidden;
            position: relative;
            min-height: 100vh;
        }

        h1, h2, h3, h4 {
            font-family: 'Orbitron', sans-serif;
            color: var(--heading-color);
            margin-top: 0;
            text-shadow: var(--border-glow);
        }
        
        a {
            color: var(--cyan-glow);
            text-decoration: none;
            transition: color 0.3s ease, text-shadow 0.3s ease;
        }

        a:hover {
            color: var(--light-blue-glow);
            text-shadow: 0 0 5px var(--cyan-glow);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        /* --- NAVBAR & FOOTER STYLES (Simplified for brevity) --- */
        .navbar {
            position: fixed; top: 0; width: 100%; background: rgba(0, 0, 26, 0.95); padding: 1rem 0; z-index: 1000;
            box-shadow: 0 4px 20px rgba(0, 255, 255, 0.1); backdrop-filter: blur(10px); border-bottom: 1px solid rgba(0, 255, 255, 0.2);
        }
        .navbar .container { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; }
        .navbar-brand { font-family: 'Orbitron', sans-serif; font-size: 1.8rem; font-weight: 700; color: var(--heading-color); text-shadow: var(--border-glow); }
        .nav-links { display: flex; list-style: none; margin: 0; padding: 0; }
        .nav-links li { margin-left: 2rem; }
        .nav-links a { color: var(--text-color); font-weight: 500; padding: 0.5rem 0; position: relative; text-shadow: none; }
        .footer { background: var(--dark-navy); color: var(--text-color); padding: 4rem 0; font-size: 0.9rem; border-top: 1px solid rgba(0, 255, 255, 0.1); text-align: center; }
        .footer .container { display: flex; flex-wrap: wrap; justify-content: space-between; align-items: flex-start; gap: 2rem; text-align: left; }
        .footer .col { flex: 1; min-width: 200px; }
        .footer h4 { font-size: 1.2rem; margin-bottom: 1.5rem; color: var(--cyan-glow); text-shadow: 0 0 5px rgba(0,255,255,0.4); }
        .footer ul { list-style: none; padding: 0; }
        .footer .legal-info { margin-top: 2rem; text-align: center; width: 100%; border-top: 1px solid rgba(0, 255, 255, 0.1); padding-top: 1.5rem; color: rgba(224, 224, 224, 0.7); }
        
        /* --- ARTICLE SPECIFIC STYLES --- */
        .article-header {
            padding: 3rem 0;
            text-align: center;
            border-bottom: 1px solid rgba(0, 255, 255, 0.1);
            margin-bottom: 3rem;
        }

        .article-header h1 {
            font-size: 3rem;
            line-height: 1.2;
            margin-bottom: 1rem;
        }

        .article-meta {
            color: rgba(224, 224, 224, 0.7);
            font-size: 0.9rem;
            margin-top: 1rem;
        }

        .article-meta i {
            margin-right: 0.3rem;
            color: var(--cyan-glow);
        }

        .article-content {
            max-width: 800px;
            margin: 0 auto;
            padding-bottom: 4rem;
        }

        .article-content p, .article-content li {
            font-size: 1.1rem;
            margin-bottom: 1.5rem;
            color: var(--text-color);
        }
        
        .article-content h2 {
            font-size: 2rem;
            margin-top: 3rem;
            margin-bottom: 1.5rem;
            border-left: 4px solid var(--cyan-glow);
            padding-left: 1rem;
            text-shadow: 0 0 8px rgba(0, 255, 255, 0.4);
        }
        
        .article-content ul {
            list-style: none;
            padding-left: 0;
        }
        
        .article-content ul li {
            position: relative;
            padding-left: 1.5rem;
        }
        
        .article-content ul li::before {
            content: "\f058"; /* Check icon */
            font-family: "Font Awesome 6 Free";
            font-weight: 900;
            color: var(--light-blue-glow);
            position: absolute;
            left: 0;
            top: 0;
        }

        /* --- AUDIO PLAYER & HIGHLIGHTING --- */
        #tts-player {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1.5rem;
            margin-bottom: 2rem;
            padding: 1rem;
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(0, 255, 255, 0.1);
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.1);
        }

        .tts-btn {
            padding: 0.8rem 1.5rem;
            background: var(--button-bg);
            color: var(--button-text-color);
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 700;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 0 5px var(--cyan-glow);
        }
        
        .tts-btn:hover {
            opacity: 0.9;
            box-shadow: 0 0 15px var(--light-blue-glow);
        }
        
        .tts-btn i {
            margin-right: 0.5rem;
        }
        
        .highlight {
            background-color: rgba(0, 255, 255, 0.3); /* Cyan semi-transparent background */
            transition: background-color 0.1s ease;
            padding: 2px 4px;
            border-radius: 4px;
        }

        /* --- COMMENT SECTION STYLES --- */
        .comment-section-container {
            max-width: 800px;
            margin: 4rem auto;
            padding: 2rem;
            background: rgba(18, 26, 48, 0.8);
            border-radius: 10px;
            border: 1px solid rgba(0, 255, 255, 0.2);
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.1);
        }

        .comment-section h2 {
            font-size: 1.8rem;
            margin-bottom: 2rem;
            color: var(--light-blue-glow);
            text-shadow: 0 0 5px var(--light-blue-glow);
        }

        #auth-container {
            padding: 1.5rem;
            margin-bottom: 2rem;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 8px;
            border: 1px dashed rgba(0, 255, 255, 0.3);
        }
        
        #auth-container h3 {
            font-size: 1.4rem;
            margin-bottom: 1.5rem;
            text-align: center;
        }
        
        .auth-input-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        #auth-container input {
            width: 100%;
            padding: 0.8rem;
            background: var(--dark-navy);
            border: 1px solid var(--cyan-glow);
            color: var(--text-color);
            border-radius: 4px;
            box-sizing: border-box;
        }

        .auth-buttons {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .auth-buttons button {
            flex: 1;
            padding: 0.8rem;
            max-width: 200px;
            font-weight: 600;
        }

        #comment-form {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        #comment-input {
            width: 100%;
            min-height: 100px;
            padding: 1rem;
            background: var(--dark-navy);
            border: 1px solid var(--cyan-glow);
            color: var(--text-color);
            border-radius: 4px;
            resize: vertical;
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
        }
        
        #comment-button {
            align-self: flex-end;
            padding: 0.8rem 2rem;
            font-weight: 700;
        }
        
        .comment-list {
            margin-top: 2rem;
            border-top: 1px solid rgba(0, 255, 255, 0.1);
            padding-top: 1rem;
        }

        .comment {
            display: flex;
            gap: 1rem;
            padding: 1rem 0;
            border-bottom: 1px solid rgba(0, 255, 255, 0.05);
            margin-bottom: 1rem;
        }

        .comment img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--cyan-glow);
            flex-shrink: 0;
        }

        .comment-user {
            font-weight: 700;
            color: var(--heading-color);
            display: block;
            margin-bottom: 0.3rem;
        }

        .custom-verified-badge {
            display: inline-block;
            width: 10px;
            height: 10px;
            background-color: #00ff00;
            border-radius: 50%;
            margin-left: 5px;
            box-shadow: 0 0 5px #00ff00;
        }

        .comment-text {
            margin: 0.5rem 0;
            font-size: 1rem;
            white-space: pre-wrap; /* Preserve formatting */
        }

        .comment-date {
            font-size: 0.8rem;
            color: rgba(224, 224, 224, 0.5);
            display: block;
            margin-bottom: 0.5rem;
        }
        
        .comment button {
            background: rgba(0, 255, 255, 0.1);
            color: var(--cyan-glow);
            border: 1px solid var(--cyan-glow);
            padding: 0.4rem 0.8rem;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.8rem;
            margin-right: 0.5rem;
            transition: background-color 0.3s;
        }

        .comment button:hover {
            background: rgba(0, 255, 255, 0.3);
        }
        
        .emoji-suggestions {
            margin-bottom: 1rem;
            color: var(--text-color);
            font-size: 0.9rem;
        }
        .emoji-suggestions span {
            cursor: pointer;
            margin-right: 0.5rem;
            padding: 2px 5px;
            transition: transform 0.1s;
        }
        .emoji-suggestions span:hover {
            transform: scale(1.2);
            text-shadow: 0 0 5px var(--cyan-glow);
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .article-header h1 { font-size: 2rem; }
            .article-content { padding: 0 1rem 4rem; }
            .auth-input-group { grid-template-columns: 1fr; }
            .auth-buttons { flex-direction: column; }
            .auth-buttons button { max-width: 100%; }
            .comment-section-container { margin: 2rem 1rem; padding: 1rem; }
            .tts-btn { font-size: 0.9rem; padding: 0.6rem 1rem; }
        }
        
        .button-style { /* Class for re-using the main button styling */
            padding: 0.7rem 1.4rem;
            background: var(--button-bg);
            color: var(--button-text-color);
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            font-family: 'Inter', sans-serif;
            font-size: 0.9rem;
            text-transform: uppercase;
        }
        .button-style:hover {
            opacity: 0.9;
            box-shadow: 0 0 10px var(--cyan-glow);
        }
        
    </style>
</head>
<body>
    <div id="stars-container" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 0; overflow: hidden;"></div>
    
    <header class="navbar">
        <div class="container">
            <a href="index.html" class="navbar-brand">Elvion AI</a>
            <nav class="nav-links">
                <li><a href="blog.html" class="active-link">Blog</a></li>
                </nav>
        </div>
    </header>

    <main class="article-main container">

        <section class="article-header">
            <p style="font-size: 1.1rem; color: var(--light-blue-glow); text-transform: uppercase; font-weight: 600;">Creative Writing</p>
            <h1>How to Craft Unforgettable Characters: A Writer's Guide</h1>
            <p class="article-meta">
                <span><i class="fas fa-calendar-alt"></i> Nov 4, 2025</span>
                <span> | <i class="fas fa-clock"></i> 8 min read</span>
                <span> | <i class="fas fa-user-edit"></i> Elvion Editor</span>
            </p>
        </section>

        <section id="tts-player">
            <button class="tts-btn" id="listen-btn" onclick="toggleSpeech()"><i class="fas fa-volume-up"></i> Listen to this Article</button>
            <p id="tts-status" style="color: var(--cyan-glow); font-weight: 500;"></p>
        </section>

        <article class="article-content" id="article-text-container">
            <p>Your characters are the **heart of your story**. They are the lens through which readers experience your world, the driving force behind the plot, and the key reason they turn the page. Creating **compelling, three-dimensional characters** is one of the most vital skills a writer can master. This guide will walk you through proven techniques to develop characters readers will remember long after the final page.</p>

            <h2>1. The Foundation: Want and Need</h2>
            <p>Every unforgettable character is defined by a fundamental **Want** (external, goal-oriented) and a hidden **Need** (internal, psychological change). The external plot is driven by the Want, but the true emotional journey and character arc are fulfilled by the Need.</p>
            <ul>
                <li>**Want:** What does your character *think* they need to be happy or complete? (e.g., to find a lost treasure, to win the championship).</li>
                <li>**Need:** What does your character *actually* need to learn or overcome to solve their internal conflict? (e.g., to learn humility, to trust others).</li>
            </ul>

            <h2>2. The Core Conflict: Flaws and Strengths</h2>
            <p>Perfect characters are boring. A character's **flaws** are what make them relatable, and their **strengths** are what make them capable of driving the plot. Ensure these two aspects are intertwined. For example, a character's greatest strength (determination) might also be their greatest flaw (stubbornness).</p>
            <p>A simple technique is to ask: **"What is my character trying to hide from the world?"** This hidden wound or fear is the root of their inner conflict and will dictate their choices throughout the narrative.</p>

            <h2>3. Give Them A Backstory Dossier</h2>
            <p>Even if it never appears on the page, every character needs a complete history. Knowing these details will inform their actions, dialogue, and reactions. Consider these dossier elements:</p>
            <ul>
                <li>**Inciting Incident:** What single event in their past fundamentally shaped their worldview?</li>
                <li>**Eccentricities:** What unique habit, mannerism, or verbal tic sets them apart? (e.g., always chewing gum, habitually touching their necklace).</li>
                <li>**Voice:** How do they speak? Do they use short, blunt sentences, or verbose, flowery language? This is key to differentiating them.</li>
            </ul>
            
            <h2>4. The Power of Relationships</h2>
            <p>A character is best defined by how they interact with others. Consider the roles of your supporting cast:</p>
            <ul>
                <li>**The Foil:** A character whose traits are opposite to the protagonist, highlighting their weaknesses and strengths.</li>
                <li>**The Mentor:** Guides the character, often acting as a mirror for their internal Need.</li>
                <li>**The Antagonist:** The force standing in the way of the Want. Their goals should be as compelling and understandable as the protagonist's.</li>
            </ul>
            <p>By giving your main character strong, defined relationships, you allow their personality to be revealed dynamically through conflict and support, rather than through static description. Master these techniques, and your readers will not just follow your characters' journeys‚Äîthey will *feel* them.</p>
        </article>

        <section class="comment-section-container">
            <div class="comment-section">
                <h2><i class="fas fa-comment-dots"></i> Join the Conversation</h2>

                <div id="auth-container" style="display:none;">
                    <h3>Sign Up / Log In to Comment</h3>
                    <p style="text-align: center; margin-bottom: 1.5rem;">Please use your Elvion AI credentials to participate.</p>
                    <div class="auth-input-group">
                        <input type="email" id="auth-email" placeholder="Email" required>
                        <input type="password" id="auth-password" placeholder="Password" required>
                    </div>
                    <div class="auth-input-group">
                        <input type="text" id="auth-username" placeholder="Username (for Sign Up only)">
                        <input type="url" id="auth-pic-url" placeholder="Profile Pic URL (Optional)">
                    </div>
                    <div class="auth-buttons">
                        <button id="login-button" class="button-style">Log In</button>
                        <button id="signup-button" class="button-style">Sign Up</button>
                    </div>
                </div>

                <div id="comment-form">
                    <textarea id="comment-input" placeholder="What are your thoughts on character development?"></textarea>
                    <div class="emoji-suggestions">
                        Quick Emojis: <span data-emoji="‚úçÔ∏è">‚úçÔ∏è</span> <span data-emoji="üí°">üí°</span> <span data-emoji="ü§î">ü§î</span> <span data-emoji="üíØ">üíØ</span>
                    </div>
                    <button id="comment-button" class="button-style">Post Comment</button>
                </div>

                <div class="comment-list" id="comment-list">
                    <p style="text-align: center; color: rgba(224, 224, 224, 0.6);">Loading comments...</p>
                </div>
            </div>
        </section>

    </main>

    <footer class="footer">
        <div class="container">
            <div class="col"><span class="brand-info">Elvion AI</span><p>Where Assistance Meets Excellence.</p></div>
            <div class="col"><h4>Quick Links</h4><ul><li><a href="blog.html">Blog</a></li></ul></div>
            <div class="col"><h4>Company</h4><ul><li><a href="about.html">About Us</a></li><li><a href="mailto:Philipsmith@consultant.com">Contact Us</a></li></ul></div>
            <div class="col"><h4>Legal</h4><ul><li><a href="https://elvionai.github.io/privacy.html">Privacy Policy</a></li></ul></div>
            <div class="legal-info">&copy; <span id="current-year-footer"></span> Elvion AI. All rights reserved.</div>
        </div>
    </footer>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, updateProfile } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-auth.js";
        import { getFirestore, collection, addDoc, query, where, onSnapshot, updateDoc, doc, arrayUnion, deleteDoc } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore.js";
        
        // --- CORRECT FIREBASE CONFIGURATION ---
        const firebaseConfig = {
            apiKey: "AIzaSyAyROm0aBGjry6NUfhNM3e0qwPcCDoIqSk",
            authDomain: "elvionai.firebaseapp.com",
            projectId: "elvionai",
            storageBucket: "elvionai.firebasestorage.app",
            messagingSenderId: "161078300830",
            appId: "1:161078300830:web:f460df8591704eb0e96b8f"
        };
        
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let currentUser = null;
        const ARTICLE_ID = 'unforgettable-characters-90'; // Unique ID for this specific article

        // --- AUTH STATE & UI TOGGLE ---
        onAuthStateChanged(auth, (user) => {
            if (user) {
                currentUser = user;
                document.getElementById('auth-container').style.display = 'none';
                document.getElementById('comment-form').style.display = 'flex'; // Show the comment box
            } else {
                currentUser = null;
                document.getElementById('auth-container').style.display = 'block';
                document.getElementById('comment-form').style.display = 'none'; // Hide comment box if not logged in
            }
        });

        // --- AUTH HANDLERS ---
        document.getElementById('signup-button').addEventListener('click', async () => {
            const email = document.getElementById('auth-email').value;
            const password = document.getElementById('auth-password').value;
            const username = document.getElementById('auth-username').value;
            const picUrl = document.getElementById('auth-pic-url').value;

            if (!email || !password || !username) {
                alert('Email, Password, and Username are required for Sign Up.');
                return;
            }

            try {
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                currentUser = userCredential.user;

                await updateProfile(currentUser, { 
                    displayName: username, 
                    photoURL: picUrl || 'https://via.placeholder.com/40x40.png?text=AI' // Default profile pic
                });

                // Add user data to Firestore (optional, but good practice)
                await addDoc(collection(db, 'users'), {
                    uid: currentUser.uid,
                    username: username,
                    email: email,
                    photoURL: currentUser.photoURL,
                    userLevel: 'Blogger' // Default level
                });
            } catch (error) {
                alert(`Sign Up Error: ${error.message}`);
            }
        });
        
        document.getElementById('login-button').addEventListener('click', async () => {
            const email = document.getElementById('auth-email').value;
            const password = document.getElementById('auth-password').value;

            try {
                await signInWithEmailAndPassword(auth, email, password);
                // onAuthStateChanged will handle the UI update
            } catch (error) {
                alert(`Login Error: ${error.message}`);
            }
        });

        // --- COMMENT HANDLERS ---
        document.getElementById('comment-button').addEventListener('click', async () => {
            if (!currentUser) {
                alert('Please log in to post a comment.');
                return;
            }

            const commentText = document.getElementById('comment-input').value.trim();
            if (!commentText) {
                alert('Please write a comment.');
                return;
            }
            
            const commentData = {
                text: commentText,
                userName: currentUser.displayName,
                userProfilePic: currentUser.photoURL,
                userId: currentUser.uid,
                timestamp: new Date(),
                articleId: ARTICLE_ID,
                replies: [],
                likes: [],
                helpful: [],
                notHelpful: [],
                userLevel: 'Blogger' // Using a default/simple level
            };

            try {
                await addDoc(collection(db, 'comments'), commentData);
                document.getElementById('comment-input').value = ''; 
            } catch (error) {
                console.error("Error posting comment: ", error);
                alert('Failed to post comment. Check console for details.');
            }
        });

        // --- REAL-TIME COMMENT LISTENER (Simplified for this example) ---
        const commentList = document.getElementById('comment-list');
        const q = query(collection(db, 'comments'), where("articleId", "==", ARTICLE_ID));

        onSnapshot(q, (snapshot) => {
            commentList.innerHTML = '';
            const commentsArray = [];
            snapshot.forEach((doc) => {
                commentsArray.push({ id: doc.id, ...doc.data() });
            });
            
            // Sort comments by timestamp (newest first)
            commentsArray.sort((a, b) => b.timestamp.seconds - a.timestamp.seconds);

            if (commentsArray.length === 0) {
                 commentList.innerHTML = '<p style="text-align: center; color: rgba(224, 224, 224, 0.6);">Be the first to leave a comment!</p>';
                 return;
            }

            commentsArray.forEach((comment) => {
                const isLiked = comment.likes.includes(currentUser ? currentUser.uid : '');
                const likeBtnClass = isLiked ? 'active-like' : '';
                
                const formattedDate = new Date(comment.timestamp.seconds * 1000).toLocaleString('en-US', { 
                    year: 'numeric', month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' 
                });

                const commentHtml = `
                    <div class="comment" id="comment-${comment.id}">
                        <img src="${comment.userProfilePic || 'https://via.placeholder.com/40x40.png?text=AI'}" alt="${comment.userName} Profile Pic" loading="lazy" />
                        <div>
                            <span class="comment-user">${comment.userName} 
                                <span class="custom-verified-badge" title="${comment.userLevel}"></span>
                            </span>
                            <p class="comment-text">${comment.text}</p>
                            <span class="comment-date">${formattedDate}</span>
                            <div class="comment-actions">
                                <button class="like-button ${likeBtnClass}" data-id="${comment.id}">
                                    <i class="fas fa-thumbs-up"></i> ${comment.likes.length}
                                </button>
                                <button class="reply-button" data-id="${comment.id}">Reply</button>
                                </div>
                        </div>
                    </div>
                `;
                commentList.insertAdjacentHTML('beforeend', commentHtml);
            });

            addCommentListeners();
        });

        // --- COMMENT ACTION LISTENERS (Refined) ---
        function addCommentListeners() {
            // Event delegation for dynamically added buttons
            commentList.addEventListener('click', async (event) => {
                const target = event.target.closest('button');
                if (!target) return;

                if (!currentUser) {
                    alert('Please log in to interact with comments.');
                    return;
                }

                const commentId = target.dataset.id;
                const commentRef = doc(db, 'comments', commentId);
                const currentUserId = currentUser.uid;

                if (target.classList.contains('like-button')) {
                    try {
                        // Implement toggling logic for likes
                        const currentLikes = (await doc(db, 'comments', commentId).get()).data().likes || [];
                        if (currentLikes.includes(currentUserId)) {
                            // Unlike
                            await updateDoc(commentRef, {
                                likes: currentLikes.filter(uid => uid !== currentUserId)
                            });
                        } else {
                            // Like
                            await updateDoc(commentRef, {
                                likes: arrayUnion(currentUserId)
                            });
                        }
                    } catch (error) {
                        console.error("Error toggling like: ", error);
                    }
                } else if (target.classList.contains('reply-button')) {
                    // Simple reply box prompt (you'll need to expand this for a full reply feature)
                    const replyText = prompt("Write your reply:");
                    if (replyText) {
                        const replyData = {
                            text: replyText,
                            userName: currentUser.displayName,
                            userProfilePic: currentUser.photoURL,
                            timestamp: new Date()
                        };
                        try {
                            await updateDoc(commentRef, {
                                replies: arrayUnion(replyData)
                            });
                        } catch (error) {
                            console.error("Error adding reply: ", error);
                        }
                    }
                }
                // Helpful/Not Helpful buttons are removed for simplicity but the logic would be similar to likes.
            });
            
            // Emoji suggestions
            document.querySelectorAll('.emoji-suggestions span').forEach(emoji => {
                emoji.addEventListener('click', (event) => {
                    const emojiClicked = event.target.textContent.trim();
                    const commentInput = document.getElementById('comment-input');
                    commentInput.value += emojiClicked;
                    commentInput.focus(); 
                });
            });
        }


        // --- WEB SPEECH API (Text-to-Speech) ---
        const synth = window.speechSynthesis;
        let utterance = null;
        let isSpeaking = false;
        const articleTextContainer = document.getElementById('article-text-container');
        const listenButton = document.getElementById('listen-btn');
        const statusElement = document.getElementById('tts-status');

        function getArticleText() {
            // Get all text content from the article body elements
            let text = '';
            articleTextContainer.querySelectorAll('h2, p, li').forEach(el => {
                // Use a period and space to ensure proper pauses between paragraphs/headings
                text += el.textContent.trim() + ". "; 
            });
            return text;
        }

        function highlightWord(wordIndex, text) {
            // Find the current speaking word and wrap it in a span for highlighting
            const words = text.split(/\s+/); // Split by space
            
            // Reconstruct HTML with highlight span
            let contentHtml = '';
            let currentWordIndex = 0;

            articleTextContainer.querySelectorAll('h2, p, li').forEach(el => {
                let elementWords = el.textContent.split(/\s+/);
                let elementHtml = el.tagName === 'LI' ? `<li>` : el.tagName === 'P' ? `<p>` : `<h2>`;
                
                elementWords.forEach((word) => {
                    if (!word.trim()) return; // Skip empty strings
                    
                    let cleanWord = word.replace(/[.,\/#!$%\^&\*;:{}=\-_`~()]/g,"");
                    
                    if (currentWordIndex === wordIndex) {
                        elementHtml += `<span class="highlight">${word}</span> `;
                    } else {
                        elementHtml += `${word} `;
                    }
                    currentWordIndex++;
                });
                
                elementHtml += el.tagName === 'LI' ? `</li>` : el.tagName === 'P' ? `</p>` : `</h2>`;
                contentHtml += elementHtml;
            });
            
            // Note: This simple highlighting is highly complex to implement perfectly with Web Speech API 
            // word boundaries and HTML structure. The implementation above is a best-effort demonstration 
            // that focuses on words *after* they've been stripped of structure. For a robust solution, 
            // a dedicated library or more complex DOM manipulation is needed.
        }

        function removeHighlighting() {
            const highlightedSpans = articleTextContainer.querySelectorAll('.highlight');
            highlightedSpans.forEach(span => {
                // Replace the span with its content text
                span.outerHTML = span.innerHTML; 
            });
        }
        
        function startSpeech() {
            if (!synth) {
                statusElement.textContent = "TTS is not supported in this browser.";
                return;
            }

            const text = getArticleText();
            utterance = new SpeechSynthesisUtterance(text);
            
            // Set preferred voice (optional)
            // const voices = synth.getVoices();
            // utterance.voice = voices.find(v => v.lang === 'en-US'); // Try to find an English voice

            utterance.rate = 1.0; // Normal speed
            utterance.pitch = 1.0; 

            utterance.onstart = () => {
                isSpeaking = true;
                listenButton.innerHTML = '<i class="fas fa-pause"></i> Pause Listening';
                statusElement.textContent = "Reading aloud...";
            };
            
            utterance.onend = () => {
                isSpeaking = false;
                listenButton.innerHTML = '<i class="fas fa-volume-up"></i> Listen to this Article';
                statusElement.textContent = "Finished reading.";
                removeHighlighting();
            };
            
            // The boundary event is key for word highlighting
            utterance.onboundary = (event) => {
                if (event.name === 'word') {
                    // Simple highlighting by index is problematic with the stripped text content.
                    // This section is commented out as robust implementation is overly complex for a simple script,
                    // but it shows where the logic would go.
                    // highlightWord(event.charIndex, text); 
                }
            };
            
            synth.speak(utterance);
        }

        function toggleSpeech() {
            if (isSpeaking) {
                if (synth.paused) {
                    synth.resume();
                    listenButton.innerHTML = '<i class="fas fa-pause"></i> Pause Listening';
                    statusElement.textContent = "Reading aloud...";
                } else {
                    synth.pause();
                    listenButton.innerHTML = '<i class="fas fa-play"></i> Resume Listening';
                    statusElement.textContent = "Paused.";
                }
            } else {
                // If a previous utterance exists, stop it before starting new one
                if (synth.speaking) {
                    synth.cancel();
                }
                removeHighlighting(); // Ensure no previous highlights remain
                startSpeech();
            }
        }
        
        // --- INITIALIZATION ---
        document.getElementById('current-year-footer').textContent = new Date().getFullYear();
    </script>
    
    <script>
        // Simple star script placeholder
        function createStars(container, numStars) {
            const minSize = 1;
            const maxSize = 3;
            for (let i = 0; i < numStars; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                container.appendChild(star);
                const size = Math.random() * (maxSize - minSize) + minSize;
                star.style.width = `${size}px`;
                star.style.height = `${size}px`;
                star.style.left = `${Math.random() * 100}%`;
                star.style.top = `${Math.random() * 100}%`;
                star.style.animationDelay = `${Math.random() * 4}s`;
                star.style.animationDuration = `${3 + Math.random() * 2}s`;
            }
        }
        document.addEventListener('DOMContentLoaded', () => {
            const starsContainer = document.getElementById('stars-container');
            if (starsContainer) createStars(starsContainer, 100);
        });
        // Note: The '.star' CSS must be present in the <style> block for stars to show.
    </script>
</body>
</html>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-J1YTKP10ZX"></script>
<script>
¬† window.dataLayer = window.dataLayer || [];
¬† function gtag(){dataLayer.push(arguments);}
¬† gtag('js', new Date()); 

¬† gtag('config', 'G-J1YTKP10ZX');
</script>
