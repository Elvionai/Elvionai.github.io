<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>English Language Assignment</title>
    <style>
        :root {
            --primary-color: #00ffff;
            --secondary-color: #ff00ff;
            --background-color: #1a1a1a;
            --text-color: #f0f0f0;
            --container-bg: #2a2a2a;
            --border-color: #00ffff;
            --error-color: #ff4d4d;
            --success-color: #4dff4d;
        }

        body {
            font-family: 'Courier New', Courier, monospace;
            background-color: var(--background-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .assignment-container {
            width: 100%;
            max-width: 900px;
            background-color: var(--container-bg);
            border: 2px solid var(--border-color);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 0 20px var(--primary-color);
        }

        header {
            text-align: center;
            border-bottom: 2px solid var(--secondary-color);
            padding-bottom: 15px;
            margin-bottom: 20px;
        }

        header h1 {
            color: var(--primary-color);
            margin: 0;
        }

        #student-selection, #timer-container, .question-section, .essay-section {
            margin-bottom: 20px;
        }

        select, button {
            background-color: transparent;
            color: var(--primary-color);
            border: 1px solid var(--primary-color);
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        select:hover, button:hover {
            background-color: var(--primary-color);
            color: var(--background-color);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        #essay-editor {
            width: 100%;
            height: 250px;
            background-color: #1a1a1a;
            color: var(--text-color);
            border: 1px solid var(--secondary-color);
            border-radius: 5px;
            padding: 10px;
        }

        #ai-status {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: inline-block;
            vertical-align: middle;
            margin-left: 10px;
            background-color: var(--error-color);
        }

        #suggestions {
            margin-top: 10px;
            padding: 10px;
            border: 1px dashed var(--secondary-color);
            min-height: 50px;
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>

    <div class="assignment-container">
        <header>
            <h1>English Language Assignment</h1>
            <p>Teacher: Mr. Kola</p>
        </header>

        <div id="student-selection">
            <label for="student-name">Select Your Name:</label>
            <select id="student-name">
                <option value="">--Select--</option>
                <option value="El Rohi">El Rohi</option>
                <option value="Kingspraise">Kingspraise</option>
            </select>
        </div>

        <div id="timer-container" class="hidden">
            <h2>Time Remaining: <span id="time">30:00</span></h2>
        </div>

        <form id="assignment-form" action="https://formspree.io/f/mldrbpwo" method="POST">
            <!-- Hidden input for student name -->
            <input type="hidden" id="student-name-hidden" name="student_name">

            <!-- El Rohi's Assignment -->
            <div id="el-rohi-assignment" class="hidden">
                <div class="question-section">
                    <h3>Multiple Choice Questions</h3>
                    <p>1. Which word is a synonym for "ephemeral"?</p>
                    <input type="radio" name="elrohi_q1" value="a"> a) Transitory<br>
                    <input type="radio" name="elrohi_q1" value="b"> b) Eternal<br>
                    <input type="radio" name="elrohi_q1" value="c"> c) Beautiful<br>

                    <p>2. Complete the sentence: The artist's work was a ________ of vibrant colors and bold strokes.</p>
                    <input type="radio" name="elrohi_q2" value="a"> a) Cacophony<br>
                    <input type="radio" name="elrohi_q2" value="b"> b) Melange<br>
                    <input type="radio" name="elrohi_q2" value="c"> c) Plethora<br>
                </div>
                <div class="essay-section">
                    <h3>Essay Question</h3>
                    <p>Write a short story of at least 150 words about a character who discovers a hidden world.</p>
                </div>
            </div>

            <!-- Kingspraise's Assignment -->
            <div id="kingspraise-assignment" class="hidden">
                <div class="question-section">
                    <h3>Multiple Choice Questions</h3>
                    <p>1. Choose the correctly punctuated sentence:</p>
                    <input type="radio" name="kingspraise_q1" value="a"> a) Let's eat, Grandma.<br>
                    <input type="radio" name="kingspraise_q1" value="b"> b) Lets eat Grandma.<br>
                    <input type="radio" name="kingspraise_q1" value="c"> c) Lets' eat Grandma.<br>

                    <p>2. Which of the following is a complex sentence?</p>
                    <input type="radio" name="kingspraise_q2" value="a"> a) I like to read and write.<br>
                    <input type="radio" name="kingspraise_q2" value="b"> b) Because it was raining, we stayed inside.<br>
                    <input type="radio" name="kingspraise_q2" value="c"> c) The cat sat on the mat.<br>
                </div>
                <div class="essay-section">
                    <h3>Essay Question</h3>
                    <p>In at least 150 words, analyze the theme of friendship in a book you have recently read.</p>
                </div>
            </div>

            <!-- Common Essay and Submission Area -->
            <div id="common-essay-area" class="hidden">
                <textarea id="essay-editor" name="essay" placeholder="Type your essay here..."></textarea>
                <p>Word Count: <span id="word-count">0</span></p>

                <div>
                    <button type="button" id="analyze-btn">Analyze Writing</button>
                    <div id="ai-status"></div>
                </div>
                <div id="suggestions">
                    <p>AI Suggestions will appear here.</p>
                </div>

                <button type="submit" id="submit-btn" disabled>Submit Assignment</button>
            </div>
        </form>
    </div>

    <script>
        const studentSelect = document.getElementById('student-name');
        const timerContainer = document.getElementById('timer-container');
        const elRohiAssignment = document.getElementById('el-rohi-assignment');
        const kingspraiseAssignment = document.getElementById('kingspraise-assignment');
        const commonEssayArea = document.getElementById('common-essay-area');
        const essayEditor = document.getElementById('essay-editor');
        const wordCount = document.getElementById('word-count');
        const submitBtn = document.getElementById('submit-btn');
        const analyzeBtn = document.getElementById('analyze-btn');
        const aiStatus = document.getElementById('ai-status');
        const suggestionsBox = document.getElementById('suggestions');
        const studentNameHidden = document.getElementById('student-name-hidden');

        let pageLocked = false;

        studentSelect.addEventListener('change', () => {
            const selectedStudent = studentSelect.value;
            if (selectedStudent) {
                studentNameHidden.value = selectedStudent;
                if (selectedStudent === 'El Rohi') {
                    elRohiAssignment.classList.remove('hidden');
                } else if (selectedStudent === 'Kingspraise') {
                    kingspraiseAssignment.classList.remove('hidden');
                }
                commonEssayArea.classList.remove('hidden');
                studentSelect.disabled = true;
                timerContainer.classList.remove('hidden');
                startTimer(1800); // 30 minutes
            }
        });

        essayEditor.addEventListener('input', () => {
            const text = essayEditor.value;
            const words = text.trim().split(/\s+/).filter(Boolean);
            wordCount.textContent = words.length;
            if (words.length >= 150) {
                submitBtn.disabled = false;
            } else {
                submitBtn.disabled = true;
            }
        });

        analyzeBtn.addEventListener('click', async () => {
            const text = essayEditor.value;
            if (!text.trim()) {
                suggestionsBox.innerHTML = '<p>Please write something before analyzing.</p>';
                return;
            }

            suggestionsBox.innerHTML = '<p>Analyzing...</p>';
            aiStatus.style.backgroundColor = 'var(--error-color)';

            try {
                const response = await fetch('https://web-production-9a18.up.railway.app/api/llama/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        prompt: text,
                        systemPrompt: "You are an AI assistant that checks for spelling and grammar errors. Provide suggestions for improvement but do not rewrite the text. Start your response with 'Analysis complete.'."
                    })
                });

                if (response.ok) {
                    const data = await response.json();
                    suggestionsBox.innerHTML = `<p>${data.content}</p>`;
                    if (!data.content.toLowerCase().includes('error') && !data.content.toLowerCase().includes('suggestion')) {
                        aiStatus.style.backgroundColor = 'var(--success-color)';
                    }
                } else {
                    suggestionsBox.innerHTML = '<p>Error analyzing text. Please try again.</p>';
                }
            } catch (error) {
                suggestionsBox.innerHTML = '<p>Could not connect to the AI assistant.</p>';
            }
        });

        function startTimer(duration) {
            let timer = duration, minutes, seconds;
            const timeDisplay = document.getElementById('time');
            setInterval(() => {
                minutes = parseInt(timer / 60, 10);
                seconds = parseInt(timer % 60, 10);

                minutes = minutes < 10 ? "0" + minutes : minutes;
                seconds = seconds < 10 ? "0" + seconds : seconds;

                timeDisplay.textContent = minutes + ":" + seconds;

                if (--timer < 0) {
                    timeDisplay.textContent = "Time's up!";
                    submitBtn.click();
                }
            }, 1000);
        }

        document.addEventListener('visibilitychange', () => {
            if (document.visibilityState === 'hidden' && !pageLocked) {
                pageLocked = true;
                document.body.innerHTML = '<h1 style="color: var(--error-color); text-align: center;">You have left the page. Access is now revoked.</h1>';
            }
        });
    </script>
</body>
</html>
