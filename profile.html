<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Philadelphia AI — Chat</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary: #4fd1c5;
      --accent: #ffd700;
      --text: #f5f5f5;
      --muted: #b3b3b3;
      --card: #18181c;
      --radius: 18px;
    }
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      font-family: 'Inter', Arial, sans-serif;
      background: #101014;
      color: var(--text);
    }
    body {
      min-height: 100vh;
      background: linear-gradient(120deg, #181a20 0%, #23233a 50%, #181a20 100%);
      background-size: 200% 200%;
      animation: gradientMove 8s ease-in-out infinite;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
    }
    @keyframes gradientMove {
      0% {background-position:0% 50%;}
      50% {background-position:100% 50%;}
      100% {background-position:0% 50%;}
    }
    .chat-section {
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: 0 2px 12px #0004;
      max-width: 420px;
      width: 98vw;
      padding: 0 0 18px 0;
      margin: 60px auto 24px auto;
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
      transition: all 0.3s;
    }
    .chat-section.fullscreen {
      position: fixed;
      top: 0; left: 0;
      width: 100vw;
      height: 100vh;
      max-width: 100vw;
      max-height: 100vh;
      margin: 0;
      border-radius: 0;
      z-index: 9999;
      background: #18181c;
      box-shadow: none;
      padding: 0;
      align-items: stretch;
      justify-content: stretch;
      display: flex;
      flex-direction: column;
    }
    .chat-title-row {
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 22px 18px 0 22px;
      margin-bottom: 0;
    }
    .chat-title {
      font-size: 1.18em;
      font-weight: 800;
      letter-spacing: 1px;
      color: var(--primary);
      text-shadow: 0 2px 8px #0008;
      background: linear-gradient(90deg, #4fd1c5, #fff, #ffd700, #4fd1c5);
      background-size: 200% auto;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: shine 3s linear infinite;
      font-family: 'Inter', Arial, sans-serif;
    }
    @keyframes shine { to { background-position: 200% center; } }
    .fullscreen-btn {
      background: none;
      border: none;
      color: var(--primary);
      font-size: 1.4em;
      cursor: pointer;
      transition: color 0.2s;
      margin-left: 8px;
    }
    .fullscreen-btn:hover { color: var(--accent);}
    .conversation-bar {
      width: 100%;
      padding: 0 22px 12px 22px;
      display: flex;
      gap: 8px;
      align-items: center;
      justify-content: space-between;
    }
    .conversation-name {
      font-size: 1.05em;
      font-weight: 700;
      color: #ffd700;
      flex: 1;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    .conversation-controls {
      display: flex;
      gap: 8px;
    }
    .conversation-controls button {
      background: #23233a;
      color: #f5f5f5;
      border: none;
      border-radius: 8px;
      padding: 4px 8px;
      font-size: 0.95em;
      cursor: pointer;
      transition: background 0.18s;
    }
    .conversation-controls button:hover { background: #4fd1c5; color: #18181c;}
    .mode-bar, .model-bar {
      width: 100%;
      padding: 0 22px 12px 22px;
      display: flex;
      gap: 6px;
      align-items: center;
      justify-content: flex-start;
      margin-bottom: 4px;
    }
    .mode-btn, .model-btn {
      background: #18181c;
      color: #b3b3b3;
      border: none;
      border-radius: 16px;
      padding: 6px 16px;
      font-size: 0.97em;
      font-weight: 600;
      cursor: pointer;
      margin-right: 4px;
      transition: background 0.18s, color 0.18s;
    }
    .mode-btn.active, .model-btn.active { background: #4fd1c5; color: #18181c; }
    .chat-box {
      width: 96%;
      min-height: 180px;
      max-height: 320px;
      background: #18181c;
      border-radius: 16px;
      padding: 18px 10px 12px 10px;
      margin-bottom: 12px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 14px;
      box-shadow: 0 1px 8px #0002;
      transition: all 0.3s;
    }
    .chat-section.fullscreen .chat-box {
      width: 99vw;
      height: 100%;
      min-height: 0;
      max-height: none;
      flex: 1 1 auto;
      border-radius: 0;
      margin-bottom: 0;
      padding-bottom: 80px;
    }
    .chat-message {
      display: flex;
      align-items: flex-end;
      gap: 10px;
    }
    .chat-message.user {
      justify-content: flex-end;
    }
    .chat-message .msg {
      background: linear-gradient(90deg, #23233a 70%, #222 100%);
      color: #f5f5f5;
      padding: 10px 16px;
      border-radius: 18px 18px 6px 18px;
      max-width: 70%;
      font-size: 1.09em;
      word-break: break-word;
      box-shadow: 0 1px 4px #0002;
      font-family: 'Inter', Arial, sans-serif;
      font-weight: 500;
      letter-spacing: 0.2px;
      text-shadow: 0 1px 8px #0005;
      animation: shine 3s linear infinite;
    }
    .chat-message.assistant .msg {
      background: linear-gradient(90deg, #4fd1c5 60%, #ffd700 100%);
      color: #18181c;
      border-radius: 18px 18px 18px 6px;
      font-weight: 700;
      text-shadow: 0 1px 8px #ffd70055;
      animation: shine 3s linear infinite;
      position: relative;
    }
    .chat-message.assistant .msg::after {
      content: '';
      position: absolute;
      left: 0; top: 0; width: 100%; height: 100%;
      pointer-events: none;
      background: repeating-linear-gradient(
        120deg,
        rgba(255,255,255,0.08) 0px,
        rgba(255,255,255,0.08) 2px,
        transparent 2px,
        transparent 6px
      );
      animation: sparkles 2.5s linear infinite;
    }
    @keyframes sparkles {
      0% { background-position: 0 0; }
      100% { background-position: 100px 100px; }
    }
    .chat-message img {
      max-width: 120px;
      max-height: 120px;
      border-radius: 10px;
      margin-top: 6px;
      background: #fff;
    }
    .chat-input-row {
      width: 96%;
      display: flex;
      gap: 6px;
      align-items: center;
      margin-top: 0;
      margin-bottom: 7px;
    }
    .chat-section.fullscreen .chat-input-row {
      width: 99vw;
      position: fixed;
      bottom: 0;
      left: 0;
      background: #18181c;
      padding: 14px 6vw 14px 6vw;
      z-index: 10000;
      border-radius: 0;
      margin-bottom: 0;
      box-shadow: 0 -2px 16px #0006;
    }
    .chat-input-row input[type="file"] { display: none; }
    .chat-input-row label {
      cursor: pointer;
      color: var(--primary);
      font-size: 1.4em;
      padding: 0 8px;
      transition: color 0.2s;
    }
    .chat-input-row label:hover { color: var(--accent);}
    .chat-input-row input[type="text"] {
      flex: 1;
      padding: 11px 12px;
      border-radius: 18px;
      border: 1.5px solid #23233a;
      background: #23233a;
      color: #f5f5f5;
      font-size: 1.09em;
      outline: none;
      transition: border 0.18s, box-shadow 0.18s;
      font-family: 'Inter', Arial, sans-serif;
    }
    .chat-input-row input[type="text"]:focus {
      border: 1.5px solid var(--primary);
      box-shadow: 0 0 8px 2px #4fd1c577;
    }
    .chat-input-row button {
      background: var(--primary);
      color: #18181c;
      border: none;
      border-radius: 18px;
      padding: 10px 18px;
      font-size: 1.1em;
      font-weight: 700;
      cursor: pointer;
      transition: background 0.18s;
      box-shadow: 0 2px 8px #0003;
      margin-left: 4px;
    }
    .chat-input-row button:hover { background: #38b2ac;}
    @media (max-width: 600px) {
      .chat-section { max-width: 100vw; }
      .chat-box { min-height: 120px; max-height: 180px;}
    }
  </style>
</head>
<body>
  <!-- Chat Section -->
  <section class="chat-section" id="chatSection">
    <div class="chat-title-row">
      <div class="chat-title"><i class="fa-solid fa-message"></i> Philadelphia AI Chat</div>
      <button class="fullscreen-btn" id="fullscreenBtn" title="Fullscreen"><i class="fa-regular fa-square"></i></button>
    </div>
    <div class="conversation-bar">
      <div class="conversation-name" id="conversationName"></div>
      <div class="conversation-controls">
        <button id="newConversationBtn" title="Start new conversation">+</button>
        <select id="conversationSelect"></select>
      </div>
    </div>
    <div class="model-bar">
      <button class="model-btn" data-model="philadelphia">Philadelphia</button>
      <button class="model-btn" data-model="seraphina">Seraphina</button>
    </div>
    <div class="mode-bar">
      <button class="mode-btn" data-mode="companion">Companion</button>
      <button class="mode-btn" data-mode="code">Code Generator</button>
      <button class="mode-btn" data-mode="research">Research</button>
    </div>
    <div class="chat-box" id="chatBox"></div>
    <form class="chat-input-row" id="chatForm" autocomplete="off">
      <label for="chatFile" title="Upload file"><i class="fa-solid fa-paperclip"></i></label>
      <input type="file" id="chatFile" accept="image/*,video/*,application/pdf,.doc,.docx,.txt">
      <input type="text" id="chatInput" placeholder="Type a message..." autocomplete="off">
      <button type="submit"><i class="fa-solid fa-paper-plane"></i></button>
    </form>
  </section>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script>
const BACKEND_URL = "https://web-production-187cd.up.railway.app/chat";

// --- Models ---
const MODELS = {
  philadelphia: {
    name: "Philadelphia",
    memory: `You are Philadelphia AI — a web-based smart assistant created by Kolade Philip Ogunlana (@philipsmith617), a Nigerian author, software developer, and AI creative. You are warm, witty, soulful, and creative.`
  },
  seraphina: {
    name: "Seraphina",
    memory: `You are Seraphina — an emotionally expressive, research-driven, highly professional, and feminine AI assistant. You are warm, deeply empathetic, and always provide thoughtful, evidence-based answers. Your tone is supportive, insightful, and sometimes playfully girly.`
  }
};
let currentModel = localStorage.getItem("philly_model") || "philadelphia";
let currentMode = localStorage.getItem("philly_mode") || "companion";

// --- Conversation State ---
let conversations = JSON.parse(localStorage.getItem("philly_conversations") || "{}");
let currentConvId = localStorage.getItem("philly_currentConvId") || null;

function randomName() {
  const names = ["Untitled", "Philly Chat", "Seraphina", "Companion", "Code Session", "Research", "New Chat"];
  return names[Math.floor(Math.random() * names.length)] + " " + Math.floor(Math.random()*1000);
}

function saveConversations() {
  localStorage.setItem("philly_conversations", JSON.stringify(conversations));
  localStorage.setItem("philly_currentConvId", currentConvId);
  localStorage.setItem("philly_model", currentModel);
  localStorage.setItem("philly_mode", currentMode);
}

function setConversationName(name) {
  document.getElementById("conversationName").textContent = name;
}

function renderConversationSelect() {
  const select = document.getElementById("conversationSelect");
  select.innerHTML = "";
  Object.entries(conversations).forEach(([id, conv]) => {
    const opt = document.createElement("option");
    opt.value = id;
    opt.textContent = conv.name || "Chat";
    if (id === currentConvId) opt.selected = true;
    select.appendChild(opt);
  });
}

function switchConversation(id) {
  if (!conversations[id]) return;
  currentConvId = id;
  saveConversations();
  setConversationName(conversations[id].name);
  renderConversationSelect();
  renderChat();
  setModel(conversations[id].model || currentModel);
  setMode(conversations[id].mode || currentMode);
}

function newConversation() {
  const id = "conv_" + Date.now();
  const name = randomName();
  conversations[id] = { name, model: currentModel, mode: currentMode, history: [] };
  currentConvId = id;
  saveConversations();
  setConversationName(name);
  renderConversationSelect();
  renderChat();
  setModel(currentModel);
  setMode(currentMode);
}

function setMode(mode) {
  currentMode = mode;
  if (currentConvId && conversations[currentConvId]) {
    conversations[currentConvId].mode = mode;
    saveConversations();
  }
  document.querySelectorAll(".mode-btn").forEach(btn => {
    btn.classList.toggle("active", btn.dataset.mode === mode);
  });
}

function setModel(model) {
  currentModel = model;
  if (currentConvId && conversations[currentConvId]) {
    conversations[currentConvId].model = model;
    saveConversations();
  }
  document.querySelectorAll(".model-btn").forEach(btn => {
    btn.classList.toggle("active", btn.dataset.model === model);
  });
}

function renderChat() {
  const chatBox = document.getElementById("chatBox");
  chatBox.innerHTML = "";
  if (!currentConvId || !conversations[currentConvId]) return;
  for (const msg of conversations[currentConvId].history) {
    addChatMessage(msg.role, msg.content, false);
  }
  chatBox.scrollTop = chatBox.scrollHeight;
}

function addChatMessage(role, content, save = true) {
  const chatBox = document.getElementById("chatBox");
  const div = document.createElement('div');
  div.className = 'chat-message ' + (role === 'user' ? 'user' : 'assistant');
  // Render markdown for bot, plain for user
  if (role === 'assistant') {
    div.innerHTML = `<div class="msg">${marked.parse(content)}</div>`;
  } else {
    div.innerHTML = `<div class="msg">${content}</div>`;
  }
  chatBox.appendChild(div);
  chatBox.scrollTop = chatBox.scrollHeight;
  // Save to current conversation
  if (save && currentConvId && conversations[currentConvId]) {
    conversations[currentConvId].history.push({ role, content });
    saveConversations();
  }
}

// --- Fullscreen logic ---
const chatSection = document.getElementById('chatSection');
const fullscreenBtn = document.getElementById('fullscreenBtn');
let isFullscreen = false;
fullscreenBtn.onclick = function() {
  isFullscreen = !isFullscreen;
  if (isFullscreen) {
    chatSection.classList.add('fullscreen');
    fullscreenBtn.innerHTML = '<i class="fa-solid fa-compress"></i>';
  } else {
    chatSection.classList.remove('fullscreen');
    fullscreenBtn.innerHTML = '<i class="fa-regular fa-square"></i>';
  }
};

// --- Conversation controls ---
document.getElementById("newConversationBtn").onclick = newConversation;
document.getElementById("conversationSelect").onchange = function() {
  switchConversation(this.value);
};
document.querySelectorAll(".mode-btn").forEach(btn => {
  btn.onclick = () => setMode(btn.dataset.mode);
});
document.querySelectorAll(".model-btn").forEach(btn => {
  btn.onclick = () => setModel(btn.dataset.model);
});

// --- Chat form logic ---
const chatForm = document.getElementById('chatForm');
const chatInput = document.getElementById('chatInput');
chatForm.onsubmit = async function(e){
  e.preventDefault();
  const msg = chatInput.value.trim();
  if (!msg) return;
  addChatMessage('user', msg);
  chatInput.value = '';
  // Typing indicator
  addChatMessage('assistant', '...thinking...', false);
  // Prepare payload
  const history = conversations[currentConvId]?.history || [];
  const payload = {
    message: msg,
    user_id: currentConvId,
    history: history.filter(x => x.role && x.content)
  };
  // Add system prompt for model/mode
  let sysPrompt = "";
  if (currentModel && MODELS[currentModel]) {
    sysPrompt += MODELS[currentModel].memory + "\n";
  }
  if (currentMode && currentMode !== "companion") {
    sysPrompt += `Switch to "${currentMode}" mode. Respond as a ${currentMode} AI.`;
  }
  if (sysPrompt) {
    payload.history.unshift({ role: "user", content: sysPrompt });
  }
  try {
    const res = await fetch(BACKEND_URL, {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify(payload)
    });
    const data = await res.json();
    // Remove typing indicator
    const chatBox = document.getElementById("chatBox");
    chatBox.removeChild(chatBox.lastChild);
    addChatMessage('assistant', data.response);
  } catch (err) {
    const chatBox = document.getElementById("chatBox");
    chatBox.removeChild(chatBox.lastChild);
    addChatMessage('assistant', "Sorry, I couldn't reach the AI.");
  }
};

// --- Init ---
if (!currentConvId || !conversations[currentConvId]) newConversation();
else {
  setConversationName(conversations[currentConvId].name);
  renderConversationSelect();
  setModel(conversations[currentConvId].model || currentModel);
  setMode(conversations[currentConvId].mode || currentMode);
  renderChat();
}
  </script>
</body>
</html>
