<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Course Viewer | Elvion University</title>
  <meta name="description" content="Learn with interactive courses at Elvion University">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Orbitron:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --dark-navy: #00001a;
      --black-bg: #000000;
      --cyan-glow: #00ffff;
      --light-blue-glow: #00aaff;
      --text-color: #e0e0e0;
      --heading-color: #ffffff;
      --gradient-start: #0a1128;
      --gradient-end: #121a30;
      --card-bg: rgba(18, 26, 48, 0.85);
      --border-glow: 0 0 10px var(--cyan-glow), 0 0 20px var(--light-blue-glow);
      --hover-glow: 0 0 15px var(--cyan-glow), 0 0 30px var(--light-blue-glow);
      --button-bg: linear-gradient(45deg, var(--cyan-glow), var(--light-blue-glow));
      --button-text-color: var(--black-bg);
      --star-color: rgba(255, 255, 255, 0.7);
      --sidebar-width: 300px;
      --success-color: #4ade80;
      --warning-color: #fbbf24;
      --error-color: #f87171;
      --primary-color: var(--cyan-glow);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html { scroll-behavior: smooth; }

    body {
      font-family: 'Inter', sans-serif;
      background-color: var(--black-bg);
      color: var(--text-color);
      line-height: 1.7;
      overflow-x: hidden;
      position: relative;
      min-height: 100vh;
    }

    h1, h2, h3, h4, h5, h6 {
      font-family: 'Orbitron', sans-serif;
      color: var(--heading-color);
      margin-top: 0;
    }

    /* Stars Animation */
    #stars-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 0;
      overflow: hidden;
    }

    .star {
      position: absolute;
      background-color: var(--star-color);
      border-radius: 50%;
      opacity: 0;
      animation: twinkle 4s infinite ease-in-out;
    }

    @keyframes twinkle {
      0%, 100% { opacity: 0; transform: scale(0.5); }
      50% { opacity: 1; transform: scale(1); }
    }

    /* Main Layout */
    .course-viewer-container {
      display: flex;
      min-height: 100vh;
      position: relative;
      z-index: 1;
    }

    /* Course Sidebar */
    .course-sidebar {
      width: var(--sidebar-width);
      background: var(--card-bg);
      backdrop-filter: blur(10px);
      border-right: 1px solid rgba(0, 255, 255, 0.2);
      position: fixed;
      height: 100vh;
      overflow-y: auto;
      z-index: 100;
      transition: transform 0.3s ease;
    }

    .course-sidebar-header {
      padding: 1.5rem;
      border-bottom: 1px solid rgba(0, 255, 255, 0.1);
    }

    .back-btn {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      color: var(--cyan-glow);
      text-decoration: none;
      font-weight: 600;
      padding: 0.8rem;
      border-radius: 8px;
      transition: all 0.3s ease;
      margin-bottom: 1rem;
    }

    .back-btn:hover {
      background: rgba(0, 255, 255, 0.1);
    }

    .course-info {
      text-align: center;
    }

    .course-icon-large {
      font-size: 3rem;
      color: var(--cyan-glow);
      text-shadow: var(--border-glow);
      margin-bottom: 1rem;
    }

    .course-title {
      font-size: 1.4rem;
      margin-bottom: 0.5rem;
      color: var(--heading-color);
    }

    .course-subtitle {
      font-size: 0.9rem;
      color: var(--text-color);
      opacity: 0.8;
      margin-bottom: 1rem;
    }

    .overall-progress {
      background: rgba(0, 0, 0, 0.3);
      border-radius: 10px;
      padding: 1rem;
      margin-bottom: 1rem;
    }

    .progress-label {
      font-size: 0.85rem;
      color: var(--text-color);
      margin-bottom: 0.5rem;
    }

    .progress-bar-container {
      width: 100%;
      height: 8px;
      background: rgba(0, 255, 255, 0.1);
      border-radius: 10px;
      overflow: hidden;
      margin-bottom: 0.5rem;
    }

    .progress-bar-fill {
      height: 100%;
      background: var(--button-bg);
      border-radius: 10px;
      transition: width 0.8s ease;
      box-shadow: 0 0 10px var(--cyan-glow);
    }

    .progress-text {
      font-size: 0.85rem;
      color: var(--cyan-glow);
      font-weight: 600;
    }

    /* Lessons List */
    .lessons-list {
      padding: 1rem 0;
    }

    .lessons-header {
      padding: 0 1.5rem 1rem 1.5rem;
      font-size: 1.1rem;
      color: var(--heading-color);
      border-bottom: 1px solid rgba(0, 255, 255, 0.1);
    }

    .lesson-item {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 1rem 1.5rem;
      cursor: pointer;
      transition: all 0.3s ease;
      border-left: 3px solid transparent;
    }

    .lesson-item:hover {
      background: rgba(0, 255, 255, 0.05);
    }

    .lesson-item.active {
      background: rgba(0, 255, 255, 0.1);
      border-left-color: var(--cyan-glow);
    }

    .lesson-item.completed {
      opacity: 0.8;
    }

    .lesson-status {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.8rem;
      flex-shrink: 0;
    }

    .lesson-status.completed {
      background: var(--success-color);
      color: var(--black-bg);
    }

    .lesson-status.current {
      background: var(--cyan-glow);
      color: var(--black-bg);
    }

    .lesson-status.locked {
      background: rgba(255, 255, 255, 0.1);
      color: var(--text-color);
    }

    .lesson-details {
      flex: 1;
    }

    .lesson-title {
      font-size: 0.9rem;
      font-weight: 600;
      color: var(--heading-color);
      margin-bottom: 0.3rem;
    }

    .lesson-duration {
      font-size: 0.8rem;
      color: var(--text-color);
      opacity: 0.7;
    }

    /* Mobile Menu Toggle */
    .mobile-menu-toggle {
      display: none;
      position: fixed;
      top: 1rem;
      left: 1rem;
      z-index: 101;
      background: var(--card-bg);
      border: 1px solid var(--cyan-glow);
      border-radius: 8px;
      padding: 0.5rem 0.8rem;
      color: var(--cyan-glow);
      cursor: pointer;
      box-shadow: var(--border-glow);
    }

    /* Content Area */
    .content-area {
      flex: 1;
      margin-left: var(--sidebar-width);
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    .content-header {
      background: var(--card-bg);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid rgba(0, 255, 255, 0.1);
      padding: 1.5rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 1rem;
    }

    .lesson-info h1 {
      font-size: 1.5rem;
      margin-bottom: 0.5rem;
    }

    .lesson-meta {
      display: flex;
      gap: 1.5rem;
      font-size: 0.9rem;
      color: var(--text-color);
    }

    .lesson-meta span {
      display: flex;
      align-items: center;
      gap: 0.3rem;
    }

    .content-actions {
      display: flex;
      gap: 1rem;
      align-items: center;
    }

    .action-btn {
      padding: 0.8rem 1.5rem;
      background: var(--button-bg);
      color: var(--button-text-color);
      border: none;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      font-family: 'Inter', sans-serif;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .action-btn:hover {
      box-shadow: var(--border-glow);
      transform: scale(1.05);
    }

    .action-btn.secondary {
      background: transparent;
      border: 2px solid var(--cyan-glow);
      color: var(--cyan-glow);
    }

    .action-btn.secondary:hover {
      background: var(--cyan-glow);
      color: var(--black-bg);
    }

    .action-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    /* Main Content */
    .main-content {
      flex: 1;
      padding: 2rem;
      background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
    }

    .content-card {
      background: var(--card-bg);
      border-radius: 15px;
      padding: 2rem;
      box-shadow: var(--border-glow);
      backdrop-filter: blur(5px);
      border: 1px solid rgba(0, 255, 255, 0.1);
      margin-bottom: 2rem;
      max-width: 900px; /* Fitting to page constraint */
      margin-left: auto;
      margin-right: auto;
    }

    .lesson-content {
      line-height: 1.8;
      font-size: 1.1rem;
    }

    .lesson-content h2 {
      color: var(--cyan-glow);
      margin: 2rem 0 1rem 0;
      font-size: 1.4rem;
    }

    .lesson-content h3 {
      color: var(--heading-color);
      margin: 1.5rem 0 0.8rem 0;
      font-size: 1.2rem;
    }

    .lesson-content p {
      margin-bottom: 1.2rem;
    }

    .lesson-content ul, .lesson-content ol {
      margin: 1rem 0 1rem 2rem;
    }

    .lesson-content li {
      margin-bottom: 0.5rem;
    }
    
    /* Code block styling for practical examples */
    .lesson-content code {
      background: rgba(0, 255, 255, 0.1);
      padding: 0.2rem 0.5rem;
      border-radius: 4px;
      color: var(--cyan-glow);
      font-family: 'Courier New', monospace;
    }

    .lesson-content pre {
      background: rgba(0, 0, 0, 0.5);
      padding: 1.5rem;
      border-radius: 8px;
      border-left: 4px solid var(--cyan-glow);
      overflow-x: auto;
      margin: 1.5rem 0;
      box-shadow: 0 0 5px rgba(0, 255, 255, 0.3);
      position: relative;
    }

    .lesson-content pre code {
      background: none;
      padding: 0;
      color: var(--text-color);
      display: block;
      white-space: pre-wrap;
      word-break: break-all;
    }

    /* Interactive Code/Markdown Area Simulation */
    .interactive-code-area {
        background: #1e1e2d;
        border: 2px solid var(--primary-color);
        border-radius: 8px;
        padding: 1rem;
        margin: 1.5rem 0;
        box-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
    }
    .interactive-code-area textarea {
        width: 100%;
        min-height: 150px;
        background: transparent;
        color: var(--success-color);
        border: none;
        resize: vertical;
        padding: 0.5rem;
        font-family: 'Courier New', monospace;
        font-size: 1rem;
        outline: none;
    }
    .interactive-code-area .output {
        border-top: 1px dashed rgba(255, 255, 255, 0.2);
        padding-top: 0.5rem;
        color: var(--warning-color);
        font-size: 0.9rem;
        min-height: 30px;
        margin-top: 0.5rem;
    }
    .interactive-code-area .area-header {
        font-size: 0.8rem;
        color: var(--primary-color);
        margin-bottom: 0.5rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }


    /* Video Player Placeholder */
    .media-player {
      width: 100%;
      height: 400px;
      background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 2rem;
      border: 1px solid rgba(0, 255, 255, 0.2);
      max-width: 900px;
      margin-left: auto;
      margin-right: auto;
    }

    .media-placeholder {
      text-align: center;
      color: var(--text-color);
    }

    .media-placeholder i {
      font-size: 4rem;
      color: var(--cyan-glow);
      margin-bottom: 1rem;
      display: block;
    }

    /* Navigation Controls */
    .lesson-navigation {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1.5rem 2rem;
      background: var(--card-bg);
      backdrop-filter: blur(10px);
      border-top: 1px solid rgba(0, 255, 255, 0.1);
    }

    .nav-info {
      display: flex;
      align-items: center;
      gap: 1rem;
      font-size: 0.9rem;
      color: var(--text-color);
    }

    .lesson-indicator {
      background: rgba(0, 255, 255, 0.1);
      padding: 0.5rem 1rem;
      border-radius: 20px;
      border: 1px solid rgba(0, 255, 255, 0.3);
    }

    .nav-buttons {
      display: flex;
      gap: 1rem;
    }

    /* Quiz/Assessment Styles */
    .quiz-container {
      background: var(--card-bg);
      border-radius: 15px;
      padding: 2rem;
      box-shadow: var(--border-glow);
      backdrop-filter: blur(5px);
      border: 1px solid rgba(0, 255, 255, 0.1);
      margin-bottom: 2rem;
      max-width: 900px;
      margin-left: auto;
      margin-right: auto;
    }

    .quiz-question {
      font-size: 1.2rem;
      color: var(--heading-color);
      margin-bottom: 1.5rem;
      border-bottom: 1px solid rgba(0, 255, 255, 0.1);
      padding-bottom: 1rem;
    }

    .quiz-options {
      display: grid;
      gap: 1rem;
      margin-bottom: 2rem;
    }

    .quiz-option {
      padding: 1rem 1.5rem;
      background: rgba(0, 0, 0, 0.3);
      border: 2px solid rgba(0, 255, 255, 0.2);
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease, transform 0.1s ease; /* Added transform for animation */
      color: var(--text-color);
      position: relative;
    }

    .quiz-option:hover {
      border-color: var(--cyan-glow);
      background: rgba(0, 255, 255, 0.05);
      transform: translateY(-2px); /* Slight hover animation */
    }

    .quiz-option.selected {
      border-color: var(--cyan-glow);
      background: rgba(0, 255, 255, 0.1);
      color: var(--cyan-glow);
    }
    
    /* Correct/Incorrect state styling with simple animation */
    .quiz-option.correct {
      border-color: var(--success-color) !important;
      background: rgba(74, 222, 128, 0.1) !important;
      color: var(--success-color) !important;
      animation: flash-correct 0.3s ease-in-out;
    }

    .quiz-option.incorrect {
      border-color: var(--error-color) !important;
      background: rgba(248, 113, 113, 0.1) !important;
      color: var(--error-color) !important;
      animation: shake 0.3s;
    }
    
    .quiz-option.correct::after {
      content: ' (Correct)';
      color: var(--success-color);
      font-weight: bold;
      margin-left: 10px;
    }
    .quiz-option.incorrect::after {
      content: ' (Incorrect)';
      color: var(--error-color);
      font-weight: bold;
      margin-left: 10px;
    }
    
    @keyframes flash-correct {
        0% { opacity: 0.5; }
        100% { opacity: 1; }
    }
    
    @keyframes shake {
        0%, 100% { transform: translateX(0); }
        20%, 60% { transform: translateX(-5px); }
        40%, 80% { transform: translateX(5px); }
    }


    .quiz-feedback {
      padding: 1rem;
      border-radius: 8px;
      margin-top: 1rem;
      display: none;
    }

    .quiz-feedback.correct {
      background: rgba(74, 222, 128, 0.1);
      border: 1px solid rgba(74, 222, 128, 0.3);
      color: var(--success-color);
      display: block;
    }

    .quiz-feedback.incorrect {
      background: rgba(248, 113, 113, 0.1);
      border: 1px solid rgba(248, 113, 113, 0.3);
      color: var(--error-color);
      display: block;
    }
    
    /* Completion Modal Adjustments */
    .completion-modal .completion-icon {
        font-size: 4rem;
        color: var(--success-color);
        text-shadow: 0 0 10px var(--success-color);
        margin-bottom: 1rem;
        animation: pulse 1s infinite alternate;
    }
    
    .completion-modal .points-earned {
        font-size: 1.2rem;
        font-weight: 700;
        color: var(--cyan-glow);
        margin: 1.5rem 0;
        padding: 0.5rem 1rem;
        background: rgba(0, 255, 255, 0.1);
        border-radius: 8px;
        display: inline-block;
        border: 1px solid var(--cyan-glow);
    }
    
    @keyframes pulse {
        from { transform: scale(1); opacity: 0.8; }
        to { transform: scale(1.05); opacity: 1; }
    }


    /* Certificate Form & Final Page Styles */
    .final-page-content {
      max-width: 900px;
      margin: 0 auto;
      text-align: center;
    }
    .certificate-form-card {
      background: var(--card-bg);
      border-radius: 15px;
      padding: 3rem;
      box-shadow: var(--hover-glow);
      border: 1px solid var(--primary-color);
      text-align: left;
      margin-top: 2rem;
    }
    .certificate-form-card h2 {
      color: var(--success-color);
      text-shadow: 0 0 10px var(--success-color);
      margin-bottom: 1.5rem;
    }
    .certificate-form-card label {
      display: block;
      margin-top: 1rem;
      margin-bottom: 0.5rem;
      font-weight: 600;
      color: var(--text-color);
    }
    .certificate-form-card input[type="text"],
    .certificate-form-card input[type="email"] {
      width: 100%;
      padding: 0.8rem;
      border: 2px solid rgba(0, 255, 255, 0.3);
      border-radius: 8px;
      background: rgba(0, 0, 0, 0.3);
      color: var(--text-color);
      font-size: 1rem;
      transition: border-color 0.3s ease;
    }
    .certificate-form-card input:focus {
      border-color: var(--cyan-glow);
      box-shadow: 0 0 5px var(--cyan-glow);
      outline: none;
    }
    .certificate-form-card .submit-btn {
      width: 100%;
      margin-top: 2rem;
    }

    /* Comment Section Styles */
    .comment-section {
        background: rgba(0, 0, 0, 0.3);
        border-radius: 10px;
        padding: 1.5rem;
        margin-top: 2rem;
        border: 1px solid rgba(255, 255, 255, 0.1);
    }
    .comment-section textarea {
        width: 100%;
        min-height: 100px;
        padding: 1rem;
        border-radius: 8px;
        border: 2px solid rgba(0, 255, 255, 0.3);
        background: rgba(0, 0, 0, 0.5);
        color: var(--text-color);
        font-size: 1rem;
        resize: vertical;
        outline: none;
        transition: border-color 0.3s ease;
    }
    .comment-section textarea:focus {
        border-color: var(--cyan-glow);
        box-shadow: 0 0 5px var(--cyan-glow);
    }
    .comment-section .comment-btn {
        margin-top: 1rem;
        padding: 0.6rem 1.2rem;
        font-weight: 500;
        float: right;
    }

    /* Completion Modal */
    .completion-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      backdrop-filter: blur(5px);
    }

    .completion-content {
      background: var(--card-bg);
      padding: 3rem;
      border-radius: 15px;
      text-align: center;
      max-width: 500px;
      box-shadow: var(--hover-glow);
      border: 1px solid rgba(0, 255, 255, 0.3);
    }
    
    /* Loading State */
    .loading-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 50vh;
    }

    .loading-spinner {
      width: 60px;
      height: 60px;
      border: 4px solid rgba(0, 255, 255, 0.1);
      border-top-color: var(--cyan-glow);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .loading-text {
      margin-top: 1rem;
      color: var(--text-color);
      font-size: 1.1rem;
    }

    /* Responsive Design */
    @media (max-width: 992px) {
      .course-sidebar {
        transform: translateX(-100%);
      }

      .course-sidebar.active {
        transform: translateX(0);
      }

      .content-area {
        margin-left: 0;
      }

      .mobile-menu-toggle {
        display: block;
      }

      .main-content {
        padding: 1rem;
        padding-top: 4rem;
      }

      .content-header {
        padding: 1rem;
        flex-direction: column;
        align-items: flex-start;
      }

      .content-actions {
        width: 100%;
        justify-content: stretch;
      }

      .action-btn {
        flex: 1;
        justify-content: center;
      }

      .lesson-navigation {
        padding: 1rem;
        flex-direction: column;
        gap: 1rem;
      }

      .nav-buttons {
        width: 100%;
        justify-content: stretch;
      }

      .nav-buttons .action-btn {
        flex: 1;
      }
    }

    @media (max-width: 768px) {
      .media-player {
        height: 250px;
      }

      .content-card {
        padding: 1.5rem;
      }

      .completion-content {
        margin: 1rem;
        padding: 2rem;
      }

      .quiz-option {
        padding: 0.8rem 1rem;
      }
    }
  </style>
</head>
<body>
  <div id="stars-container"></div>

  <button class="mobile-menu-toggle" id="mobileMenuToggle">
    <i class="fas fa-bars"></i>
  </button>

  <div class="course-viewer-container">
    <aside class="course-sidebar" id="courseSidebar">
      <div class="course-sidebar-header">
        <a href="studyingatelvion.html" class="back-btn">
          <i class="fas fa-arrow-left"></i>
          Back to Dashboard
        </a>
        
        <div class="course-info">
          <i id="courseIconLarge" class="course-icon-large"></i>
          <h2 id="courseTitle" class="course-title">Loading...</h2>
          <p id="courseSubtitle" class="course-subtitle">Please wait...</p>
          
          <div class="overall-progress">
            <div class="progress-label">Overall Progress</div>
            <div class="progress-bar-container">
              <div id="overallProgressBar" class="progress-bar-fill" style="width: 0%"></div>
            </div>
            <div class="progress-text"><span id="overallProgressText">0% Complete</span></div>
            <div class="progress-text" style="margin-top: 0.5rem;"><i class="fas fa-trophy"></i> Total Points: <span id="totalPointsEarnedSidebar">0</span></div>
          </div>
        </div>
      </div>

      <div class="lessons-list">
        <div class="lessons-header">Course Lessons</div>
        <div id="lessonsContainer">
          </div>
      </div>
    </aside>

    <main class="content-area">
      <div class="loading-container" id="loadingContainer">
        <div class="loading-spinner"></div>
        <p class="loading-text">Loading course content...</p>
      </div>

      <header class="content-header" id="contentHeader" style="display: none;">
        <div class="lesson-info">
          <h1 id="lessonTitle">Lesson Title</h1>
          <div class="lesson-meta">
            <span><i class="fas fa-clock"></i> <span id="lessonDuration">45 min</span></span>
            <span><i class="fas fa-book"></i> Lesson <span id="currentLessonNumber">1</span> of <span id="totalLessons">8</span></span>
            <span><i class="fas fa-star"></i> <span id="lessonPoints">10</span> Points</span>
          </div>
        </div>
        <div class="content-actions">
          <button id="markCompleteBtn" class="action-btn" style="display: none;">
            <i class="fas fa-check"></i>
            Mark Complete
          </button>
        </div>
      </header>

      <section class="main-content" id="mainContent" style="display: none;">
        
        <div id="finalCoursePage" style="display: none;" class="final-page-content">
            <h1 style="color: var(--success-color); text-shadow: var(--hover-glow);">Course Completed!</h1>
            <p class="lead" style="margin-bottom: 2rem;">
                Congratulations! You have completed all lessons and earned your GP! The final step is to request your certificate.
            </p>
            
            <div class="overall-progress" style="margin-bottom: 3rem; background: var(--black-bg); border: 2px solid var(--success-color);">
                <div class="progress-label" style="font-size: 1.1rem; color: var(--success-color);">Your Final Course Grade Point (GP)</div>
                <div class="progress-text" style="font-size: 2rem; color: var(--success-color); font-weight: 800;"><span id="finalTotalPoints">0</span> Points</div>
                <p style="font-size: 0.9rem; margin-top: 0.5rem; opacity: 0.8;">(Based on 10 points per successfully completed lesson quiz)</p>
            </div>

            <div class="certificate-form-card">
                <h2>Certificate & Project Submission</h2>
                <p style="margin-bottom: 1.5rem; color: var(--warning-color);">
                    To receive your certificate, please fill in your details below. For courses with a project (e.g., Computer Science, Software Engineering, Visual Arts), please **email your Final Project** (as outlined in the last lesson) to: <strong style="color: var(--cyan-glow);">elvionailabs@gmail.com</strong>.
                </p>
                <form id="certificateForm" action="https://formspree.io/f/mldrbpwo" method="post">
                    <input type="hidden" name="_subject" id="formSubject">
                    <input type="hidden" name="Course Completed" id="completedCourseName">
                    <input type="hidden" name="Total Points Earned" id="formTotalPoints">
                    
                    <label for="fullName">Full Name (for Certificate):</label>
                    <input type="text" id="fullName" name="Full Name" required>

                    <label for="email">Email Address (for delivery):</label>
                    <input type="email" id="email" name="Email" required>

                    <label for="studentId">Elvion Student ID (Optional):</label>
                    <input type="text" id="studentId" name="Student ID">

                    <button type="submit" class="action-btn submit-btn">
                        <i class="fas fa-certificate"></i> Request Certificate
                    </button>
                </form>

                <div class="comment-section">
                    <h4>Feedback & Questions</h4>
                    <form>
                        <textarea placeholder="Share your experience, ask a question, or send a thank you note to Elvion!"></textarea>
                        <button type="submit" class="action-btn comment-btn secondary" style="background: var(--dark-navy); color: var(--cyan-glow);">Submit Feedback</button>
                    </form>
                </div>
            </div>
        </div>

        <div class="media-player" id="mediaPlayer">
          <div class="media-placeholder">
            <i class="fas fa-play-circle"></i>
            <p id="mediaPlaceholderText">Video/Media content coming soon</p>
            <p style="font-size: 0.9rem; opacity: 0.7;">For now, please read the lesson content below</p>
          </div>
        </div>

        <div class="content-card">
          <div id="lessonContent" class="lesson-content">
            </div>
        </div>

        <div id="quizContainer" class="quiz-container" style="display: none;">
          <h3 style="margin-bottom: 1.5rem; color: var(--warning-color);"><i class="fas fa-clipboard-check"></i> Mandatory Quiz: Pass to Proceed</h3>
          <p style="margin-bottom: 2rem; border-bottom: 1px solid rgba(0, 255, 255, 0.1); padding-bottom: 1rem;">
            You must correctly answer all questions below before the 'Next' lesson button is enabled.
          </p>
          <div id="quizQuestions">
            </div>
          <button id="submitQuizBtn" class="action-btn" style="width: 100%; margin-top: 2rem;">
            <i class="fas fa-paper-plane"></i> Submit Answers
          </button>
          <div id="quizResult" style="margin-top: 1rem;"></div>
        </div>
      </section>

      <nav class="lesson-navigation" id="lessonNavigation" style="display: none;">
        <div class="nav-info">
          <div class="lesson-indicator">
            Lesson <span id="navCurrentLesson">1</span> of <span id="navTotalLessons">8</span>
          </div>
          <span><i class="fas fa-trophy"></i> GP: <span id="totalPointsEarnedNav">0</span> Points</span>
        </div>
        <div class="nav-buttons">
          <button id="prevLessonBtn" class="action-btn secondary">
            <i class="fas fa-chevron-left"></i>
            Previous
          </button>
          <button id="nextLessonBtn" class="action-btn">
            Next
            <i class="fas fa-chevron-right"></i>
          </button>
        </div>
      </nav>
    </main>
  </div>

  <div id="completionModal" class="completion-modal">
    <div class="completion-content">
      <i class="fas fa-trophy completion-icon"></i>
      <h2 class="completion-title">Lesson Complete!</h2>
      <p class="completion-message">
        Congratulations! You've successfully completed the quiz and this lesson.
      </p>
      <div class="points-earned">
        <i class="fas fa-star"></i>
        You earned <span id="pointsEarned">10</span> points!
      </div>
      <div style="display: flex; gap: 1rem;">
        <button id="continueBtn" class="action-btn" style="flex: 1;">
          Continue Learning
        </button>
        <button id="backToDashboardBtn" class="action-btn secondary" style="flex: 1;">
          Back to Dashboard
        </button>
      </div>
    </div>
  </div>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
    import {
        getAuth,
        onAuthStateChanged
    } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-auth.js";
    import {
        getFirestore,
        doc,
        getDoc,
        updateDoc
    } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyAyROm0aBGjry6NUfhNM3e0qwPcCDoIqSk",
        authDomain: "elvionai.firebaseapp.com",
        projectId: "elvionai",
        storageBucket: "elvionai.firebasestorage.app",
        messagingSenderId: "161078300830",
        appId: "1:161078300830:web:f460df8591704eb0e96b8f"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // --- FALLBACK/DEFAULT LESSON & QUIZ FOR NEW COURSES ---
    const defaultLessonContent = `
        <h2>Welcome to Your Course!</h2>
        <p>This is the first lesson of your course. Here you will learn the foundational concepts.</p>
        <p>This course is designed to provide you with a comprehensive, pre-university foundation in your chosen field. Our learning methodology focuses on practical knowledge and critical thinking.</p>
        
        <h3>Elvion University Philosophy</h3>
        <p>Elvion University is dedicated to **providing free, quality pre-degree knowledge and certificates** to empower future students globally. Your commitment to completing this course is your most valuable credential.</p>
        
        <div class="interactive-code-area" style="background: rgba(18, 26, 48, 0.85); border-color: var(--warning-color);">
            <div class="area-header" style="color: var(--warning-color);"><span>Course Focus</span></div>
            <p>Please remember to focus on the core concepts of this subject. You will be tested on the content to ensure you grasp the fundamentals before moving to the next lesson.</p>
        </div>
    `;

    const defaultLesson = {
        id: 1,
        title: 'Course Introduction',
        duration: '40 min',
        content: defaultLessonContent,
        quiz: [
            { type: 'mcq', question: 'What is the main purpose of Elvion University?', options: ['Awarding accredited degrees', 'Providing free pre-degree knowledge and certificates', 'Replacing traditional universities', 'Offering high-cost private education'], answer: 'Providing free pre-degree knowledge and certificates' },
            { type: 'mcq', question: 'How is student progress measured in this course viewer?', options: ['Monthly Exams', 'Lesson by lesson mandatory quizzes', 'Instructor approval only', 'Number of videos watched'], answer: 'Lesson by lesson mandatory quizzes' },
        ]
    };

    // Helper to generate default lessons for other courses
    const generateDefaultLessons = (count, coursePrefix, isProject) => {
        return Array(count).fill(0).map((_, i) => {
            let lessonTitle = `Lesson ${i + 1}: Introduction to ${coursePrefix} Concepts`;
            let content = defaultLessonContent.replace(/Welcome!|This is the first lesson/g, `Welcome to ${coursePrefix}!`).replace(/Introduction/g, lessonTitle);

            if (i === 0) {
                // Keep the original quiz for the first lesson of a new course
                return {
                    ...defaultLesson,
                    id: i + 1,
                    title: `${coursePrefix} ${lessonTitle}`,
                    content: content,
                };
            }

            if (i === count - 1) {
                lessonTitle = isProject ? `Lesson ${i + 1}: Final Project / Capstone` : `Lesson ${i + 1}: Conclusion & Next Steps`;
                content = `<h2>${lessonTitle}</h2>
                    <p>Congratulations on reaching the final lesson of the ${coursePrefix} course!</p>
                    <p>This course's final requirement is a **Project Submission** (if \`isProject\` is true) or a final reflection. Follow the certificate steps on the next page.</p>
                    ${isProject ? `<p style="color: var(--cyan-glow);">**Project Submission Required:** Please check the last lesson for specific instructions and remember to **email your project to elvionailabs@gmail.com**.</p>` : ''}
                `;

                // Final lesson quiz should be specific if it's a project
                const finalQuiz = isProject ? [
                    { type: 'mcq', question: `For the ${coursePrefix} course, what is the final deliverable requirement?`, options: ['A final written exam', 'A Project/Capstone Submission', 'A face-to-face interview', 'A group presentation'], answer: 'A Project/Capstone Submission' },
                    { type: 'text', question: 'What is the email address to which you must submit your project for certificate review? (Enter exactly)', answer: 'elvionailabs@gmail.com' },
                ] : [
                    { type: 'mcq', question: `How many lessons did you complete in the ${coursePrefix} course?`, options: ['1', '5', '8', count.toString()], answer: count.toString() },
                    { type: 'mcq', question: 'What is the next suggested step after completing this course?', options: ['Retake the first lesson', 'Explore another Elvion course or request your certificate', 'Close the browser', 'Nothing'], answer: 'Explore another Elvion course or request your certificate' },
                ];

                return {
                    id: i + 1,
                    title: `${coursePrefix} ${lessonTitle}`,
                    duration: `${40 + Math.floor(Math.random() * 20)} min`, // Varied duration
                    content: content,
                    quiz: finalQuiz,
                };
            }

            // Simplified, universal quiz for placeholder lessons after the first one
            const simpleQuiz = [
                { type: 'mcq', question: `How many lessons are in the ${coursePrefix} course? (Hint: The answer is in the course metadata)`, options: ['1', '5', '8', count.toString()], answer: count.toString() },
                { type: 'mcq', question: `What is the most important skill for a ${coursePrefix} professional?`, options: ['Memorization', 'Critical Thinking & Problem Solving', 'Speed Reading', 'Ignoring details'], answer: 'Critical Thinking & Problem Solving' },
            ];

            return {
                id: i + 1,
                title: `${coursePrefix} ${lessonTitle}`,
                duration: `${40 + Math.floor(Math.random() * 20)} min`, // Varied duration
                content: content,
                quiz: simpleQuiz,
            };
        });
    };

    // --- UPDATED AND EXPANDED COURSE DATABASE (Incorporating all your courses) ---
    // ====================================================================
// ENHANCED COMPUTER SCIENCE COURSE (CS101) - COMPLETE 8 LESSONS
// ====================================================================
// Production-ready curriculum with hands-on projects, detailed content,
// comprehensive quizzes, and professional formatting
// ====================================================================

const cs101Lessons = [
    // ==================== LESSON 1 ====================
    {
        id: 1,
        title: 'Introduction to Programming & Computational Thinking',
        duration: '60 min',
        content: `
            <h2>Welcome to the World of Programming</h2>
            <p>Programming is more than writing code—it's about teaching machines to solve problems through precise instructions. Every app on your phone, every website you visit, and every digital tool you use was built by programmers who learned to think computationally. In this lesson, you'll discover the foundational concepts that power all software development.</p>
            
            <h3>What is Computational Thinking?</h3>
            <p>Before writing a single line of code, programmers break down complex problems into smaller, manageable pieces. This process, called <strong>computational thinking</strong>, involves four key steps:</p>
            <ul>
                <li><strong>Decomposition:</strong> Breaking a large problem into smaller sub-problems</li>
                <li><strong>Pattern Recognition:</strong> Identifying similarities and patterns in data</li>
                <li><strong>Abstraction:</strong> Focusing on important information while ignoring irrelevant details</li>
                <li><strong>Algorithm Design:</strong> Creating step-by-step solutions</li>
            </ul>

            <h3>Understanding Algorithms</h3>
            <p>An <strong>algorithm</strong> is a finite sequence of well-defined instructions to solve a problem or perform a computation. Think of it as a recipe: precise, ordered steps that produce consistent results when followed correctly.</p>
            
            <div class="interactive-code-area" style="background: rgba(18, 26, 48, 0.85); border-left: 4px solid var(--primary-color);">
                <div class="area-header" style="color: var(--primary-color);"><span>Real-World Algorithm Example</span></div>
                <pre><code>Problem: Find the largest number in a list

Algorithm:
1. Start with the first number as the "largest"
2. Compare it with the next number
3. If the next number is larger, update "largest"
4. Repeat steps 2-3 for all numbers
5. Return the "largest" number

This is how search engines rank results and how your phone finds the strongest WiFi signal.</code></pre>
            </div>

            <h3>Variables: The Building Blocks of Programs</h3>
            <p>Variables are named containers that store data in your program's memory. Every variable has a <strong>data type</strong> that determines what kind of information it can hold and what operations can be performed on it.</p>
            
            <h4>Common Data Types</h4>
            <ul>
                <li><strong>Strings</strong> (text): <code>username = "ElvionStudent"</code></li>
                <li><strong>Integers</strong> (whole numbers): <code>age = 21</code></li>
                <li><strong>Floats</strong> (decimal numbers): <code>gpa = 3.75</code></li>
                <li><strong>Booleans</strong> (true/false): <code>is_enrolled = True</code></li>
            </ul>

            <h3>Your First Python Program</h3>
            <p>Python is one of the most beginner-friendly programming languages. It powers YouTube, Instagram, Netflix, and NASA's mission planning systems. Let's write your first interactive program:</p>
            
            <pre><code class="language-python"># This is a comment - Python ignores this line
# Comments help humans understand code

# Get user input
student_name = input("What is your name? ")
favorite_subject = input("What subject interests you most? ")

# Process and display output
greeting = f"Hello, {student_name}! Welcome to Elvion University."
message = f"We're excited to teach you {favorite_subject}."

print(greeting)
print(message)
print("Let's start your coding journey!")</code></pre>

            <h3>Hands-On Project: Your First Program</h3>
            <div class="interactive-code-area" style="background: rgba(18, 26, 48, 0.85); border-left: 4px solid var(--success-color);">
                <div class="area-header" style="color: var(--success-color);"><span>Action Required: Complete This Task</span></div>
                <p><strong>Task:</strong> Set up your development environment and write your first program.</p>
                <ol>
                    <li>Visit <a href="https://replit.com" target="_blank" rel="noopener">Replit.com</a> and create a free account</li>
                    <li>Create a new Python Repl (project) named "Lesson1-Introduction"</li>
                    <li>Write a program that asks the user for their name, age, and dream career</li>
                    <li>Display a personalized message using all three inputs</li>
                    <li>Run your program and screenshot the output</li>
                </ol>
                <p><strong>Bonus Challenge:</strong> Add a calculation that shows how many years until they turn 30.</p>
            </div>

            <h3>Understanding Input and Output</h3>
            <p>Programs interact with users through input (data coming in) and output (data going out). The <code>input()</code> function pauses your program and waits for the user to type something, while <code>print()</code> displays information on the screen.</p>

            <pre><code class="language-python"># Input Example
birth_year = input("What year were you born? ")

# Convert string to integer for calculations
birth_year = int(birth_year)

# Calculate age
current_year = 2025
age = current_year - birth_year

# Output
print(f"You are approximately {age} years old in 2025.")</code></pre>

            <h3>Further Learning Resources</h3>
            <ul>
                <li><strong>Official Python Documentation:</strong> <a href="https://docs.python.org/3/tutorial/" target="_blank" rel="noopener">Python.org Tutorial</a></li>
                <li><strong>Interactive Practice:</strong> <a href="https://www.codecademy.com/learn/learn-python-3" target="_blank" rel="noopener">Codecademy Python Course</a></li>
                <li><strong>Video Series:</strong> CS50's Introduction to Programming (Harvard University - YouTube)</li>
                <li><strong>Reference Book:</strong> "Python Crash Course" by Eric Matthes (3rd Edition, 2023)</li>
            </ul>

            <div class="interactive-code-area" style="background: rgba(18, 26, 48, 0.85); border-left: 4px solid var(--warning-color);">
                <div class="area-header" style="color: var(--warning-color);"><span>Before You Continue</span></div>
                <p>Make sure you have completed the hands-on project above. Programming is learned by doing, not just reading. Save your Replit project link—you'll build a portfolio of work throughout this course.</p>
            </div>
        `,
        quiz: [
            { 
                type: 'mcq', 
                question: 'Which step in computational thinking involves breaking a large problem into smaller, manageable pieces?', 
                options: ['Pattern Recognition', 'Abstraction', 'Decomposition', 'Algorithm Design'], 
                answer: 'Decomposition' 
            },
            { 
                type: 'mcq', 
                question: 'What data type would you use to store a student\\'s GPA (such as 3.75)?', 
                options: ['String', 'Integer', 'Float', 'Boolean'], 
                answer: 'Float' 
            },
            { 
                type: 'mcq', 
                question: 'In Python, which function is used to display information to the user on the screen?', 
                options: ['input()', 'display()', 'print()', 'show()'], 
                answer: 'print()' 
            },
            { 
                type: 'mcq', 
                question: 'What is an algorithm in programming?', 
                options: ['A type of variable', 'A programming language', 'A finite sequence of well-defined instructions to solve a problem', 'A data type for storing numbers'], 
                answer: 'A finite sequence of well-defined instructions to solve a problem' 
            },
            { 
                type: 'mcq', 
                question: 'Which of the following is a Boolean data type value?', 
                options: ['3.14', '"Hello"', '42', 'True'], 
                answer: 'True' 
            },
            { 
                type: 'mcq', 
                question: 'What does the input() function do in Python?', 
                options: ['Displays output to the screen', 'Pauses the program and waits for user input', 'Calculates mathematical operations', 'Deletes variables'], 
                answer: 'Pauses the program and waits for user input' 
            },
            { 
                type: 'mcq', 
                question: 'Which symbol is used in Python to create a comment (text that the computer ignores)?', 
                options: ['//', '#', '<!--', '/*'], 
                answer: '#' 
            },
            { 
                type: 'text', 
                question: 'In your own words (2-3 sentences), explain what computational thinking means and why it is important for programming.', 
                answer: '' 
            }
        ]
    },

    // ==================== LESSON 2 ====================
    {
        id: 2,
        title: 'Control Flow: Making Decisions in Code',
        duration: '70 min',
        content: `
            <h2>Teaching Programs to Make Decisions</h2>
            <p>Real-world programs must make decisions based on conditions. When you log into a website, the code checks if your password is correct. When you search on Google, algorithms decide which results to show first. This lesson teaches you how to write programs that think and adapt.</p>

            <h3>Conditional Statements: The if Statement</h3>
            <p>The <code>if</code> statement allows your program to execute code only when a certain condition is true. This is the foundation of decision-making in programming.</p>

            <pre><code class="language-python"># Basic if statement
age = int(input("Enter your age: "))

if age >= 18:
    print("You are eligible to vote.")
    print("Please register at your local election office.")

# This line runs regardless of the condition
print("Thank you for checking your eligibility.")</code></pre>

            <h3>The if-else Statement</h3>
            <p>Often, you want to execute different code depending on whether a condition is true or false. The <code>else</code> clause handles the "otherwise" scenario.</p>

            <pre><code class="language-python">grade = float(input("Enter your exam score (0-100): "))

if grade >= 60:
    print("Congratulations! You passed the exam.")
    print("Your certificate will be processed.")
else:
    print("Unfortunately, you did not pass this time.")
    print("You can retake the exam after reviewing the material.")</code></pre>

            <h3>The if-elif-else Chain</h3>
            <p>For multiple conditions, use <code>elif</code> (short for "else if"). This allows you to test several conditions in sequence.</p>

            <pre><code class="language-python">score = float(input("Enter your test score: "))

if score >= 90:
    grade_letter = "A"
    message = "Excellent work!"
elif score >= 80:
    grade_letter = "B"
    message = "Very good!"
elif score >= 70:
    grade_letter = "C"
    message = "Good job!"
elif score >= 60:
    grade_letter = "D"
    message = "You passed, but consider reviewing."
else:
    grade_letter = "F"
    message = "Please retake this exam."

print(f"Your grade: {grade_letter}")
print(message)</code></pre>

            <h3>Comparison and Logical Operators</h3>
            <p>Conditions are built using comparison and logical operators:</p>

            <h4>Comparison Operators</h4>
            <ul>
                <li><code>==</code> - Equal to</li>
                <li><code>!=</code> - Not equal to</li>
                <li><code>&gt;</code> - Greater than</li>
                <li><code>&lt;</code> - Less than</li>
                <li><code>&gt;=</code> - Greater than or equal to</li>
                <li><code>&lt;=</code> - Less than or equal to</li>
            </ul>

            <h4>Logical Operators</h4>
            <ul>
                <li><code>and</code> - Both conditions must be true</li>
                <li><code>or</code> - At least one condition must be true</li>
                <li><code>not</code> - Reverses the condition</li>
            </ul>

            <pre><code class="language-python"># Example with logical operators
age = int(input("Enter your age: "))
has_id = input("Do you have a valid ID? (yes/no): ").lower()

if age >= 18 and has_id == "yes":
    print("Access granted.")
elif age >= 18 and has_id == "no":
    print("You must present a valid ID.")
else:
    print("You must be 18 or older.")</code></pre>

            <h3>Loops: Repeating Actions</h3>
            <p>Loops allow you to execute the same block of code multiple times. There are two main types of loops in Python.</p>

            <h4>The while Loop</h4>
            <p>A <code>while</code> loop repeats as long as a condition remains true.</p>

            <pre><code class="language-python"># Count from 1 to 5
counter = 1

while counter <= 5:
    print(f"Count: {counter}")
    counter = counter + 1  # Increment the counter

print("Loop finished!")</code></pre>

            <h4>The for Loop</h4>
            <p>A <code>for</code> loop iterates over a sequence (like a range of numbers or a list of items).</p>

            <pre><code class="language-python"># Print numbers 1 through 10
for number in range(1, 11):
    print(f"Number: {number}")

# Loop through a list of courses
courses = ["Computer Science", "Mathematics", "Physics", "Chemistry"]

for course in courses:
    print(f"Enrolling in: {course}")</code></pre>

            <h3>Hands-On Project: Password Validator</h3>
            <div class="interactive-code-area" style="background: rgba(18, 26, 48, 0.85); border-left: 4px solid var(--success-color);">
                <div class="area-header" style="color: var(--success-color);"><span>Action Required: Build This Project</span></div>
                <p><strong>Task:</strong> Create a password validation system in Replit.</p>
                <p><strong>Requirements:</strong></p>
                <ol>
                    <li>Create a new Python Repl named "Lesson2-PasswordValidator"</li>
                    <li>Write a program that asks the user to create a password</li>
                    <li>The password must meet these criteria: at least 8 characters long and contains at least one number</li>
                    <li>Use if-elif-else statements to validate the password</li>
                    <li>Display appropriate messages for valid and invalid passwords</li>
                    <li>Use a while loop to let users try again if their password is invalid (maximum 3 attempts)</li>
                </ol>
                <p><strong>Bonus Challenge:</strong> Add a check for at least one uppercase letter and one special character.</p>
            </div>

            <h3>Further Learning Resources</h3>
            <ul>
                <li><strong>Python Control Flow Documentation:</strong> <a href="https://docs.python.org/3/tutorial/controlflow.html" target="_blank" rel="noopener">Python.org Control Flow</a></li>
                <li><strong>Interactive Exercises:</strong> <a href="https://www.hackerrank.com/domains/python" target="_blank" rel="noopener">HackerRank Python Challenges</a></li>
                <li><strong>Video Tutorial:</strong> "Python Conditionals and Loops" by Corey Schafer (YouTube)</li>
                <li><strong>Practice Problems:</strong> <a href="https://codingbat.com/python" target="_blank" rel="noopener">CodingBat Python Exercises</a></li>
            </ul>

            <div class="interactive-code-area" style="background: rgba(18, 26, 48, 0.85); border-left: 4px solid var(--warning-color);">
                <div class="area-header" style="color: var(--warning-color);"><span>Checkpoint</span></div>
                <p>Before moving to the next lesson, ensure you have completed the Password Validator project and understand the difference between if, elif, else statements and both while and for loops.</p>
            </div>
        `,
        quiz: [
            { 
                type: 'mcq', 
                question: 'Which Python keyword is used to check a condition only if the previous if condition was false?', 
                options: ['else', 'elif', 'then', 'check'], 
                answer: 'elif' 
            },
            { 
                type: 'mcq', 
                question: 'What is the output of this code: x = 10; if x > 5: print("A") else: print("B")', 
                options: ['A', 'B', 'AB', 'Error'], 
                answer: 'A' 
            },
            { 
                type: 'mcq', 
                question: 'Which operator would you use to check if two values are equal?', 
                options: ['=', '==', '!=', '>='], 
                answer: '==' 
            },
            { 
                type: 'mcq', 
                question: 'A while loop continues to execute as long as:', 
                options: ['The condition is false', 'The condition is true', 'There are items in a list', 'The user presses a key'], 
                answer: 'The condition is true' 
            },
            { 
                type: 'mcq', 
                question: 'What does the range(1, 6) function generate in Python?', 
                options: ['Numbers 1, 2, 3, 4, 5, 6', 'Numbers 1, 2, 3, 4, 5', 'Numbers 0, 1, 2, 3, 4, 5', 'Numbers 2, 3, 4, 5'], 
                answer: 'Numbers 1, 2, 3, 4, 5' 
            },
            { 
                type: 'mcq', 
                question: 'Which logical operator returns True only if both conditions are true?', 
                options: ['or', 'and', 'not', 'xor'], 
                answer: 'and' 
            },
            { 
                type: 'mcq', 
                question: 'What is an infinite loop?', 
                options: ['A loop that runs very fast', 'A loop that never terminates because its condition never becomes false', 'A loop that runs exactly once', 'A loop that contains an error'], 
                answer: 'A loop that never terminates because its condition never becomes false' 
            },
            { 
                type: 'mcq', 
                question: 'In Python, what defines a code block (such as the body of an if statement)?', 
                options: ['Curly braces {}', 'Parentheses ()', 'Indentation (spaces or tabs)', 'Square brackets []'], 
                answer: 'Indentation (spaces or tabs)' 
            },
            { 
                type: 'text', 
                question: 'Write a Python if-elif-else statement that checks a variable called temperature and prints "Hot" if it is above 30, "Warm" if between 20-30, and "Cold" if below 20.', 
                answer: '' 
            }
        ]
    }
    
    // ... Continue with lessons 3-8 following the same enhanced format
];
    // --- SOFTWARE ENGINEERING COURSE CONTENT (ALL Template Literals) ---
    const swe101Lessons = [
        {
            id: 1,
            title: 'L1: Software Engineering Discipline & Mindset',
            duration: '50 min',
            content: `
                <h2>What is Software Engineering? (SWE)</h2>
                <p>Software Engineering is the systematic, disciplined, quantifiable approach to the development, operation, and maintenance of software. It's not just coding; it's about building complex systems reliably, on time, and within budget, treating software development as an engineering discipline.</p>

                <h3>Why Engineering?</h3>
                <p>Unlike simple programming (where one person writes code for a small task), Software Engineering deals with:</p>
                <ul>
                    <li><strong>Scale:</strong> Projects involving hundreds of developers and millions of lines of code.</li>
                    <li><strong>Reliability:</strong> The software must work correctly, especially in critical applications (e.g., medical, aviation).</li>
                    <li><strong>Maintainability:</strong> The ability for future teams to update and fix the software efficiently.</li>
                </ul>

                <div class="interactive-code-area" style="background: rgba(18, 26, 48, 0.85); border-left: 4px solid var(--warning-color);">
                    <div class="area-header" style="color: var(--warning-color);"><span>The SWE Mindset</span></div>
                    <p>The core mindset of an engineer is: **Plan, Test, Document, and Optimize**. A software engineer spends far more time designing and verifying than writing the initial code.</p>
                </div>
                
                <h3>Activity: The Bridge Analogy</h3>
                <p>Consider a bridge builder (Civil Engineer) vs. someone nailing two boards together (Hobbyist). The bridge requires extensive planning, stress testing, material science, and regulatory compliance. Software development for a bank's security system is like building a bridge; an engineer is required.</p>
                
                <h3>Further Reading</h3>
                <ul>
                    <li>IEEE/ISO Standard for Software Engineering: <code>iso.org/standard/24640.html</code></li>
                    <li>"The Mythical Man-Month" by Frederick Brooks (On software project management).</li>
                </ul>
            `,
            quiz: [
                { type: 'mcq', question: 'Software Engineering is defined as a systematic, disciplined, quantifiable approach to:', options: ['Only coding tasks', 'The development, operation, and maintenance of software', 'Only bug fixing', 'Writing short scripts'], answer: 'The development, operation, and maintenance of software' },
                { type: 'mcq', question: 'Which characteristic is a major concern for Software Engineering but less so for simple programming?', options: ['Writing variable names', 'Choosing a text editor', 'Dealing with project scale and maintainability', 'Debugging basic loops'], answer: 'Dealing with project scale and maintainability' },
            ],
        },
        {
            id: 2,
            title: 'L2: SDLC and Methodologies (Agile vs. Waterfall)',
            duration: '60 min',
            content: `
                <h2>The Software Development Lifecycle (SDLC)</h2>
                <p>The SDLC is a process followed by a software project within a software organization. It outlines a detailed plan for how to develop, maintain, replace, or alter software systems. The common phases are: Planning, Requirements Analysis, Design, Implementation (Coding), Testing, Deployment, and Maintenance.</p>

                <h3>Waterfall Methodology</h3>
                <p>The Waterfall model is a sequential design process, where progress flows steadily downwards like a waterfall. Each phase must be completed and signed off before the next phase can begin.</p>
                <ul>
                    <li>**Pros:** Simple to understand, easy to manage due to rigid phases, good for small projects with clearly defined, unchanging requirements.</li>
                    <li>**Cons:** High risk for complex projects; no working software until late in the cycle; difficult to respond to changing requirements.</li>
                </ul>

                <h3>Agile Methodology</h3>
                <p>Agile is an iterative, incremental approach. It focuses on delivering value quickly and responding to change. It is guided by the **Agile Manifesto** principles: individuals and interactions over processes and tools, working software over comprehensive documentation, customer collaboration over contract negotiation, and responding to change over following a plan.</p>
                <ul>
                    <li>**Key Concepts:** **Sprints** (short, time-boxed iterations, typically 2-4 weeks), **Daily Standups**, **Product Backlogs**.</li>
                    <li>**Pros:** High customer satisfaction, early and continuous delivery of working software, highly adaptable to changes.</li>
                    <li>**Cons:** Requires intense customer involvement, can be hard to measure progress for complex projects without clear documentation.</li>
                </ul>

                <div class="interactive-code-area" style="background: rgba(18, 26, 48, 0.85); border-left: 4px solid var(--primary-color);">
                    <div class="area-header" style="color: var(--primary-color);"><span>Real-World SDLC</span></div>
                    <p>Most modern tech companies use variations of Agile (like Scrum or Kanban) because product requirements in the tech industry change constantly. Waterfall is generally reserved for government contracts or embedded systems where requirements are fixed from the start.</p>
                </div>
            `,
            quiz: [
                { type: 'mcq', question: 'Which SDLC methodology requires that each phase be completed and signed off before the next phase begins?', options: ['Agile', 'Scrum', 'Kanban', 'Waterfall'], answer: 'Waterfall' },
                { type: 'mcq', question: 'The Agile methodology prioritizes "working software" over what, according to the manifesto?', options: ['Individuals and interactions', 'Comprehensive documentation', 'Responding to change', 'Customer collaboration'], answer: 'Comprehensive documentation' },
            ],
        },
        {
            id: 3,
            title: 'L3: Requirements and Design Documentation',
            duration: '45 min',
            content: `
                <h2>The Importance of Documentation</h2>
                <p>In software engineering, documentation is the blueprint for development. It ensures everyone—from the customer to the developer—is aligned on what needs to be built and how it will function. Two critical types of documents are requirements and design.</p>

                <h3>Requirements Documentation (SRS)</h3>
                <p>The **Software Requirements Specification (SRS)** documents the functional and non-functional requirements of the system. This answers: **"What will the system do?"**</p>
                <ul>
                    <li>**Functional Requirements:** Define the features and services the system provides (e.g., "The system shall allow users to log in with a valid username and password").</li>
                    <li>**Non-functional Requirements:** Define the qualities of the system (e.g., **Performance:** "The system shall load the dashboard in under 2 seconds." **Security:** "All user data must be encrypted.").</li>
                </ul>

                <h3>Design Documentation</h3>
                <p>The Design Document details the high-level architecture and low-level component design. This answers: **"How will the system be built?"**</p>
                <ul>
                    <li>**UML Diagrams:** **Unified Modeling Language** diagrams (like Class Diagrams or Use Case Diagrams) are used to visually model the system's structure and behavior.</li>
                    <li>**Use Cases:** Describes how a user interacts with the system to achieve a specific goal (e.g., "User logs in" or "User creates a new order").</li>
                </ul>

                <div class="interactive-code-area" style="background: rgba(18, 26, 48, 0.85); border-left: 4px solid var(--success-color);">
                    <div class="area-header" style="color: var(--success-color);"><span>The Engineer's Motto</span></div>
                    <p>A poorly written requirement leads to poorly written code. A Software Engineer's first job is not to code, but to **ensure the requirements are complete, consistent, and unambiguous.**</p>
                </div>
            `,
            quiz: [
                { type: 'mcq', question: 'Which requirement specifies the qualities of a system, such as speed or security?', options: ['Functional Requirement', 'Business Requirement', 'Non-functional Requirement', 'User Story'], answer: 'Non-functional Requirement' },
                { type: 'mcq', question: 'The Software Requirements Specification (SRS) primarily answers which question?', options: ['How long will it take to build?', 'What will the system do?', 'What coding language is best?', 'How much will it cost?'], answer: 'What will the system do?' },
            ],
        },
        {
            id: 4,
            title: 'L4: Introduction to Design Patterns',
            duration: '75 min',
            content: `
                <h2>Solving Common Problems with Design Patterns</h2>
                <p>In software engineering, a **Design Pattern** is a reusable solution to a commonly occurring problem within a given context in software design. They are not finished designs that can be plugged straight into your code; they are templates or blueprints for how to solve a problem.</p>

                <h3>The Three Categories</h3>
                <p>Patterns are usually categorized into three groups:</p>
                <ol>
                    <li>**Creational Patterns:** Concerned with the way objects are created (e.g., Factory, Singleton).</li>
                    <li>**Structural Patterns:** Concerned with composing classes and objects (e.g., Adapter, Decorator).</li>
                    <li>**Behavioral Patterns:** Concerned with communication between objects (e.g., Observer, Strategy).</li>
                </ol>

                <h3>Pattern Deep Dive: The Singleton Pattern (Creational)</h3>
                <p>The Singleton Pattern ensures a class has only **one instance** and provides a global point of access to it. This is useful for things like a single database connection pool or a global configuration manager.</p>
                <pre><code>// Example Concept: Singleton
class ConfigurationManager {
    private static instance: ConfigurationManager;
    private constructor() { /* Load settings */ }
    
    public static getInstance(): ConfigurationManager {
        if (!ConfigurationManager.instance) {
            ConfigurationManager.instance = new ConfigurationManager();
        }
        return ConfigurationManager.instance;
    }
}</code></pre>

                <h3>Pattern Deep Dive: The Factory Pattern (Creational)</h3>
                <p>The Factory Pattern provides an interface for creating objects in a superclass, but allows subclasses to alter the type of objects that will be created. This decouples the object creation logic from the client code.</p>
                <p style="color: var(--cyan-glow);">**Benefit:** Using design patterns leads to code that is more robust, reusable, and easier to maintain because it follows well-established engineering best practices.</p>
            `,
            quiz: [
                { type: 'mcq', question: 'A Design Pattern is best described as:', options: ['A finished, plug-and-play piece of code', 'A template for solving a common problem in a specific context', 'A legal contract for software design', 'A programming language feature'], answer: 'A template for solving a common problem in a specific context' },
                { type: 'mcq', question: 'Which creational pattern ensures a class has only one instance and provides a global access point?', options: ['Observer', 'Factory', 'Decorator', 'Singleton'], answer: 'Singleton' },
            ],
        },
        {
            id: 5,
            title: 'L5: Final Project: Architecting a System',
            duration: '90 min',
            content: `
                <h2>Course Capstone: The Architectural Design Document</h2>
                <p>Congratulations on completing the core lessons! Your final requirement is to apply the principles of Requirements Analysis, SDLC, and Design to create a professional **Architectural Design Document** for a new software system.</p>

                <h3>Project Brief: The "Elvion Academy Planner"</h3>
                <p>Design a system that allows Elvion University students to track their course progress, manage due dates, and visualize their overall Grade Point (GP) progress across all courses.</p>

                <h3>Required Sections for Submission</h3>
                <p>Your Design Document (PDF or Markdown file) must include the following sections (2000-word minimum total):</p>
                <ol>
                    <li>**Overview & Goals:** (500 words) What is the system? What problem does it solve? Define the target user.</li>
                    <li>**Requirements (SRS):** (500 words) Detail at least 5 **Functional** and 5 **Non-functional** requirements (e.g., Performance, Security, Usability).</li>
                    <li>**SDLC Justification:** (300 words) Which methodology (Agile or Waterfall) would you choose for this project and why?</li>
                    <li>**Architectural Design:** (700 words)
                        <ul>
                            <li>Propose a high-level architecture (e.g., 3-Tier, Microservices).</li>
                            <li>Identify two key components (e.g., Database, Authentication Service).</li>
                            <li>**Design Pattern Application:** Specify one Creational and one Structural/Behavioral design pattern you would use in a component and justify its use.</li>
                        </ul>
                    </li>
                </ol>
                
                <div class="interactive-code-area" style="background: rgba(18, 26, 48, 0.85); border-left: 4px solid var(--success-color);">
                    <div class="area-header" style="color: var(--success-color);"><span>Submission Instructions</span></div>
                    <p>This is a non-code project. Your final submission is the written document. Save your document as: <strong>SWE101_YourName_DesignDoc.pdf</strong>.</p>
                    <p style="color: var(--error-color); font-weight: bold;">**ACTION:** Email your final document to: <code>elvionailabs@gmail.com</code></p>
                </div>
                <p>Once you pass the final quiz below, click "Final Exam/Certificate" in the navigation bar to proceed with certificate request.</p>
            `,
            quiz: [
                { type: 'mcq', question: 'For the SWE101 course, what is the final deliverable requirement?', options: ['A full, working code application', 'An Architectural Design Document', 'A face-to-face interview', 'A group presentation'], answer: 'An Architectural Design Document' },
                { type: 'text', question: 'What is the email address to which you must submit your project for certificate review? (Enter exactly)', answer: 'elvionailabs@gmail.com' },
            ],
        }
    ];


    // Assembling all courses
    const allCourses = [
        { id: 'cs101', title: 'Computer Science', description: 'Fundamentals of computing, programming, and algorithms', icon: 'fas fa-laptop-code', totalLessons: 8, estimatedHours: 120, mediaType: 'video', lessons: cs101Lessons },
        // NEW SOFTWARE ENGINEERING COURSE - CORRECTLY LINKED
        { id: 'swe101', title: 'Software Engineering', description: 'Design, develop, and maintain large-scale software systems.', icon: 'fas fa-cogs', totalLessons: 5, estimatedHours: 80, mediaType: 'video', lessons: swe101Lessons },
        // OTHER COURSES WITH GENERATED PLACEHOLDERS
        { id: 'law101', title: 'Law (LLB)', description: 'Comprehensive study of legal principles and practice.', icon: 'fas fa-balance-scale', totalLessons: 6, estimatedHours: 90, mediaType: 'video', lessons: generateDefaultLessons(6, 'LAW', false) },
        { id: 'eng101', title: 'English & Literary Studies', description: 'Study of English language, literature, and critical analysis.', icon: 'fas fa-pen-nib', totalLessons: 4, estimatedHours: 60, mediaType: 'audio', lessons: generateDefaultLessons(4, 'ENG', false) },
        { id: 'his101', title: 'History & Strategic Studies', description: 'World history, Nigerian history, and strategic studies.', icon: 'fas fa-globe-africa', totalLessons: 5, estimatedHours: 75, mediaType: 'audio', lessons: generateDefaultLessons(5, 'HIS', false) },
        { id: 'bus101', title: 'Business Administration', description: 'Principles of management, marketing, finance, and entrepreneurship.', icon: 'fas fa-chart-line', totalLessons: 7, estimatedHours: 100, mediaType: 'audio', lessons: generateDefaultLessons(7, 'BUS', true) },
        { id: 'mass101', title: 'Mass Communication', description: 'Journalism, public relations, broadcasting, and digital media communication.', icon: 'fas fa-bullhorn', totalLessons: 6, estimatedHours: 90, mediaType: 'audio', lessons: generateDefaultLessons(6, 'MASS', false) },
        { id: 'math101', title: 'Mathematics Education', description: 'Methods and strategies for teaching mathematics.', icon: 'fas fa-calculator', totalLessons: 5, estimatedHours: 70, mediaType: 'audio', lessons: generateDefaultLessons(5, 'MATED', false) },
        { id: 'aed101', title: 'Adult Education', description: 'Teaching and learning strategies for adult learners.', icon: 'fas fa-chalkboard-teacher', totalLessons: 4, estimatedHours: 60, mediaType: 'audio', lessons: generateDefaultLessons(4, 'ADULT', false) },
        {
            id: 'visart101',
            title: 'Visual Arts & Digital Media',
            description: 'A study of animation, painting, graphic design, and digital art.',
            icon: 'fas fa-palette',
            totalLessons: 6,
            estimatedHours: 95,
            mediaType: 'video',
            lessons: generateDefaultLessons(6, 'VA', true)
        },
    ];

    let currentUser = null;
    let userData = null;
    let currentCourse = null;
    let currentLesson = 1;
    let totalLessons = 0;
    let quizPassed = false; // New state to track if quiz is passed for navigation

    // URL Parameters
    const urlParams = new URLSearchParams(window.location.search);
    const courseId = urlParams.get('courseId');
    const lessonParam = urlParams.get('lesson');

    // ... (DOM Content Loaded and Star Animation code remains the same)

    // Mobile Menu Toggle
    const mobileMenuToggle = document.getElementById('mobileMenuToggle');
    const courseSidebar = document.getElementById('courseSidebar');

    mobileMenuToggle.addEventListener('click', () => {
        courseSidebar.classList.toggle('active');
    });

    // Close sidebar when clicking outside on mobile
    document.addEventListener('click', (e) => {
        if (window.innerWidth <= 992) {
            if (!courseSidebar.contains(e.target) && !mobileMenuToggle.contains(e.target)) {
                courseSidebar.classList.remove('active');
            }
        }
    });

    // Auth State Management
    onAuthStateChanged(auth, async (user) => {
        if (user) {
            currentUser = user;
            await loadUserData();
            await initializeCourseViewer();
        } else {
            // Redirect to enrollment page if not logged in
            window.location.href = 'enroll.html';
        }
    });

    async function loadUserData() {
        try {
            const userDocRef = doc(db, 'users', currentUser.uid);
            const userDoc = await getDoc(userDocRef);

            if (userDoc.exists()) {
                userData = userDoc.data();
                // Ensure totalPoints exists for new users
                if (userData.totalPoints === undefined) {
                    userData.totalPoints = 0;
                    await updateDoc(userDocRef, { totalPoints: 0 });
                }
            } else {
                // Redirect to dashboard (or enrollment flow) if user data is missing
                window.location.href = 'studyingatelvion.html';
            }
        } catch (error) {
            console.error('Error loading user data:', error);
            alert('Error loading user data. Please try again.');
        }
    }

    async function initializeCourseViewer() {
        if (!courseId) {
            alert('No course specified');
            window.location.href = 'studyingatelvion.html';
            return;
        }

        currentCourse = findCourseById(courseId);
        if (!currentCourse) {
            alert('Course not found');
            window.location.href = 'studyingatelvion.html';
            return;
        }

        totalLessons = currentCourse.totalLessons;
        currentLesson = parseInt(lessonParam) || 1;

        // Check if user is enrolled
        const enrolledCourse = userData.enrolledCourses?.find(c => c.courseId === courseId);
        if (!enrolledCourse) {
            alert('You are not enrolled in this course');
            window.location.href = 'studyingatelvion.html';
            return;
        }

        setupCourseInterface();
        renderLessonsList();
        loadLesson(currentLesson);

        document.getElementById('loadingContainer').style.display = 'none';
        document.getElementById('contentHeader').style.display = 'flex';
        document.getElementById('mainContent').style.display = 'block';
        document.getElementById('lessonNavigation').style.display = 'flex';
    }

    function findCourseById(courseId) {
        return allCourses.find(c => c.id === courseId);
    }

    function setupCourseInterface() {
        document.getElementById('courseIconLarge').className = `course-icon-large ${currentCourse.icon}`;
        document.getElementById('courseTitle').textContent = currentCourse.title;
        document.getElementById('courseSubtitle').textContent = currentCourse.description;

        // Populate Certificate Form details
        document.getElementById('formSubject').value = `Certificate Request: ${currentCourse.title}`;
        document.getElementById('completedCourseName').value = currentCourse.title;

        updateOverallProgress();
    }

    function updateOverallProgress() {
        const enrolledCourse = userData.enrolledCourses?.find(c => c.courseId === courseId);
        const progress = enrolledCourse?.progress || 0;
        const completedLessons = enrolledCourse?.completedLessons?.length || 0;

        document.getElementById('overallProgressBar').style.width = `${progress}%`;
        document.getElementById('overallProgressText').textContent = `${progress}% Complete (${completedLessons}/${totalLessons} lessons)`;

        // Update Total Points for GP (sidebar and nav)
        document.getElementById('totalPointsEarnedSidebar').textContent = userData.totalPoints || 0;
        document.getElementById('totalPointsEarnedNav').textContent = userData.totalPoints || 0;
        document.getElementById('formTotalPoints').value = userData.totalPoints || 0;
        document.getElementById('finalTotalPoints').textContent = userData.totalPoints || 0;
    }

    function renderLessonsList() {
        const container = document.getElementById('lessonsContainer');
        const enrolledCourse = userData.enrolledCourses?.find(c => c.courseId === courseId);
        const completedLessons = enrolledCourse?.completedLessons || [];

        container.innerHTML = '';

        currentCourse.lessons.forEach((lesson) => {
            const lessonNumber = lesson.id;
            const isCompleted = completedLessons.includes(lessonNumber);
            const isCurrent = lessonNumber === currentLesson;
            const isAccessible = lessonNumber <= (enrolledCourse?.currentLesson || 1);

            const lessonItem = document.createElement('div');
            lessonItem.className = `lesson-item ${isCurrent ? 'active' : ''} ${isCompleted ? 'completed' : ''}`;

            let statusIcon, statusClass;
            if (isCompleted) {
                statusIcon = '<i class="fas fa-check"></i>';
                statusClass = 'completed';
            } else if (isCurrent) {
                statusIcon = lessonNumber;
                statusClass = 'current';
            } else if (isAccessible) {
                statusIcon = lessonNumber;
                statusClass = ''; // Accessible but not current/completed
            } else {
                statusIcon = '<i class="fas fa-lock"></i>';
                statusClass = 'locked';
            }

            lessonItem.innerHTML = `
                <div class="lesson-status ${statusClass}">${statusIcon}</div>
                <div class="lesson-details">
                    <div class="lesson-title">${lesson.title}</div>
                    <div class="lesson-duration">${lesson.duration}</div>
                </div>
            `;

            if (isAccessible) {
                lessonItem.style.cursor = 'pointer';
                lessonItem.addEventListener('click', () => {
                    if (lessonNumber !== currentLesson) {
                        loadLesson(lessonNumber);
                        courseSidebar.classList.remove('active'); // Close on mobile navigation
                    }
                });
            } else {
                lessonItem.style.opacity = '0.5';
                lessonItem.style.cursor = 'not-allowed';
            }

            container.appendChild(lessonItem);
        });

        // Add the final certificate page link
        if (enrolledCourse?.progress === 100) {
            const finalItem = document.createElement('div');
            finalItem.className = `lesson-item ${currentLesson === totalLessons + 1 ? 'active' : ''}`;
            finalItem.style.borderLeftColor = 'var(--success-color)';
            finalItem.innerHTML = `
                <div class="lesson-status completed" style="background: var(--success-color);"><i class="fas fa-certificate"></i></div>
                <div class="lesson-details">
                    <div class="lesson-title" style="color: var(--success-color); font-weight: 700;">Final Exam/Certificate</div>
                    <div class="lesson-duration">Your Course GP is Ready</div>
                </div>
            `;
            finalItem.style.cursor = 'pointer';
            finalItem.addEventListener('click', () => {
                loadLesson(totalLessons + 1);
                courseSidebar.classList.remove('active'); // Close on mobile navigation
            });
            container.appendChild(finalItem);
        }
    }

    function loadLesson(lessonNumber) {
        currentLesson = lessonNumber;
        quizPassed = false; // Reset quiz state for the new lesson

        // Update URL without reloading
        const newUrl = new URL(window.location);
        newUrl.searchParams.set('lesson', lessonNumber);
        window.history.pushState({}, '', newUrl);

        // Hide all main content elements first
        document.getElementById('finalCoursePage').style.display = 'none';
        document.getElementById('contentHeader').style.display = 'flex';
        document.getElementById('lessonNavigation').style.display = 'flex';
        const contentCard = document.querySelector('.content-card');
        const quizContainer = document.getElementById('quizContainer');
        const mediaPlayer = document.getElementById('mediaPlayer');

        contentCard.style.display = 'block';
        mediaPlayer.style.display = 'flex';

        if (currentLesson === totalLessons + 1) {
            // Final Page Logic
            document.getElementById('contentHeader').style.display = 'none';
            document.getElementById('lessonNavigation').style.display = 'none';
            document.getElementById('finalCoursePage').style.display = 'block';
            contentCard.style.display = 'none';
            quizContainer.style.display = 'none';
            mediaPlayer.style.display = 'none';

            updateOverallProgress(); // Refresh GP
        } else {
            // Lesson Page Logic
            const lesson = currentCourse.lessons.find(l => l.id === lessonNumber);
            if (!lesson) return;

            // Update header
            document.getElementById('lessonTitle').textContent = lesson.title;
            document.getElementById('lessonDuration').textContent = lesson.duration;
            document.getElementById('currentLessonNumber').textContent = lessonNumber;
            document.getElementById('totalLessons').textContent = totalLessons;
            document.getElementById('lessonPoints').textContent = '10';
            document.getElementById('markCompleteBtn').style.display = 'none';

            // Update navigation
            document.getElementById('navCurrentLesson').textContent = lessonNumber;
            document.getElementById('navTotalLessons').textContent = totalLessons;

            // Update content
            document.getElementById('lessonContent').innerHTML = lesson.content;

            // Update media player
            const mediaPlaceholderText = document.getElementById('mediaPlaceholderText');
            if (currentCourse.mediaType === 'audio') {
                mediaPlayer.innerHTML = `
                    <audio controls style="width:100%; height: auto; outline:none; border-radius:10px; box-shadow:0 0 8px var(--cyan-glow);">
                        <source src="university/generic_audio.mp3" type="audio/mpeg">
                        Your browser does not support the audio element.
                    </audio>
                `;
                mediaPlaceholderText.textContent = 'Audio content for this lesson is available above.';
            } else {
                mediaPlayer.innerHTML = `
                <div class="media-placeholder">
                    <i class="fas fa-play-circle"></i>
                    <p id="mediaPlaceholderText">Video content coming soon</p>
                    <p style="font-size: 0.9rem; opacity: 0.7;">For now, please read the lesson content below</p>
                </div>
                `;
                mediaPlaceholderText.textContent = 'Video content coming soon';
            }

            // Render Quiz
            const enrolledCourse = userData.enrolledCourses?.find(c => c.courseId === courseId);
            const isCompleted = enrolledCourse?.completedLessons?.includes(currentLesson);

            if (lesson.quiz) {
                quizContainer.style.display = 'block';
                renderQuiz(lesson.quiz, isCompleted);
            } else {
                quizContainer.style.display = 'none';
            }
        }

        // Update navigation buttons and state
        updateNavigationControls();

        // Update sidebar
        renderLessonsList();

        // Scroll to top
        window.scrollTo(0, 0);
    }

    function updateNavigationControls() {
        const prevBtn = document.getElementById('prevLessonBtn');
        const nextBtn = document.getElementById('nextLessonBtn');
        const enrolledCourse = userData.enrolledCourses?.find(c => c.courseId === courseId);
        const isCompleted = enrolledCourse?.completedLessons?.includes(currentLesson);
        const isCourseFullyCompleted = enrolledCourse?.progress === 100;

        // Previous Button Logic
        prevBtn.disabled = currentLesson <= 1;

        // Next Button Logic
        if (currentLesson === totalLessons) {
            nextBtn.textContent = 'Final Exam/Certificate';
            // Enable only if all lessons are completed (progress 100%)
            nextBtn.disabled = !isCourseFullyCompleted && !isCompleted; // Use isCompleted as a fallback if progress hasn't updated immediately
        } else if (currentLesson === totalLessons + 1) {
            // On Final Page, next is always disabled
            nextBtn.textContent = 'Course Completed';
            nextBtn.disabled = true;
        } else if (isCompleted || quizPassed) {
            nextBtn.textContent = 'Next Lesson';
            nextBtn.disabled = false;
        } else {
            nextBtn.textContent = 'Pass Quiz to Unlock';
            nextBtn.disabled = true;
        }
    }

    // --- QUIZ LOGIC (Updated to include animation/feedback) ---

    function renderQuiz(quizData, isLessonCompleted) {
        const quizQuestionsContainer = document.getElementById('quizQuestions');
        quizQuestionsContainer.innerHTML = '';
        document.getElementById('quizResult').innerHTML = ''; // Clear result area

        // Hide submit button if lesson is already completed
        const submitBtn = document.getElementById('submitQuizBtn');
        submitBtn.style.display = isLessonCompleted ? 'none' : 'block';

        quizData.forEach((q, index) => {
            const questionElement = document.createElement('div');
            questionElement.className = 'quiz-question-wrapper';
            questionElement.style.marginBottom = '2rem'; // Separating questions

            questionElement.innerHTML = `
                <div class="quiz-question">Question ${index + 1}: ${q.question}</div>
                <div class="quiz-options" data-question-index="${index}">
                    ${q.type === 'mcq' ? q.options.map(option => `
                        <div class="quiz-option" data-answer="${option}" ${isLessonCompleted ? 'style="cursor: default;"' : ''}>${option}</div>
                    `).join('') : ''}
                    ${q.type === 'text' ? `
                        <input type="text" class="text-input-answer" placeholder="Type your answer here..." style="width: 100%; padding: 1rem; border-radius: 8px; border: 2px solid rgba(0, 255, 255, 0.3); background: rgba(0, 0, 0, 0.5); color: var(--text-color); font-size: 1rem;" ${isLessonCompleted ? 'disabled' : ''}>
                    ` : ''}
                </div>
            `;
            quizQuestionsContainer.appendChild(questionElement);
        });

        // Add event listeners for MCQ selection only if not completed
        if (!isLessonCompleted) {
            quizQuestionsContainer.querySelectorAll('.quiz-option').forEach(option => {
                option.addEventListener('click', function () {
                    const optionsGroup = this.closest('.quiz-options');
                    // Deselect all others in the group
                    optionsGroup.querySelectorAll('.quiz-option').forEach(opt => opt.classList.remove('selected', 'correct', 'incorrect'));
                    // Select the clicked one
                    this.classList.add('selected');
                });
            });
        } else {
            // If completed, visually mark the correct answer on load
            quizData.forEach((q, index) => {
                const optionsGroup = document.querySelector(`.quiz-options[data-question-index="${index}"]`);
                if (q.type === 'mcq') {
                    // Mark the correct answer
                    optionsGroup.querySelector(`.quiz-option[data-answer="${q.answer}"]`)?.classList.add('correct');
                } else if (q.type === 'text') {
                    const input = optionsGroup.querySelector(`.text-input-answer`);
                    input.value = q.answer;
                    input.style.border = `2px solid var(--success-color)`;
                }
            });
            document.getElementById('quizResult').innerHTML = `<div class="quiz-feedback correct"><i class="fas fa-check-circle"></i> **Lesson Already Completed!** You may move to the next lesson.</div>`;
            quizPassed = true;
            updateNavigationControls();
        }
    }

    document.getElementById('submitQuizBtn').addEventListener('click', () => {
        const lesson = currentCourse.lessons.find(l => l.id === currentLesson);
        const quizData = lesson.quiz;
        let allCorrect = true;
        let score = 0;

        // Reset and evaluate
        quizData.forEach((q, index) => {
            const optionsGroup = document.querySelector(`.quiz-options[data-question-index="${index}"]`);
            let isCorrect = false;

            if (q.type === 'mcq') {
                const selectedOption = optionsGroup.querySelector('.quiz-option.selected');

                // Clear all previous result classes and animation classes first
                optionsGroup.querySelectorAll('.quiz-option').forEach(opt => opt.classList.remove('correct', 'incorrect'));

                if (selectedOption) {
                    if (selectedOption.dataset.answer === q.answer) {
                        isCorrect = true;
                        selectedOption.classList.add('correct');
                    } else {
                        selectedOption.classList.add('incorrect');
                        // Highlight the correct answer
                        optionsGroup.querySelector(`.quiz-option[data-answer="${q.answer}"]`).classList.add('correct');
                    }
                } else {
                    // User did not select an answer, fail and highlight correct answer
                    optionsGroup.querySelector(`.quiz-option[data-answer="${q.answer}"]`)?.classList.add('correct');
                }
            } else if (q.type === 'text') {
                const input = optionsGroup.querySelector('.text-input-answer');
                const userAnswer = input.value.trim().toLowerCase();
                const correctAnswer = q.answer.trim().toLowerCase();

                if (userAnswer === correctAnswer) {
                    isCorrect = true;
                    input.style.border = `2px solid var(--success-color)`;
                } else {
                    input.style.border = `2px solid var(--error-color)`;
                    // Note: No easy way to show correct text answer without disrupting the UI, just show error
                }
            }

            if (isCorrect) {
                score++;
            } else {
                allCorrect = false;
            }
        });

        const quizResultElement = document.getElementById('quizResult');
        const totalQuestions = quizData.length;

        if (allCorrect) {
            quizResultElement.innerHTML = `
                <div class="quiz-feedback correct">
                    <i class="fas fa-check-circle"></i> **Perfect Score!** You got ${score}/${totalQuestions} correct. Lesson unlocked!
                </div>
            `;
            // All correct! Mark lesson complete and show modal.
            markLessonComplete();
            document.getElementById('submitQuizBtn').style.display = 'none'; // Hide submit after passing
        } else {
            quizResultElement.innerHTML = `
                <div class="quiz-feedback incorrect">
                    <i class="fas fa-times-circle"></i> **Incorrect Answers.** Score: ${score}/${totalQuestions}. Please review the lesson and try again.
                </div>
            `;
            // Disable navigation controls if quiz failed
            quizPassed = false;
            updateNavigationControls();
        }
    });

    // --- END QUIZ LOGIC ---


    // Event Listeners
    document.getElementById('prevLessonBtn').addEventListener('click', () => {
        if (currentLesson === totalLessons + 1) {
            loadLesson(totalLessons); // Back from final page to last lesson
        } else if (currentLesson > 1) {
            loadLesson(currentLesson - 1);
        }
    });

    document.getElementById('nextLessonBtn').addEventListener('click', () => {
        if (currentLesson < totalLessons) {
            // This is only enabled if the lesson is completed/quiz is passed
            loadLesson(currentLesson + 1);
        } else if (currentLesson === totalLessons) {
            // Go to final page (Only enabled if progress is 100)
            const enrolledCourse = userData.enrolledCourses?.find(c => c.courseId === courseId);
            if (enrolledCourse?.progress === 100 || enrolledCourse?.completedLessons?.includes(totalLessons)) {
                loadLesson(currentLesson + 1);
            }
        }
    });

    document.getElementById('continueBtn').addEventListener('click', () => {
        document.getElementById('completionModal').style.display = 'none';
        if (currentLesson < totalLessons) {
            loadLesson(currentLesson + 1);
        } else if (currentLesson === totalLessons) {
            loadLesson(currentLesson + 1); // Go to the final certificate page
        }
    });

    // Corrected Dashboard Redirect
    document.getElementById('backToDashboardBtn').addEventListener('click', () => {
        window.location.href = 'studyingatelvion.html';
    });

    async function markLessonComplete() {
        try {
            const enrolledCourseIndex = userData.enrolledCourses.findIndex(c => c.courseId === courseId);
            if (enrolledCourseIndex === -1) return;

            const enrolledCourse = userData.enrolledCourses[enrolledCourseIndex];

            // Check for double completion (to prevent point inflation)
            if (enrolledCourse.completedLessons?.includes(currentLesson)) {
                // Already completed, just update session state and show modal
                quizPassed = true;
                updateNavigationControls();
                document.getElementById('pointsEarned').textContent = '0 (Already earned)';
                document.getElementById('completionModal').style.display = 'flex';
                return;
            }

            // Add to completed lessons
            if (!enrolledCourse.completedLessons) {
                enrolledCourse.completedLessons = [];
            }
            enrolledCourse.completedLessons.push(currentLesson);

            // Update current lesson access: currentLesson + 1
            enrolledCourse.currentLesson = Math.max(enrolledCourse.currentLesson || 1, currentLesson + 1);

            // Calculate progress
            const completedCount = enrolledCourse.completedLessons.length;
            enrolledCourse.progress = Math.round((completedCount / totalLessons) * 100);

            // Update user data: GP/Points logic is here
            userData.enrolledCourses[enrolledCourseIndex] = enrolledCourse;
            userData.completedLessons = (userData.completedLessons || 0) + 1;
            userData.totalPoints = (userData.totalPoints || 0) + 10; // 10 points per lesson

            // Save to database
            await updateDoc(doc(db, 'users', currentUser.uid), {
                enrolledCourses: userData.enrolledCourses,
                completedLessons: userData.completedLessons,
                totalPoints: userData.totalPoints
            });

            // Update UI
            updateOverallProgress();
            renderLessonsList();

            // Mark Quiz as passed for this session
            quizPassed = true;
            updateNavigationControls();

            // Show completion modal
            document.getElementById('pointsEarned').textContent = '10';
            document.getElementById('completionModal').style.display = 'flex';

        } catch (error) {
            console.error('Error marking lesson complete:', error);
            alert('Error updating progress. Please try again.');
        }
    }

    // Initialize stars (outside of DOMContentLoaded to be safe with module imports)
    document.addEventListener('DOMContentLoaded', () => {
        const starsContainer = document.getElementById('stars-container');
        const numStars = 100;
        const minSize = 1;
        const maxSize = 3;
        for (let i = 0; i < numStars; i++) {
            const star = document.createElement('div');
            star.className = 'star';
            const size = Math.random() * (maxSize - minSize) + minSize;
            star.style.width = `${size}px`;
            star.style.height = `${size}px`;
            star.style.left = `${Math.random() * 100}%`;
            star.style.top = `${Math.random() * 100}%`;
            star.style.animationDelay = `${Math.random() * 4}s`;
            star.style.animationDuration = `${3 + Math.random() * 2}s`;
            starsContainer.appendChild(star);
        }
    });

</script>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-J1YTKP10ZX"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date()); 

  gtag('config', 'G-J1YTKP10ZX');
</script>
