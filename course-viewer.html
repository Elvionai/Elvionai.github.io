<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Course Viewer | Elvion University</title>
  <meta name="description" content="Learn with interactive courses at Elvion University">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Orbitron:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --dark-navy: #00001a;
      --black-bg: #000000;
      --cyan-glow: #00ffff;
      --light-blue-glow: #00aaff;
      --text-color: #e0e0e0;
      --heading-color: #ffffff;
      --gradient-start: #0a1128;
      --gradient-end: #121a30;
      --card-bg: rgba(18, 26, 48, 0.85);
      --border-glow: 0 0 10px var(--cyan-glow), 0 0 20px var(--light-blue-glow);
      --hover-glow: 0 0 15px var(--cyan-glow), 0 0 30px var(--light-blue-glow);
      --button-bg: linear-gradient(45deg, var(--cyan-glow), var(--light-blue-glow));
      --button-text-color: var(--black-bg);
      --star-color: rgba(255, 255, 255, 0.7);
      --sidebar-width: 300px;
      --success-color: #4ade80;
      --warning-color: #fbbf24;
      --error-color: #f87171;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html { scroll-behavior: smooth; }

    body {
      font-family: 'Inter', sans-serif;
      background-color: var(--black-bg);
      color: var(--text-color);
      line-height: 1.7;
      overflow-x: hidden;
      position: relative;
      min-height: 100vh;
    }

    h1, h2, h3, h4, h5, h6 {
      font-family: 'Orbitron', sans-serif;
      color: var(--heading-color);
      margin-top: 0;
    }

    /* Stars Animation */
    #stars-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 0;
      overflow: hidden;
    }

    .star {
      position: absolute;
      background-color: var(--star-color);
      border-radius: 50%;
      opacity: 0;
      animation: twinkle 4s infinite ease-in-out;
    }

    @keyframes twinkle {
      0%, 100% { opacity: 0; transform: scale(0.5); }
      50% { opacity: 1; transform: scale(1); }
    }

    /* Main Layout */
    .course-viewer-container {
      display: flex;
      min-height: 100vh;
      position: relative;
      z-index: 1;
    }

    /* Course Sidebar */
    .course-sidebar {
      width: var(--sidebar-width);
      background: var(--card-bg);
      backdrop-filter: blur(10px);
      border-right: 1px solid rgba(0, 255, 255, 0.2);
      position: fixed;
      height: 100vh;
      overflow-y: auto;
      z-index: 100;
      transition: transform 0.3s ease;
    }

    .course-sidebar-header {
      padding: 1.5rem;
      border-bottom: 1px solid rgba(0, 255, 255, 0.1);
    }

    .back-btn {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      color: var(--cyan-glow);
      text-decoration: none;
      font-weight: 600;
      padding: 0.8rem;
      border-radius: 8px;
      transition: all 0.3s ease;
      margin-bottom: 1rem;
    }

    .back-btn:hover {
      background: rgba(0, 255, 255, 0.1);
    }

    .course-info {
      text-align: center;
    }

    .course-icon-large {
      font-size: 3rem;
      color: var(--cyan-glow);
      text-shadow: var(--border-glow);
      margin-bottom: 1rem;
    }

    .course-title {
      font-size: 1.4rem;
      margin-bottom: 0.5rem;
      color: var(--heading-color);
    }

    .course-subtitle {
      font-size: 0.9rem;
      color: var(--text-color);
      opacity: 0.8;
      margin-bottom: 1rem;
    }

    .overall-progress {
      background: rgba(0, 0, 0, 0.3);
      border-radius: 10px;
      padding: 1rem;
      margin-bottom: 1rem;
    }

    .progress-label {
      font-size: 0.85rem;
      color: var(--text-color);
      margin-bottom: 0.5rem;
    }

    .progress-bar-container {
      width: 100%;
      height: 8px;
      background: rgba(0, 255, 255, 0.1);
      border-radius: 10px;
      overflow: hidden;
      margin-bottom: 0.5rem;
    }

    .progress-bar-fill {
      height: 100%;
      background: var(--button-bg);
      border-radius: 10px;
      transition: width 0.8s ease;
      box-shadow: 0 0 10px var(--cyan-glow);
    }

    .progress-text {
      font-size: 0.85rem;
      color: var(--cyan-glow);
      font-weight: 600;
    }

    /* Lessons List */
    .lessons-list {
      padding: 1rem 0;
    }

    .lessons-header {
      padding: 0 1.5rem 1rem 1.5rem;
      font-size: 1.1rem;
      color: var(--heading-color);
      border-bottom: 1px solid rgba(0, 255, 255, 0.1);
    }

    .lesson-item {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 1rem 1.5rem;
      cursor: pointer;
      transition: all 0.3s ease;
      border-left: 3px solid transparent;
    }

    .lesson-item:hover {
      background: rgba(0, 255, 255, 0.05);
    }

    .lesson-item.active {
      background: rgba(0, 255, 255, 0.1);
      border-left-color: var(--cyan-glow);
    }

    .lesson-item.completed {
      opacity: 0.8;
    }

    .lesson-status {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.8rem;
      flex-shrink: 0;
    }

    .lesson-status.completed {
      background: var(--success-color);
      color: var(--black-bg);
    }

    .lesson-status.current {
      background: var(--cyan-glow);
      color: var(--black-bg);
    }

    .lesson-status.locked {
      background: rgba(255, 255, 255, 0.1);
      color: var(--text-color);
    }

    .lesson-details {
      flex: 1;
    }

    .lesson-title {
      font-size: 0.9rem;
      font-weight: 600;
      color: var(--heading-color);
      margin-bottom: 0.3rem;
    }

    .lesson-duration {
      font-size: 0.8rem;
      color: var(--text-color);
      opacity: 0.7;
    }

    /* Mobile Menu Toggle */
    .mobile-menu-toggle {
      display: none;
      position: fixed;
      top: 1rem;
      left: 1rem;
      z-index: 101;
      background: var(--card-bg);
      border: 1px solid var(--cyan-glow);
      border-radius: 8px;
      padding: 0.5rem 0.8rem;
      color: var(--cyan-glow);
      cursor: pointer;
      box-shadow: var(--border-glow);
    }

    /* Content Area */
    .content-area {
      flex: 1;
      margin-left: var(--sidebar-width);
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      width: calc(100% - var(--sidebar-width)); /* Added for better responsiveness */
    }

    .content-header {
      background: var(--card-bg);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid rgba(0, 255, 255, 0.1);
      padding: 1.5rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 1rem;
    }

    .lesson-info h1 {
      font-size: 1.5rem;
      margin-bottom: 0.5rem;
    }

    .lesson-meta {
      display: flex;
      gap: 1.5rem;
      font-size: 0.9rem;
      color: var(--text-color);
    }

    .lesson-meta span {
      display: flex;
      align-items: center;
      gap: 0.3rem;
    }

    .content-actions {
      display: flex;
      gap: 1rem;
      align-items: center;
    }

    .action-btn {
      padding: 0.8rem 1.5rem;
      background: var(--button-bg);
      color: var(--button-text-color);
      border: none;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      font-family: 'Inter', sans-serif;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .action-btn:hover {
      box-shadow: var(--hover-glow);
      transform: scale(1.02);
    }

    .action-btn.secondary {
      background: transparent;
      border: 2px solid var(--cyan-glow);
      color: var(--cyan-glow);
    }

    .action-btn.secondary:hover {
      background: var(--cyan-glow);
      color: var(--black-bg);
      box-shadow: var(--border-glow);
    }

    .action-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
      background: rgba(0, 255, 255, 0.1);
      border: none;
      color: var(--text-color);
    }

    /* Main Content */
    .main-content {
      flex: 1;
      padding: 2rem;
      background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
    }

    .content-card {
      background: var(--card-bg);
      border-radius: 15px;
      padding: 2rem;
      box-shadow: var(--border-glow);
      backdrop-filter: blur(5px);
      border: 1px solid rgba(0, 255, 255, 0.1);
      margin-bottom: 2rem;
    }

    .lesson-content {
      line-height: 1.8;
      font-size: 1.1rem;
    }

    .lesson-content h2 {
      color: var(--cyan-glow);
      margin: 2rem 0 1rem 0;
      font-size: 1.6rem;
    }

    .lesson-content h3 {
      color: var(--heading-color);
      margin: 1.5rem 0 0.8rem 0;
      font-size: 1.3rem;
    }

    .lesson-content p {
      margin-bottom: 1.2rem;
    }

    .lesson-content ul, .lesson-content ol {
      margin: 1rem 0 1rem 2rem;
      padding-left: 0.5rem;
    }

    .lesson-content li {
      margin-bottom: 0.5rem;
    }

    .lesson-content code {
      background: rgba(0, 255, 255, 0.1);
      padding: 0.2rem 0.5rem;
      border-radius: 4px;
      color: var(--cyan-glow);
      font-family: 'Courier New', monospace;
    }

    .lesson-content pre {
      background: #0d1a26; /* Darker, more code-like background */
      padding: 1.5rem;
      border-radius: 8px;
      border-left: 4px solid var(--cyan-glow);
      overflow-x: auto;
      margin: 1.5rem 0;
      box-shadow: 0 0 10px rgba(0, 255, 255, 0.1);
    }

    .lesson-content pre code {
      background: none;
      padding: 0;
      color: #9cdcfe; /* Light blue for code */
      display: block;
      font-size: 0.95rem;
      line-height: 1.5;
    }

    /* Video Player Placeholder */
    .video-player {
      width: 100%;
      height: 400px;
      background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 2rem;
      border: 1px solid rgba(0, 255, 255, 0.2);
    }

    .video-placeholder {
      text-align: center;
      color: var(--text-color);
    }

    .video-placeholder i {
      font-size: 4rem;
      color: var(--cyan-glow);
      margin-bottom: 1rem;
      display: block;
      text-shadow: var(--border-glow);
    }

    /* Navigation Controls */
    .lesson-navigation {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1.5rem 2rem;
      background: var(--card-bg);
      backdrop-filter: blur(10px);
      border-top: 1px solid rgba(0, 255, 255, 0.1);
      position: sticky;
      bottom: 0;
      z-index: 50;
    }

    .nav-info {
      display: flex;
      align-items: center;
      gap: 1.5rem;
      font-size: 0.9rem;
      color: var(--text-color);
    }

    .lesson-indicator {
      background: rgba(0, 255, 255, 0.1);
      padding: 0.5rem 1rem;
      border-radius: 20px;
      border: 1px solid rgba(0, 255, 255, 0.3);
    }

    .nav-buttons {
      display: flex;
      gap: 1rem;
    }

    /* Quiz/Assessment Styles (Reused for Assignment/Form) */
    .quiz-container, .assignment-form-container {
      background: var(--card-bg);
      border-radius: 15px;
      padding: 2rem;
      box-shadow: var(--border-glow);
      backdrop-filter: blur(5px);
      border: 1px solid rgba(0, 255, 255, 0.1);
      margin-bottom: 2rem;
    }
    
    .assignment-form-container h2 {
        color: var(--success-color);
        text-shadow: 0 0 5px rgba(74, 222, 128, 0.5);
    }

    /* Certification Form Styles */
    .certificate-form label {
        display: block;
        margin-top: 1rem;
        font-weight: 600;
        color: var(--cyan-glow);
    }
    
    .certificate-form input[type="text"],
    .certificate-form input[type="email"] {
        width: 100%;
        padding: 0.75rem;
        margin-top: 0.5rem;
        border-radius: 6px;
        border: 1px solid rgba(0, 255, 255, 0.3);
        background-color: rgba(0, 0, 0, 0.4);
        color: var(--text-color);
        font-size: 1rem;
        transition: border-color 0.3s ease;
    }
    
    .certificate-form input[type="text"]:focus,
    .certificate-form input[type="email"]:focus {
        border-color: var(--cyan-glow);
        outline: none;
        box-shadow: 0 0 5px var(--cyan-glow);
    }
    
    .certificate-form p.info {
        font-size: 0.85rem;
        color: var(--warning-color);
        margin-top: 1rem;
    }

    /* Completion Modal */
    .completion-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      padding: 1rem; /* Added padding for small screens */
    }

    .completion-content {
      background: var(--card-bg);
      padding: 3rem;
      border-radius: 15px;
      text-align: center;
      max-width: 550px; /* Slightly wider */
      box-shadow: var(--hover-glow);
      border: 1px solid rgba(0, 255, 255, 0.3);
      width: 100%; /* Ensure it uses max-width */
    }

    .completion-icon {
      font-size: 4rem;
      color: var(--success-color);
      margin-bottom: 1rem;
    }

    .completion-title {
      font-size: 1.8rem;
      margin-bottom: 1rem;
      color: var(--heading-color);
    }

    .completion-message {
      color: var(--text-color);
      margin-bottom: 2rem;
      line-height: 1.6;
    }

    .points-earned {
      background: rgba(255, 215, 0, 0.1);
      border: 1px solid rgba(255, 215, 0, 0.3);
      padding: 1rem;
      border-radius: 8px;
      margin-bottom: 2rem;
      color: #ffd700;
    }
    
    /* New: Casual Comment Section */
    .casual-comment-section {
        margin-top: 2rem;
        padding: 1rem;
        background: rgba(0, 255, 255, 0.05);
        border: 1px solid rgba(0, 255, 255, 0.2);
        border-radius: 8px;
        text-align: left;
    }
    
    .casual-comment-section h3 {
        color: var(--cyan-glow);
        font-size: 1.2rem;
        margin-bottom: 0.75rem;
        text-align: center;
    }
    
    .casual-comment-section textarea {
        width: 100%;
        min-height: 80px;
        padding: 0.75rem;
        border-radius: 6px;
        border: 1px solid rgba(0, 255, 255, 0.3);
        background-color: rgba(0, 0, 0, 0.4);
        color: var(--text-color);
        font-size: 1rem;
        resize: vertical;
    }

    /* Loading State */
    .loading-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 50vh;
    }

    .loading-spinner {
      width: 60px;
      height: 60px;
      border: 4px solid rgba(0, 255, 255, 0.1);
      border-top-color: var(--cyan-glow);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .loading-text {
      margin-top: 1rem;
      color: var(--text-color);
      font-size: 1.1rem;
    }

    /* Responsive Design */
    @media (max-width: 992px) {
      .course-sidebar {
        transform: translateX(-100%);
      }

      .course-sidebar.active {
        transform: translateX(0);
      }

      .content-area {
        margin-left: 0;
        width: 100%; /* Full width on mobile */
      }

      .mobile-menu-toggle {
        display: block;
      }

      .main-content {
        padding: 1rem;
        padding-top: 5rem; /* Space for the fixed toggle button */
      }

      .content-header {
        padding: 1rem;
        flex-direction: column;
        align-items: flex-start;
      }

      .content-actions {
        width: 100%;
        justify-content: stretch;
      }

      .action-btn {
        flex: 1;
        justify-content: center;
      }

      .lesson-navigation {
        padding: 1rem;
        flex-direction: column;
        gap: 1rem;
      }

      .nav-buttons {
        width: 100%;
        justify-content: stretch;
      }

      .nav-buttons .action-btn {
        flex: 1;
      }
      
      .content-card {
        padding: 1.5rem;
      }
      
      .completion-content {
          padding: 2rem 1.5rem;
      }
    }

    @media (max-width: 768px) {
      .video-player {
        height: 250px;
      }

      .completion-content {
        margin: 1rem;
      }
      
      .lesson-content h2 {
          font-size: 1.4rem;
      }
      
      .lesson-content h3 {
          font-size: 1.1rem;
      }
      
      .nav-info {
          flex-direction: column;
          align-items: flex-start;
          gap: 0.5rem;
      }
    }
  </style>
</head>
<body>
  <div id="stars-container"></div>

  <button class="mobile-menu-toggle" id="mobileMenuToggle">
    <i class="fas fa-bars"></i>
  </button>

  <div class="course-viewer-container">
    <aside class="course-sidebar" id="courseSidebar">
      <div class="course-sidebar-header">
        <a href="studyingatelvion.html" class="back-btn">
          <i class="fas fa-arrow-left"></i>
          Back to Dashboard
        </a>
        
        <div class="course-info">
          <i id="courseIconLarge" class="course-icon-large"></i>
          <h2 id="courseTitle" class="course-title">Loading...</h2>
          <p id="courseSubtitle" class="course-subtitle">Please wait...</p>
          
          <div class="overall-progress">
            <div class="progress-label">Overall Progress</div>
            <div class="progress-bar-container">
              <div id="overallProgressBar" class="progress-bar-fill" style="width: 0%"></div>
            </div>
            <div id="overallProgressText" class="progress-text">0% Complete</div>
          </div>
        </div>
      </div>

      <div class="lessons-list">
        <div class="lessons-header">Course Lessons</div>
        <div id="lessonsContainer">
          </div>
      </div>
    </aside>

    <main class="content-area">
      <div class="loading-container" id="loadingContainer">
        <div class="loading-spinner"></div>
        <p class="loading-text">Loading course content...</p>
      </div>

      <header class="content-header" id="contentHeader" style="display: none;">
        <div class="lesson-info">
          <h1 id="lessonTitle">Lesson Title</h1>
          <div class="lesson-meta">
            <span><i class="fas fa-clock"></i> <span id="lessonDuration">45 min</span></span>
            <span><i class="fas fa-book"></i> Lesson <span id="currentLessonNumber">1</span> of <span id="totalLessons">8</span></span>
            <span><i class="fas fa-star"></i> <span id="lessonPoints">10</span> Points</span>
          </div>
        </div>
        <div class="content-actions">
          <button id="markCompleteBtn" class="action-btn">
            <i class="fas fa-check"></i>
            Mark Complete
          </button>
        </div>
      </header>

      <section class="main-content" id="mainContent" style="display: none;">
        <div class="video-player" id="videoPlayer">
          <div class="video-placeholder">
            <i class="fas fa-play-circle"></i>
            <p>Video content coming soon</p>
            <p style="font-size: 0.9rem; opacity: 0.7;">For now, please read the lesson content below</p>
          </div>
        </div>

        <div class="content-card">
          <div id="lessonContent" class="lesson-content">
            </div>
        </div>

        <div id="assignmentContainer" class="assignment-form-container" style="display: none;">
            </div>
      </section>

      <nav class="lesson-navigation" id="lessonNavigation" style="display: none;">
        <div class="nav-info">
          <div class="lesson-indicator">
            Lesson <span id="navCurrentLesson">1</span> of <span id="navTotalLessons">8</span>
          </div>
          <span><i class="fas fa-trophy"></i> <span id="totalPointsEarned">0</span> Points Earned</span>
        </div>
        <div class="nav-buttons">
          <button id="prevLessonBtn" class="action-btn secondary">
            <i class="fas fa-chevron-left"></i>
            Previous
          </button>
          <button id="nextLessonBtn" class="action-btn">
            Next
            <i class="fas fa-chevron-right"></i>
          </button>
        </div>
      </nav>
    </main>
  </div>

  <div id="completionModal" class="completion-modal">
    <div class="completion-content">
      <i class="fas fa-trophy completion-icon"></i>
      <h2 class="completion-title">Lesson Complete!</h2>
      <p class="completion-message">
        Congratulations! You've successfully completed this lesson.
      </p>
      <div class="points-earned">
        <i class="fas fa-star"></i>
        You earned <span id="pointsEarned">10</span> points!
      </div>
      
      <div id="commentSection" class="casual-comment-section">
          <h3>Thank Elvion for the Course!</h3>
          <p style="font-size:0.9rem; color:var(--text-color); margin-bottom: 0.5rem; opacity:0.8;">Leave a casual message or feedback below (optional):</p>
          <textarea placeholder="e.g., 'Thank you for the amazing course! I learned so much about OOP.'"></textarea>
          <button class="action-btn" style="width: 100%; margin-top: 1rem;">Submit Feedback</button>
      </div>

      <div style="display: flex; gap: 1rem; margin-top: 2rem;">
        <button id="continueBtn" class="action-btn" style="flex: 1;">
          Continue Learning
        </button>
        <button id="backToDashboardBtn" class="action-btn secondary" style="flex: 1;">
          Back to Dashboard
        </button>
      </div>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
    import {
      getAuth,
      onAuthStateChanged
    } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-auth.js";
    import {
      getFirestore,
      doc,
      getDoc,
      updateDoc,
    } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore.js";

    // IMPORTANT: Replace this with your actual Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyAyROm0aBGjry6NUfhNM3e0qwPcCDoIqSk",
      authDomain: "elvionai.firebaseapp.com",
      projectId: "elvionai",
      storageBucket: "elvionai.firebasestorage.app",
      messagingSenderId: "161078300830",
      appId: "1:161078300830:web:f460df8591704eb0e96b8f"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    
    // --- COURSE DATABASE ---
    const certificateLesson = { 
        id: 99, // High ID to ensure it's last
        title: 'Course Completion & Certification', 
        duration: '10 min', 
        isCertificate: true,
        content: `
            <h2>Claim Your Certificate of Participation</h2>
            <p>Congratulations on completing the foundational knowledge portion of this course! Elvion University awards **Certificates of Participation** to recognize your dedication to pre-degree learning. These certificates are not for academic credit or degree applications but are a testament to your commitment and knowledge gained.</p>
            <p>To receive your personalized certificate via email, please complete the form below. Ensure your name is exactly how you want it to appear on the final document.</p>
        `,
        assignmentContent: `
            <div class="assignment-form-container">
                <h2>Certificate Information Submission</h2>
                <p style="margin-bottom: 1.5rem; color: var(--text-color); opacity: 0.9;">Please fill out your details to receive your personalized Certificate of Participation.</p>
                <form class="certificate-form" action="https://formspree.io/f/mldrbpwo" method="post">
                    <label for="full-name"><i class="fas fa-user-circle"></i> Full Name (as it should appear on certificate)</label>
                    <input type="text" id="full-name" name="Full Name" placeholder="e.g., Jane C. Doe" required>

                    <label for="email"><i class="fas fa-envelope"></i> Email Address</label>
                    <input type="email" id="email" name="Email" placeholder="jane.doe@example.com" required>
                    
                    <input type="hidden" name="Course ID" value="${courseId}">
                    <input type="hidden" name="Course Title" id="courseTitleHidden">

                    <p class="info"><i class="fas fa-exclamation-triangle"></i> Note: This certificate is for personal recognition only and does not award official academic credit.</p>

                    <button type="submit" class="action-btn" style="width: 100%; margin-top: 2rem;">
                        <i class="fas fa-award"></i> Submit & Get Certificate
                    </button>
                </form>
            </div>
        `
    };

    const coursesDatabase = {
      'science-tech': {
        facultyName: 'Faculty of Science & Technology',
        courses: [
          {
            id: 'cs101',
            title: 'Computer Science: Fundamentals & Logic',
            description: 'Fundamentals of computing, programming, and algorithms',
            icon: 'fas fa-laptop-code',
            lessons: [
              { 
                id: 1, 
                title: 'Introduction to Programming & Data Types', 
                duration: '45 min', 
                content: `
                  <h2>The Core of Computation: Variables and Types</h2>
                  <p>In all programming, the most fundamental concept is the **variable**—a named storage location that holds a value. Consider this as defining the raw material we use to build software logic.</p>
                  
                  <h3>Practical Example: Defining Primitive Types (Python)</h3>
                  <p>In Python, you don't explicitly declare the type, but the type is assigned dynamically. Let’s look at the four core primitive types:</p>
                  <pre><code># Integer (Whole numbers)
student_count = 358
year_of_birth = 1999

# Float (Decimal numbers)
pi_value = 3.14159265
lab_temp_celsius = 20.5

# String (Text data, always wrapped in quotes)
user_greeting = "Welcome to Elvion University!"
api_endpoint = '/api/v1/users'

# Boolean (True or False logic)
is_enrolled = True
has_passed_quiz = False</code></pre>
                  <p>Understanding these types is essential because different data types occupy different amounts of memory and support different operations. For instance, you can multiply two integers, but not an integer and a boolean.</p>

                  <h3>The Hello World Function</h3>
                  <p>To prove that the compiler is working and you can execute a command, every coding journey starts here. This simple I/O (Input/Output) operation is your first practical step:</p>
                  <pre><code># Basic Output function in most languages:
print("Hello, Elvion!")  
# In a compiled language like Java, it's slightly longer:
// System.out.println("Hello, Elvion!");</code></pre>

                  <h3>Next Steps</h3>
                  <p>Next, we move beyond single variables to **Data Structures**—how we organize these variables for efficient processing.</p>
                `
              },
              { 
                id: 2, 
                title: 'Data Structures: Lists, Dictionaries, and Hashing', 
                duration: '60 min', 
                content: `
                  <h2>Organizing Data: Arrays vs. Dictionaries</h2>
                  <p>When you have thousands of data points, storing them in individual variables is impossible. **Data Structures** provide a blueprint for how data is related and accessed.</p>

                  <h3>1. Lists (Dynamic Arrays) - Sequential Access</h3>
                  <p>A list is a sequence of items, indexed by their position (starting at 0). It's great when order matters.</p>
                  <pre><code># Python List Example
course_modules = ["Intro", "Data Types", "OOP", "Databases"]

# Accessing by Index (Position)
first_module = course_modules[0]   # 'Intro'
last_module = course_modules[-1]  # 'Databases'

# Modifying the list
course_modules.append("Networking")
course_modules.remove("Data Types")</code></pre>
                  
                  <h3>2. Dictionaries (Hash Maps) - Keyed Access</h3>
                  <p>A dictionary stores data in **key-value pairs**. It's crucial for quick lookups, as the key is *hashed* to immediately find the value, making it much faster than searching a list.</p>
                  <pre><code># Python Dictionary Example
student_record = {
    "student_id": "ELV90210",
    "name": "Alexia Vane",
    "gpa": 3.85,
    "is_graduating": False
}

# Accessing by Key (Name, not Position)
name = student_record["name"] # 'Alexia Vane'

# Adding a new key-value pair
student_record["major"] = "Cybernetics"</code></pre>

                  <h3>Practical Comparison: Lookup Time</h3>
                  <p>Imagine you have 1 million records. To find a name in a **List**, the computer might check up to 1 million positions (**O(n) time complexity**). In a **Dictionary**, the lookup is near-instantaneous, requiring only one step regardless of the size (**O(1) time complexity**).</p>
                `
              },
              { 
                id: 3, 
                title: 'Object-Oriented Programming (OOP) in Action', 
                duration: '55 min', 
                content: `
                  <h2>Classes, Objects, and the Power of Reusability</h2>
                  <p>OOP is a paradigm that models real-world entities into **Objects**. It allows us to create reusable, organized, and scalable code.</p>

                  <h3>Blueprint to Reality: Defining a Class</h3>
                  <p>A **Class** is the blueprint. An **Object** is an instance built from that blueprint. Let's model a Drone class with a few properties (data) and methods (behaviors).</p>
                  <pre><code>class Drone:
    # The Constructor: initializes the object's properties
    def __init__(self, serial_number, max_altitude):
        self.serial_number = serial_number
        self.max_altitude = max_altitude
        self.current_altitude = 0
        self.is_flying = False

    # A Method (behavior)
    def take_off(self):
        if not self.is_flying:
            self.is_flying = True
            print(f"Drone {self.serial_number} initiating launch sequence.")
        else:
            print(f"Drone {self.serial_number} is already airborne.")

    # Another Method (behavior)
    def ascend(self, meters):
        if self.is_flying:
            new_alt = self.current_altitude + meters
            if new_alt <= self.max_altitude:
                self.current_altitude = new_alt
                print(f"Ascending to {new_alt} meters.")
            else:
                print("Altitude limit reached. Cannot ascend further.")
        else:
            print("Drone must take off first.")</code></pre>

                  <h3>Creating and Interacting with Objects</h3>
                  <p>We now instantiate two separate objects from the same `Drone` class. Each object has its own unique state (altitude, serial number).</p>
                  <pre><code># Creating two independent objects (instances)
drone_alpha = Drone("ALPHA-001", 500)
drone_beta = Drone("BETA-002", 300)

# Interacting with drone_alpha
drone_alpha.take_off()     # Output: Drone ALPHA-001 initiating launch sequence.
drone_alpha.ascend(150)    # Output: Ascending to 150 meters.
print(drone_alpha.current_altitude) # Output: 150

# Interacting with drone_beta
drone_beta.take_off()      # Output: Drone BETA-002 initiating launch sequence.
drone_beta.ascend(400)     # Output: Altitude limit reached. Cannot ascend further.</code></pre>

                  <p>This demonstrates **Encapsulation** (bundling data and methods) and the independence of objects, the core benefits of OOP.</p>
                `
              },
              { 
                id: 4, 
                title: 'Relational Databases and SQL Mastery', 
                duration: '50 min', 
                content: `
                  <h2>Structured Query Language (SQL) for Data Management</h2>
                  <p>SQL is the standard language for managing relational databases, which organize data into **tables** linked by **relationships**.</p>

                  <h3>Creating a Database Schema</h3>
                  <p>The first step is defining the structure. Here, we create two tables and link them using a **Foreign Key**.</p>
                  <pre><code>-- 1. Create the primary table for Courses
CREATE TABLE Courses (
    course_id VARCHAR(10) PRIMARY KEY,
    course_name VARCHAR(255) NOT NULL,
    credits INT NOT NULL
);

-- 2. Create the dependent table for Students, linking to Courses
CREATE TABLE Students (
    student_id SERIAL PRIMARY KEY,
    student_name VARCHAR(100) NOT NULL,
    enrollment_date DATE,
    -- Foreign Key links this column to the Courses table
    enrolled_course_id VARCHAR(10),
    FOREIGN KEY (enrolled_course_id) REFERENCES Courses(course_id)
);</code></pre>

                  <h3>The Power of JOIN: Retrieving Related Data</h3>
                  <p>The true power of relational databases is in the `JOIN` command, which combines columns from two or more tables based on a related column.</p>
                  <pre><code>-- Insert some sample data
INSERT INTO Courses VALUES ('CS101', 'Intro to Computing', 4);
INSERT INTO Students (student_name, enrolled_course_id) 
VALUES ('Elara Kael', 'CS101');
INSERT INTO Students (student_name, enrolled_course_id) 
VALUES ('Rix Volkov', 'CS101');
INSERT INTO Students (student_name, enrolled_course_id) 
VALUES ('Jada Syrus', NULL); -- Not enrolled yet

-- Join Query: Find the name of the course each student is in
SELECT 
    S.student_name, 
    C.course_name 
FROM 
    Students AS S
INNER JOIN 
    Courses AS C 
ON 
    S.enrolled_course_id = C.course_id;

-- Output:
-- student_name | course_name
-- ----------------------------
-- Elara Kael   | Intro to Computing
-- Rix Volkov   | Intro to Computing</code></pre>

                  <h3>Practical Maintenance Commands</h3>
                  <ul>
                    <li>**Filtering:** `SELECT * FROM Students WHERE student_name = 'Elara Kael';`</li>
                    <li>**Aggregation:** `SELECT COUNT(student_id) FROM Students;`</li>
                    <li>**Updating:** `UPDATE Students SET enrolled_course_id = 'CS101' WHERE student_name = 'Jada Syrus';`</li>
                  </ul>
                `
              },
              { 
                id: 5, 
                title: 'Software Engineering & Version Control (Git)', 
                duration: '60 min', 
                content: `
                  <h2>Collaboration and Tracking: Mastering Git Workflow</h2>
                  <p>Software Engineering ensures complex projects are built reliably. **Git** is the industry standard for version control, allowing teams to track and merge code changes safely.</p>

                  <h3>The Core Git Commands</h3>
                  <p>A typical workflow involves four main stages: Working Directory, Staging Area, Local Repository, and Remote Repository.</p>
                  <pre><code># 1. Start a new local repository
git init

# 2. Make changes to files (e.g., update index.html)

# 3. Stage the changes (prepare for commit)
git add index.html
git add .               # To stage all changes

# 4. Commit the staged changes to the local repository
git commit -m "FEAT: Add responsive layout to index page"

# 5. Push changes to the remote repository (like GitHub)
git push origin main</code></pre>

                  <h3>Branching and Merging: Safe Development</h3>
                  <p>Branches allow developers to work on new features or fixes without breaking the main working version (`main` or `master`).</p>
                  <pre><code># Create and switch to a new branch for a feature
git checkout -b feature/certificate-form

# (Work, add, commit code on the new branch)

# Switch back to the main branch
git checkout main

# Pull the changes from the feature branch into the main branch
git merge feature/certificate-form</code></pre>

                  <h3>Assignment: Version Control Simulation</h3>
                  <p>Imagine you're developing a feature. **Your Assignment is to outline the 3 Git commands you would use to save and share your work on a new branch called `fix/typo-on-course-page`**.</p>
                  <p>Submit your response below detailing the sequence and purpose of each command.</p>
                `,
                assignmentContent: `
                    <div class="assignment-form-container">
                        <h2>Assignment: Git Workflow Submission</h2>
                        <p style="margin-bottom: 1.5rem;">Describe the 3 core Git commands to commit and push changes on a new branch (`fix/typo-on-course-page`).</p>
                        <form action="https://formspree.io/f/mldrbpwo" method="post">
                            <label for="student-name"><i class="fas fa-user"></i> Your Name</label>
                            <input type="text" id="student-name" name="Student Name" required>
                            
                            <label for="git-commands"><i class="fas fa-code-branch"></i> Git Command Sequence (Enter the 3 commands and their brief purpose)</label>
                            <textarea id="git-commands" name="Git Commands" placeholder="1. git checkout -b fix/typo-on-course-page (Create and switch branch)..." style="width: 100%; min-height: 150px; padding: 10px; border-radius: 6px; border: 1px solid rgba(0, 255, 255, 0.3); background-color: rgba(0, 0, 0, 0.4); color: var(--text-color); margin-top: 0.5rem;" required></textarea>
                            
                            <input type="hidden" name="Assignment" value="CS101-L5-Git-Workflow">
                            
                            <button type="submit" class="action-btn" style="width: 100%; margin-top: 1rem;">
                                <i class="fas fa-upload"></i> Submit Assignment
                            </button>
                        </form>
                    </div>
                `
              },
              { 
                id: 6, 
                title: 'The AI Revolution: Machine Learning Models', 
                duration: '65 min', 
                content: `
                  <h2>Teaching the Machine: Supervised vs. Unsupervised Learning</h2>
                  <p>Artificial Intelligence starts with **Machine Learning**—algorithms that learn patterns from data without explicit programming.</p>

                  <h3>Supervised Learning: Learning with a Teacher (Labels)</h3>
                  <p>This is like learning from a flashcard set where every card has a question and a correct answer (label). The algorithm trains by predicting the answer and correcting its errors.</p>
                  <h4>Example: Predicting Solar Flare Intensity</h4>
                  <pre><code># Training Data Sample (Features and Label)
data = [
    (100, 2, 'High'),   # (Sunspot Area, Plasma Velocity, Flare Intensity)
    (50, 1, 'Low'),
    (120, 3, 'High'),
    (40, 0, 'Low')
]

# Python Example using a simplified Scikit-learn structure
from sklearn.linear_model import LogisticRegression

# Features (X) and Label (y)
X = [[100, 2], [50, 1], [120, 3], [40, 0]]
y = ['High', 'Low', 'High', 'Low']

# 1. Initialize the Model
model = LogisticRegression()

# 2. Train the Model (The 'Learning' Step)
model.fit(X, y)

# 3. Predict on new data
new_flare = [[110, 2.5]]
prediction = model.predict(new_flare)
# Output: ['High'] - The model predicts the new flare is 'High' intensity.</code></pre>
                  
                  <h3>Unsupervised Learning: Finding Patterns in the Wild</h3>
                  <p>In this scenario, there are no labels. The machine must find hidden structure in the data itself. The primary use is **Clustering**.</p>
                  <h4>Example: Astronomical Object Classification</h4>
                  <p>We can use a K-Means clustering algorithm to group astronomical observations (brightness, size, temperature) into $K$ distinct clusters (e.g., $K=3$ for Stars, Planets, and Nebulae), without ever telling the algorithm which is which initially.</p>
                  <pre><code># Python K-Means Clustering Concept
from sklearn.cluster import KMeans

# 1. Input Data (Unlabeled - just features)
astronomy_data = [
    [5.2, 1200, 5000],  # Object 1: Brightness, Size, Temp
    [1.1, 50, 300],    # Object 2
    [5.5, 1300, 4800],  # Object 3
    [1.3, 60, 320]     # Object 4
]

# 2. Initialize and Fit (Tells the model to find 2 groups/clusters)
kmeans = KMeans(n_clusters=2, random_state=0)
kmeans.fit(astronomy_data)

# 3. Get Cluster Labels
labels = kmeans.labels_ 
# Output: [0, 1, 0, 1] - Indicates Object 1 and 3 are in Cluster 0 (likely Stars),
# and Object 2 and 4 are in Cluster 1 (likely Planets).</code></pre>
                  <p>This method is crucial for exploratory data analysis where you don't know what you're looking for.</p>
                `
              },
              { 
                id: 7, 
                title: 'Final Project: Building an Authentication System', 
                duration: '120 min', 
                content: `
                  <h2>The Final Gauntlet: Authentication & Security</h2>
                  <p>For your final project, you will combine your knowledge of data types, OOP, and databases to design the core of any modern application: a secure user **Authentication System**.</p>
                  
                  <h3>Key Security Requirements</h3>
                  <p>Your system must implement three critical security measures:</p>
                  <ol>
                    <li>**Password Hashing:** NEVER store plaintext passwords. Use a strong, one-way hashing function (like bcrypt or Argon2).</li>
                    <li>**Token Generation:** Use a JWT (JSON Web Token) to maintain a user's logged-in status.</li>
                    <li>**Input Validation:** Sanitize and validate all user inputs to prevent SQL injection or other attacks.</li>
                  </ol>
                  
                  <h3>Project Structure Blueprint (Python/Flask Example)</h3>
                  <pre><code># Hashing Example: NEVER do this in real life, this is conceptual for a class.
import hashlib
password = "mySecretPassword123"
hashed_password = hashlib.sha256(password.encode()).hexdigest()
# The hashed string is what you store in the database.

# Flask Application Structure for Login
@app.route('/login', methods=['POST'])
def login():
    # 1. Get user data from form
    data = request.get_json()
    username = data.get('username')
    input_password = data.get('password')

    # 2. Query database for user record
    user = db.get_user_by_username(username)
    
    if user and verify_hash(user.hashed_password, input_password):
        # 3. Successful login: Generate JWT and send it back
        jwt_token = generate_jwt({'user_id': user.id})
        return jsonify({'message': 'Login successful', 'token': jwt_token})
    else:
        # 4. Failed login attempt
        return jsonify({'message': 'Invalid credentials'}), 401</code></pre>

                  <h3>Next Step: Certification</h3>
                  <p>Once you feel you have a clear grasp of this system's design, proceed to the next lesson to submit your information and receive your Certificate of Participation.</p>
                `
              },
              certificateLesson
            ].map((lesson, index) => ({...lesson, id: index + 1})), // Re-map IDs after adding certificate lesson
          },
          // --- NEW COURSE: ASTROPHYSICS ---
          {
            id: 'astro101',
            title: 'Astrophysics & Cosmography: Space & Time',
            description: 'The study of the universe, celestial bodies, and cosmic phenomena.',
            icon: 'fas fa-rocket',
            lessons: [
              {
                id: 1,
                title: 'The Stellar Forge: Birth, Life, and Death of Stars',
                duration: '40 min',
                content: `
                  <h2>Nuclear Fusion: The Engine of the Universe</h2>
                  <p>Stars are colossal fusion reactors. They spend their main-sequence lives converting **hydrogen into helium** in their cores, releasing tremendous energy that resists gravity’s pull.</p>
                  
                  <h3>The Proton-Proton Chain Reaction</h3>
                  <p>This is the primary mechanism for energy generation in Sun-like stars. It’s a multi-step process that ultimately converts four hydrogen nuclei ($4 \text{H}$) into one helium nucleus ($1 \text{He}$).</p>
                  <pre><code># Simplified Fusion Equation (E = mc²)
4 * (Mass of Hydrogen)  ->  1 * (Mass of Helium) + Energy
# The difference in mass (mass defect) is converted directly into energy.

# The energy released is often expressed as a gamma-ray photon ($\gamma$) and neutrinos ($\nu$).
1. H-1 + H-1 -> H-2 + e+ + $\nu$
2. H-2 + H-1 -> He-3 + $\gamma$
3. He-3 + He-3 -> He-4 + 2 H-1 + $\gamma$</code></pre>

                  <h3>Stellar Death: Supernovae and White Dwarfs</h3>
                  <ul>
                    <li>**Low-Mass Stars (like the Sun):** Will exhaust hydrogen, swell into a Red Giant, then shed outer layers to form a beautiful **Planetary Nebula**, leaving behind a dense, hot **White Dwarf** that slowly cools.</li>
                    <li>**High-Mass Stars ($\gt 8$ Solar Masses):** Fuse heavier elements up to iron (Fe). Once iron is reached, fusion stops. The core collapses rapidly, triggering a massive explosion called a **Type II Supernova**. This process forges elements heavier than iron, like gold and uranium.</li>
                  </ul>
                  
                  <h3>Practical Thought Experiment</h3>
                  <p>If a star starts with $10^{57}$ hydrogen atoms, and each fusion cycle uses 4, how many fusion events occur before the core begins to change composition?</p>
                `
              },
              {
                id: 2,
                title: 'The Fabric of Spacetime: General Relativity',
                duration: '50 min',
                content: `
                  <h2>Einstein's Revolution: Gravity as a Geometric Effect</h2>
                  <p>In 1915, Albert Einstein published his theory of **General Relativity (GR)**, which redefined gravity not as a force, but as the **curvature of spacetime** caused by mass and energy.</p>
                  
                  <h3>Analogy: The Trampoline and the Bowling Ball</h3>
                  <p>Imagine spacetime as a stretched trampoline. A massive object (like a planet, the Bowling Ball) sits on it, creating a deep dip. When a smaller object (a marble) rolls nearby, it doesn't get pulled by an invisible force; it simply follows the curvature of the dip. **This curvature is what we perceive as gravity.**</p>

                  <h3>The Equivalence Principle</h3>
                  <p>The core concept of GR: **Gravity and acceleration are locally indistinguishable.**</p>
                  <pre><code># Conceptual Equivalence:
Passenger in a windowless accelerating rocket (a)
is equivalent to
Passenger standing on Earth's surface (g)

# The effect felt (weight, pressure) is exactly the same.
# This led Einstein to conclude that gravity is also a form of spacetime acceleration/geometry.</code></pre>

                  <h3>Observable Effects of General Relativity</h3>
                  <ul>
                    <li>**Gravitational Lensing:** Light from distant galaxies is bent around massive foreground objects (galaxies or clusters), creating distorted or multiple images of the background source.</li>
                    <li>**Time Dilation:** Time runs slower in a stronger gravitational field (closer to the massive object). GPS satellites must constantly correct for this effect, proving GR's daily relevance!</li>
                    <li>**Black Holes:** The ultimate curvature, where gravity is so strong that spacetime curves in on itself, forming a point of infinite density called a **singularity**, from which not even light can escape.</li>
                  </ul>
                `
              },
              {
                id: 3,
                title: 'Black Holes, Singularities, and Event Horizons',
                duration: '45 min',
                content: `
                  <h2>Where the Laws of Physics End: The Black Hole</h2>
                  <p>A **Black Hole** is a region of spacetime exhibiting such strong gravitational effects that nothing—including particles and electromagnetic radiation such as light—can escape from inside it.</p>

                  <h3>Defining the Key Components</h3>
                  <ul>
                    <li>**Singularity:** The center of the black hole, a point of zero volume and infinite density, where all the mass is concentrated. General Relativity predicts this, but it also signals where the theory breaks down.</li>
                    <li>**Event Horizon:** The boundary or 'point of no return.' Crossing this horizon means escape is physically impossible, as the escape velocity is greater than the speed of light ($c$).</li>
                  </ul>

                  <h3>The Schwarzschild Radius ($\text{R}_S$)</h3>
                  <p>This is the radius of the event horizon for a non-rotating black hole. It's the critical radius at which an object's mass would be so compressed that its escape velocity equals the speed of light. The formula is:</p>
                  $$R_S = \frac{2GM}{c^2}$$
                  <pre><code>Where:
- $R_S$ = Schwarzschild Radius (Event Horizon)
- $G$ = Gravitational Constant
- $M$ = Mass of the object
- $c$ = Speed of Light</code></pre>
                  
                  <h3>Example Calculation: Earth's Schwarzschild Radius</h3>
                  <p>If we could compress Earth (Mass $\approx 5.97 \times 10^{24}$ kg) into a black hole, its $\text{R}_S$ would be tiny—about **9 millimeters**. This illustrates just how dense an object must be to form an event horizon.</p>
                `
              },
              {
                id: 4,
                title: 'Cosmological Models: Big Bang and Expansion',
                duration: '60 min',
                content: `
                  <h2>The History of the Universe: From Singularity to Galaxy</h2>
                  <p>The **Big Bang Theory** is the prevailing cosmological model for the observable universe from the earliest known periods through its subsequent large-scale evolution. It is often misunderstood as an explosion in space, but it was an **expansion of space itself**.</p>
                  
                  <h3>Key Evidence for the Big Bang</h3>
                  <ol>
                    <li>**Hubble's Law (Redshift):** Distant galaxies are moving away from us, and the further they are, the faster they recede. This implies the universe is expanding. The equation is simple: $v = H_0 \cdot d$.</li>
                    <li>**Cosmic Microwave Background (CMB):** This is the residual heat (thermal radiation) left over from the Big Bang. It is uniform across the sky and matches predictions for a universe cooling from a hot, dense state.</li>
                    <li>**Abundance of Light Elements:** The Big Bang nucleosynthesis correctly predicts the primordial ratio of Hydrogen and Helium, which makes up almost all the matter in the universe.</li>
                  </ol>

                  <h3>The Fate of the Universe: Dark Energy's Influence</h3>
                  <p>The expansion is not slowing down—it's **accelerating** due to a mysterious force called **Dark Energy**.</p>
                  <pre><code># The Cosmic Recipe (Conceptual Energy Density Pie Chart)
Normal Matter (Atoms): 4.9%
Dark Matter (Gravity): 26.8%
Dark Energy (Expansion): 68.3%</code></pre>
                  <p>The final fate of the universe is still debated, but the current model suggests a **Big Freeze** or **Heat Death**, where the accelerating expansion stretches everything out until no energy transfer can occur, resulting in a cold, dark universe.</p>
                `
              },
              { 
                id: 5, 
                title: 'Practical Astrophysics: Telescopes and Data Analysis', 
                duration: '50 min', 
                content: `
                  <h2>The Tools of the Trade: Spectroscopy and Imaging</h2>
                  <p>Modern astrophysics relies on technology to capture and analyze light (electromagnetic radiation) from distant sources. Two critical techniques are imaging and **spectroscopy** (breaking light into its component wavelengths).</p>

                  <h3>Spectroscopy: Decoding Starlight</h3>
                  <p>Every element emits and absorbs light at specific wavelengths, creating a unique "barcode." By analyzing a star's spectrum, we can determine its:</p>
                  <ul>
                    <li>**Chemical Composition:** Which elements it's made of (Hydrogen, Carbon, Iron, etc.).</li>
                    <li>**Temperature:** The shape of the spectrum curve.</li>
                    <li>**Velocity (Doppler Shift):** Whether it's moving towards (Blueshift) or away (Redshift) from us.</li>
                  </ul>
                  
                  <h3>Assignment: Exoplanet Detection</h3>
                  <p>The **Radial Velocity Method** detects exoplanets by observing the tiny wobble (Doppler shift) in a star's light as an orbiting planet gravitationally tugs on it.</p>
                  <p>Your Assignment is to outline, in detail, how you would use **spectroscopy and the Doppler effect** to prove that a star has an orbiting planet, even if you can't see the planet directly. Focus on the observable changes in the star's spectral lines.</p>
                `,
                assignmentContent: `
                    <div class="assignment-form-container">
                        <h2>Assignment: Exoplanet Detection Method</h2>
                        <p style="margin-bottom: 1.5rem;">Explain how the Doppler shift of a star's spectral lines proves the existence of an orbiting exoplanet (Radial Velocity Method).</p>
                        <form action="https://formspree.io/f/mldrbpwo" method="post">
                            <label for="student-name"><i class="fas fa-user"></i> Your Name</label>
                            <input type="text" id="student-name" name="Student Name" required>
                            
                            <label for="exoplanet-explanation"><i class="fas fa-satellite-dish"></i> Explanation of Radial Velocity</label>
                            <textarea id="exoplanet-explanation" name="Exoplanet Explanation" placeholder="Start with the planet's gravitational tug causing a wobble in the star..." style="width: 100%; min-height: 150px; padding: 10px; border-radius: 6px; border: 1px solid rgba(0, 255, 255, 0.3); background-color: rgba(0, 0, 0, 0.4); color: var(--text-color); margin-top: 0.5rem;" required></textarea>
                            
                            <input type="hidden" name="Assignment" value="ASTRO101-L5-Exoplanet-Detection">
                            
                            <button type="submit" class="action-btn" style="width: 100%; margin-top: 1rem;">
                                <i class="fas fa-upload"></i> Submit Assignment
                            </button>
                        </form>
                    </div>
                `
              },
              certificateLesson
            ].map((lesson, index) => ({...lesson, id: index + 1})), // Re-map IDs after adding certificate lesson
          }
        ]
      }
    };
    
    // Calculate total lessons and re-map IDs after adding the certificate lesson
    coursesDatabase['science-tech'].courses.forEach(course => {
        const lastId = course.lessons.length;
        course.totalLessons = lastId; // Update totalLessons property
        course.lessons[lastId - 1].id = lastId; // Ensure the last lesson has the correct final ID
    });


    let currentUser = null;
    let userData = null;
    let currentCourse = null;
    let currentLesson = 1;
    let totalLessons = 0;

    // URL Parameters
    const urlParams = new URLSearchParams(window.location.search);
    const courseId = urlParams.get('courseId');
    const lessonParam = urlParams.get('lesson');

    // --- UTILITY FUNCTIONS ---

    function generateStars(numStars = 100) {
      const starsContainer = document.getElementById('stars-container');
      for (let i = 0; i < numStars; i++) {
        const star = document.createElement('div');
        star.className = 'star';
        star.style.width = `${1 + Math.random() * 2}px`;
        star.style.height = star.style.width;
        star.style.left = `${Math.random() * 100}%`;
        star.style.top = `${Math.random() * 100}%`;
        star.style.animationDelay = `${Math.random() * 4}s`;
        starsContainer.appendChild(star);
      }
    }

    // --- INITIALIZATION ---
    document.addEventListener('DOMContentLoaded', () => {
      generateStars();
      
      // Mobile Menu Toggle
      const mobileMenuToggle = document.getElementById('mobileMenuToggle');
      const courseSidebar = document.getElementById('courseSidebar');

      mobileMenuToggle.addEventListener('click', () => {
        courseSidebar.classList.toggle('active');
        if (courseSidebar.classList.contains('active')) {
            mobileMenuToggle.innerHTML = '<i class="fas fa-times"></i>';
        } else {
            mobileMenuToggle.innerHTML = '<i class="fas fa-bars"></i>';
        }
      });

      // Close sidebar when clicking outside on mobile
      document.addEventListener('click', (e) => {
        if (window.innerWidth <= 992) {
          if (courseSidebar.classList.contains('active') && !courseSidebar.contains(e.target) && !mobileMenuToggle.contains(e.target)) {
            courseSidebar.classList.remove('active');
            mobileMenuToggle.innerHTML = '<i class="fas fa-bars"></i>';
          }
        }
      });
      
      // Set the default course title in the certificate form
      document.getElementById('courseTitleHidden').value = courseId;
    });

    // Auth State Management
    onAuthStateChanged(auth, async (user) => {
      if (user) {
        currentUser = user;
        await loadUserData();
        await initializeCourseViewer();
      } else {
        // Redirect to enrollment page if not logged in
        window.location.href = 'enroll.html';
      }
    });

    async function loadUserData() {
      try {
        const userDocRef = doc(db, 'users', currentUser.uid);
        const userDoc = await getDoc(userDocRef);
        
        if (userDoc.exists()) {
          userData = userDoc.data();
        } else {
          // If user doc doesn't exist, redirect to dashboard
          window.location.href = 'studyingatelvion.html';
        }
      } catch (error) {
        console.error('Error loading user data:', error);
        alert('Error loading user data. Please try again.');
      }
    }

    async function initializeCourseViewer() {
      if (!courseId) {
        alert('No course specified');
        window.location.href = 'studyingatelvion.html';
        return;
      }

      currentCourse = findCourseById(courseId);
      if (!currentCourse) {
        alert('Course not found');
        window.location.href = 'studyingatelvion.html';
        return;
      }

      totalLessons = currentCourse.totalLessons;
      currentLesson = parseInt(lessonParam) || 1;

      // Check if user is enrolled
      const enrolledCourse = userData.enrolledCourses?.find(c => c.courseId === courseId);
      if (!enrolledCourse) {
        alert('You are not enrolled in this course');
        window.location.href = 'studyingatelvion.html';
        return;
      }
      
      // Check if the lesson number is valid and accessible (to prevent URL cheating)
      const accessibleLesson = enrolledCourse?.currentLesson || 1;
      currentLesson = Math.min(currentLesson, accessibleLesson);
      currentLesson = Math.max(currentLesson, 1);
      
      setupCourseInterface();
      renderLessonsList();
      loadLesson(currentLesson);
      
      document.getElementById('loadingContainer').style.display = 'none';
      document.getElementById('contentHeader').style.display = 'flex';
      document.getElementById('mainContent').style.display = 'block';
      document.getElementById('lessonNavigation').style.display = 'flex';
    }

    function findCourseById(courseId) {
      for (const facultyKey in coursesDatabase) {
        const course = coursesDatabase[facultyKey].courses.find(c => c.id === courseId);
        if (course) return course;
      }
      return null;
    }

    function setupCourseInterface() {
      document.getElementById('courseIconLarge').className = `course-icon-large ${currentCourse.icon}`;
      document.getElementById('courseTitle').textContent = currentCourse.title;
      document.getElementById('courseSubtitle').textContent = currentCourse.description;
      
      // Update hidden form field for the certificate lesson
      document.getElementById('courseTitleHidden').value = currentCourse.title;

      updateOverallProgress();
    }

    function updateOverallProgress() {
      const enrolledCourse = userData.enrolledCourses?.find(c => c.courseId === courseId);
      const progress = enrolledCourse?.progress || 0;
      const completedLessons = enrolledCourse?.completedLessons?.length || 0;
      
      document.getElementById('overallProgressBar').style.width = `${progress}%`;
      document.getElementById('overallProgressText').textContent = `${progress}% Complete (${completedLessons}/${totalLessons} lessons)`;
      
      // Update total points display in navigation
      document.getElementById('totalPointsEarned').textContent = userData.totalPoints || 0;
    }

    function renderLessonsList() {
      const container = document.getElementById('lessonsContainer');
      const enrolledCourse = userData.enrolledCourses?.find(c => c.courseId === courseId);
      const completedLessons = enrolledCourse?.completedLessons || [];
      
      container.innerHTML = '';
      
      currentCourse.lessons.forEach((lesson, index) => {
        const lessonNumber = index + 1; // Use array index + 1 for display and navigation
        const isCompleted = completedLessons.includes(lessonNumber);
        const isCurrent = lessonNumber === currentLesson;
        const isAccessible = lessonNumber <= (enrolledCourse?.currentLesson || 1);
        
        const lessonItem = document.createElement('div');
        lessonItem.className = `lesson-item ${isCurrent ? 'active' : ''} ${isCompleted ? 'completed' : ''}`;
        
        let statusIcon, statusClass;
        if (isCompleted) {
          statusIcon = '<i class="fas fa-check"></i>';
          statusClass = 'completed';
        } else if (isAccessible) {
          statusIcon = lessonNumber;
          statusClass = 'current';
        } else {
          statusIcon = '<i class="fas fa-lock"></i>';
          statusClass = 'locked';
        }
        
        lessonItem.innerHTML = `
          <div class="lesson-status ${statusClass}">${statusIcon}</div>
          <div class="lesson-details">
            <div class="lesson-title">${lesson.title}</div>
            <div class="lesson-duration">${lesson.duration}</div>
          </div>
        `;
        
        if (isAccessible) {
          lessonItem.style.cursor = 'pointer';
          lessonItem.addEventListener('click', () => {
            if (lessonNumber !== currentLesson) {
              loadLesson(lessonNumber);
            }
          });
        } else {
          lessonItem.style.opacity = '0.5';
          lessonItem.style.cursor = 'not-allowed';
        }
        
        container.appendChild(lessonItem);
      });
    }

    function loadLesson(lessonNumber) {
      const lesson = currentCourse.lessons[lessonNumber - 1];
      if (!lesson) return;
      
      currentLesson = lessonNumber;
      
      // Update URL without reloading
      const newUrl = new URL(window.location);
      newUrl.searchParams.set('lesson', lessonNumber);
      window.history.pushState({}, '', newUrl);
      
      // Hide mobile sidebar
      document.getElementById('courseSidebar').classList.remove('active');
      document.getElementById('mobileMenuToggle').innerHTML = '<i class="fas fa-bars"></i>';
      
      // Update header
      document.getElementById('lessonTitle').textContent = lesson.title;
      document.getElementById('lessonDuration').textContent = lesson.duration;
      document.getElementById('currentLessonNumber').textContent = lessonNumber;
      document.getElementById('totalLessons').textContent = totalLessons;
      document.getElementById('lessonPoints').textContent = lesson.isCertificate ? '0' : '10'; // 0 points for the final form

      
      // Update navigation
      document.getElementById('navCurrentLesson').textContent = lessonNumber;
      document.getElementById('navTotalLessons').textContent = totalLessons;
      
      // Update content
      document.getElementById('lessonContent').innerHTML = lesson.content;
      
      // Handle Assignment/Certificate content
      const assignmentContainer = document.getElementById('assignmentContainer');
      const videoPlayer = document.getElementById('videoPlayer');
      
      if (lesson.assignmentContent) {
          assignmentContainer.style.display = 'block';
          assignmentContainer.innerHTML = lesson.assignmentContent;
          videoPlayer.style.display = 'none';
      } else if (lesson.isCertificate) {
          assignmentContainer.style.display = 'block';
          assignmentContainer.innerHTML = lesson.assignmentContent;
          videoPlayer.style.display = 'none';
      }
      else {
          assignmentContainer.style.display = 'none';
          videoPlayer.style.display = 'flex'; // Show placeholder video
      }
      
      // Update navigation buttons
      const prevBtn = document.getElementById('prevLessonBtn');
      const nextBtn = document.getElementById('nextLessonBtn');
      const enrolledCourse = userData.enrolledCourses?.find(c => c.courseId === courseId);
      const isLastLesson = lessonNumber === totalLessons;
      const isCompleted = enrolledCourse?.completedLessons?.includes(lessonNumber);
      const isNextAccessible = (lessonNumber + 1) <= (enrolledCourse?.currentLesson || 1);

      prevBtn.disabled = lessonNumber === 1;
      nextBtn.disabled = isLastLesson || !isNextAccessible;
      
      // Update mark complete button
      const markCompleteBtn = document.getElementById('markCompleteBtn');
      
      if (isCompleted) {
        markCompleteBtn.innerHTML = '<i class="fas fa-check"></i> Completed';
        markCompleteBtn.disabled = true;
      } else if (lesson.isCertificate) {
        // Special case for Certificate lesson - mark complete should be disabled/hidden if not all previous lessons are done
        const prevLessonsCompleted = enrolledCourse.completedLessons.length === totalLessons - 1;
        if (prevLessonsCompleted) {
             markCompleteBtn.innerHTML = '<i class="fas fa-award"></i> Course Complete!';
             markCompleteBtn.disabled = true;
        } else {
             markCompleteBtn.innerHTML = '<i class="fas fa-lock"></i> Complete All Lessons First';
             markCompleteBtn.disabled = true;
        }
      } 
      else {
        markCompleteBtn.innerHTML = '<i class="fas fa-check"></i> Mark Complete';
        markCompleteBtn.disabled = false;
      }
      
      // Update sidebar
      renderLessonsList();
      
      // Scroll to top
      window.scrollTo(0, 0);
    }

    // --- EVENT LISTENERS ---
    document.getElementById('markCompleteBtn').addEventListener('click', async () => {
      await markLessonComplete();
    });

    document.getElementById('prevLessonBtn').addEventListener('click', () => {
      if (currentLesson > 1) {
        loadLesson(currentLesson - 1);
      }
    });

    document.getElementById('nextLessonBtn').addEventListener('click', () => {
      const enrolledCourse = userData.enrolledCourses?.find(c => c.courseId === courseId);
      const isNextAccessible = (currentLesson + 1) <= (enrolledCourse?.currentLesson || 1);
      
      if (currentLesson < totalLessons && isNextAccessible) {
        loadLesson(currentLesson + 1);
      }
    });

    document.getElementById('continueBtn').addEventListener('click', () => {
      document.getElementById('completionModal').style.display = 'none';
      if (currentLesson < totalLessons) {
        loadLesson(currentLesson + 1);
      } else {
          // If the last lesson (Certificate) is reached, redirect to dashboard.
          window.location.href = 'studyingatelvion.html';
      }
    });

    document.getElementById('backToDashboardBtn').addEventListener('click', () => {
      window.location.href = 'studyingatelvion.html';
    });
    
    // --- FIREBASE UPDATE LOGIC ---
    async function markLessonComplete() {
      try {
        const enrolledCourseIndex = userData.enrolledCourses.findIndex(c => c.courseId === courseId);
        if (enrolledCourseIndex === -1) return;
        
        const enrolledCourse = userData.enrolledCourses[enrolledCourseIndex];
        const currentLessonObj = currentCourse.lessons[currentLesson - 1];
        
        // Only lessons that are not the certificate lesson give points/mark complete
        if (currentLessonObj.isCertificate) return; 

        const pointsToAward = 10;
        
        // Add to completed lessons if not already completed
        if (!enrolledCourse.completedLessons?.includes(currentLesson)) {
          if (!enrolledCourse.completedLessons) {
            enrolledCourse.completedLessons = [];
          }
          enrolledCourse.completedLessons.push(currentLesson);
          
          // Update current lesson access
          enrolledCourse.currentLesson = Math.max(enrolledCourse.currentLesson || 1, currentLesson + 1);
          
          // Calculate progress
          const completedCount = enrolledCourse.completedLessons.length;
          enrolledCourse.progress = Math.round((completedCount / totalLessons) * 100);
          
          // Update user data
          userData.enrolledCourses[enrolledCourseIndex] = enrolledCourse;
          userData.completedLessons = (userData.completedLessons || 0) + 1;
          userData.totalPoints = (userData.totalPoints || 0) + pointsToAward;
          
          // Save to database
          await updateDoc(doc(db, 'users', currentUser.uid), {
            enrolledCourses: userData.enrolledCourses,
            completedLessons: userData.completedLessons,
            totalPoints: userData.totalPoints
          });
          
          // Update UI
          updateOverallProgress();
          renderLessonsList();
          
          // Update mark complete button
          const markCompleteBtn = document.getElementById('markCompleteBtn');
          markCompleteBtn.innerHTML = '<i class="fas fa-check"></i> Completed';
          markCompleteBtn.disabled = true;
          
          // Show completion modal
          document.getElementById('pointsEarned').textContent = pointsToAward;
          document.getElementById('completionModal').style.display = 'flex';
          
          // Update modal button text for the last non-certificate lesson
          if (currentLesson === totalLessons - 1) {
              document.getElementById('continueBtn').textContent = 'Go to Certificate';
          } else {
              document.getElementById('continueBtn').textContent = 'Continue Learning';
          }
        }
      } catch (error) {
        console.error('Error marking lesson complete:', error);
        alert('Error updating progress. Please try again.');
      }
    }
  </script>
</body>
  </html>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-J1YTKP10ZX"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date()); 

  gtag('config', 'G-J1YTKP10ZX');
</script>
