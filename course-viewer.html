<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Course Viewer | Elvion University</title>
  <meta name="description" content="Learn with interactive courses at Elvion University">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Orbitron:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --dark-navy: #00001a;
      --black-bg: #000000;
      --cyan-glow: #00ffff;
      --light-blue-glow: #00aaff;
      --text-color: #e0e0e0;
      --heading-color: #ffffff;
      --gradient-start: #0a1128;
      --gradient-end: #121a30;
      --card-bg: rgba(18, 26, 48, 0.85);
      --border-glow: 0 0 10px var(--cyan-glow), 0 0 20px var(--light-blue-glow);
      --hover-glow: 0 0 15px var(--cyan-glow), 0 0 30px var(--light-blue-glow);
      --button-bg: linear-gradient(45deg, var(--cyan-glow), var(--light-blue-glow));
      --button-text-color: var(--black-bg);
      --star-color: rgba(255, 255, 255, 0.7);
      --sidebar-width: 300px;
      --success-color: #4ade80;
      --warning-color: #fbbf24;
      --error-color: #f87171;
      --primary-color: var(--cyan-glow);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html { scroll-behavior: smooth; }

    body {
      font-family: 'Inter', sans-serif;
      background-color: var(--black-bg);
      color: var(--text-color);
      line-height: 1.7;
      overflow-x: hidden;
      position: relative;
      min-height: 100vh;
    }

    h1, h2, h3, h4, h5, h6 {
      font-family: 'Orbitron', sans-serif;
      color: var(--heading-color);
      margin-top: 0;
    }

    /* Stars Animation */
    #stars-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 0;
      overflow: hidden;
    }

    .star {
      position: absolute;
      background-color: var(--star-color);
      border-radius: 50%;
      opacity: 0;
      animation: twinkle 4s infinite ease-in-out;
    }

    @keyframes twinkle {
      0%, 100% { opacity: 0; transform: scale(0.5); }
      50% { opacity: 1; transform: scale(1); }
    }

    /* Main Layout */
    .course-viewer-container {
      display: flex;
      min-height: 100vh;
      position: relative;
      z-index: 1;
    }

    /* Course Sidebar */
    .course-sidebar {
      width: var(--sidebar-width);
      background: var(--card-bg);
      backdrop-filter: blur(10px);
      border-right: 1px solid rgba(0, 255, 255, 0.2);
      position: fixed;
      height: 100vh;
      overflow-y: auto;
      z-index: 100;
      transition: transform 0.3s ease;
    }

    .course-sidebar-header {
      padding: 1.5rem;
      border-bottom: 1px solid rgba(0, 255, 255, 0.1);
    }

    .back-btn {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      color: var(--cyan-glow);
      text-decoration: none;
      font-weight: 600;
      padding: 0.8rem;
      border-radius: 8px;
      transition: all 0.3s ease;
      margin-bottom: 1rem;
    }

    .back-btn:hover {
      background: rgba(0, 255, 255, 0.1);
    }

    .course-info {
      text-align: center;
    }

    .course-icon-large {
      font-size: 3rem;
      color: var(--cyan-glow);
      text-shadow: var(--border-glow);
      margin-bottom: 1rem;
    }

    .course-title {
      font-size: 1.4rem;
      margin-bottom: 0.5rem;
      color: var(--heading-color);
    }

    .course-subtitle {
      font-size: 0.9rem;
      color: var(--text-color);
      opacity: 0.8;
      margin-bottom: 1rem;
    }

    .overall-progress {
      background: rgba(0, 0, 0, 0.3);
      border-radius: 10px;
      padding: 1rem;
      margin-bottom: 1rem;
    }

    .progress-label {
      font-size: 0.85rem;
      color: var(--text-color);
      margin-bottom: 0.5rem;
    }

    .progress-bar-container {
      width: 100%;
      height: 8px;
      background: rgba(0, 255, 255, 0.1);
      border-radius: 10px;
      overflow: hidden;
      margin-bottom: 0.5rem;
    }

    .progress-bar-fill {
      height: 100%;
      background: var(--button-bg);
      border-radius: 10px;
      transition: width 0.8s ease;
      box-shadow: 0 0 10px var(--cyan-glow);
    }

    .progress-text {
      font-size: 0.85rem;
      color: var(--cyan-glow);
      font-weight: 600;
    }

    /* Lessons List */
    .lessons-list {
      padding: 1rem 0;
    }

    .lessons-header {
      padding: 0 1.5rem 1rem 1.5rem;
      font-size: 1.1rem;
      color: var(--heading-color);
      border-bottom: 1px solid rgba(0, 255, 255, 0.1);
    }

    .lesson-item {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 1rem 1.5rem;
      cursor: pointer;
      transition: all 0.3s ease;
      border-left: 3px solid transparent;
    }

    .lesson-item:hover {
      background: rgba(0, 255, 255, 0.05);
    }

    .lesson-item.active {
      background: rgba(0, 255, 255, 0.1);
      border-left-color: var(--cyan-glow);
    }

    .lesson-item.completed {
      opacity: 0.8;
    }

    .lesson-status {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.8rem;
      flex-shrink: 0;
    }

    .lesson-status.completed {
      background: var(--success-color);
      color: var(--black-bg);
    }

    .lesson-status.current {
      background: var(--cyan-glow);
      color: var(--black-bg);
    }

    .lesson-status.locked {
      background: rgba(255, 255, 255, 0.1);
      color: var(--text-color);
    }

    .lesson-details {
      flex: 1;
    }

    .lesson-title {
      font-size: 0.9rem;
      font-weight: 600;
      color: var(--heading-color);
      margin-bottom: 0.3rem;
    }

    .lesson-duration {
      font-size: 0.8rem;
      color: var(--text-color);
      opacity: 0.7;
    }

    /* Mobile Menu Toggle */
    .mobile-menu-toggle {
      display: none;
      position: fixed;
      top: 1rem;
      left: 1rem;
      z-index: 101;
      background: var(--card-bg);
      border: 1px solid var(--cyan-glow);
      border-radius: 8px;
      padding: 0.5rem 0.8rem;
      color: var(--cyan-glow);
      cursor: pointer;
      box-shadow: var(--border-glow);
    }

    /* Content Area */
    .content-area {
      flex: 1;
      margin-left: var(--sidebar-width);
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    .content-header {
      background: var(--card-bg);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid rgba(0, 255, 255, 0.1);
      padding: 1.5rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 1rem;
    }

    .lesson-info h1 {
      font-size: 1.5rem;
      margin-bottom: 0.5rem;
    }

    .lesson-meta {
      display: flex;
      gap: 1.5rem;
      font-size: 0.9rem;
      color: var(--text-color);
    }

    .lesson-meta span {
      display: flex;
      align-items: center;
      gap: 0.3rem;
    }

    .content-actions {
      display: flex;
      gap: 1rem;
      align-items: center;
    }

    .action-btn {
      padding: 0.8rem 1.5rem;
      background: var(--button-bg);
      color: var(--button-text-color);
      border: none;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      font-family: 'Inter', sans-serif;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .action-btn:hover {
      box-shadow: var(--border-glow);
      transform: scale(1.05);
    }

    .action-btn.secondary {
      background: transparent;
      border: 2px solid var(--cyan-glow);
      color: var(--cyan-glow);
    }

    .action-btn.secondary:hover {
      background: var(--cyan-glow);
      color: var(--black-bg);
    }

    .action-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    /* Main Content */
    .main-content {
      flex: 1;
      padding: 2rem;
      background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
    }

    .content-card {
      background: var(--card-bg);
      border-radius: 15px;
      padding: 2rem;
      box-shadow: var(--border-glow);
      backdrop-filter: blur(5px);
      border: 1px solid rgba(0, 255, 255, 0.1);
      margin-bottom: 2rem;
      max-width: 900px; /* Fitting to page constraint */
      margin-left: auto;
      margin-right: auto;
    }

    .lesson-content {
      line-height: 1.8;
      font-size: 1.1rem;
    }

    .lesson-content h2 {
      color: var(--cyan-glow);
      margin: 2rem 0 1rem 0;
      font-size: 1.4rem;
    }

    .lesson-content h3 {
      color: var(--heading-color);
      margin: 1.5rem 0 0.8rem 0;
      font-size: 1.2rem;
    }

    .lesson-content p {
      margin-bottom: 1.2rem;
    }

    .lesson-content ul, .lesson-content ol {
      margin: 1rem 0 1rem 2rem;
    }

    .lesson-content li {
      margin-bottom: 0.5rem;
    }
    
    /* Code block styling for practical examples */
    .lesson-content code {
      background: rgba(0, 255, 255, 0.1);
      padding: 0.2rem 0.5rem;
      border-radius: 4px;
      color: var(--cyan-glow);
      font-family: 'Courier New', monospace;
    }

    .lesson-content pre {
      background: rgba(0, 0, 0, 0.5);
      padding: 1.5rem;
      border-radius: 8px;
      border-left: 4px solid var(--cyan-glow);
      overflow-x: auto;
      margin: 1.5rem 0;
      box-shadow: 0 0 5px rgba(0, 255, 255, 0.3);
      position: relative;
    }

    .lesson-content pre code {
      background: none;
      padding: 0;
      color: var(--text-color);
      display: block;
      white-space: pre-wrap;
      word-break: break-all;
    }

    /* Interactive Code/Markdown Area Simulation */
    .interactive-code-area {
        background: #1e1e2d;
        border: 2px solid var(--primary-color);
        border-radius: 8px;
        padding: 1rem;
        margin: 1.5rem 0;
        box-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
    }
    .interactive-code-area textarea {
        width: 100%;
        min-height: 150px;
        background: transparent;
        color: var(--success-color);
        border: none;
        resize: vertical;
        padding: 0.5rem;
        font-family: 'Courier New', monospace;
        font-size: 1rem;
        outline: none;
    }
    .interactive-code-area .output {
        border-top: 1px dashed rgba(255, 255, 255, 0.2);
        padding-top: 0.5rem;
        color: var(--warning-color);
        font-size: 0.9rem;
        min-height: 30px;
        margin-top: 0.5rem;
    }
    .interactive-code-area .area-header {
        font-size: 0.8rem;
        color: var(--primary-color);
        margin-bottom: 0.5rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }


    /* Video Player Placeholder */
    .media-player {
      width: 100%;
      height: 400px;
      background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 2rem;
      border: 1px solid rgba(0, 255, 255, 0.2);
      max-width: 900px;
      margin-left: auto;
      margin-right: auto;
    }

    .media-placeholder {
      text-align: center;
      color: var(--text-color);
    }

    .media-placeholder i {
      font-size: 4rem;
      color: var(--cyan-glow);
      margin-bottom: 1rem;
      display: block;
    }

    /* Navigation Controls */
    .lesson-navigation {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1.5rem 2rem;
      background: var(--card-bg);
      backdrop-filter: blur(10px);
      border-top: 1px solid rgba(0, 255, 255, 0.1);
    }

    .nav-info {
      display: flex;
      align-items: center;
      gap: 1rem;
      font-size: 0.9rem;
      color: var(--text-color);
    }

    .lesson-indicator {
      background: rgba(0, 255, 255, 0.1);
      padding: 0.5rem 1rem;
      border-radius: 20px;
      border: 1px solid rgba(0, 255, 255, 0.3);
    }

    .nav-buttons {
      display: flex;
      gap: 1rem;
    }

    /* Quiz/Assessment Styles */
    .quiz-container {
      background: var(--card-bg);
      border-radius: 15px;
      padding: 2rem;
      box-shadow: var(--border-glow);
      backdrop-filter: blur(5px);
      border: 1px solid rgba(0, 255, 255, 0.1);
      margin-bottom: 2rem;
      max-width: 900px;
      margin-left: auto;
      margin-right: auto;
    }

    .quiz-question {
      font-size: 1.2rem;
      color: var(--heading-color);
      margin-bottom: 1.5rem;
      border-bottom: 1px solid rgba(0, 255, 255, 0.1);
      padding-bottom: 1rem;
    }

    .quiz-options {
      display: grid;
      gap: 1rem;
      margin-bottom: 2rem;
    }

    .quiz-option {
      padding: 1rem 1.5rem;
      background: rgba(0, 0, 0, 0.3);
      border: 2px solid rgba(0, 255, 255, 0.2);
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease, transform 0.1s ease; /* Added transform for animation */
      color: var(--text-color);
      position: relative;
    }

    .quiz-option:hover {
      border-color: var(--cyan-glow);
      background: rgba(0, 255, 255, 0.05);
      transform: translateY(-2px); /* Slight hover animation */
    }

    .quiz-option.selected {
      border-color: var(--cyan-glow);
      background: rgba(0, 255, 255, 0.1);
      color: var(--cyan-glow);
    }
    
    /* Correct/Incorrect state styling with simple animation */
    .quiz-option.correct {
      border-color: var(--success-color) !important;
      background: rgba(74, 222, 128, 0.1) !important;
      color: var(--success-color) !important;
      animation: flash-correct 0.3s ease-in-out;
    }

    .quiz-option.incorrect {
      border-color: var(--error-color) !important;
      background: rgba(248, 113, 113, 0.1) !important;
      color: var(--error-color) !important;
      animation: shake 0.3s;
    }
    
    .quiz-option.correct::after {
      content: ' (Correct)';
      color: var(--success-color);
      font-weight: bold;
      margin-left: 10px;
    }
    .quiz-option.incorrect::after {
      content: ' (Incorrect)';
      color: var(--error-color);
      font-weight: bold;
      margin-left: 10px;
    }
    
    @keyframes flash-correct {
        0% { opacity: 0.5; }
        100% { opacity: 1; }
    }
    
    @keyframes shake {
        0%, 100% { transform: translateX(0); }
        20%, 60% { transform: translateX(-5px); }
        40%, 80% { transform: translateX(5px); }
    }


    .quiz-feedback {
      padding: 1rem;
      border-radius: 8px;
      margin-top: 1rem;
      display: none;
    }

    .quiz-feedback.correct {
      background: rgba(74, 222, 128, 0.1);
      border: 1px solid rgba(74, 222, 128, 0.3);
      color: var(--success-color);
      display: block;
    }

    .quiz-feedback.incorrect {
      background: rgba(248, 113, 113, 0.1);
      border: 1px solid rgba(248, 113, 113, 0.3);
      color: var(--error-color);
      display: block;
    }
    
    /* Completion Modal Adjustments */
    .completion-modal .completion-icon {
        font-size: 4rem;
        color: var(--success-color);
        text-shadow: 0 0 10px var(--success-color);
        margin-bottom: 1rem;
        animation: pulse 1s infinite alternate;
    }
    
    .completion-modal .points-earned {
        font-size: 1.2rem;
        font-weight: 700;
        color: var(--cyan-glow);
        margin: 1.5rem 0;
        padding: 0.5rem 1rem;
        background: rgba(0, 255, 255, 0.1);
        border-radius: 8px;
        display: inline-block;
        border: 1px solid var(--cyan-glow);
    }
    
    @keyframes pulse {
        from { transform: scale(1); opacity: 0.8; }
        to { transform: scale(1.05); opacity: 1; }
    }


    /* Certificate Form & Final Page Styles */
    .final-page-content {
      max-width: 900px;
      margin: 0 auto;
      text-align: center;
    }
    .certificate-form-card {
      background: var(--card-bg);
      border-radius: 15px;
      padding: 3rem;
      box-shadow: var(--hover-glow);
      border: 1px solid var(--primary-color);
      text-align: left;
      margin-top: 2rem;
    }
    .certificate-form-card h2 {
      color: var(--success-color);
      text-shadow: 0 0 10px var(--success-color);
      margin-bottom: 1.5rem;
    }
    .certificate-form-card label {
      display: block;
      margin-top: 1rem;
      margin-bottom: 0.5rem;
      font-weight: 600;
      color: var(--text-color);
    }
    .certificate-form-card input[type="text"],
    .certificate-form-card input[type="email"] {
      width: 100%;
      padding: 0.8rem;
      border: 2px solid rgba(0, 255, 255, 0.3);
      border-radius: 8px;
      background: rgba(0, 0, 0, 0.3);
      color: var(--text-color);
      font-size: 1rem;
      transition: border-color 0.3s ease;
    }
    .certificate-form-card input:focus {
      border-color: var(--cyan-glow);
      box-shadow: 0 0 5px var(--cyan-glow);
      outline: none;
    }
    .certificate-form-card .submit-btn {
      width: 100%;
      margin-top: 2rem;
    }

    /* Comment Section Styles */
    .comment-section {
        background: rgba(0, 0, 0, 0.3);
        border-radius: 10px;
        padding: 1.5rem;
        margin-top: 2rem;
        border: 1px solid rgba(255, 255, 255, 0.1);
    }
    .comment-section textarea {
        width: 100%;
        min-height: 100px;
        padding: 1rem;
        border-radius: 8px;
        border: 2px solid rgba(0, 255, 255, 0.3);
        background: rgba(0, 0, 0, 0.5);
        color: var(--text-color);
        font-size: 1rem;
        resize: vertical;
        outline: none;
        transition: border-color 0.3s ease;
    }
    .comment-section textarea:focus {
        border-color: var(--cyan-glow);
        box-shadow: 0 0 5px var(--cyan-glow);
    }
    .comment-section .comment-btn {
        margin-top: 1rem;
        padding: 0.6rem 1.2rem;
        font-weight: 500;
        float: right;
    }

    /* Completion Modal */
    .completion-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      backdrop-filter: blur(5px);
    }

    .completion-content {
      background: var(--card-bg);
      padding: 3rem;
      border-radius: 15px;
      text-align: center;
      max-width: 500px;
      box-shadow: var(--hover-glow);
      border: 1px solid rgba(0, 255, 255, 0.3);
    }
    
    /* Loading State */
    .loading-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 50vh;
    }

    .loading-spinner {
      width: 60px;
      height: 60px;
      border: 4px solid rgba(0, 255, 255, 0.1);
      border-top-color: var(--cyan-glow);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .loading-text {
      margin-top: 1rem;
      color: var(--text-color);
      font-size: 1.1rem;
    }

    /* Responsive Design */
    @media (max-width: 992px) {
      .course-sidebar {
        transform: translateX(-100%);
      }

      .course-sidebar.active {
        transform: translateX(0);
      }

      .content-area {
        margin-left: 0;
      }

      .mobile-menu-toggle {
        display: block;
      }

      .main-content {
        padding: 1rem;
        padding-top: 4rem;
      }

      .content-header {
        padding: 1rem;
        flex-direction: column;
        align-items: flex-start;
      }

      .content-actions {
        width: 100%;
        justify-content: stretch;
      }

      .action-btn {
        flex: 1;
        justify-content: center;
      }

      .lesson-navigation {
        padding: 1rem;
        flex-direction: column;
        gap: 1rem;
      }

      .nav-buttons {
        width: 100%;
        justify-content: stretch;
      }

      .nav-buttons .action-btn {
        flex: 1;
      }
    }

    @media (max-width: 768px) {
      .media-player {
        height: 250px;
      }

      .content-card {
        padding: 1.5rem;
      }

      .completion-content {
        margin: 1rem;
        padding: 2rem;
      }

      .quiz-option {
        padding: 0.8rem 1rem;
      }
    }
  </style>
</head>
<body>
  <div id="stars-container"></div>

  <button class="mobile-menu-toggle" id="mobileMenuToggle">
    <i class="fas fa-bars"></i>
  </button>

  <div class="course-viewer-container">
    <aside class="course-sidebar" id="courseSidebar">
      <div class="course-sidebar-header">
        <a href="studyingatelvion.html" class="back-btn">
          <i class="fas fa-arrow-left"></i>
          Back to Dashboard
        </a>
        
        <div class="course-info">
          <i id="courseIconLarge" class="course-icon-large"></i>
          <h2 id="courseTitle" class="course-title">Loading...</h2>
          <p id="courseSubtitle" class="course-subtitle">Please wait...</p>
          
          <div class="overall-progress">
            <div class="progress-label">Overall Progress</div>
            <div class="progress-bar-container">
              <div id="overallProgressBar" class="progress-bar-fill" style="width: 0%"></div>
            </div>
            <div class="progress-text"><span id="overallProgressText">0% Complete</span></div>
            <div class="progress-text" style="margin-top: 0.5rem;"><i class="fas fa-trophy"></i> Total Points: <span id="totalPointsEarnedSidebar">0</span></div>
          </div>
        </div>
      </div>

      <div class="lessons-list">
        <div class="lessons-header">Course Lessons</div>
        <div id="lessonsContainer">
          </div>
      </div>
    </aside>

    <main class="content-area">
      <div class="loading-container" id="loadingContainer">
        <div class="loading-spinner"></div>
        <p class="loading-text">Loading course content...</p>
      </div>

      <header class="content-header" id="contentHeader" style="display: none;">
        <div class="lesson-info">
          <h1 id="lessonTitle">Lesson Title</h1>
          <div class="lesson-meta">
            <span><i class="fas fa-clock"></i> <span id="lessonDuration">45 min</span></span>
            <span><i class="fas fa-book"></i> Lesson <span id="currentLessonNumber">1</span> of <span id="totalLessons">8</span></span>
            <span><i class="fas fa-star"></i> <span id="lessonPoints">10</span> Points</span>
          </div>
        </div>
        <div class="content-actions">
          <button id="markCompleteBtn" class="action-btn" style="display: none;">
            <i class="fas fa-check"></i>
            Mark Complete
          </button>
        </div>
      </header>

      <section class="main-content" id="mainContent" style="display: none;">
        
        <div id="finalCoursePage" style="display: none;" class="final-page-content">
            <h1 style="color: var(--success-color); text-shadow: var(--hover-glow);">Course Completed!</h1>
            <p class="lead" style="margin-bottom: 2rem;">
                Congratulations! You have completed all lessons and earned your GP! The final step is to request your certificate.
            </p>
            
            <div class="overall-progress" style="margin-bottom: 3rem; background: var(--black-bg); border: 2px solid var(--success-color);">
                <div class="progress-label" style="font-size: 1.1rem; color: var(--success-color);">Your Final Course Grade Point (GP)</div>
                <div class="progress-text" style="font-size: 2rem; color: var(--success-color); font-weight: 800;"><span id="finalTotalPoints">0</span> Points</div>
                <p style="font-size: 0.9rem; margin-top: 0.5rem; opacity: 0.8;">(Based on 10 points per successfully completed lesson quiz)</p>
            </div>

            <div class="certificate-form-card">
                <h2>Certificate & Project Submission</h2>
                <p style="margin-bottom: 1.5rem; color: var(--warning-color);">
                    To receive your certificate, please fill in your details below. For courses with a project (e.g., Computer Science, Software Engineering, Visual Arts), please **email your Final Project** (as outlined in the last lesson) to: <strong style="color: var(--cyan-glow);">elvionailabs@gmail.com</strong>.
                </p>
                <form id="certificateForm" action="https://formspree.io/f/mldrbpwo" method="post">
                    <input type="hidden" name="_subject" id="formSubject">
                    <input type="hidden" name="Course Completed" id="completedCourseName">
                    <input type="hidden" name="Total Points Earned" id="formTotalPoints">
                    
                    <label for="fullName">Full Name (for Certificate):</label>
                    <input type="text" id="fullName" name="Full Name" required>

                    <label for="email">Email Address (for delivery):</label>
                    <input type="email" id="email" name="Email" required>

                    <label for="studentId">Elvion Student ID (Optional):</label>
                    <input type="text" id="studentId" name="Student ID">

                    <button type="submit" class="action-btn submit-btn">
                        <i class="fas fa-certificate"></i> Request Certificate
                    </button>
                </form>

                <div class="comment-section">
                    <h4>Feedback & Questions</h4>
                    <form>
                        <textarea placeholder="Share your experience, ask a question, or send a thank you note to Elvion!"></textarea>
                        <button type="submit" class="action-btn comment-btn secondary" style="background: var(--dark-navy); color: var(--cyan-glow);">Submit Feedback</button>
                    </form>
                </div>
            </div>
        </div>

        <div class="media-player" id="mediaPlayer">
          <div class="media-placeholder">
            <i class="fas fa-play-circle"></i>
            <p id="mediaPlaceholderText">Video/Media content coming soon</p>
            <p style="font-size: 0.9rem; opacity: 0.7;">For now, please read the lesson content below</p>
          </div>
        </div>

        <div class="content-card">
          <div id="lessonContent" class="lesson-content">
            </div>
        </div>

        <div id="quizContainer" class="quiz-container" style="display: none;">
          <h3 style="margin-bottom: 1.5rem; color: var(--warning-color);"><i class="fas fa-clipboard-check"></i> Mandatory Quiz: Pass to Proceed</h3>
          <p style="margin-bottom: 2rem; border-bottom: 1px solid rgba(0, 255, 255, 0.1); padding-bottom: 1rem;">
            You must correctly answer all questions below before the 'Next' lesson button is enabled.
          </p>
          <div id="quizQuestions">
            </div>
          <button id="submitQuizBtn" class="action-btn" style="width: 100%; margin-top: 2rem;">
            <i class="fas fa-paper-plane"></i> Submit Answers
          </button>
          <div id="quizResult" style="margin-top: 1rem;"></div>
        </div>
      </section>

      <nav class="lesson-navigation" id="lessonNavigation" style="display: none;">
        <div class="nav-info">
          <div class="lesson-indicator">
            Lesson <span id="navCurrentLesson">1</span> of <span id="navTotalLessons">8</span>
          </div>
          <span><i class="fas fa-trophy"></i> GP: <span id="totalPointsEarnedNav">0</span> Points</span>
        </div>
        <div class="nav-buttons">
          <button id="prevLessonBtn" class="action-btn secondary">
            <i class="fas fa-chevron-left"></i>
            Previous
          </button>
          <button id="nextLessonBtn" class="action-btn">
            Next
            <i class="fas fa-chevron-right"></i>
          </button>
        </div>
      </nav>
    </main>
  </div>

  <div id="completionModal" class="completion-modal">
    <div class="completion-content">
      <i class="fas fa-trophy completion-icon"></i>
      <h2 class="completion-title">Lesson Complete!</h2>
      <p class="completion-message">
        Congratulations! You've successfully completed the quiz and this lesson.
      </p>
      <div class="points-earned">
        <i class="fas fa-star"></i>
        You earned <span id="pointsEarned">10</span> points!
      </div>
      <div style="display: flex; gap: 1rem;">
        <button id="continueBtn" class="action-btn" style="flex: 1;">
          Continue Learning
        </button>
        <button id="backToDashboardBtn" class="action-btn secondary" style="flex: 1;">
          Back to Dashboard
        </button>
      </div>
    </div>
  </div>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
    import {
        getAuth,
        onAuthStateChanged
    } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-auth.js";
    import {
        getFirestore,
        doc,
        getDoc,
        updateDoc
    } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyAyROm0aBGjry6NUfhNM3e0qwPcCDoIqSk",
        authDomain: "elvionai.firebaseapp.com",
        projectId: "elvionai",
        storageBucket: "elvionai.firebasestorage.app",
        messagingSenderId: "161078300830",
        appId: "1:161078300830:web:f460df8591704eb0e96b8f"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // --- FALLBACK/DEFAULT LESSON & QUIZ FOR NEW COURSES ---
    const defaultLessonContent = `
        <h2>Welcome to Your Course!</h2>
        <p>This is the first lesson of your course. Here you will learn the foundational concepts.</p>
        <p>This course is designed to provide you with a comprehensive, pre-university foundation in your chosen field. Our learning methodology focuses on practical knowledge and critical thinking.</p>
        
        <h3>Elvion University Philosophy</h3>
        <p>Elvion University is dedicated to **providing free, quality pre-degree knowledge and certificates** to empower future students globally. Your commitment to completing this course is your most valuable credential.</p>
        
        <div class="interactive-code-area" style="background: rgba(18, 26, 48, 0.85); border-color: var(--warning-color);">
            <div class="area-header" style="color: var(--warning-color);"><span>Course Focus</span></div>
            <p>Please remember to focus on the core concepts of this subject. You will be tested on the content to ensure you grasp the fundamentals before moving to the next lesson.</p>
        </div>
    `;

    const defaultLesson = {
        id: 1,
        title: 'Course Introduction',
        duration: '40 min',
        content: defaultLessonContent,
        quiz: [
            { type: 'mcq', question: 'What is the main purpose of Elvion University?', options: ['Awarding accredited degrees', 'Providing free pre-degree knowledge and certificates', 'Replacing traditional universities', 'Offering high-cost private education'], answer: 'Providing free pre-degree knowledge and certificates' },
            { type: 'mcq', question: 'How is student progress measured in this course viewer?', options: ['Monthly Exams', 'Lesson by lesson mandatory quizzes', 'Instructor approval only', 'Number of videos watched'], answer: 'Lesson by lesson mandatory quizzes' },
        ]
    };

    // Helper to generate default lessons for other courses
    const generateDefaultLessons = (count, coursePrefix, isProject) => {
        return Array(count).fill(0).map((_, i) => {
            let lessonTitle = `Lesson ${i + 1}: Introduction to ${coursePrefix} Concepts`;
            let content = defaultLessonContent.replace(/Welcome!|This is the first lesson/g, `Welcome to ${coursePrefix}!`).replace(/Introduction/g, lessonTitle);

            if (i === 0) {
                // Keep the original quiz for the first lesson of a new course
                return {
                    ...defaultLesson,
                    id: i + 1,
                    title: `${coursePrefix} ${lessonTitle}`,
                    content: content,
                };
            }

            if (i === count - 1) {
                lessonTitle = isProject ? `Lesson ${i + 1}: Final Project / Capstone` : `Lesson ${i + 1}: Conclusion & Next Steps`;
                content = `<h2>${lessonTitle}</h2>
                    <p>Congratulations on reaching the final lesson of the ${coursePrefix} course!</p>
                    <p>This course's final requirement is a **Project Submission** (if \`isProject\` is true) or a final reflection. Follow the certificate steps on the next page.</p>
                    ${isProject ? `<p style="color: var(--cyan-glow);">**Project Submission Required:** Please check the last lesson for specific instructions and remember to **email your project to elvionailabs@gmail.com**.</p>` : ''}
                `;

                // Final lesson quiz should be specific if it's a project
                const finalQuiz = isProject ? [
                    { type: 'mcq', question: `For the ${coursePrefix} course, what is the final deliverable requirement?`, options: ['A final written exam', 'A Project/Capstone Submission', 'A face-to-face interview', 'A group presentation'], answer: 'A Project/Capstone Submission' },
                    { type: 'text', question: 'What is the email address to which you must submit your project for certificate review? (Enter exactly)', answer: 'elvionailabs@gmail.com' },
                ] : [
                    { type: 'mcq', question: `How many lessons did you complete in the ${coursePrefix} course?`, options: ['1', '5', '8', count.toString()], answer: count.toString() },
                    { type: 'mcq', question: 'What is the next suggested step after completing this course?', options: ['Retake the first lesson', 'Explore another Elvion course or request your certificate', 'Close the browser', 'Nothing'], answer: 'Explore another Elvion course or request your certificate' },
                ];

                return {
                    id: i + 1,
                    title: `${coursePrefix} ${lessonTitle}`,
                    duration: `${40 + Math.floor(Math.random() * 20)} min`, // Varied duration
                    content: content,
                    quiz: finalQuiz,
                };
            }

            // Simplified, universal quiz for placeholder lessons after the first one
            const simpleQuiz = [
                { type: 'mcq', question: `How many lessons are in the ${coursePrefix} course? (Hint: The answer is in the course metadata)`, options: ['1', '5', '8', count.toString()], answer: count.toString() },
                { type: 'mcq', question: `What is the most important skill for a ${coursePrefix} professional?`, options: ['Memorization', 'Critical Thinking & Problem Solving', 'Speed Reading', 'Ignoring details'], answer: 'Critical Thinking & Problem Solving' },
            ];

            return {
                id: i + 1,
                title: `${coursePrefix} ${lessonTitle}`,
                duration: `${40 + Math.floor(Math.random() * 20)} min`, // Varied duration
                content: content,
                quiz: simpleQuiz,
            };
        });
    };

    // --- UPDATED AND EXPANDED COURSE DATABASE (Incorporating all your courses) ---
    const cs101Lessons = [
    {
  id: 1,
  title: 'Foundations of Programming: From Logic to Code',
  duration: '90 min',
  content: `
    <h2>Welcome to Computer Science</h2>
    <p>Programming is the art and science of instructing computers to solve problems. This lesson introduces you to the fundamental concepts that underpin all programming languages and computational thinking. By the end of this lesson, you will have written and executed your first programs, understood core data types, and begun thinking like a programmer.</p>
    
    <h3>What You Will Build Today</h3>
    <p>By the end of this lesson, you will create three working programs: a personal profile generator, a basic calculator, and a decision-making chatbot. You will also set up your development environment and create your first GitHub repository.</p>

    <h3>Part 1: Computational Thinking and Algorithms</h3>
    <p>Before writing code, programmers think algorithmically. An algorithm is a precise, step-by-step procedure for solving a problem. Algorithms must be unambiguous, finite, and produce a correct output for all valid inputs.</p>
    
    <h4>The Four Pillars of Computational Thinking</h4>
    <ul>
      <li><strong>Decomposition:</strong> Breaking complex problems into smaller, manageable parts</li>
      <li><strong>Pattern Recognition:</strong> Identifying similarities and trends in data or processes</li>
      <li><strong>Abstraction:</strong> Focusing on essential information while ignoring irrelevant details</li>
      <li><strong>Algorithm Design:</strong> Creating step-by-step solutions that can be implemented in code</li>
    </ul>

    <p>Reference: Wing, J. M. (2006). "Computational Thinking." Communications of the ACM, 49(3), 33-35. Available at: <code>doi.org/10.1145/1118178.1118215</code></p>

    <h4>Exercise 1.1: Design Your Morning Algorithm</h4>
    <p>Write a precise algorithm for your morning routine. Include decision points (if-then statements) and loops (repeated actions). For example:</p>
    <pre><code>1. Wake up at alarm
2. IF (it is a weekday) THEN
     Set alarm for 6:00 AM
   ELSE
     Set alarm for 8:00 AM
3. WHILE (not fully awake) DO
     Snooze for 5 minutes
4. Get out of bed
5. Brush teeth
6. ...</code></pre>
    
    <p class="task-highlight">Task: Write your own morning algorithm in plain English, using IF, WHILE, and sequential steps. Save this in a text file named <code>morning_algorithm.txt</code>.</p>

    <h3>Part 2: Variables and Data Types</h3>
    <p>Variables are named containers that store data in computer memory. Every variable has a data type that determines what kind of information it can hold and what operations can be performed on it.</p>

    <h4>Primitive Data Types in Python</h4>
    <table style="width: 100%; border-collapse: collapse; margin: 20px 0;">
      <tr style="background: rgba(99, 102, 241, 0.1);">
        <th>Data Type</th>
        <th>Description</th>
        <th>Example</th>
        <th>Common Operations</th>
      </tr>
      <tr>
        <td><code>int</code></td>
        <td>Whole numbers</td>
        <td><code>age = 25</code></td>
        <td>+, -, *, /, //, %</td>
      </tr>
      <tr>
        <td><code>float</code></td>
        <td>Decimal numbers</td>
        <td><code>price = 19.99</code></td>
        <td>+, -, *, /, round()</td>
      </tr>
      <tr>
        <td><code>str</code></td>
        <td>Text sequences</td>
        <td><code>name = "Alice"</code></td>
        <td>+, .upper(), .lower(), .split()</td>
      </tr>
      <tr>
        <td><code>bool</code></td>
        <td>True or False values</td>
        <td><code>is_student = True</code></td>
        <td>and, or, not</td>
      </tr>
    </table>

    <p>Reference: Python Official Documentation - Built-in Types: <code>docs.python.org/3/library/stdtypes.html</code></p>

    <h4>Type Conversion and Dynamic Typing</h4>
    <p>Python is dynamically typed, meaning you do not need to declare variable types explicitly. However, understanding type conversion is crucial for preventing runtime errors.</p>
    <pre><code class="language-python"># Type conversion examples
age_string = "25"
age_int = int(age_string)      # Convert string to integer
price = 19.99
price_string = str(price)      # Convert float to string
temperature = "98.6"
temp_float = float(temperature) # Convert string to float

# Dynamic typing demonstration
variable = 42          # variable is an integer
variable = "Hello"     # now variable is a string (no error!)
variable = 3.14        # now variable is a float
</code></pre>

    <h3>Part 3: Setting Up Your Development Environment</h3>
    <p>Professional programmers use integrated development environments (IDEs) and version control systems. Let us set up yours.</p>

    <h4>Required Tools</h4>
    <ol>
      <li><strong>Python 3.10+:</strong> Download from python.org/downloads</li>
      <li><strong>Visual Studio Code:</strong> Download from code.visualstudio.com</li>
      <li><strong>Git:</strong> Download from git-scm.com</li>
      <li><strong>GitHub Account:</strong> Sign up at github.com</li>
    </ol>

    <div class="interactive-code-area" style="background: rgba(16, 185, 129, 0.1); border-left: 4px solid #10b981; padding: 20px; margin: 20px 0;">
      <div class="area-header"><span>Critical Setup Task</span></div>
      <p>Install all four tools listed above. Verify your Python installation by opening a terminal and typing:</p>
      <pre><code>python --version</code></pre>
      <p>You should see output like: <code>Python 3.10.0</code> or higher.</p>
    </div>

    <h4>Exercise 1.2: Create Your First GitHub Repository</h4>
    <ol>
      <li>Log into your GitHub account</li>
      <li>Click the "+" icon in the top right and select "New repository"</li>
      <li>Name it <code>cs101-elvion-journey</code></li>
      <li>Add a description: "My Computer Science learning journey at Elvion University"</li>
      <li>Select "Public" and check "Add a README file"</li>
      <li>Click "Create repository"</li>
    </ol>
    <p class="task-highlight">Task: After creating your repository, copy its URL and save it. You will use this repository throughout the course.</p>

    <h3>Part 4: Your First Three Programs</h3>

    <h4>Program 1: Personal Profile Generator</h4>
    <p>This program demonstrates input/output, string concatenation, and the print function.</p>
    <pre><code class="language-python"># Save this as: profile_generator.py

print("=== Elvion University Profile Generator ===")
print()

full_name = input("Enter your full name: ")
age = input("Enter your age: ")
country = input("Enter your country: ")
course = input("Enter your primary course of study: ")

print("\
" + "="*50)
print("STUDENT PROFILE")
print("="*50)
print(f"Name: {full_name}")
print(f"Age: {age} years old")
print(f"Location: {country}")
print(f"Studying: {course}")
print(f"Status: Active Elvion Student")
print("="*50)
print("\
Welcome to the Elvion community!")
</code></pre>
    <p class="task-highlight">Task: Type this, save as <code>profile_generator.py</code>, and run it in VS Code.</p>

    <h4>Program 2: Intelligent Calculator</h4>
    <p>This program introduces arithmetic operations, type conversion, and formatted output.</p>
    <pre><code class="language-python"># Save this as: calculator.py

print("=== Elvion Calculator ===")
print("Supported operations: +, -, *, /")
print()

num1 = float(input("Enter first number: "))
operator = input("Enter operator (+, -, *, /): ")
num2 = float(input("Enter second number: "))

if operator == "+":
    result = num1 + num2
elif operator == "-":
    result = num1 - num2
elif operator == "*":
    result = num1 * num2
elif operator == "/":
    if num2 != 0:
        result = num1 / num2
    else:
        result = "Error: Division by zero"
else:
    result = "Error: Invalid operator"

print(f"\
Result: {num1} {operator} {num2} = {result}")
</code></pre>
    <p class="task-highlight">Task: Create this calculator, test every operation, and document edge cases in <code>calculator_tests.txt</code>.</p>

    <h4>Program 3: Decision-Making Chatbot</h4>
    <p>This program uses conditional logic, boolean expressions, and nested statements.</p>
    <pre><code class="language-python"># Save this as: chatbot.py

print("=== Elvion Course Advisor Chatbot ===")
print()

name = input("Hello! What's your name? ")
print(f"\
Nice to meet you, {name}!")

interests = input("\
Are you interested in (1) Technology, (2) Business, or (3) Creative Arts? Enter 1, 2, or 3: ")

if interests == "1":
    print("\
Great choice! Technology is transforming the world.")
    math_comfort = input("Are you comfortable with mathematics? (yes/no): ").lower()
    
    if math_comfort == "yes":
        print("\
Recommendation: Start with Computer Science (CS101)")
        print("You'll learn programming, algorithms, and software development.")
    else:
        print("\
Recommendation: Start with Web Development Fundamentals")
        print("You'll build websites and applications with minimal math.")
        
elif interests == "2":
    print("\
Excellent! Business skills are always in demand.")
    print("\
Recommendation: Start with Business Administration (BA101)")
    
elif interests == "3":
    print("\
Wonderful! Creativity drives innovation.")
    print("\
Recommendation: Start with Digital Media & Design")
    
else:
    print("\
I didn't understand your choice. Please run the program again.")

print(f"\
Thank you, {name}! Visit elvion.com to enroll.")
</code></pre>
    <p class="task-highlight">Task: Run with different inputs. Modify it to ask two additional questions. Save as <code>chatbot_enhanced.py</code>.</p>

    <h3>Professional Development Practices</h3>
    <p>Write readable, maintainable code. Use clear variable names and comments.</p>
    <ul>
      <li>Variables/functions: <code>lowercase_with_underscores</code></li>
      <li>Constants: <code>UPPERCASE_WITH_UNDERSCORES</code></li>
      <li>Classes: <code>CapitalizedWords</code></li>
      <li>Use descriptive names: <code>student_age</code> not <code>sa</code></li>
    </ul>
    <p>Reference: PEP 8 - Style Guide for Python Code: peps.python.org/pep-0008/</p>

    <h3>Final Assignment: Portfolio Repository</h3>
    <p>Create this lesson structure in your repository:</p>
    <ul>
      <li>morning_algorithm.txt</li>
      <li>profile_generator.py</li>
      <li>calculator.py</li>
      <li>calculator_tests.txt</li>
      <li>chatbot.py</li>
      <li>chatbot_enhanced.py</li>
      <li>reflection.md (200-300 words about this lesson)</li>
    </ul>

    <h3>Additional Resources</h3>
    <ul>
      <li>Interactive Python Tutorial: learnpython.org</li>
      <li>Python Visualizer: pythontutor.com</li>
      <li>MIT OCW, CS50</li>
    </ul>

    <h3>Key Takeaways</h3>
    <p>You've completed your first computer science lesson, learned computational thinking, created programs, set up a pro environment, and started building your portfolio. Keep coding!</p>
  `,
  quiz: [
    { 
      type: 'mcq', 
      question: 'Which of the following best describes an algorithm?', 
      options: [
        'A programming language used to build websites', 
        'A precise, step-by-step procedure for solving a problem that is unambiguous and finite', 
        'A type of variable that stores text data', 
        'An error message displayed when code fails to execute'
      ], 
      answer: 'A precise, step-by-step procedure for solving a problem that is unambiguous and finite' 
    },
    { 
      type: 'mcq', 
      question: 'What will be the output of the following Python code?

age = "25"
print(age + 5)', 
      options: [
        '30', 
        '255', 
        'A TypeError because you cannot add a string and an integer', 
        '25'
      ], 
      answer: 'A TypeError because you cannot add a string and an integer' 
    },
    { 
      type: 'mcq', 
      question: 'In the context of the four pillars of computational thinking, breaking a complex problem into smaller, manageable parts is called:', 
      options: [
        'Pattern Recognition', 
        'Abstraction', 
        'Decomposition', 
        'Algorithm Design'
      ], 
      answer: 'Decomposition' 
    },
    { 
      type: 'mcq', 
      question: "According to PEP 8 naming conventions, which is the correct way to name a Python variable that stores a student email address?", 
      options: [
        'StudentEmail', 
        'STUDENT_EMAIL', 
        'student_email', 
        'studentEmail'
      ], 
      answer: 'student_email' 
    },
    { 
      type: 'mcq', 
      question: 'You are building a calculator and the user enters "10" and "5" as inputs. To perform arithmetic operations, what must you do first?', 
      options: [
        'Nothing - Python automatically handles this', 
        'Convert the string inputs to numeric types using int() or float()', 
        'Store them in a list first', 
        'Use the print() function'
      ], 
      answer: 'Convert the string inputs to numeric types using int() or float()' 
    },
    { 
      type: 'text', 
      question: 'What is the exact command you type in the terminal to check your Python version?', 
      answer: 'python --version' 
    },
    { 
      type: 'mcq', 
      question: 'In the decision-making chatbot program, what control flow structure allows the program to execute different code blocks based on user interests?', 
      options: [
        'for loop', 
        'while loop', 
        'if-elif-else conditional statements', 
        'function definition'
      ], 
      answer: 'if-elif-else conditional statements' 
    },
    { 
      type: 'mcq', 
      question: 'Which of the following is NOT a primitive data type in Python?', 
      options: [
        'int', 
        'str', 
        'bool', 
        'algorithm'
      ], 
      answer: 'algorithm' 
    },
    { 
      type: 'text', 
      question: 'What is the file extension for Python source code files? (Enter with the dot)', 
      answer: '.py' 
    },
    { 
      type: 'mcq', 
      question: 'What is the primary purpose of creating a GitHub repository for your coursework?', 
      options: [
        'To make your code run faster', 
        'To track your progress, maintain version control, and build a professional portfolio', 
        'To automatically grade your assignments', 
        'To download Python libraries'
      ], 
      answer: 'To track your progress, maintain version control, and build a professional portfolio' 
    }
  ]
    },
    {
        id: 3,
        title: 'L3: Building Blueprints with Object-Oriented Programming',
        duration: '90 min',
        content: `
            <h2>Module 3: Creating Reusable Code Structures</h2>
            <p class="lead">As programs grow, managing code becomes a challenge. <strong>Object-Oriented Programming (OOP)</strong> is a powerful paradigm that helps you structure your code in a way that is clean, reusable, and easy to understand. It organizes code around "objects," which bundle together related data and behaviors.</p>
            
            <h3>Analogy: The Car Factory</h3>
            <p>Imagine you are a car manufacturer. You don't build each car from scratch. Instead, you start with a detailed <strong>blueprint</strong>. This blueprint defines what every car must have (wheels, engine, doors) and what it can do (accelerate, brake). In OOP:</p>
            <ul>
                <li>The <strong>Class</strong> is the blueprint. It defines the properties (data) and methods (functions/behaviors) that all objects of that type will have.</li>
                <li>An <strong>Object</strong> is the actual car built from the blueprint. You can create many objects (many cars) from a single class (a single blueprint), and each can have its own specific properties (e.g., one car is red, another is blue).</li>
            </ul>

            <h3>Defining a Class in Python</h3>
            <p>Let's define a simple <code>Dog</code> class. The <code>__init__</code> method is a special "constructor" method that runs when you create a new object. It's used to set up the initial properties of the object. The <code>self</code> keyword refers to the specific object instance being created.</p>
            <pre><code>class Dog:
    # The constructor method
    def __init__(self, name, age):
        # These are the properties (attributes)
        self.name = name
        self.age = age
        print("A new dog has been created!")

    # This is a method (behavior)
    def bark(self):
        return f"{self.name} says Woof!"

# Now, let's create objects (instances) from our class
my_dog = Dog("Buddy", 5)
neighbors_dog = Dog("Lucy", 2)

# We can access their properties and methods
print(f"{my_dog.name} is {my_dog.age} years old.")
print(neighbors_dog.bark())</code></pre>
            
            <div class="interactive-code-area" style="border-left-color: var(--primary-color);">
                <div class="area-header" style="color: var(--primary-color);"><span> Practical Task: Build a `Book` Class</span></div>
                <p>Go to your Replit file. Define a new class called <code>Book</code>. The constructor (<code>__init__</code>) should take <code>title</code> and <code>author</code> as arguments and store them as properties. Create a method called <code>get_description</code> that returns a string like "[Title] by [Author]".</p>
                <p>After defining the class, create two different book objects from it and use the <code>print()</code> function to display the description for each book.</p>
            </div>

            <h3>The Four Pillars of OOP</h3>
            <p>OOP is built on four main principles that help create robust and scalable software:</p>
            <ol>
                <li><strong>Encapsulation:</strong> Bundling data (properties) and the methods that operate on that data into a single unit (the object). This hides the complex internal details from the outside world.</li>
                <li><strong>Abstraction:</strong> Hiding the complex implementation details and showing only the essential features of the object. The gas pedal in a car is a great example of abstraction; you just need to know to press it to go, not how the engine works.</li>
                <li><strong>Inheritance:</strong> Allowing a new class to inherit properties and methods from an existing class. This promotes code reuse. A `Poodle` class could inherit from the `Dog` class.</li>
                <li><strong>Polymorphism:</strong> Allowing objects of different classes to be treated as objects of a common super class. It literally means "many forms."</li>
            </ol>

            <h3>Further Reading and Resources</h3>
            <ul>
                <li>Real Python OOP: <a href="https://realpython.com/python3-object-oriented-programming/" target="_blank">A comprehensive guide to OOP in Python.</a></li>
            </ul>
        `,
        quiz: [
            { type: 'mcq', question: 'In the car factory analogy, what represents the Class?', options: ['The individual car', 'The factory owner', 'The blueprint', 'The car keys'], answer: 'The blueprint' },
            { type: 'mcq', question: 'What is the name of the special constructor method in a Python class?', options: ['__constructor__', '__main__', '__init__', '__start__'], answer: '__init__' },
            { type: 'mcq', question: 'The principle of bundling data and methods together within an object is known as:', options: ['Inheritance', 'Polymorphism', 'Abstraction', 'Encapsulation'], answer: 'Encapsulation' },
            { type: 'text', question: 'What keyword is used within a class method to refer to the object instance itself?', answer: 'self' },
            { type: 'mcq', question: 'If you create multiple objects from the same class, do they all share the exact same properties?', options: ['Yes, they are identical clones', 'No, each object can have its own unique property values'], answer: 'No, each object can have its own unique property values' }
        ]
    },
    {
        id: 4,
        title: 'L4: Managing Data with Database Systems & SQL',
        duration: '70 min',
        content: `
            <h2>Module 4: Storing and Retrieving Information</h2>
            <p class="lead">Most real-world applications need to store data permanently. A <strong>database</strong> is an organized collection of structured information, or data, typically stored electronically in a computer system. To communicate with databases, we use a special language called <strong>SQL</strong>.</p>
            
            <h3>Why Not Just Use Text Files?</h3>
            <p>You might wonder why we can't just store our data in simple text files. While that works for small amounts of data, it quickly becomes inefficient. Databases are designed to be:</p>
            <ul>
                <li><strong>Fast:</strong> They use indexing to retrieve specific data incredibly quickly, even from billions of records.</li>
                <li><strong>Scalable:</strong> They can handle massive amounts of data and thousands of simultaneous users.</li>
                <li><strong>Secure:</strong> They have robust systems for managing permissions and preventing unauthorized access.</li>
                <li><strong>Consistent:</strong> They ensure that data remains in a consistent state, even if errors or power failures occur (a concept known as ACID compliance).</li>
            </ul>

            <h3>Relational Databases and SQL</h3>
            <p>The most common type of database is the <strong>Relational Database</strong>. It organizes data into tables, which are similar to spreadsheets. Each table has rows (records) and columns (attributes). <strong>SQL (Structured Query Language)</strong> is the standard language for managing data in relational databases.</p>
            <p>The four fundamental operations you can perform are known by the acronym <strong>CRUD</strong>:</p>
            <ul>
                <li><strong>C</strong>reate: Add new data (The <code>INSERT</code> statement).</li>
                <li><strong>R</strong>ead: Retrieve data (The <code>SELECT</code> statement).</li>
                <li><strong>U</strong>pdate: Modify existing data (The <code>UPDATE</code> statement).</li>
                <li><strong>D</strong>elete: Remove data (The <code>DELETE</code> statement).</li>
            </ul>

            <pre><code>-- This is an SQL comment
-- The SELECT statement is used to query the database
-- This query selects the name and email columns from a table called Users
SELECT name, email FROM Users WHERE country = 'Nigeria';

-- The INSERT statement adds a new row of data
INSERT INTO Users (name, email, country) VALUES ('Ada Lovelace', 'ada@example.com', 'UK');
</code></pre>

            <div class="interactive-code-area" style="border-left-color: var(--primary-color);">
                <div class="area-header" style="color: var(--primary-color);"><span> Practical Task: Use a Live SQL Sandbox</span></div>
                <p>Let's write some real SQL. We will use a free online tool that provides a sample database to practice on.</p>
                <ol>
                    <li>Go to <a href="https://www.w3schools.com/sql/trysql.asp?filename=trysql_select_all" target="_blank">W3Schools SQL Tryit Editor</a>.</li>
                    <li>You will see a sample database with several tables like 'Customers' and 'Products'.</li>
                    <li>In the SQL statement window, delete the existing text and write a query to <strong>select all columns from the 'Customers' table where the 'Country' is 'Mexico'</strong>. (Hint: The wildcard to select all columns is <code>*</code>).</li>
                    <li>Click "Run SQL" to see the result. Now, try another query to select the 'ProductName' and 'Price' from the 'Products' table for all products with a 'Price' less than 20.</li>
                </ol>
            </div>

            <h3>Further Reading and Resources</h3>
            <ul>
                <li>SQLZoo: <a href="https://sqlzoo.net/" target="_blank">An excellent interactive SQL tutorial.</a></li>
            </ul>
        `,
        quiz: [
            { type: 'mcq', question: 'What does SQL stand for?', options: ['Structured Query Logic', 'Simple Query Language', 'Structured Query Language', 'Standard Question Language'], answer: 'Structured Query Language' },
            { type: 'mcq', question: 'Which SQL keyword is used to retrieve data from a database?', options: ['GET', 'SELECT', 'RETRIEVE', 'READ'], answer: 'SELECT' },
            { type: 'mcq', question: 'In the CRUD acronym, what does the "U" stand for?', options: ['Undo', 'Unlink', 'Upgrade', 'Update'], answer: 'Update' },
            { type: 'text', question: 'What type of database organizes data into tables consisting of rows and columns?', answer: 'Relational Database' },
            { type: 'mcq', question: 'Which SQL statement would you use to add a new customer to the `Customers` table?', options: ['ADD', 'CREATE', 'INSERT', 'NEW'], answer: 'INSERT' }
        ]
    },
    {
        id: 5,
        title: 'L5: The Engineering Process & Version Control with Git',
        duration: '85 min',
        content: `
            <h2>Module 5: From Writing Code to Building Software</h2>
            <p class="lead">There is a significant difference between writing a small script for yourself and building a large, reliable software application for others. This discipline is known as <strong>Software Engineering</strong>, and it involves processes and tools to manage complexity and collaboration. In this lesson, we'll explore the development lifecycle and the most essential tool for any developer: <strong>Git</strong>.</p>
            
            <h3>Software Development Life Cycle (SDLC)</h3>
            <p>The SDLC is a framework that outlines the stages involved in creating high-quality software. A popular modern approach is the <strong>Agile methodology</strong>.</p>
            <p>Imagine building a car. The old way (Waterfall) was to build the entire car in secret and reveal it at the end. The problem? If the customer wanted changes, it was too late. The <strong>Agile</strong> way is to build the car in small, iterative cycles. First, you build a skateboard, show it to the customer, and get feedback. Then you add a steering wheel to make it a scooter. Then you add an engine. At each stage, you have a working product and can easily adapt to changing requirements.</p>

            <h3>Version Control with Git and GitHub</h3>
            <p>When you work on a project, especially with a team, you need a way to track changes. What if you introduce a bug and need to go back to a previous working version? What if two people edit the same file? This is where <strong>Version Control Systems (VCS)</strong> come in. The most popular VCS in the world is <strong>Git</strong>.</p>
            <ul>
                <li><strong>Repository (Repo):</strong> A folder that contains your project and its entire history of changes.</li>
                <li><strong>Commit:</strong> A snapshot of your repository at a specific point in time. You make a commit every time you reach a meaningful milestone in your work. Each commit has a unique ID and a message describing the changes.</li>
                <li><strong>Push:</strong> The command to upload your local commits to a remote repository, like the one you created on GitHub. This is how you back up your work and share it with others.</li>
            </ul>

            <div class="interactive-code-area" style="border-left-color: var(--primary-color);">
                <div class="area-header" style="color: var(--primary-color);"><span> Practical Task: Your First Git Commit</span></div>
                <p>This task requires you to have Git installed on your computer. If you don't, you can use the built-in version control features on Replit, which use Git behind the scenes.</p>
                <ol>
                    <li>On GitHub, create a new, blank repository. Name it something like "cs101-practice".</li>
                    <li>On your local machine (or in Replit), create a new folder and add a file called <code>hello.py</code> with the "Hello, World!" code from Lesson 1.</li>
                    <li>Follow the instructions on your new GitHub repository page to "push an existing repository from the command line". The key commands will be:</li>
                </ol>
                <pre><code># Initialize a new Git repository in your folder
git init

# Add all files in the folder to be tracked
git add .

# Create a commit (a snapshot) with a descriptive message
git commit -m "feat: Add initial hello world program"

# Connect your local repo to the remote one on GitHub
git remote add origin [YOUR_GITHUB_REPO_URL]

# Push your commit to GitHub
git push -u origin master</code></pre>
                <p>If you succeed, you will see your <code>hello.py</code> file in your repository on the GitHub website. This is a monumental step in your journey as a developer.</p>
            </div>

            <h3>Further Reading and Resources</h3>
            <ul>
                <li>Atlassian Git Tutorial: <a href="https://www.atlassian.com/git/tutorials/what-is-git" target="_blank">An excellent beginner's guide to Git.</a></li>
            </ul>
        `,
        quiz: [
            { type: 'mcq', question: 'What is the main advantage of the Agile methodology?', options: ['It is very rigid and prevents changes', 'It allows for flexibility and adapting to changes during development', 'It does not require any planning', 'It is only for solo developers'], answer: 'It allows for flexibility and adapting to changes during development' },
            { type: 'mcq', question: 'In Git, what is a "commit"?', options: ['A command to download a repository', 'A mistake in the code', 'A snapshot of your project at a specific point in time', 'A request to join a team'], answer: 'A snapshot of your project at a specific point in time' },
            { type: 'mcq', question: 'Which Git command is used to upload your local commits to GitHub?', options: ['git pull', 'git fetch', 'git commit', 'git push'], answer: 'git push' },
            { type: 'text', question: 'What is the name of the most popular Version Control System used by developers?', answer: 'Git' },
            { type: 'mcq', question: 'Why is version control important in software development?', options: ['It makes the code run faster', 'It tracks changes, allows for collaboration, and enables reverting to previous versions', 'It automatically finds and fixes all bugs', 'It is not important for modern development'], answer: 'It tracks changes, allows for collaboration, and enables reverting to previous versions' }
        ]
    },
    {
        id: 6,
        title: 'L6: How the Internet Works: Computer Networks',
        duration: '60 min',
        content: `
            <h2>Module 6: Connecting the World</h2>
            <p class="lead">As a software developer, you will almost certainly build applications that communicate over the internet. But how does it actually work? In this lesson, we will demystify the process that occurs every time you type a website address into your browser and press Enter.</p>
            
            <h3>Journey of a Web Request</h3>
            <p>Let's trace the path of a simple request, like visiting <strong>www.google.com</strong>. It's like sending a letter through a global postal service.</p>
            <ol>
                <li><strong>DNS Lookup (The Address Book):</strong> Your computer doesn't know where "www.google.com" is. It needs a physical address, known as an <strong>IP Address</strong> (e.g., <code>142.250.184.196</code>). Your computer asks a Domain Name System (DNS) server to look up the IP address for the domain name, just like you'd look up a friend's address in an address book.</li>
                <li><strong>TCP/IP (The Postal Service):</strong> Once your computer has the IP address, it needs to send a request. This is handled by the <strong>Transmission Control Protocol (TCP)</strong> and the <strong>Internet Protocol (IP)</strong>. IP is responsible for routing the data packet to the correct address. TCP is responsible for ensuring all the packets arrive in the correct order and without errors, like getting a delivery confirmation.</li>
                <li><strong>HTTP (The Language of the Letter):</strong> The request itself is written in a specific language. For the web, this is the <strong>Hypertext Transfer Protocol (HTTP)</strong>. Your browser sends an HTTP request like <code>GET / HTTP/1.1</code> to Google's server.</li>
                <li><strong>The Server Responds:</strong> Google's server receives the request, processes it, and sends back an HTTP response. This response contains the HTML, CSS, and JavaScript code needed to display the Google homepage. Your browser then receives this code and renders the webpage you see.</li>
            </ol>
            
            <div class="interactive-code-area" style="border-left-color: var(--primary-color);">
                <div class="area-header" style="color: var(--primary-color);"><span> Practical Task: Find an IP Address</span></div>
                <p>You can perform a simple DNS lookup yourself using a command-line tool available on every operating system.</p>
                <ul>
                    <li><strong>On Windows:</strong> Open the Command Prompt and type <code>ping elvion.com</code> then press Enter.</li>
                    <li><strong>On Mac/Linux:</strong> Open the Terminal and type <code>ping elvion.com</code> then press Enter.</li>
                </ul>
                <p>The command will send a small packet to the server and measure the response time. In the output, you will see the IP address that the domain name resolved to. This is the real, physical address of the server hosting that website.</p>
            </div>

            <h3>Clients and Servers</h3>
            <p>This entire interaction is based on the <strong>client-server model</strong>. The <strong>client</strong> is the device requesting the information (your web browser). The <strong>server</strong> is the powerful computer that stores the information and responds to requests. As a web developer, you will write code that runs on both the client (front-end) and the server (back-end).</p>
        `,
        quiz: [
            { type: 'mcq', question: 'What is the primary role of DNS?', options: ['To ensure data arrives without errors', 'To translate human-readable domain names into machine-readable IP addresses', 'To display the webpage', 'To write the HTML code'], answer: 'To translate human-readable domain names into machine-readable IP addresses' },
            { type: 'mcq', question: 'In the client-server model, what is your web browser considered?', options: ['The server', 'The client', 'The protocol', 'The network'], answer: 'The client' },
            { type: 'mcq', question: 'What does HTTP stand for?', options: ['Hypertext Transfer Protocol', 'High-Level Text Protocol', 'Hyperlink Test Program', 'Home Transfer Tool Protocol'], answer: 'Hypertext Transfer Protocol' },
            { type: 'text', question: 'What is the unique numerical address for a device on the internet called? (e.g., 192.168.1.1)', answer: 'IP Address' },
            { type: 'mcq', question: 'Which protocol is responsible for ensuring that data packets arrive reliably and in the correct order?', options: ['IP', 'DNS', 'HTTP', 'TCP'], answer: 'TCP' }
        ]
    },
    {
        id: 7,
        title: 'L7: Introduction to Artificial Intelligence & Machine Learning',
        duration: '75 min',
        content: `
            <h2>Module 7: Teaching Machines to Learn</h2>
            <p class="lead"><strong>Artificial Intelligence (AI)</strong> is one of the most transformative fields in computer science. At its core, AI is about creating systems that can perform tasks that typically require human intelligence. A major subfield of AI is <strong>Machine Learning (ML)</strong>, which focuses on the idea that we can give machines access to data and let them learn for themselves.</p>

            <h3>The Core Idea: Learning from Data</h3>
            <p>Traditionally, we programmed computers by writing explicit, rule-based instructions. For example, to identify spam email, we might write a rule: "If the email contains the words 'free money', then mark it as spam." The problem? Spammers quickly learn to use different words. It's impossible to write enough rules.</p>
            <p>Machine Learning flips this on its head. Instead of writing rules, we show the machine thousands of emails that we have already labeled as "spam" or "not spam." The ML algorithm then learns the patterns associated with spam on its own. It might discover that certain phrases, sender reputations, and email structures are common in spam, creating a far more effective and adaptable filter.</p>

            <h3>Types of Machine Learning</h3>
            <ol>
                <li><strong>Supervised Learning:</strong> This is the most common type. You train the model with labeled data, like the spam email example. You provide both the input (the email) and the correct output (the "spam" label). The goal is for the model to learn how to predict the output for new, unseen inputs. Image recognition (labeling pictures as "cat" or "dog") is another classic example.</li>
                <li><strong>Unsupervised Learning:</strong> Here, you provide the model with unlabeled data and ask it to find hidden patterns or structures on its own. For example, you could give it customer purchase data, and it might discover different customer segments (e.g., "budget shoppers," "brand loyalists") without you defining those groups beforehand. Recommendation engines, like on Netflix or Amazon, use this to group similar users and items.</li>
                <li><strong>Reinforcement Learning:</strong> This type of learning is modeled after how humans learn from trial and error. The AI agent (e.g., a game-playing bot) takes actions in an environment and receives rewards or penalties. The goal is for the agent to learn the best sequence of actions to maximize its total reward. This is the technology behind AIs that can master complex games like Chess or Go.</li>
            </ol>

            <div class="interactive-code-area" style="border-left-color: var(--primary-color);">
                <div class="area-header" style="color: var(--primary-color);"><span> Practical Task: Experience a Live AI Model</span></div>
                <p>Let's interact with a powerful AI model in a tangible way. Many AI research labs create "Generative Adversarial Networks" (GANs) to generate hyper-realistic images.</p>
                <ol>
                    <li>Go to the website <a href="https://www.whichfaceisreal.com/" target="_blank">Which Face Is Real?</a>.</li>
                    <li>You will be shown two pictures of human faces. One is a real photograph, and the other was completely generated by an AI that was trained on hundreds of thousands of real photos.</li>
                    <li>Try to guess which one is real. This exercise gives you a direct sense of the power and sophistication of modern machine learning models.</li>
                </ol>
            </div>

            <h3>Further Reading and Resources</h3>
            <ul>
                <li>Google's "What is Machine Learning?": <a href="https://developers.google.com/machine-learning/crash-course/ml-intro" target="_blank">An excellent introduction from industry leaders.</a></li>
            </ul>
        `,
        quiz: [
            { type: 'mcq', question: 'What is the key idea behind Machine Learning?', options: ['Writing millions of specific rules', 'Allowing systems to learn patterns directly from data', 'Making computers conscious', 'Building physical robots'], answer: 'Allowing systems to learn patterns directly from data' },
            { type: 'mcq', question: 'You have a dataset of 10,000 images, each labeled as either "cat" or "dog". Which type of ML would you use to train a model to identify them?', options: ['Supervised Learning', 'Unsupervised Learning', 'Reinforcement Learning'], answer: 'Supervised Learning' },
            { type: 'mcq', question: 'A streaming service wants to recommend new shows to you by finding other users with similar tastes. This is an example of:', options: ['Supervised Learning', 'Unsupervised Learning', 'Reinforcement Learning'], answer: 'Unsupervised Learning' },
            { type: 'text', question: 'Which type of machine learning involves an agent learning through trial and error by receiving rewards or penalties?', answer: 'Reinforcement Learning' },
            { type: 'mcq', question: 'What is the main limitation of a traditional, rule-based system compared to a machine learning system?', options: ['It is faster', 'It is less adaptable to new or changing patterns', 'It requires more data', 'It is more intelligent'], answer: 'It is less adaptable to new or changing patterns' }
        ]
    },
    {
        id: 8,
        title: 'Final Capstone Project: Building a Complete Application',
        duration: '120 min',
        content: `
            <h2>Final Module: Your Capstone Project</h2>
            <p class="lead" style="color: var(--warning-color);">Congratulations on reaching the final module of this course. You have journeyed from writing your first line of code to understanding the complex systems that power the modern web. Now, it is time to synthesize your knowledge by building a complete, functional software solution.</p>
            
            <h3>The Project Goal: Personal Portfolio Tracker</h3>
            <p>Your goal is to build a simple command-line application in Python to track a list of personal projects. This application will demonstrate your understanding of the core concepts learned in lessons 1 through 7.</p>
            
            <h4>Core Feature Requirements:</h4>
            <p>Your application must start up and present the user with a menu of options, such as:</p>
            <ol>
                <li>Add a new project</li>
                <li>List all projects</li>
                <li>Mark a project as complete</li>
                <li>Exit</li>
            </ol>

            <h4>Technical Requirements (Tied to Your Lessons):</h4>
            <ul>
                <li><strong>Data Structures (Lesson 2):</strong> You must use a <strong>List of Dictionaries</strong> to store the project data in memory. Each project in the list should be a dictionary with keys like <code>'title'</code>, <code>'description'</code>, and <code>'is_complete'</code> (a Boolean).</li>
                <li><strong>Object-Oriented Programming (Lesson 3):</strong> You must define a <code>Project</code> class. Your program should create instances (objects) of this class and manage them. The class should have properties for title, description, and completion status.</li>
                <li><strong>Software Engineering (Lesson 5):</strong> You must initialize a Git repository for your project and host it on GitHub. Your submission must be a link to this GitHub repository. Make at least three meaningful commits as you build the project.</li>
            </ul>

            <h3>Submission Guidelines (Crucial)</h3>
            <p>To receive your certificate, you must submit two items:</p>
            <ol>
                <li><strong>The GitHub Repository Link:</strong> The public URL to your GitHub repository containing the complete, working Python code for your application.</li>
                <li><strong>The Documentation (README.md):</strong> Your GitHub repository must contain a well-written <code>README.md</code> file. This file must detail the project's goal, how to run the application, and a <strong>brief personal reflection</strong> on what you learned during the course and this project.</li>
            </ol>
            <p style="color: var(--cyan-glow);"><strong>Submit BOTH of these items by emailing the GitHub link to: elvionailabs@gmail.com</strong> after filling out the certificate form on the next page.</p>
        `,
        quiz: [
            { type: 'mcq', question: 'What is the main deliverable for the Final Project?', options: ['A video demonstration', 'A link to a public GitHub repository', 'Only the Python file', 'A 100-page thesis'], answer: 'A link to a public GitHub repository' },
            { type: 'text', question: 'What data structure are you required to use to store the list of projects?', answer: 'List of Dictionaries' },
            { type: 'mcq', question: 'Besides the code, what other important file must be included and well-written in your GitHub repository?', options: ['A license file', 'A settings file', 'The README.md documentation and reflection file', 'A CSS file'], answer: 'The README.md documentation and reflection file' },
            { type: 'text', question: 'What is the email address to which you must submit your GitHub link for certificate review? (Enter exactly)', answer: 'elvionailabs@gmail.com' }
        ]
    }
];

    // --- SOFTWARE ENGINEERING COURSE CONTENT (ALL Template Literals) ---
    const swe101Lessons = [
        {
            id: 1,
            title: 'L1: Software Engineering Discipline & Mindset',
            duration: '50 min',
            content: `
                <h2>What is Software Engineering? (SWE)</h2>
                <p>Software Engineering is the systematic, disciplined, quantifiable approach to the development, operation, and maintenance of software. It's not just coding; it's about building complex systems reliably, on time, and within budget, treating software development as an engineering discipline.</p>

                <h3>Why Engineering?</h3>
                <p>Unlike simple programming (where one person writes code for a small task), Software Engineering deals with:</p>
                <ul>
                    <li><strong>Scale:</strong> Projects involving hundreds of developers and millions of lines of code.</li>
                    <li><strong>Reliability:</strong> The software must work correctly, especially in critical applications (e.g., medical, aviation).</li>
                    <li><strong>Maintainability:</strong> The ability for future teams to update and fix the software efficiently.</li>
                </ul>

                <div class="interactive-code-area" style="background: rgba(18, 26, 48, 0.85); border-left: 4px solid var(--warning-color);">
                    <div class="area-header" style="color: var(--warning-color);"><span>The SWE Mindset</span></div>
                    <p>The core mindset of an engineer is: **Plan, Test, Document, and Optimize**. A software engineer spends far more time designing and verifying than writing the initial code.</p>
                </div>
                
                <h3>Activity: The Bridge Analogy</h3>
                <p>Consider a bridge builder (Civil Engineer) vs. someone nailing two boards together (Hobbyist). The bridge requires extensive planning, stress testing, material science, and regulatory compliance. Software development for a bank's security system is like building a bridge; an engineer is required.</p>
                
                <h3>Further Reading</h3>
                <ul>
                    <li>IEEE/ISO Standard for Software Engineering: <code>iso.org/standard/24640.html</code></li>
                    <li>"The Mythical Man-Month" by Frederick Brooks (On software project management).</li>
                </ul>
            `,
            quiz: [
                { type: 'mcq', question: 'Software Engineering is defined as a systematic, disciplined, quantifiable approach to:', options: ['Only coding tasks', 'The development, operation, and maintenance of software', 'Only bug fixing', 'Writing short scripts'], answer: 'The development, operation, and maintenance of software' },
                { type: 'mcq', question: 'Which characteristic is a major concern for Software Engineering but less so for simple programming?', options: ['Writing variable names', 'Choosing a text editor', 'Dealing with project scale and maintainability', 'Debugging basic loops'], answer: 'Dealing with project scale and maintainability' },
            ],
        },
        {
            id: 2,
            title: 'L2: SDLC and Methodologies (Agile vs. Waterfall)',
            duration: '60 min',
            content: `
                <h2>The Software Development Lifecycle (SDLC)</h2>
                <p>The SDLC is a process followed by a software project within a software organization. It outlines a detailed plan for how to develop, maintain, replace, or alter software systems. The common phases are: Planning, Requirements Analysis, Design, Implementation (Coding), Testing, Deployment, and Maintenance.</p>

                <h3>Waterfall Methodology</h3>
                <p>The Waterfall model is a sequential design process, where progress flows steadily downwards like a waterfall. Each phase must be completed and signed off before the next phase can begin.</p>
                <ul>
                    <li>**Pros:** Simple to understand, easy to manage due to rigid phases, good for small projects with clearly defined, unchanging requirements.</li>
                    <li>**Cons:** High risk for complex projects; no working software until late in the cycle; difficult to respond to changing requirements.</li>
                </ul>

                <h3>Agile Methodology</h3>
                <p>Agile is an iterative, incremental approach. It focuses on delivering value quickly and responding to change. It is guided by the **Agile Manifesto** principles: individuals and interactions over processes and tools, working software over comprehensive documentation, customer collaboration over contract negotiation, and responding to change over following a plan.</p>
                <ul>
                    <li>**Key Concepts:** **Sprints** (short, time-boxed iterations, typically 2-4 weeks), **Daily Standups**, **Product Backlogs**.</li>
                    <li>**Pros:** High customer satisfaction, early and continuous delivery of working software, highly adaptable to changes.</li>
                    <li>**Cons:** Requires intense customer involvement, can be hard to measure progress for complex projects without clear documentation.</li>
                </ul>

                <div class="interactive-code-area" style="background: rgba(18, 26, 48, 0.85); border-left: 4px solid var(--primary-color);">
                    <div class="area-header" style="color: var(--primary-color);"><span>Real-World SDLC</span></div>
                    <p>Most modern tech companies use variations of Agile (like Scrum or Kanban) because product requirements in the tech industry change constantly. Waterfall is generally reserved for government contracts or embedded systems where requirements are fixed from the start.</p>
                </div>
            `,
            quiz: [
                { type: 'mcq', question: 'Which SDLC methodology requires that each phase be completed and signed off before the next phase begins?', options: ['Agile', 'Scrum', 'Kanban', 'Waterfall'], answer: 'Waterfall' },
                { type: 'mcq', question: 'The Agile methodology prioritizes "working software" over what, according to the manifesto?', options: ['Individuals and interactions', 'Comprehensive documentation', 'Responding to change', 'Customer collaboration'], answer: 'Comprehensive documentation' },
            ],
        },
        {
            id: 3,
            title: 'L3: Requirements and Design Documentation',
            duration: '45 min',
            content: `
                <h2>The Importance of Documentation</h2>
                <p>In software engineering, documentation is the blueprint for development. It ensures everyonefrom the customer to the developeris aligned on what needs to be built and how it will function. Two critical types of documents are requirements and design.</p>

                <h3>Requirements Documentation (SRS)</h3>
                <p>The **Software Requirements Specification (SRS)** documents the functional and non-functional requirements of the system. This answers: **"What will the system do?"**</p>
                <ul>
                    <li>**Functional Requirements:** Define the features and services the system provides (e.g., "The system shall allow users to log in with a valid username and password").</li>
                    <li>**Non-functional Requirements:** Define the qualities of the system (e.g., **Performance:** "The system shall load the dashboard in under 2 seconds." **Security:** "All user data must be encrypted.").</li>
                </ul>

                <h3>Design Documentation</h3>
                <p>The Design Document details the high-level architecture and low-level component design. This answers: **"How will the system be built?"**</p>
                <ul>
                    <li>**UML Diagrams:** **Unified Modeling Language** diagrams (like Class Diagrams or Use Case Diagrams) are used to visually model the system's structure and behavior.</li>
                    <li>**Use Cases:** Describes how a user interacts with the system to achieve a specific goal (e.g., "User logs in" or "User creates a new order").</li>
                </ul>

                <div class="interactive-code-area" style="background: rgba(18, 26, 48, 0.85); border-left: 4px solid var(--success-color);">
                    <div class="area-header" style="color: var(--success-color);"><span>The Engineer's Motto</span></div>
                    <p>A poorly written requirement leads to poorly written code. A Software Engineer's first job is not to code, but to **ensure the requirements are complete, consistent, and unambiguous.**</p>
                </div>
            `,
            quiz: [
                { type: 'mcq', question: 'Which requirement specifies the qualities of a system, such as speed or security?', options: ['Functional Requirement', 'Business Requirement', 'Non-functional Requirement', 'User Story'], answer: 'Non-functional Requirement' },
                { type: 'mcq', question: 'The Software Requirements Specification (SRS) primarily answers which question?', options: ['How long will it take to build?', 'What will the system do?', 'What coding language is best?', 'How much will it cost?'], answer: 'What will the system do?' },
            ],
        },
        {
            id: 4,
            title: 'L4: Introduction to Design Patterns',
            duration: '75 min',
            content: `
                <h2>Solving Common Problems with Design Patterns</h2>
                <p>In software engineering, a **Design Pattern** is a reusable solution to a commonly occurring problem within a given context in software design. They are not finished designs that can be plugged straight into your code; they are templates or blueprints for how to solve a problem.</p>

                <h3>The Three Categories</h3>
                <p>Patterns are usually categorized into three groups:</p>
                <ol>
                    <li>**Creational Patterns:** Concerned with the way objects are created (e.g., Factory, Singleton).</li>
                    <li>**Structural Patterns:** Concerned with composing classes and objects (e.g., Adapter, Decorator).</li>
                    <li>**Behavioral Patterns:** Concerned with communication between objects (e.g., Observer, Strategy).</li>
                </ol>

                <h3>Pattern Deep Dive: The Singleton Pattern (Creational)</h3>
                <p>The Singleton Pattern ensures a class has only **one instance** and provides a global point of access to it. This is useful for things like a single database connection pool or a global configuration manager.</p>
                <pre><code>// Example Concept: Singleton
class ConfigurationManager {
    private static instance: ConfigurationManager;
    private constructor() { /* Load settings */ }
    
    public static getInstance(): ConfigurationManager {
        if (!ConfigurationManager.instance) {
            ConfigurationManager.instance = new ConfigurationManager();
        }
        return ConfigurationManager.instance;
    }
}</code></pre>

                <h3>Pattern Deep Dive: The Factory Pattern (Creational)</h3>
                <p>The Factory Pattern provides an interface for creating objects in a superclass, but allows subclasses to alter the type of objects that will be created. This decouples the object creation logic from the client code.</p>
                <p style="color: var(--cyan-glow);">**Benefit:** Using design patterns leads to code that is more robust, reusable, and easier to maintain because it follows well-established engineering best practices.</p>
            `,
            quiz: [
                { type: 'mcq', question: 'A Design Pattern is best described as:', options: ['A finished, plug-and-play piece of code', 'A template for solving a common problem in a specific context', 'A legal contract for software design', 'A programming language feature'], answer: 'A template for solving a common problem in a specific context' },
                { type: 'mcq', question: 'Which creational pattern ensures a class has only one instance and provides a global access point?', options: ['Observer', 'Factory', 'Decorator', 'Singleton'], answer: 'Singleton' },
            ],
        },
        {
            id: 5,
            title: 'L5: Final Project: Architecting a System',
            duration: '90 min',
            content: `
                <h2>Course Capstone: The Architectural Design Document</h2>
                <p>Congratulations on completing the core lessons! Your final requirement is to apply the principles of Requirements Analysis, SDLC, and Design to create a professional **Architectural Design Document** for a new software system.</p>

                <h3>Project Brief: The "Elvion Academy Planner"</h3>
                <p>Design a system that allows Elvion University students to track their course progress, manage due dates, and visualize their overall Grade Point (GP) progress across all courses.</p>

                <h3>Required Sections for Submission</h3>
                <p>Your Design Document (PDF or Markdown file) must include the following sections (2000-word minimum total):</p>
                <ol>
                    <li>**Overview & Goals:** (500 words) What is the system? What problem does it solve? Define the target user.</li>
                    <li>**Requirements (SRS):** (500 words) Detail at least 5 **Functional** and 5 **Non-functional** requirements (e.g., Performance, Security, Usability).</li>
                    <li>**SDLC Justification:** (300 words) Which methodology (Agile or Waterfall) would you choose for this project and why?</li>
                    <li>**Architectural Design:** (700 words)
                        <ul>
                            <li>Propose a high-level architecture (e.g., 3-Tier, Microservices).</li>
                            <li>Identify two key components (e.g., Database, Authentication Service).</li>
                            <li>**Design Pattern Application:** Specify one Creational and one Structural/Behavioral design pattern you would use in a component and justify its use.</li>
                        </ul>
                    </li>
                </ol>
                
                <div class="interactive-code-area" style="background: rgba(18, 26, 48, 0.85); border-left: 4px solid var(--success-color);">
                    <div class="area-header" style="color: var(--success-color);"><span>Submission Instructions</span></div>
                    <p>This is a non-code project. Your final submission is the written document. Save your document as: <strong>SWE101_YourName_DesignDoc.pdf</strong>.</p>
                    <p style="color: var(--error-color); font-weight: bold;">**ACTION:** Email your final document to: <code>elvionailabs@gmail.com</code></p>
                </div>
                <p>Once you pass the final quiz below, click "Final Exam/Certificate" in the navigation bar to proceed with certificate request.</p>
            `,
            quiz: [
                { type: 'mcq', question: 'For the SWE101 course, what is the final deliverable requirement?', options: ['A full, working code application', 'An Architectural Design Document', 'A face-to-face interview', 'A group presentation'], answer: 'An Architectural Design Document' },
                { type: 'text', question: 'What is the email address to which you must submit your project for certificate review? (Enter exactly)', answer: 'elvionailabs@gmail.com' },
            ],
        }
    ];


    // Assembling all courses
    const allCourses = [
        { id: 'cs101', title: 'Computer Science', description: 'Fundamentals of computing, programming, and algorithms', icon: 'fas fa-laptop-code', totalLessons: 8, estimatedHours: 120, mediaType: 'video', lessons: cs101Lessons },
        // NEW SOFTWARE ENGINEERING COURSE - CORRECTLY LINKED
        { id: 'swe101', title: 'Software Engineering', description: 'Design, develop, and maintain large-scale software systems.', icon: 'fas fa-cogs', totalLessons: 5, estimatedHours: 80, mediaType: 'video', lessons: swe101Lessons },
        // OTHER COURSES WITH GENERATED PLACEHOLDERS
        { id: 'law101', title: 'Law (LLB)', description: 'Comprehensive study of legal principles and practice.', icon: 'fas fa-balance-scale', totalLessons: 6, estimatedHours: 90, mediaType: 'video', lessons: generateDefaultLessons(6, 'LAW', false) },
        { id: 'eng101', title: 'English & Literary Studies', description: 'Study of English language, literature, and critical analysis.', icon: 'fas fa-pen-nib', totalLessons: 4, estimatedHours: 60, mediaType: 'audio', lessons: generateDefaultLessons(4, 'ENG', false) },
        { id: 'his101', title: 'History & Strategic Studies', description: 'World history, Nigerian history, and strategic studies.', icon: 'fas fa-globe-africa', totalLessons: 5, estimatedHours: 75, mediaType: 'audio', lessons: generateDefaultLessons(5, 'HIS', false) },
        { id: 'bus101', title: 'Business Administration', description: 'Principles of management, marketing, finance, and entrepreneurship.', icon: 'fas fa-chart-line', totalLessons: 7, estimatedHours: 100, mediaType: 'audio', lessons: generateDefaultLessons(7, 'BUS', true) },
        { id: 'mass101', title: 'Mass Communication', description: 'Journalism, public relations, broadcasting, and digital media communication.', icon: 'fas fa-bullhorn', totalLessons: 6, estimatedHours: 90, mediaType: 'audio', lessons: generateDefaultLessons(6, 'MASS', false) },
        { id: 'math101', title: 'Mathematics Education', description: 'Methods and strategies for teaching mathematics.', icon: 'fas fa-calculator', totalLessons: 5, estimatedHours: 70, mediaType: 'audio', lessons: generateDefaultLessons(5, 'MATED', false) },
        { id: 'aed101', title: 'Adult Education', description: 'Teaching and learning strategies for adult learners.', icon: 'fas fa-chalkboard-teacher', totalLessons: 4, estimatedHours: 60, mediaType: 'audio', lessons: generateDefaultLessons(4, 'ADULT', false) },
        {
            id: 'visart101',
            title: 'Visual Arts & Digital Media',
            description: 'A study of animation, painting, graphic design, and digital art.',
            icon: 'fas fa-palette',
            totalLessons: 6,
            estimatedHours: 95,
            mediaType: 'video',
            lessons: generateDefaultLessons(6, 'VA', true)
        },
    ];

    let currentUser = null;
    let userData = null;
    let currentCourse = null;
    let currentLesson = 1;
    let totalLessons = 0;
    let quizPassed = false; // New state to track if quiz is passed for navigation

    // URL Parameters
    const urlParams = new URLSearchParams(window.location.search);
    const courseId = urlParams.get('courseId');
    const lessonParam = urlParams.get('lesson');

    // ... (DOM Content Loaded and Star Animation code remains the same)

    // Mobile Menu Toggle
    const mobileMenuToggle = document.getElementById('mobileMenuToggle');
    const courseSidebar = document.getElementById('courseSidebar');

    mobileMenuToggle.addEventListener('click', () => {
        courseSidebar.classList.toggle('active');
    });

    // Close sidebar when clicking outside on mobile
    document.addEventListener('click', (e) => {
        if (window.innerWidth <= 992) {
            if (!courseSidebar.contains(e.target) && !mobileMenuToggle.contains(e.target)) {
                courseSidebar.classList.remove('active');
            }
        }
    });

    // Auth State Management
    onAuthStateChanged(auth, async (user) => {
        if (user) {
            currentUser = user;
            await loadUserData();
            await initializeCourseViewer();
        } else {
            // Redirect to enrollment page if not logged in
            window.location.href = 'enroll.html';
        }
    });

    async function loadUserData() {
        try {
            const userDocRef = doc(db, 'users', currentUser.uid);
            const userDoc = await getDoc(userDocRef);

            if (userDoc.exists()) {
                userData = userDoc.data();
                // Ensure totalPoints exists for new users
                if (userData.totalPoints === undefined) {
                    userData.totalPoints = 0;
                    await updateDoc(userDocRef, { totalPoints: 0 });
                }
            } else {
                // Redirect to dashboard (or enrollment flow) if user data is missing
                window.location.href = 'studyingatelvion.html';
            }
        } catch (error) {
            console.error('Error loading user data:', error);
            alert('Error loading user data. Please try again.');
        }
    }

    async function initializeCourseViewer() {
        if (!courseId) {
            alert('No course specified');
            window.location.href = 'studyingatelvion.html';
            return;
        }

        currentCourse = findCourseById(courseId);
        if (!currentCourse) {
            alert('Course not found');
            window.location.href = 'studyingatelvion.html';
            return;
        }

        totalLessons = currentCourse.totalLessons;
        currentLesson = parseInt(lessonParam) || 1;

        // Check if user is enrolled
        const enrolledCourse = userData.enrolledCourses?.find(c => c.courseId === courseId);
        if (!enrolledCourse) {
            alert('You are not enrolled in this course');
            window.location.href = 'studyingatelvion.html';
            return;
        }

        setupCourseInterface();
        renderLessonsList();
        loadLesson(currentLesson);

        document.getElementById('loadingContainer').style.display = 'none';
        document.getElementById('contentHeader').style.display = 'flex';
        document.getElementById('mainContent').style.display = 'block';
        document.getElementById('lessonNavigation').style.display = 'flex';
    }

    function findCourseById(courseId) {
        return allCourses.find(c => c.id === courseId);
    }

    function setupCourseInterface() {
        document.getElementById('courseIconLarge').className = `course-icon-large ${currentCourse.icon}`;
        document.getElementById('courseTitle').textContent = currentCourse.title;
        document.getElementById('courseSubtitle').textContent = currentCourse.description;

        // Populate Certificate Form details
        document.getElementById('formSubject').value = `Certificate Request: ${currentCourse.title}`;
        document.getElementById('completedCourseName').value = currentCourse.title;

        updateOverallProgress();
    }

    function updateOverallProgress() {
        const enrolledCourse = userData.enrolledCourses?.find(c => c.courseId === courseId);
        const progress = enrolledCourse?.progress || 0;
        const completedLessons = enrolledCourse?.completedLessons?.length || 0;

        document.getElementById('overallProgressBar').style.width = `${progress}%`;
        document.getElementById('overallProgressText').textContent = `${progress}% Complete (${completedLessons}/${totalLessons} lessons)`;

        // Update Total Points for GP (sidebar and nav)
        document.getElementById('totalPointsEarnedSidebar').textContent = userData.totalPoints || 0;
        document.getElementById('totalPointsEarnedNav').textContent = userData.totalPoints || 0;
        document.getElementById('formTotalPoints').value = userData.totalPoints || 0;
        document.getElementById('finalTotalPoints').textContent = userData.totalPoints || 0;
    }

    function renderLessonsList() {
        const container = document.getElementById('lessonsContainer');
        const enrolledCourse = userData.enrolledCourses?.find(c => c.courseId === courseId);
        const completedLessons = enrolledCourse?.completedLessons || [];

        container.innerHTML = '';

        currentCourse.lessons.forEach((lesson) => {
            const lessonNumber = lesson.id;
            const isCompleted = completedLessons.includes(lessonNumber);
            const isCurrent = lessonNumber === currentLesson;
            const isAccessible = lessonNumber <= (enrolledCourse?.currentLesson || 1);

            const lessonItem = document.createElement('div');
            lessonItem.className = `lesson-item ${isCurrent ? 'active' : ''} ${isCompleted ? 'completed' : ''}`;

            let statusIcon, statusClass;
            if (isCompleted) {
                statusIcon = '<i class="fas fa-check"></i>';
                statusClass = 'completed';
            } else if (isCurrent) {
                statusIcon = lessonNumber;
                statusClass = 'current';
            } else if (isAccessible) {
                statusIcon = lessonNumber;
                statusClass = ''; // Accessible but not current/completed
            } else {
                statusIcon = '<i class="fas fa-lock"></i>';
                statusClass = 'locked';
            }

            lessonItem.innerHTML = `
                <div class="lesson-status ${statusClass}">${statusIcon}</div>
                <div class="lesson-details">
                    <div class="lesson-title">${lesson.title}</div>
                    <div class="lesson-duration">${lesson.duration}</div>
                </div>
            `;

            if (isAccessible) {
                lessonItem.style.cursor = 'pointer';
                lessonItem.addEventListener('click', () => {
                    if (lessonNumber !== currentLesson) {
                        loadLesson(lessonNumber);
                        courseSidebar.classList.remove('active'); // Close on mobile navigation
                    }
                });
            } else {
                lessonItem.style.opacity = '0.5';
                lessonItem.style.cursor = 'not-allowed';
            }

            container.appendChild(lessonItem);
        });

        // Add the final certificate page link
        if (enrolledCourse?.progress === 100) {
            const finalItem = document.createElement('div');
            finalItem.className = `lesson-item ${currentLesson === totalLessons + 1 ? 'active' : ''}`;
            finalItem.style.borderLeftColor = 'var(--success-color)';
            finalItem.innerHTML = `
                <div class="lesson-status completed" style="background: var(--success-color);"><i class="fas fa-certificate"></i></div>
                <div class="lesson-details">
                    <div class="lesson-title" style="color: var(--success-color); font-weight: 700;">Final Exam/Certificate</div>
                    <div class="lesson-duration">Your Course GP is Ready</div>
                </div>
            `;
            finalItem.style.cursor = 'pointer';
            finalItem.addEventListener('click', () => {
                loadLesson(totalLessons + 1);
                courseSidebar.classList.remove('active'); // Close on mobile navigation
            });
            container.appendChild(finalItem);
        }
    }

    function loadLesson(lessonNumber) {
        currentLesson = lessonNumber;
        quizPassed = false; // Reset quiz state for the new lesson

        // Update URL without reloading
        const newUrl = new URL(window.location);
        newUrl.searchParams.set('lesson', lessonNumber);
        window.history.pushState({}, '', newUrl);

        // Hide all main content elements first
        document.getElementById('finalCoursePage').style.display = 'none';
        document.getElementById('contentHeader').style.display = 'flex';
        document.getElementById('lessonNavigation').style.display = 'flex';
        const contentCard = document.querySelector('.content-card');
        const quizContainer = document.getElementById('quizContainer');
        const mediaPlayer = document.getElementById('mediaPlayer');

        contentCard.style.display = 'block';
        mediaPlayer.style.display = 'flex';

        if (currentLesson === totalLessons + 1) {
            // Final Page Logic
            document.getElementById('contentHeader').style.display = 'none';
            document.getElementById('lessonNavigation').style.display = 'none';
            document.getElementById('finalCoursePage').style.display = 'block';
            contentCard.style.display = 'none';
            quizContainer.style.display = 'none';
            mediaPlayer.style.display = 'none';

            updateOverallProgress(); // Refresh GP
        } else {
            // Lesson Page Logic
            const lesson = currentCourse.lessons.find(l => l.id === lessonNumber);
            if (!lesson) return;

            // Update header
            document.getElementById('lessonTitle').textContent = lesson.title;
            document.getElementById('lessonDuration').textContent = lesson.duration;
            document.getElementById('currentLessonNumber').textContent = lessonNumber;
            document.getElementById('totalLessons').textContent = totalLessons;
            document.getElementById('lessonPoints').textContent = '10';
            document.getElementById('markCompleteBtn').style.display = 'none';

            // Update navigation
            document.getElementById('navCurrentLesson').textContent = lessonNumber;
            document.getElementById('navTotalLessons').textContent = totalLessons;

            // Update content
            document.getElementById('lessonContent').innerHTML = lesson.content;

            // Update media player
            const mediaPlaceholderText = document.getElementById('mediaPlaceholderText');
            if (currentCourse.mediaType === 'audio') {
                mediaPlayer.innerHTML = `
                    <audio controls style="width:100%; height: auto; outline:none; border-radius:10px; box-shadow:0 0 8px var(--cyan-glow);">
                        <source src="university/generic_audio.mp3" type="audio/mpeg">
                        Your browser does not support the audio element.
                    </audio>
                `;
                mediaPlaceholderText.textContent = 'Audio content for this lesson is available above.';
            } else {
                mediaPlayer.innerHTML = `
                <div class="media-placeholder">
                    <i class="fas fa-play-circle"></i>
                    <p id="mediaPlaceholderText">Video content coming soon</p>
                    <p style="font-size: 0.9rem; opacity: 0.7;">For now, please read the lesson content below</p>
                </div>
                `;
                mediaPlaceholderText.textContent = 'Video content coming soon';
            }

            // Render Quiz
            const enrolledCourse = userData.enrolledCourses?.find(c => c.courseId === courseId);
            const isCompleted = enrolledCourse?.completedLessons?.includes(currentLesson);

            if (lesson.quiz) {
                quizContainer.style.display = 'block';
                renderQuiz(lesson.quiz, isCompleted);
            } else {
                quizContainer.style.display = 'none';
            }
        }

        // Update navigation buttons and state
        updateNavigationControls();

        // Update sidebar
        renderLessonsList();

        // Scroll to top
        window.scrollTo(0, 0);
    }

    function updateNavigationControls() {
        const prevBtn = document.getElementById('prevLessonBtn');
        const nextBtn = document.getElementById('nextLessonBtn');
        const enrolledCourse = userData.enrolledCourses?.find(c => c.courseId === courseId);
        const isCompleted = enrolledCourse?.completedLessons?.includes(currentLesson);
        const isCourseFullyCompleted = enrolledCourse?.progress === 100;

        // Previous Button Logic
        prevBtn.disabled = currentLesson <= 1;

        // Next Button Logic
        if (currentLesson === totalLessons) {
            nextBtn.textContent = 'Final Exam/Certificate';
            // Enable only if all lessons are completed (progress 100%)
            nextBtn.disabled = !isCourseFullyCompleted && !isCompleted; // Use isCompleted as a fallback if progress hasn't updated immediately
        } else if (currentLesson === totalLessons + 1) {
            // On Final Page, next is always disabled
            nextBtn.textContent = 'Course Completed';
            nextBtn.disabled = true;
        } else if (isCompleted || quizPassed) {
            nextBtn.textContent = 'Next Lesson';
            nextBtn.disabled = false;
        } else {
            nextBtn.textContent = 'Pass Quiz to Unlock';
            nextBtn.disabled = true;
        }
    }

    // --- QUIZ LOGIC (Updated to include animation/feedback) ---

    function renderQuiz(quizData, isLessonCompleted) {
        const quizQuestionsContainer = document.getElementById('quizQuestions');
        quizQuestionsContainer.innerHTML = '';
        document.getElementById('quizResult').innerHTML = ''; // Clear result area

        // Hide submit button if lesson is already completed
        const submitBtn = document.getElementById('submitQuizBtn');
        submitBtn.style.display = isLessonCompleted ? 'none' : 'block';

        quizData.forEach((q, index) => {
            const questionElement = document.createElement('div');
            questionElement.className = 'quiz-question-wrapper';
            questionElement.style.marginBottom = '2rem'; // Separating questions

            questionElement.innerHTML = `
                <div class="quiz-question">Question ${index + 1}: ${q.question}</div>
                <div class="quiz-options" data-question-index="${index}">
                    ${q.type === 'mcq' ? q.options.map(option => `
                        <div class="quiz-option" data-answer="${option}" ${isLessonCompleted ? 'style="cursor: default;"' : ''}>${option}</div>
                    `).join('') : ''}
                    ${q.type === 'text' ? `
                        <input type="text" class="text-input-answer" placeholder="Type your answer here..." style="width: 100%; padding: 1rem; border-radius: 8px; border: 2px solid rgba(0, 255, 255, 0.3); background: rgba(0, 0, 0, 0.5); color: var(--text-color); font-size: 1rem;" ${isLessonCompleted ? 'disabled' : ''}>
                    ` : ''}
                </div>
            `;
            quizQuestionsContainer.appendChild(questionElement);
        });

        // Add event listeners for MCQ selection only if not completed
        if (!isLessonCompleted) {
            quizQuestionsContainer.querySelectorAll('.quiz-option').forEach(option => {
                option.addEventListener('click', function () {
                    const optionsGroup = this.closest('.quiz-options');
                    // Deselect all others in the group
                    optionsGroup.querySelectorAll('.quiz-option').forEach(opt => opt.classList.remove('selected', 'correct', 'incorrect'));
                    // Select the clicked one
                    this.classList.add('selected');
                });
            });
        } else {
            // If completed, visually mark the correct answer on load
            quizData.forEach((q, index) => {
                const optionsGroup = document.querySelector(`.quiz-options[data-question-index="${index}"]`);
                if (q.type === 'mcq') {
                    // Mark the correct answer
                    optionsGroup.querySelector(`.quiz-option[data-answer="${q.answer}"]`)?.classList.add('correct');
                } else if (q.type === 'text') {
                    const input = optionsGroup.querySelector(`.text-input-answer`);
                    input.value = q.answer;
                    input.style.border = `2px solid var(--success-color)`;
                }
            });
            document.getElementById('quizResult').innerHTML = `<div class="quiz-feedback correct"><i class="fas fa-check-circle"></i> **Lesson Already Completed!** You may move to the next lesson.</div>`;
            quizPassed = true;
            updateNavigationControls();
        }
    }

    document.getElementById('submitQuizBtn').addEventListener('click', () => {
        const lesson = currentCourse.lessons.find(l => l.id === currentLesson);
        const quizData = lesson.quiz;
        let allCorrect = true;
        let score = 0;

        // Reset and evaluate
        quizData.forEach((q, index) => {
            const optionsGroup = document.querySelector(`.quiz-options[data-question-index="${index}"]`);
            let isCorrect = false;

            if (q.type === 'mcq') {
                const selectedOption = optionsGroup.querySelector('.quiz-option.selected');

                // Clear all previous result classes and animation classes first
                optionsGroup.querySelectorAll('.quiz-option').forEach(opt => opt.classList.remove('correct', 'incorrect'));

                if (selectedOption) {
                    if (selectedOption.dataset.answer === q.answer) {
                        isCorrect = true;
                        selectedOption.classList.add('correct');
                    } else {
                        selectedOption.classList.add('incorrect');
                        // Highlight the correct answer
                        optionsGroup.querySelector(`.quiz-option[data-answer="${q.answer}"]`).classList.add('correct');
                    }
                } else {
                    // User did not select an answer, fail and highlight correct answer
                    optionsGroup.querySelector(`.quiz-option[data-answer="${q.answer}"]`)?.classList.add('correct');
                }
            } else if (q.type === 'text') {
                const input = optionsGroup.querySelector('.text-input-answer');
                const userAnswer = input.value.trim().toLowerCase();
                const correctAnswer = q.answer.trim().toLowerCase();

                if (userAnswer === correctAnswer) {
                    isCorrect = true;
                    input.style.border = `2px solid var(--success-color)`;
                } else {
                    input.style.border = `2px solid var(--error-color)`;
                    // Note: No easy way to show correct text answer without disrupting the UI, just show error
                }
            }

            if (isCorrect) {
                score++;
            } else {
                allCorrect = false;
            }
        });

        const quizResultElement = document.getElementById('quizResult');
        const totalQuestions = quizData.length;

        if (allCorrect) {
            quizResultElement.innerHTML = `
                <div class="quiz-feedback correct">
                    <i class="fas fa-check-circle"></i> **Perfect Score!** You got ${score}/${totalQuestions} correct. Lesson unlocked!
                </div>
            `;
            // All correct! Mark lesson complete and show modal.
            markLessonComplete();
            document.getElementById('submitQuizBtn').style.display = 'none'; // Hide submit after passing
        } else {
            quizResultElement.innerHTML = `
                <div class="quiz-feedback incorrect">
                    <i class="fas fa-times-circle"></i> **Incorrect Answers.** Score: ${score}/${totalQuestions}. Please review the lesson and try again.
                </div>
            `;
            // Disable navigation controls if quiz failed
            quizPassed = false;
            updateNavigationControls();
        }
    });

    // --- END QUIZ LOGIC ---


    // Event Listeners
    document.getElementById('prevLessonBtn').addEventListener('click', () => {
        if (currentLesson === totalLessons + 1) {
            loadLesson(totalLessons); // Back from final page to last lesson
        } else if (currentLesson > 1) {
            loadLesson(currentLesson - 1);
        }
    });

    document.getElementById('nextLessonBtn').addEventListener('click', () => {
        if (currentLesson < totalLessons) {
            // This is only enabled if the lesson is completed/quiz is passed
            loadLesson(currentLesson + 1);
        } else if (currentLesson === totalLessons) {
            // Go to final page (Only enabled if progress is 100)
            const enrolledCourse = userData.enrolledCourses?.find(c => c.courseId === courseId);
            if (enrolledCourse?.progress === 100 || enrolledCourse?.completedLessons?.includes(totalLessons)) {
                loadLesson(currentLesson + 1);
            }
        }
    });

    document.getElementById('continueBtn').addEventListener('click', () => {
        document.getElementById('completionModal').style.display = 'none';
        if (currentLesson < totalLessons) {
            loadLesson(currentLesson + 1);
        } else if (currentLesson === totalLessons) {
            loadLesson(currentLesson + 1); // Go to the final certificate page
        }
    });

    // Corrected Dashboard Redirect
    document.getElementById('backToDashboardBtn').addEventListener('click', () => {
        window.location.href = 'studyingatelvion.html';
    });

    async function markLessonComplete() {
        try {
            const enrolledCourseIndex = userData.enrolledCourses.findIndex(c => c.courseId === courseId);
            if (enrolledCourseIndex === -1) return;

            const enrolledCourse = userData.enrolledCourses[enrolledCourseIndex];

            // Check for double completion (to prevent point inflation)
            if (enrolledCourse.completedLessons?.includes(currentLesson)) {
                // Already completed, just update session state and show modal
                quizPassed = true;
                updateNavigationControls();
                document.getElementById('pointsEarned').textContent = '0 (Already earned)';
                document.getElementById('completionModal').style.display = 'flex';
                return;
            }

            // Add to completed lessons
            if (!enrolledCourse.completedLessons) {
                enrolledCourse.completedLessons = [];
            }
            enrolledCourse.completedLessons.push(currentLesson);

            // Update current lesson access: currentLesson + 1
            enrolledCourse.currentLesson = Math.max(enrolledCourse.currentLesson || 1, currentLesson + 1);

            // Calculate progress
            const completedCount = enrolledCourse.completedLessons.length;
            enrolledCourse.progress = Math.round((completedCount / totalLessons) * 100);

            // Update user data: GP/Points logic is here
            userData.enrolledCourses[enrolledCourseIndex] = enrolledCourse;
            userData.completedLessons = (userData.completedLessons || 0) + 1;
            userData.totalPoints = (userData.totalPoints || 0) + 10; // 10 points per lesson

            // Save to database
            await updateDoc(doc(db, 'users', currentUser.uid), {
                enrolledCourses: userData.enrolledCourses,
                completedLessons: userData.completedLessons,
                totalPoints: userData.totalPoints
            });

            // Update UI
            updateOverallProgress();
            renderLessonsList();

            // Mark Quiz as passed for this session
            quizPassed = true;
            updateNavigationControls();

            // Show completion modal
            document.getElementById('pointsEarned').textContent = '10';
            document.getElementById('completionModal').style.display = 'flex';

        } catch (error) {
            console.error('Error marking lesson complete:', error);
            alert('Error updating progress. Please try again.');
        }
    }

    // Initialize stars (outside of DOMContentLoaded to be safe with module imports)
    document.addEventListener('DOMContentLoaded', () => {
        const starsContainer = document.getElementById('stars-container');
        const numStars = 100;
        const minSize = 1;
        const maxSize = 3;
        for (let i = 0; i < numStars; i++) {
            const star = document.createElement('div');
            star.className = 'star';
            const size = Math.random() * (maxSize - minSize) + minSize;
            star.style.width = `${size}px`;
            star.style.height = `${size}px`;
            star.style.left = `${Math.random() * 100}%`;
            star.style.top = `${Math.random() * 100}%`;
            star.style.animationDelay = `${Math.random() * 4}s`;
            star.style.animationDuration = `${3 + Math.random() * 2}s`;
            starsContainer.appendChild(star);
        }
    });

</script>                                                                                                                
                                                    
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-J1YTKP10ZX"></script>
<script>
 window.dataLayer = window.dataLayer || [];
 function gtag(){dataLayer.push(arguments);}
 gtag('js', new Date()); 

 gtag('config', 'G-J1YTKP10ZX');
</script>
