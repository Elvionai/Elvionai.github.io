<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Profile â€” Elvion AI</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover">
  <meta name="description" content="Elvion AI Fullscreen Chat & Profile">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Orbitron:wght@700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --cyan: #00ffff;
      --blue: #0090ff;
      --bg: #191a26; --card: #181e2e; --radius: 19px;
      --input-glow: 0 2px 10px #00ffff4a;
      --text: #e0e0e0;
      --muted: #b3b3b3;
      --anim-bg: radial-gradient(circle, #23233a 68%, #0a1128 100%);
    }
    html, body {
      width:100vw; height:100vh; margin:0; padding:0;
      font-family: 'Inter', sans-serif; background:var(--anim-bg); color:var(--text);
      overflow: hidden;
    }
    #stars-container {position:fixed;top:0;left:0;pointer-events:none;width:100vw;height:100vh;z-index:0;}
    .star {position: absolute;background:rgba(255,255,255,0.7);border-radius:50%;opacity:.13;animation:twinkle 5s infinite linear;}
    @keyframes twinkle {0%,100%{opacity:.13;}50%{opacity:.93;}}
    .profile-container {
      position:fixed;top:0;left:0;width:100vw;height:100vh;min-height:100vh;max-height:100dvh;overflow:hidden;
      display:flex;flex-direction:column;align-items:center;justify-content:stretch;
      background:transparent;z-index:2;
    }
    .menu-bar {
      display:flex;justify-content:space-between;align-items:center;width:100%;padding:14px 0 0 0;
      max-width:520px;margin:0 auto 10px auto;
    }
    .menu-btn {background:none;border:none;color:var(--cyan);font-size:2em;cursor:pointer;padding:3px 15px;border-radius:14px;}
    .menu-btn:hover{background:var(--cyan);color:#23233a;}
    .profile-header {display:flex;flex-direction:column;align-items:center;gap:6px;)
    .logo-img {width:55px;height:55px;border-radius:50%;background:#fff;object-fit:cover;animation:logoPulse 3.2s infinite alternate,floatLogo 3.3s infinite alternate;}
    @keyframes logoPulse {0%{box-shadow:0 0 14px #00e2ff,0 0 23px #70fff7;}100%{box-shadow:0 0 15px #007c97,0 0 28px #00ceff60;}}
    @keyframes floatLogo {0%{transform:translateY(0);}100%{transform:translateY(-7px);}}
    .site-heading {font-family:'Orbitron',sans-serif;font-size:1.16em;font-weight:800;letter-spacing:.5px;background:linear-gradient(90deg,#00ffff,#fff,#0090ff);background-size:200% auto;-webkit-background-clip:text;-webkit-text-fill-color:transparent;animation:shine 4s linear infinite;text-shadow:0 0 18px #00ffff44;}
    @keyframes shine {to{background-position:200% center;}}
    .profile-greet{color:#aee;font-size:.93em;text-align:center;padding-bottom:7px;}
    /* Full Height Chat Card */
    .chat-card{
      flex:1; min-height:0;
      display:flex;flex-direction:column;align-items:center;justify-content:stretch;background:var(--bg);width:100vw;max-width:520px;border-radius:var(--radius);box-shadow:0 8px 34px #00fff212;
      margin-bottom:0;border:1.6px solid #161f3c69;
    }
    #chatSwitchBar {display:flex;align-items:center;gap:7px;width:96%;margin:.2em auto .2em auto;}
    #chatSelector{padding:8px 14px;border-radius:9px 13px 13px 9px;border:1.5px solid #00ffff;font-size:1em;background:#19192a;color:#e0e0e0;}
    #newChatBtn{padding:5px 12px;border-radius:13px;background:linear-gradient(95deg,#00ffff 65%,#0090ff 100%);font-family:'Orbitron';font-size:1em;color:#23233a;font-weight:600;border:none;box-shadow:0 0 11px #00fff2c7;}
    #delChatBtn{padding:4px 9px;background:none;border:none;color:#ffd500aa;border-radius:7px;font-size:1.3em;cursor:pointer;}
    #delChatBtn:hover{color:#ff3131;background:#23233a;}
    .chat-box{flex:1;overflow-y:auto;background:transparent;max-width:99vw;width:97.5%;padding:10px 9px 2px 12px;border-radius:17px;}
    .chat-message{display:flex;align-items:flex-end;gap:10px;}
    .chat-message.user{justify-content:flex-end;}
    .chat-message .msg{background:linear-gradient(90deg,#222e34 75%,#222 100%);color:#e0e0e0;padding:9px 14px;border-radius:14px 14px 10px 13px;max-width:78%;font-size:1.08em;}
    .chat-message.user .msg{background:linear-gradient(90deg,#00ffff 65%,#0090ff 100%);color:#23233a;border-radius:14px 15px 14px 10px;font-weight:700;}
    .chat-message img,.chat-message video{max-width:110px;max-height:120px;border-radius:8px;margin-top:2px;background:#fff;}
    .chat-typing{color:#00ffff;font-size:1.19em;display:flex;align-items:center;gap:7px;margin:.5em 0 0 .3em;}
    .typing-loader{display:inline-block;width:40px;text-align:left;}
    .typing-loader span{display:inline-block;width:9px;height:9px;margin-right:4px;background:#00ffff;border-radius:50%;animation:bounce 1.3s infinite;}
    .typing-loader span:nth-child(2){animation-delay:.16s;}
    .typing-loader span:nth-child(3){animation-delay:.33s;}
    @keyframes bounce {
      0%,100%{transform:translateY(0);}
      33%{transform:translateY(-11px);}
      66%{transform:translateY(0);}
    }
    .file-preview{max-width:98vw;margin:11px 0 0 2px;border-radius:9px;overflow:hidden;background:rgba(35,35,58,.6);border:1px solid rgba(255,255,255,0.17);}
    .file-preview img,.file-preview video{max-width:95vw;max-height:115px;display:block;margin:0 auto;}
    .file-preview .file-info{padding:7px;display:flex;align-items:center;font-size:.95em;color:var(--muted);}
    .file-preview .file-info i{margin-right:6px;}
    .chat-input-row{width:97%;display:flex;gap:7px;align-items:center;background:#23233a;border-radius:12px;padding:8px 8px;border:1px solid rgba(0,255,255,.11);box-shadow:var(--input-glow);}
    .chat-input-row input[type="file"]{display:none;}
    .chat-input-row label{cursor:pointer;color:var(--cyan);font-size:1.2em;padding:0 6px;}
    .chat-input-row label:hover{color:var(--blue);}
    .chat-input-row input[type="text"]{flex:1;padding:10px 6px;border-radius:13px;border:1.1px solid #23233a;background:#23233a;color:#e0e0e0;font-size:1em;}
    .chat-input-row input[type="text"]:focus{border:1.3px solid var(--cyan);box-shadow:var(--input-glow);}
    .chat-input-row button{background:linear-gradient(90deg,#00ffff,#0090ff);color:#23233a;border:none;border-radius:11px;padding:9px 15px;font-size:1.12em;font-weight:700;cursor:pointer;box-shadow:0 2px 8px #00ffff33;}
    .chat-input-row button:hover{background:#0090ff;color:#fff;}
    .status-message{color:#ffd700;font-size:.97em;text-align:center;min-height:17px;}
    /* Modal panels */
    .panel-bg{display:none;position:fixed;z-index:201;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.59);}
    .panel-bg.active{display:flex;}
    .side-panel{background:var(--card);width:99vw;max-width:335px;height:100vh;box-shadow:-2px 0 32px #00ffffef;display:flex;flex-direction:column;transition:transform .15s;overflow-y:auto;transform:translateX(340px);}
    .side-panel.active{transform:translateX(0);}
    .panel-header{display:flex;flex-direction:column;align-items:center;padding:25px 0 10px 0;}
    .panel-header img{width:44px;height:44px;border-radius:55%;object-fit:cover;}
    .panel-header .username{font-weight:800;font-size:1em;color:var(--cyan);}
    .panel-header .email{font-size:.93em;color:var(--muted);}
    .edit-form{display:flex;flex-direction:column;gap:10px;}
    .edit-form label{color:#00ffff;font-size:.92em;margin-bottom:2px;}
    .edit-form input{border:none;border-bottom:2px solid #23233a;background:#181d2c;color:#eee;font-size:.98em;padding:7px 4px 7px 9px;margin-bottom:3px;border-radius:8px;}
    .edit-form input:focus{border-color:#00ffff;background:#23233a;}
    .profile-photo-tip{color:#b3b3b3;font-size:.91em;margin-bottom:4px;}
    .panel-links{display:flex;flex-direction:column;gap:1px;margin-bottom:15px;margin-top:9px;align-items:flex-start;}
    .panel-links a{color:var(--text);text-decoration:none;font-weight:700;font-size:1.02em;padding:8px 15px 8px 13px;border-radius:0 13px 13px 0;transition:background .1s;color .12s;background:#1d2031;}
    .panel-links a:hover{background:var(--cyan);color:#23233a;}
    @media(max-width:600px){
      .profile-container,.chat-card{height:100vh;max-width:100vw;width:100vw;border-radius:0;}
      .chat-input-row{width:98vw;}
    }
  </style>
</head>
<body>
<div id="stars-container"></div>
<div class="profile-container">
  <div class="menu-bar">
    <button class="menu-btn" id="openProfileMenu"><i class="fa-solid fa-user"></i></button>
    <button class="menu-btn" id="openLinksMenu"><i class="fa-solid fa-link"></i></button>
  </div>
  <div class="profile-header">
    <img id="profilePic" src="https://i.ibb.co/YTkKPfvf/IMG-20250715-102103-129.jpg" class="logo-img" alt="Elvion AI logo">
    <div class="site-heading">Elvion AI</div>
    <div class="profile-greet" id="greetMsg">Welcome!</div>
  </div>
  <div class="chat-card">
    <div id="chatSwitchBar">
      <select id="chatSelector"></select>
      <button id="newChatBtn">New Chat</button>
      <button id="delChatBtn" title="Delete this chat"><i class="fa-solid fa-trash"></i></button>
    </div>
    <div class="chat-box" id="chatBox"></div>
    <div id="typingMsg" class="chat-typing" style="display:none;">
      <span class="typing-loader"><span></span><span></span><span></span></span>
    </div>
    <div id="filePreview" class="file-preview" style="display:none;"></div>
    <form class="chat-input-row" id="chatForm" autocomplete="off">
      <label for="chatFile"><i class="fa-solid fa-paperclip"></i></label>
      <input type="file" id="chatFile" accept="*">
      <input type="text" id="chatInput" placeholder="Type or record...">
      <button type="submit"><i class="fa-solid fa-paper-plane"></i></button>
      <button type="button" id="voiceInputBtn" title="Record voice" style="margin-left:7px;"><i class="fa-solid fa-microphone"></i></button>
    </form>
    <div class="status-message" id="statusMsg"></div>
  </div>
</div>
<!-- Profile and Link Modals â€” as before, see earlier code (identical) -->
<!-- ...ProfileMenuBg, profileMenu, LinkMenuBg, linkMenu... -->
<!-- Insert modal code from above response for brevity -->
<script type="module">
  // Star bg
  document.addEventListener('DOMContentLoaded',()=>{
    const starsContainer=document.getElementById('stars-container');
    for(let i=0;i<52;i++){
      const star=document.createElement('div');star.className='star';
      const z=Math.random()*2.22+1;star.style.width=z+'px';star.style.height=z+'px';
      star.style.left=Math.random()*100+'%';star.style.top=Math.random()*100+'%';
      star.style.animationDelay=(Math.random()*3.8)+'s';star.style.animationDuration=(2.5+Math.random()*1.7)+'s';
      starsContainer.appendChild(star);}
  });
  // Modals
  const profileMenuBg=document.getElementById('profileMenuBg'),profileMenu=document.getElementById('profileMenu');
  const linkMenuBg=document.getElementById('linkMenuBg'),linkMenu=document.getElementById('linkMenu');
  document.getElementById('openProfileMenu').onclick=()=>{profileMenuBg.classList.add('active');setTimeout(()=>profileMenu.classList.add('active'),10);}
  profileMenuBg.onclick=e=>{if(e.target===profileMenuBg){profileMenu.classList.remove('active');setTimeout(()=>profileMenuBg.classList.remove('active'),160);}};
  document.getElementById('openLinksMenu').onclick=()=>{linkMenuBg.classList.add('active');setTimeout(()=>linkMenu.classList.add('active'),10);}
  linkMenuBg.onclick=e=>{if(e.target===linkMenuBg){linkMenu.classList.remove('active');setTimeout(()=>linkMenuBg.classList.remove('active'),160);}};
  document.getElementById('logoutBtn').onclick=()=>window.location.href='signup-login.html';
  // Firebase profile
  import {initializeApp} from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
  import {getAuth,onAuthStateChanged,updateProfile} from "https://www.gstatic.com/firebasejs/10.12.4/firebase-auth.js";
  const firebaseConfig={apiKey:"AIzaSyAyROm0aBGjry6NUfhNM3e0qwPcCDoIqSk",authDomain:"elvionai.firebaseapp.com",projectId:"elvionai",storageBucket:"elvionai.firebasestorage.app",messagingSenderId:"161078300830",appId:"1:161078300830:web:f460df8591704eb0e96b8f"};
  const app=initializeApp(firebaseConfig);const auth=getAuth(app);
  let currentUser;
  onAuthStateChanged(auth, user=>{
    if(!user)window.location.href="signup-login.html";
    else{
      currentUser=user;
      document.getElementById("greetMsg").textContent="Welcome, "+(user.displayName||user.email.split('@')[0])+"!";
      document.getElementById("profilePic").src=user.photoURL||"https://i.ibb.co/YTkKPfvf/IMG-20250715-102103-129.jpg";
      document.getElementById("profileMenuUser").textContent=user.displayName||"User";
      document.getElementById("profileMenuEmail").textContent=user.email;
      document.getElementById("edit-name").value=user.displayName||"";
      document.getElementById("edit-photo").value=user.photoURL||"";
      document.getElementById("profilePicPreview").src=user.photoURL||"https://i.ibb.co/YTkKPfvf/IMG-20250715-102103-129.jpg";
    }
  });
  document.getElementById("edit-photo").oninput=function(){
    document.getElementById("profilePicPreview").src=this.value||"https://i.ibb.co/YTkKPfvf/IMG-20250715-102103-129.jpg";
  };
  document.getElementById("profileForm").onsubmit=async function(e){
    e.preventDefault();
    if(!currentUser)return;
    const status=document.getElementById("profileStatusMsg"); status.textContent='';
    const name=document.getElementById("edit-name").value.trim();
    const photoURL=document.getElementById("edit-photo").value.trim();
    try{
      await updateProfile(currentUser,{displayName:name,photoURL});
      await auth.currentUser.reload();
      document.getElementById("profilePic").src=auth.currentUser.photoURL||"https://i.ibb.co/YTkKPfvf/IMG-20250715-102103-129.jpg";
      status.textContent="Profile updated!";
      status.style.color="#00ffff";
      setTimeout(()=>{profileMenu.classList.remove('active');profileMenuBg.classList.remove('active');}, 650);
      document.getElementById("greetMsg").textContent="Welcome, "+(auth.currentUser.displayName||auth.currentUser.email.split('@')[0])+"!";
    }catch(err){
      status.textContent=err.message||"Update failed";
      status.style.color="#ffd700";
    }
  };
  // Chat management
  let chats=JSON.parse(localStorage.getItem("elvion_chats")||"[]");
  let currentChatIdx=chats.length-1>=0?chats.length-1:0;
  function saveChats(){localStorage.setItem("elvion_chats",JSON.stringify(chats));}
  function renderChatSelector(){
    const chatSelector=document.getElementById("chatSelector");
    chatSelector.innerHTML="";
    chats.forEach((chat,idx)=>{
      const option=document.createElement("option");
      option.value=idx;option.textContent=chat.name||(chat.history?.[0]?.text?.slice(0,20)||"Untitled");
      chatSelector.appendChild(option);
    });
    chatSelector.value=currentChatIdx;
  }
  document.getElementById("chatSelector").onchange=function(){currentChatIdx=parseInt(this.value)||0;renderChatBox(chats[currentChatIdx]?.history);}
  function loadChat(idx){currentChatIdx=idx||0;renderChatBox(chats[idx]?.history);}
  function renderChatBox(messages){
    const cb=document.getElementById("chatBox");cb.innerHTML="";
    (messages||[]).forEach(msg=>{
      const div=document.createElement('div');
      div.className="chat-message "+(msg.role==="user"?"user":"ai");
      div.innerHTML=`<div class="msg">${msg.text}</div>`;
      cb.appendChild(div);
    });
    cb.scrollTop=cb.scrollHeight;
  }
  document.getElementById("newChatBtn").onclick=function(){
    const name="Chat "+(chats.length+1);
    chats.push({name,history:[]});
    currentChatIdx=chats.length-1;
    saveChats();renderChatSelector();loadChat(currentChatIdx);
  };
  // Delete current chat
  document.getElementById("delChatBtn").onclick=function(){
    if(!chats.length)return;
    if(!confirm("Delete this chat?"))return;
    chats.splice(currentChatIdx,1);
    if(currentChatIdx>=chats.length)currentChatIdx=chats.length-1;
    saveChats();renderChatSelector();loadChat(currentChatIdx);
  };
  // Animate typing
  function showTyping(waiting){document.getElementById("typingMsg").style.display=waiting?"":"none";}
  // Chat, file+text POST
  document.getElementById("chatForm").onsubmit=async function(e){
    e.preventDefault();
    const chatInput=document.getElementById("chatInput");
    const file=document.getElementById("chatFile").files[0];
    const msgText=chatInput.value.trim();
    if(currentChatIdx<0){chats.push({name:"Chat 1",history:[]});currentChatIdx=0;}
    if(file){
      // show in preview only, not chat, until sent
      let fp=document.getElementById("filePreview");
      fp.style.display="block";
      if(file.type.startsWith("image/")){
        const reader=new FileReader();
        reader.onload=e=>{fp.innerHTML=`<img src="${e.target.result}">`;};
        reader.readAsDataURL(file);
      }else if(file.type.startsWith("video/")){
        const reader=new FileReader();
        reader.onload=e=>{fp.innerHTML=`<video src="${e.target.result}" controls></video>`;};
        reader.readAsDataURL(file);
      }else{
        fp.innerHTML=`<div class="file-info"><i class="fa-solid fa-file"></i> ${file.name}</div>`;
      }
      if(msgText===""){return;} // Wait for user to type a caption if desired
      // When form is actually submitted, POST file
      showTyping(true);
      const formData=new FormData();
      formData.append("file",file);
      formData.append("message",msgText);
      formData.append("user_id","user");
      const res=await fetch("https://web-production-9a18.up.railway.app/upload-file",{method:"POST",body:formData});
      const data=await res.json();
      chats[currentChatIdx].history.push({role:"user",text:"[File] "+(msgText||file.name)});
      chats[currentChatIdx].history.push({role:"ai",text:data.response||"ðŸ¤– Bot (file) reply."});
      chatInput.value="";
      document.getElementById("chatFile").value="";
      fp.style.display="none";
      saveChats();renderChatSelector();renderChatBox(chats[currentChatIdx].history);
      showTyping(false);
      return;
    }
    if(msgText){
      chats[currentChatIdx].history.push({role:"user",text:msgText});
      if(chats[currentChatIdx].history.length===1){
        chats[currentChatIdx].name=msgText.slice(0,25)+"..."; renderChatSelector();
      }
      renderChatBox(chats[currentChatIdx].history);saveChats();showTyping(true);
      try{
        const history=chats[currentChatIdx].history.map(m=>({role:m.role,content:m.text}));
        const res=await fetch("https://web-production-9a18.up.railway.app/chat",{method:"POST",headers:{'Content-Type':'application/json'},body:JSON.stringify({message:msgText,user_id:"user",history})});
        const data=await res.json();
        chats[currentChatIdx].history.push({role:"ai",text:data.response||"ðŸ¤– Bot replied."});
        saveChats();renderChatSelector();renderChatBox(chats[currentChatIdx].history);showTyping(false);
      }catch(err){
        showTyping(false);
        chats[currentChatIdx].history.push({role:"ai",text:"Sorry, bot error: "+err.message});
        renderChatBox(chats[currentChatIdx].history);saveChats();
      }
    }
    chatInput.value="";
  };
  // File preview (show on pick, only send when user hits send)
  document.getElementById("chatFile").onchange = function(){
    const file=this.files[0], fp=document.getElementById("filePreview");
    if(!file){fp.style.display="none";fp.innerHTML="";return;}
    fp.style.display='block';
    if(file.type.startsWith("image/")){
      const reader=new FileReader();
      reader.onload=e=>{fp.innerHTML=`<img src="${e.target.result}">`;};
      reader.readAsDataURL(file);
    }else if(file.type.startsWith("video/")){
      const reader=new FileReader();
      reader.onload=e=>{fp.innerHTML=`<video src="${e.target.result}" controls></video>`;};
      reader.readAsDataURL(file);
    }else{
      fp.innerHTML=`<div class="file-info"><i class="fa-solid fa-file"></i> ${file.name}</div>`;
    }
  };
  // Voice input
  let recognition;
  document.getElementById("voiceInputBtn").onclick=function(){
    if('webkitSpeechRecognition'in window){
      recognition=new webkitSpeechRecognition();
      recognition.continuous=false;recognition.interimResults=false;recognition.lang='en-US';
      document.getElementById("voiceInputBtn").innerHTML='<i class="fa-solid fa-microphone-lines"></i>';
      recognition.onresult=function(e){
        document.getElementById('chatInput').value+=e.results[0][0].transcript;
        document.getElementById("voiceInputBtn").innerHTML='<i class="fa-solid fa-microphone"></i>';
      };
      recognition.onend=function(){document.getElementById("voiceInputBtn").innerHTML='<i class="fa-solid fa-microphone"></i>';};
      recognition.onerror=function(){document.getElementById("voiceInputBtn").innerHTML='<i class="fa-solid fa-microphone"></i>';};
      recognition.start();
    }else{
      alert("Speech recognition not supported in your browser.");
    }
  };

  // Initial render
  renderChatSelector();loadChat(currentChatIdx);
</script>
</body>
</html>
