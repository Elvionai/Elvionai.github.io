<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>How to Craft Unforgettable Characters: A Writer's Guide | Elvion AI Blog</title>
    <meta name="description" content="Master the art of character creation with proven techniques to build compelling, three-dimensional characters that readers will love.">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Orbitron:wght@600;700;800;900&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* --- DUAL THEME VARIABLES (Default: DARK MODE) --- */
        :root {
            /* Elvion AI Cyan/Blue Theme */
            --dark-navy: #00001a;
            --bg-color: #0d1117; 
            --text-color: #e6edf3;
            --heading-color: #ffffff;
            --cyan-glow: #00ffff;
            --light-blue-glow: #00aaff; 
            --link-color: var(--cyan-glow);
            --link-hover-color: var(--light-blue-glow);
            --border-color: #21262d;
            --card-bg: #161b22; 
            --button-bg: linear-gradient(45deg, var(--cyan-glow), var(--light-blue-glow));
            --button-text-color: #0d1117; /* Dark text on bright button */
            --button-hover-bg: linear-gradient(45deg, #00d4d4, #0077ff);
            --navbar-bg: rgba(13, 17, 23, 0.95);
            --footer-bg: #0a0e14;
            --highlight-color: rgba(0, 255, 255, 0.3); 
            --comment-bg: #0d1117;
            --shadow-glow: 0 0 10px rgba(0, 255, 255, 0.15);
            /* New: Dark Mode Headline Color */
            --headline-color: var(--light-blue-glow);
        }

        /* LIGHT MODE VARIABLES */
        body.light-theme {
            --bg-color: #f7f7f7; /* Less whitish, slight off-white */
            --text-color: #333333;
            --heading-color: #111111;
            --link-color: #0056b3;
            --link-hover-color: #003d80;
            --border-color: #e0e0e0;
            --card-bg: #ffffff;
            --button-bg: #0056b3;
            --button-text-color: #ffffff;
            --button-hover-bg: #003d80;
            --navbar-bg: rgba(255, 255, 255, 0.95);
            --footer-bg: #eeeeee;
            --highlight-color: #ffeb3b; 
            --comment-bg: #ffffff;
            --shadow-glow: none;
            /* New: Light Mode Headline Color */
            --headline-color: #111111; /* Black headline */
        }

        /* --- GLOBAL STYLES --- */
        html { scroll-behavior: smooth; }

        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding-top: 60px;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.8;
            font-size: 1.1rem;
            overflow-x: hidden;
            transition: background-color 0.3s, color 0.3s;
        }

        h1, h2, h3, h4 {
            font-family: 'Orbitron', sans-serif;
            color: var(--heading-color);
            margin-top: 0;
            line-height: 1.3;
            text-shadow: var(--shadow-glow);
        }
        
        a {
            color: var(--link-color);
            text-decoration: none;
            transition: color 0.3s ease;
        }

        a:hover {
            color: var(--link-hover-color);
            text-decoration: underline;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
        }
        
        .post-container {
             max-width: 800px;
             margin: 0 auto;
             padding: 0 1rem;
        }

        /* --- Navbar Styles (Existing) --- */
        .navbar {
            position: fixed; top: 0; width: 100%; 
            background: var(--navbar-bg); 
            padding: 1rem 0; z-index: 1000;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5); 
            border-bottom: 1px solid var(--border-color);
            backdrop-filter: blur(5px);
        }
        .navbar .container { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; }
        .navbar-brand { font-family: 'Orbitron', sans-serif; font-size: 1.8rem; font-weight: 700; color: var(--heading-color); text-shadow: var(--shadow-glow); }
        .nav-links { display: flex; list-style: none; margin: 0; padding: 0; }
        .nav-links li { margin-left: 2rem; }
        .nav-links a { 
            color: var(--text-color); font-weight: 500; font-family: 'Inter', sans-serif; font-size: 1rem;
            text-transform: uppercase; letter-spacing: 0.5px; padding: 0.5rem 0; position: relative; 
        }
        .nav-links .active-link { color: var(--link-color); }
        .nav-links a::after { 
            content: ''; position: absolute; width: 0; height: 2px; bottom: 0; left: 0; 
            background: var(--link-color); transition: width 0.3s ease-in-out; 
        }
        .nav-links a:hover::after, .nav-links .active-link::after { width: 100%; }
        
        .hamburger { display: none; flex-direction: column; cursor: pointer; padding: 0.5rem; background: transparent; border: none; }
        .hamburger .bar { 
            width: 25px; height: 3px; background-color: var(--heading-color); margin: 4px 0; transition: 0.4s; box-shadow: none; 
        }
        .hamburger.active .bar:nth-child(2) { opacity: 0; }
        .hamburger.active .bar:nth-child(1) { transform: translateY(7px) rotate(45deg); }
        .hamburger.active .bar:nth-child(3) { transform: translateY(-7px) rotate(-45deg); }
        
        #theme-toggle {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            color: var(--text-color);
            padding: 0.5rem;
            border-radius: 50%;
            cursor: pointer;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            margin-left: 1rem;
        }
        #theme-toggle:hover {
            border-color: var(--link-color);
            color: var(--link-color);
        }
        .nav-controls {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        /* --- Footer Styles (Existing) --- */
        .footer {
            background: var(--footer-bg); color: var(--text-color); padding: 4rem 0 2rem; font-size: 0.9rem;
            border-top: 1px solid var(--border-color); text-align: center; position: relative; margin-top: 4rem;
        }
        .footer .container {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 2rem;
            text-align: left;
            max-width: 900px;
        }
        .footer .col h4 {
            font-size: 1.1rem;
            margin-bottom: 1rem;
        }
        .footer ul {
            list-style: none;
            padding: 0;
        }
        .footer li {
            margin-bottom: 0.5rem;
        }
        .footer a {
            color: var(--text-color);
            font-size: 0.9rem;
        }
        .footer a:hover {
            color: var(--link-color);
            text-decoration: none;
        }
        .footer .brand-info {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--link-color);
        }
        .footer .legal-info { 
            grid-column: 1 / -1;
            text-align: center;
            margin-top: 2rem;
            border-top: 1px solid var(--border-color);
            padding-top: 1rem;
            color: #777; 
        }

        /* --- Single Post Styles --- */
        .post-main { padding-top: 3rem; padding-bottom: 3rem; position: relative; }
        .post-header { border-bottom: 1px solid var(--border-color); padding-bottom: 1.5rem; margin-bottom: 2rem; }
        .post-header .post-tag { 
            display: inline-block; padding: 0.4rem 1rem; background: var(--button-bg); 
            color: var(--button-text-color); font-weight: 700; font-size: 0.85rem; 
            border-radius: 20px; text-transform: uppercase; margin-bottom: 1rem;
            background-image: var(--button-bg); /* Apply gradient */
        }
        .post-meta {
            display: flex; flex-wrap: wrap; gap: 1.5rem; 
            color: rgba(224, 224, 224, 0.7); font-size: 0.95rem; margin-top: 1rem;
        }
        body.light-theme .post-meta { color: #666; }
        .post-meta span { display: flex; align-items: center; gap: 0.5rem; }
        .post-meta i { color: var(--link-color); }
        
        .post-thumbnail-placeholder {
            height: 300px; line-height: 300px; text-align: center; font-size: 4rem;
            background-color: var(--card-bg); 
            border: 1px solid var(--border-color);
            color: var(--link-color);
            border-radius: 8px;
            margin-bottom: 2rem;
        }
        
        .article-content blockquote {
            border-left: 4px solid var(--link-color);
            color: var(--text-color);
            background: var(--card-bg);
            padding: 1.5rem;
            margin: 2rem 0;
            border-radius: 4px;
        }
        
        .article-content h2 { 
            font-size: 2rem; margin-top: 3rem; margin-bottom: 1rem;
            border-bottom: 2px solid var(--border-color); padding-bottom: 0.5rem;
            color: var(--headline-color);
        }
        .article-content h3 { color: var(--heading-color); font-size: 1.5rem; margin-top: 2rem; }
        .article-content ul, .article-content ol { padding-left: 1.5rem; margin-bottom: 1.5rem; }
        .article-content b { color: var(--cyan-glow); font-weight: 600; }
        body.light-theme .article-content b { color: var(--link-color); }


        /* --- Audio Player Styles (Aesthetic Update) --- */
        .audio-player {
            background: var(--card-bg); 
            border: 1px solid var(--link-color); 
            padding: 1.25rem; border-radius: 8px; margin-bottom: 2.5rem;
            display: flex; flex-wrap: wrap; align-items: center; justify-content: space-between;
            gap: 1rem;
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.5); /* Stronger glow effect */
            transition: all 0.3s;
            position: relative; /* Needed for progress bar positioning */
        }
        body.light-theme .audio-player {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); 
            border-color: var(--border-color);
        }
        
        .audio-progress-bar {
            position: absolute;
            bottom: 0;
            left: 0;
            height: 5px;
            background: var(--link-color);
            width: 0%;
            border-radius: 0 0 0 8px;
            transition: width 0.1s linear;
        }

        #reading-time {
            font-size: 0.95rem;
            color: var(--link-color);
            font-weight: 600;
        }
        
        /* Word Highlighting (Inline span) */
        .word-highlight {
            background-color: var(--highlight-color);
            padding: 0 1px;
            border-radius: 2px;
            transition: background-color 0.1s;
        }
        body.light-theme .word-highlight {
            box-shadow: none; 
            color: var(--heading-color);
        }

        .btn-primary {
            background: var(--button-bg); color: var(--button-text-color); border: none;
            padding: 0.8rem 1.5rem; border-radius: 25px; cursor: pointer; font-weight: 700;
            font-family: 'Orbitron', sans-serif; font-size: 1rem; transition: all 0.3s ease;
            text-transform: uppercase;
        }
        .btn-primary:hover { 
            background: var(--button-hover-bg); 
            box-shadow: var(--shadow-glow);
        }
        .btn-primary:disabled { opacity: 0.6; cursor: not-allowed; }

        /* Form Controls */
        .form-input {
            background: var(--bg-color); border: 1px solid var(--border-color); color: var(--text-color);
            display: block; width: 100%; padding: 0.8rem; margin-bottom: 1rem; border-radius: 4px; box-sizing: border-box;
            font-family: 'Inter', sans-serif;
            font-size: 1rem;
        }
        .form-input:focus { 
            border-color: var(--link-color); 
            box-shadow: 0 0 0 2px rgba(0, 255, 255, 0.3); 
            outline: none;
        }
        textarea.form-input { min-height: 100px; resize: vertical; }

        /* --- Comment Section Styles (Authentication & Likes/Replies) --- */
        .comments-wrapper { 
            margin-top: 4rem;
            padding-top: 2rem; 
            border-top: 1px solid var(--border-color); 
        }
        .comments-wrapper h2 { 
            font-size: 1.8rem;
            margin-bottom: 2rem;
            border-bottom: none;
        }
        
        /* New: Authentication prompt as suggestion, not blocker */
        .auth-prompt {
            border: 1px solid var(--border-color);
            padding: 1.5rem;
            margin-bottom: 2rem;
            background: var(--card-bg);
            text-align: center;
        }
        .auth-prompt h3 {
            font-size: 1.4rem;
            margin-bottom: 0.5rem;
        }
        
        .guest-inputs {
            /* Now handled by JS based on auth status */
            display: none; 
        }

        .comment-form-container {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            padding: 2rem;
            border-radius: 8px;
            margin-bottom: 3rem;
        }
        .comment-form-container h3 {
            margin-bottom: 1.5rem;
            font-size: 1.4rem;
        }

        .comment {
            background: var(--comment-bg); border: 1px solid var(--border-color);
            display: flex; gap: 1rem; padding: 1.5rem; border-radius: 8px; margin-bottom: 1.5rem;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            position: relative;
        }
        .comment-avatar { 
            width: 45px; height: 45px; border-radius: 50%; background: var(--link-color); 
            display: flex; align-items: center; justify-content: center; font-size: 1.2rem;
            color: var(--button-text-color); font-weight: 700; flex-shrink: 0;
        }
        .comment-user { 
            font-weight: 600; color: var(--cyan-glow); font-size: 1rem; 
            display: inline-block; margin-bottom: 0.3rem;
        }
        body.light-theme .comment-user { color: var(--link-color); }
        .verified-badge { 
            color: #4CAF50; margin-left: 5px; font-size: 0.8rem; 
            vertical-align: middle; 
        }
        .admin-badge {
            color: gold; margin-left: 5px; font-size: 0.8rem;
            vertical-align: middle;
        }
        .comment-meta {
            font-size: 0.85rem;
            color: #888;
            margin-top: 0.5rem;
        }
        .comment-actions {
            font-size: 0.9rem;
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
            color: #777;
        }
        .comment-actions button {
            background: none; border: none; color: #777; cursor: pointer;
            transition: color 0.2s; font-family: 'Inter', sans-serif;
            font-size: 0.9rem;
        }
        .comment-actions button:hover {
            color: var(--link-color);
        }
        .comment-actions i {
            margin-right: 5px;
        }
        .like-btn.liked {
            color: #E91E63;
        }
        .comment-actions button:disabled {
             opacity: 0.5;
             cursor: not-allowed;
             color: #777;
        }
        
        .no-comments {
            text-align: center;
            padding: 3rem;
            color: #777;
        }
        
        /* Responsive adjustments (Existing) */
        @media (max-width: 992px) {
            .nav-links {
                display: none;
                flex-direction: column;
                width: 100%;
                background: var(--navbar-bg);
                position: absolute;
                top: 100%;
                left: 0;
                padding: 1rem 0;
                border-top: 1px solid var(--border-color);
            }
            .nav-links.active {
                display: flex;
            }
            .nav-links li {
                margin: 0.5rem 2rem;
            }
            .nav-links a::after { display: none; }
            .hamburger { display: flex; }
            .footer .container { grid-template-columns: repeat(2, 1fr); }
            .footer .col:nth-child(1), .footer .col:nth-child(2) { margin-bottom: 1.5rem; }
        }

        @media (max-width: 500px) {
            .footer .container { grid-template-columns: 1fr; text-align: center; }
            .footer .col { margin-bottom: 1rem; }
            .audio-player { flex-direction: column; align-items: stretch; }
        }
    </style>
</head>
<body>
    
    <header class="navbar">
        <div class="container">
            <a href="index.html" class="navbar-brand">Elvion AI</a>
            
            <div class="nav-controls">
                <nav class="nav-links">
                    <li><a href="university.html">University</a></li>
                    <li><a href="blog.html" class="active-link">Blog</a></li>
                    <li><a href="about.html">About Us</a></li>
                </nav>
                <button id="theme-toggle" aria-label="Toggle theme">
                    <i class="fas fa-sun"></i> 
                </button>
                <button class="hamburger" aria-label="Toggle navigation">
                    <span class="bar"></span>
                    <span class="bar"></span>
                    <span class="bar"></span>
                </button>
            </div>
        </div>
    </header>

    <main class="post-main">
        <div class="post-container">

            <header class="post-header">
                <span class="post-tag">Creative Writing</span>
                <h1>How to Craft Unforgettable Characters: A Writer's Guide</h1>
                <div class="post-meta">
                    <span><i class="fas fa-user-edit"></i> By Elvion AI Staff</span>
                    <span><i class="fas fa-calendar-alt"></i> Nov 5, 2025</span>
                    <span id="estimated-time"><i class="fas fa-clock"></i> Calculating read time...</span>
                </div>
            </header>

            <div class="post-thumbnail-placeholder">
                <i class="fas fa-feather-pointed"></i>
            </div>
            
            <section class="audio-player">
                <span id="reading-time"></span>
                <select id="voice-select" class="form-input" style="width: 250px; margin: 0; flex-grow: 1;">
                    <option value="">Select Voice...</option>
                </select>
                <button id="audio-play-pause-btn" class="btn-primary" disabled style="width: 200px;">
                    <i class="fas fa-play"></i>
                    <span>Listen</span>
                </button>
                <span id="speech-status" style="font-size: 0.9rem; color: #aaa;">Loading voices...</span>
                <div class="audio-progress-bar" id="audio-progress-bar"></div>
            </section>
            
            <article class="article-content" id="article-content">
                <p>Your characters are the heart of your story. They are the vessels through which your reader experiences the world you've built, the conflicts you've crafted, and the emotions you want to evoke. A weak plot can sometimes be saved by compelling characters, but even the most brilliant plot will fall flat if the characters feel like cardboard cutouts. So, how do you create three-dimensional, <b>unforgettable characters</b> that leap off the page?</p>

                <h2>1. Beyond the Surface: The Iceberg Method</h2>
                <p>What we see of a character‚Äîtheir appearance, their job, their actions‚Äîis just the tip of the iceberg. The real substance lies beneath the surface. This is their <b>backstory</b>. You don't need to dump all of this information on the reader (in fact, please don't!), but <i>you</i> need to know it. What was their childhood like? What's their biggest regret? What is the secret they've never told anyone? This hidden weight informs their every decision, fear, and desire.</p>

                <blockquote>
                    <b>Pro-Tip:</b> Ask yourself: What is the single most important event that shaped my character into who they are today? How does it affect their behavior in Chapter 1?
                </blockquote>

                <h2>2. Give Them Flaws (Real Ones)</h2>
                <p>Perfection is boring. A character who is always right, always strong, and always kind is not relatable‚Äîthey're annoying. Real people are messy. They are impatient, they are selfish, they are afraid of spiders, they procrastinate. A flaw makes a character human. More importantly, a character's <b>fatal flaw</b> is often the engine of the plot. It's the internal obstacle they must overcome to achieve their external goal. Is your hero brave? Make them reckless. Is your heroine brilliant? Make her arrogant.</p>

                <h2>3. Wants vs. Needs</h2>
                <p>This is a classic writing technique for a reason. Every compelling character has two goals:</p>
                
                <ul>
                    <li><b>The Want:</b> This is the external, conscious goal. It's what the character <i>thinks</i> they need to be happy. (e.g., "I want to win the championship.")</li>
                    <li><b>The Need:</b> This is the internal, often subconscious truth. It's what the character <i>actually</i> needs to grow as a person. (e.g., "I need to learn to trust my teammates.")</li>
                </ul>

                <p>The best stories create conflict by putting the Want and the Need at odds. The character's journey (their "arc") is complete when they either sacrifice their Want to achieve their Need, or finally realize that what they Needed was the key to getting what they Wanted all along.</p>
                
                <h2>4. Let Their Voice Be Heard</h2>
                <p>How does your character speak? Their dialogue is a window into their soul. A character's voice is more than just an accent; it's their word choice, their sentence structure, their rhythm, and what they choose to say (or not say).</p>
                
                <h3>Quick Voice Tips:</h3>
                <ul>
                    <li>An educated professor might use complex sentences and precise vocabulary.</li>
                    <li>A nervous teenager might speak in short, halting sentences, using a lot of "like" or "um."</li>
                    <li>A cynical detective might use dry, sarcastic wit.</li>
                </ul>
                <p>Try this exercise: Write a scene with two characters arguing, but remove all dialogue tags ("he said," "she yelled"). Can you tell who is speaking just by their words and rhythm? If so, you're on the right track.</p>

                <h2>5. Make Them Act: Decisions Define Character</h2>
                <p>Don't just <i>tell</i> us your character is brave; put them in a situation where they must <i>choose</i> to be brave, especially when it's hard. Character is revealed through action and choice, especially choices made under pressure. The harder the choice, the more we learn about who they really are. A character who chooses to run into a burning building is defined by that action in a way no amount of descriptive prose ever could.</p>
                
                <p>Ultimately, an unforgettable character feels <b>real</b>. They are a bundle of contradictions, flaws, desires, and secrets, just like us. By digging deep into their past, understanding their internal conflicts, and letting them express themselves through a unique voice, you can create characters that readers will carry with them long after the final page.</p>
            </article>

            <section class="comments-wrapper" id="comments">
                <h2>üí¨ Join the Conversation (<span id="comment-count">0</span> Comments)</h2>

                <div id="auth-prompt" class="auth-prompt">
                    <div id="logged-in-message" style="display: none;">
                         <p>Posting as: <b id="current-user-name" style="color: var(--link-color);"></b> <button id="sign-out-btn" style="color: #DB4437; background: none; border: none; cursor: pointer; font-weight: 500;">(Sign Out)</button></p>
                    </div>
                    <div id="logged-out-message">
                        <h3>Want a verified badge and likes/replies?</h3>
                        <button id="google-sign-in-btn" class="btn-primary" style="background: #DB4437; background-image: none;">
                            <i class="fab fa-google"></i> Sign in with Google
                        </button>
                    </div>
                </div>
                
                <div class="comment-form-container" id="comment-form-container">
                    <h3>Post Your Comment</h3>
                    <form id="comment-form">
                        <div id="guest-inputs" class="guest-inputs">
                            <div>
                                <label for="comment-name" class="form-label">Your Name <span style="color: red;">*</span></label>
                                <input type="text" id="comment-name" class="form-input" placeholder="Guest Name" required>
                            </div>
                        </div>

                        <div>
                            <label for="comment-input-text" class="form-label">Share your thoughts <span style="color: red;">*</span></label>
                            <textarea id="comment-input-text" class="form-input" placeholder="What did you think about this article? (Supports links, bold, and line breaks!)" required></textarea>
                        </div>
                        <button type="submit" id="comment-button" class="btn-primary">
                            <i class="fas fa-paper-plane"></i> Post Comment
                        </button>
                    </form>
                </div>

                <div id="comment-list-container">
                    <div id="comment-list">
                        <p class="loading-message" style="text-align: center; color: #777;">Loading comments...</p>
                    </div>
                </div>

            </section>

        </div>
    </main>

    <footer class="footer">
        <div class="container">
            <div class="col">
                <span class="brand-info">Elvion AI</span>
                <p>Where Assistance Meets Excellence.</p>
            </div>
            <div class="col">
                <h4>Quick Links</h4>
                <ul>
                    <li><a href="index.html#hero">Home</a></li>
                    <li><a href="blog.html">Blog</a></li>
                    <li><a href="university.html">University</a></li>
                </ul>
            </div>
            <div class="col">
                <h4>Company</h4>
                <ul>
                    <li><a href="about.html">About Us</a></li>
                    <li><a href="mailto:contact@elvionai.com">Contact Us</a></li>
                </ul>
            </div>
            <div class="col">
                <h4>Legal</h4>
                <ul>
                    <li><a href="privacy.html">Privacy Policy</a></li>
                    <li><a href="terms.html">Terms of Service</a></li>
                </ul>
            </div>
            <div class="legal-info">
                &copy; <span id="current-year-footer"></span> Elvion AI. All rights reserved.
            </div>
        </div>
    </footer>

    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    
    <script>
        // --- Theme Toggle Script & Hamburger ---
        document.addEventListener('DOMContentLoaded', () => {
            const body = document.body;
            const toggleButton = document.getElementById('theme-toggle');
            const hamburger = document.querySelector('.hamburger');
            const navLinks = document.querySelector('.nav-links');

            const savedTheme = localStorage.getItem('theme') || 'dark';

            function applyTheme(theme) {
                if (theme === 'light') {
                    body.classList.add('light-theme');
                    toggleButton.innerHTML = '<i class="fas fa-moon"></i>';
                } else {
                    body.classList.remove('light-theme');
                    toggleButton.innerHTML = '<i class="fas fa-sun"></i>';
                }
                localStorage.setItem('theme', theme);
            }

            applyTheme(savedTheme);

            toggleButton.addEventListener('click', () => {
                const currentTheme = body.classList.contains('light-theme') ? 'light' : 'dark';
                const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
                applyTheme(newTheme);
            });

            hamburger.addEventListener('click', () => {
                hamburger.classList.toggle('active');
                navLinks.classList.toggle('active');
            });
            navLinks.querySelectorAll('a').forEach(link => {
                link.addEventListener('click', () => {
                    if (window.innerWidth <= 992) {
                        hamburger.classList.remove('active');
                        navLinks.classList.remove('active');
                    }
                });
            });

            document.getElementById('current-year-footer').textContent = new Date().getFullYear();
        });
    </script>
    
    <script>
        // --- TEXT TO SPEECH SCRIPT (Reverted to Native TTS for Perfected Highlights) ---
        document.addEventListener('DOMContentLoaded', () => {
            const playPauseBtn = document.getElementById('audio-play-pause-btn');
            const speechStatus = document.getElementById('speech-status');
            const articleContent = document.getElementById('article-content');
            const voiceSelect = document.getElementById('voice-select');
            const estimatedTimeEl = document.getElementById('estimated-time');
            const progressBar = document.getElementById('audio-progress-bar'); 
            
            const synth = window.speechSynthesis;
            const WPM = 200; 

            let isPlaying = false;
            let isPaused = false;
            let currentUtterance = null;
            let wordsMap = []; 
            let wordIndexInMap = 0;

            if ('speechSynthesis' in window) {
                
                // --- 1. Content Processing & Read Time ---
                function processArticleContent() {
                    let totalWordCount = 0;
                    wordsMap = [];
                    
                    const elements = articleContent.querySelectorAll('p, h2, h3, li, blockquote');
                    
                    elements.forEach(el => {
                        const originalHTML = el.innerHTML;
                        const text = el.textContent.trim();
                        if (text.length === 0) return;
                        
                        const sentences = text.match(/[^.!?]+[.!?]+/g) || [text];

                        sentences.forEach(sentence => {
                            const words = sentence.match(/\b\w+['‚Äô]*\w*[\.,;:]*\b/g) || []; 
                            
                            words.forEach((word) => {
                                // Store the word in its original case/form for highlighting regex, but clean for tracking map
                                wordsMap.push({ text: word, element: el }); 
                                totalWordCount++;
                            });
                        });
                        
                        el.setAttribute('data-tts-text', sentences.join(' '));
                        el.setAttribute('data-original-html', originalHTML);
                    });
                    
                    const readTimeMinutes = Math.ceil(totalWordCount / WPM);
                    estimatedTimeEl.innerHTML = `<i class="fas fa-clock"></i> ${readTimeMinutes} min read`;
                    document.getElementById('reading-time').textContent = `Duration: ${readTimeMinutes} min`;
                }
                
                // --- 2. Voice Selection Setup ---
                function populateVoiceList() {
                    const voices = synth.getVoices();
                    voiceSelect.innerHTML = '<option value="">Select Voice...</option>';
                    
                    const englishVoices = voices.filter(v => v.lang.startsWith('en'));
                    
                    // Priority list for a default, clear voice
                    const priorityNames = ['Google US English', 'Zira', 'David', 'Microsoft Zira'];
                    let preferredVoice = englishVoices.find(v => priorityNames.some(name => v.name.includes(name))) || englishVoices[0];
                    
                    if (preferredVoice) {
                        const option = document.createElement('option');
                        option.textContent = `${preferredVoice.name} (${preferredVoice.lang})`;
                        option.value = preferredVoice.name;
                        option.selected = true;
                        voiceSelect.appendChild(option);
                    }
                    
                    englishVoices.filter(v => v.name !== (preferredVoice ? preferredVoice.name : '')).forEach(v => {
                        const option = document.createElement('option');
                        option.textContent = `${v.name} (${v.lang})`;
                        option.value = v.name;
                        voiceSelect.appendChild(option);
                    });


                    if (voiceSelect.options.length > 1) {
                         speechStatus.textContent = "Ready to listen.";
                         playPauseBtn.disabled = false;
                    } else {
                        speechStatus.textContent = "Voices loading or not supported.";
                    }
                }
                
                // --- 3. Speech Control & Highlighting (Perfected) ---
                function startSpeaking(voiceName) {
                    removeHighlighting();
                    wordIndexInMap = 0; 
                    
                    const fullText = Array.from(articleContent.querySelectorAll('[data-tts-text]'))
                        .map(el => el.getAttribute('data-tts-text')).join(' ');

                    if (!fullText) { return; }

                    currentUtterance = new SpeechSynthesisUtterance(fullText);
                    
                    const selectedVoice = synth.getVoices().find(v => v.name === voiceName);
                    if (selectedVoice) {
                        currentUtterance.voice = selectedVoice;
                    }

                    currentUtterance.rate = 1.0; 
                    currentUtterance.pitch = 1.0;

                    currentUtterance.onstart = () => {
                        isPlaying = true;
                        isPaused = false;
                        playPauseBtn.innerHTML = '<i class="fas fa-pause"></i> <span>Pause</span>';
                        speechStatus.textContent = "Reading aloud...";
                        progressBar.style.width = '0%';
                    };
                    
                    currentUtterance.onboundary = (event) => {
                        if (event.name === 'word') {
                            // Progress Bar update
                            const totalLength = currentUtterance.text.length;
                            const progress = (event.charIndex / totalLength) * 100;
                            progressBar.style.width = `${progress}%`;
                            
                            let foundWordData = wordsMap[wordIndexInMap];
                            
                            if (foundWordData) {
                                removeHighlighting();
                                
                                const currentElement = foundWordData.element;
                                const wordToHighlight = foundWordData.text;
                                
                                currentElement.innerHTML = currentElement.getAttribute('data-original-html') || currentElement.textContent;

                                // Escaped regex for safe replacement
                                const escapedWord = wordToHighlight.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
                                // Targets the whole word (non-greedy) and is case-insensitive
                                const regex = new RegExp(`(?<!<[^>]*>)(\\b${escapedWord}\\b)`, 'i'); 
                                
                                // Only highlight the first instance found in the element
                                if (regex.test(currentElement.innerHTML)) {
                                    currentElement.innerHTML = currentElement.innerHTML.replace(regex, `<span class="word-highlight">${wordToHighlight}</span>`);
                                    currentElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                                }
                                
                                wordIndexInMap++;
                            }
                        }
                    };

                    currentUtterance.onend = () => {
                        resetPlayer();
                        speechStatus.textContent = "Finished reading.";
                        progressBar.style.width = '100%';
                    };
                    
                    currentUtterance.onerror = (e) => {
                        console.error('Speech synthesis error:', e);
                        resetPlayer();
                        speechStatus.textContent = `Error reading: ${e.error}`;
                    };

                    synth.speak(currentUtterance);
                }

                function removeHighlighting() {
                    const highlightedSpans = articleContent.querySelectorAll('.word-highlight');
                    highlightedSpans.forEach(span => {
                        span.outerHTML = span.textContent; 
                    });
                }
                
                function resetPlayer() {
                    isPlaying = false;
                    isPaused = false;
                    wordIndexInMap = 0;
                    removeHighlighting();
                    playPauseBtn.innerHTML = '<i class="fas fa-play"></i> <span>Listen</span>';
                    synth.cancel();
                    progressBar.style.width = '0%';
                }

                // --- 4. Event Listeners ---
                playPauseBtn.addEventListener('click', () => {
                    const selectedVoice = voiceSelect.value;
                    if (!selectedVoice && synth.getVoices().length > 0) {
                        speechStatus.textContent = "Please select a voice first!";
                        return;
                    } else if (synth.getVoices().length === 0) {
                         speechStatus.textContent = "Voices not yet loaded. Try again in a moment.";
                         return;
                    }

                    if (!isPlaying && !isPaused) {
                        startSpeaking(selectedVoice);
                    } else if (isPlaying && !isPaused) {
                        isPlaying = false;
                        isPaused = true;
                        synth.pause();
                        speechStatus.textContent = "Paused";
                        playPauseBtn.innerHTML = '<i class="fas fa-play"></i> <span>Resume</span>';
                    } else if (!isPlaying && isPaused) {
                        isPlaying = true;
                        isPaused = false;
                        synth.resume();
                        speechStatus.textContent = "Reading aloud...";
                        playPauseBtn.innerHTML = '<i class="fas fa-pause"></i> <span>Pause</span>';
                    }
                });
                
                synth.onvoiceschanged = populateVoiceList;

                processArticleContent();
                populateVoiceList();

                window.onbeforeunload = () => {
                    synth.cancel();
                };

            } else {
                speechStatus.textContent = "Audio playback not supported by your browser.";
                playPauseBtn.disabled = true;
                estimatedTimeEl.textContent = '';
                document.getElementById('reading-time').textContent = 'Audio not supported.';
            }
        });
    </script>


    <script>
        // --- FIREBASE/COMMENT SCRIPT (Updated for Guest/Auth Hybrid) ---
        
        const firebaseConfig = {
            apiKey: "AIzaSyAyROm0aBGjry6NUfhNM3e0qwPcCDoIqSk",
            authDomain: "elvionai.firebaseapp.com",
            projectId: "elvionai",
            storageBucket: "elvionai.firebasestorage.app",
            messagingSenderId: "161078300830",
            appId: "1:161078300830:web:f460df8591704eb0e96b8f"
        };

        try {
            firebase.initializeApp(firebaseConfig);
        } catch (e) {
            console.error("Firebase Init Error (Check API Key/Config):", e);
        }
        
        const db = firebase.firestore();
        const auth = firebase.auth();
        const ARTICLE_ID = 'crafting-characters-01';
        const ADMIN_EMAIL = 'koladhino@gmail.com'; 

        // --- DOM Elements ---
        const commentForm = document.getElementById('comment-form');
        const commentTextInput = document.getElementById('comment-input-text');
        const commentList = document.getElementById('comment-list');
        const commentCountEl = document.getElementById('comment-count');
        const submitBtn = document.getElementById('comment-button');
        const googleSignInBtn = document.getElementById('google-sign-in-btn');
        const currentUserNameEl = document.getElementById('current-user-name');
        
        // New/Re-added elements for guest comments
        const commentNameInput = document.getElementById('comment-name'); 
        const guestInputsDiv = document.getElementById('guest-inputs'); 
        const loggedInMessage = document.getElementById('logged-in-message'); 
        const loggedOutMessage = document.getElementById('logged-out-message'); 
        const signOutBtn = document.getElementById('sign-out-btn'); 
        
        let currentUser = null;

        // --- 1. Authentication Logic ---
        
        // Google Sign-In Handler
        googleSignInBtn.addEventListener('click', async () => {
            const provider = new firebase.auth.GoogleAuthProvider();
            try {
                await auth.signInWithPopup(provider);
            } catch (error) {
                console.error("Google Sign-In Error:", error);
                alert(`Sign in failed: ${error.message}`);
            }
        });
        
        // Sign Out Handler
        signOutBtn.addEventListener('click', () => {
            auth.signOut();
        });

        // State Observer (Manages UI based on Guest/Auth status)
        auth.onAuthStateChanged(user => {
            if (user) {
                // Logged In
                currentUser = user;
                loggedInMessage.style.display = 'block';
                loggedOutMessage.style.display = 'none';
                guestInputsDiv.style.display = 'none'; // Hide guest inputs
                currentUserNameEl.textContent = user.displayName || user.email.split('@')[0];

            } else {
                // Logged Out (Guest)
                currentUser = null;
                loggedInMessage.style.display = 'none';
                loggedOutMessage.style.display = 'block';
                guestInputsDiv.style.display = 'block'; // Show guest inputs
            }
            loadComments(); 
        });


        // --- 2. Comment Display & Actions ---
        
        function loadComments() {
            commentList.innerHTML = `<p class="loading-message" style="text-align: center; color: #777;">Loading comments...</p>`;
            
            db.collection('comments')
                .where('articleId', '==', ARTICLE_ID)
                .orderBy('timestamp', 'desc')
                .onSnapshot(snapshot => {
                    commentList.innerHTML = '';
                    
                    if (snapshot.empty) {
                        commentList.innerHTML = `
                            <div class="no-comments">
                                <i class="fas fa-comments" style="font-size: 3rem; opacity: 0.3; margin-bottom: 1rem; display: block;"></i>
                                <p>No comments yet. Be the first to share your thoughts! üåü</p>
                            </div>
                        `;
                        commentCountEl.textContent = '0';
                        return;
                    }

                    commentCountEl.textContent = snapshot.size;

                    snapshot.forEach(doc => {
                        const comment = { id: doc.id, ...doc.data() };
                        const commentEl = createCommentElement(comment);
                        commentList.appendChild(commentEl);
                    });
                }, error => {
                    console.error("Error loading comments:", error);
                    commentList.innerHTML = `<p class="loading-message" style="color: red;">Failed to load comments. (Check Firestore Rules)</p>`;
                });
        }

        function createCommentElement(comment) {
            const div = document.createElement('div');
            div.className = 'comment';
            
            const userName = escapeHtml(comment.userName) || 'Anonymous';
            const initial = userName.charAt(0).toUpperCase();
            const timestamp = comment.timestamp ? new Date(comment.timestamp.toDate()).toLocaleString() : 'Just now';
            
            let badge = '';
            if (comment.userEmail === ADMIN_EMAIL) {
                 badge = '<span class="admin-badge" title="Admin/Author"><i class="fas fa-crown"></i> Admin</span>';
            } else if (comment.userId) { 
                badge = '<span class="verified-badge" title="Verified User">‚úî</span>';
            }
            
            const processedText = formatCommentText(comment.text);
            
            const isLiked = currentUser && comment.likes && comment.likes.includes(currentUser.uid);
            const likeCount = comment.likes ? comment.likes.length : 0;
            const actionsDisabled = !currentUser ? 'disabled' : '';

            div.innerHTML = `
                <div class="comment-avatar">${initial}</div>
                <div class="comment-content" style="flex-grow: 1;">
                    <span class="comment-user">${userName}</span>${badge}
                    <p class="comment-text">${processedText}</p>
                    <div class="comment-meta">üïê ${timestamp}</div>
                    <div class="comment-actions">
                        <button class="like-btn ${isLiked ? 'liked' : ''}" data-comment-id="${comment.id}" ${actionsDisabled}>
                            <i class="${isLiked ? 'fas' : 'far'} fa-heart"></i> 
                            <span>Like</span> (<span class="like-count">${likeCount}</span>)
                        </button>
                        <button class="reply-btn" data-comment-id="${comment.id}" ${actionsDisabled}>
                            <i class="fas fa-reply"></i> Reply
                        </button>
                    </div>
                </div>
            `;
            
            const likeBtn = div.querySelector('.like-btn');
            if (likeBtn) {
                likeBtn.addEventListener('click', () => toggleLike(comment.id, likeBtn));
            }
            const replyBtn = div.querySelector('.reply-btn');
            if (replyBtn) {
                replyBtn.addEventListener('click', () => {
                    alert(`Replying to ${userName}. (Full reply functionality requires more complex UI/Firestore structure.)`);
                });
            }
            
            return div;
        }
        
        // --- 3. Comment Submission & Actions (FIXED) ---

        commentForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const commentText = commentTextInput.value.trim();
            
            let postData = {
                articleId: ARTICLE_ID,
                text: commentText,
                timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                likes: [] 
            };

            if (currentUser) {
                // AUTHENTICATED USER
                postData.userId = currentUser.uid;
                postData.userName = currentUser.displayName || currentUser.email.split('@')[0];
                postData.userEmail = currentUser.email;
            } else {
                // GUEST USER
                const guestName = commentNameInput.value.trim();
                if (!guestName) {
                    alert('Please enter your Name and Comment! üòä');
                    return;
                }
                postData.userName = guestName;
                // Note: userEmail/userId intentionally excluded for guests (matches corrected rules)
            }
            
            if (!commentText) {
                alert('Please enter your comment! üòä');
                return;
            }

            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Posting...';

            try {
                // FIX: Posting logic now handles both authenticated and guest data structures correctly
                await db.collection('comments').add(postData);

                commentTextInput.value = '';
                if (!currentUser) {
                    commentNameInput.value = '';
                }
            } catch (error) {
                console.error('Error posting comment:', error);
                alert(`Oops! Failed to post comment. Check console. You might need to publish the new Firebase Security Rules. Error: ${error.message}`);
            } finally {
                submitBtn.disabled = false;
                submitBtn.innerHTML = '<i class="fas fa-paper-plane"></i> Post Comment';
            }
        });

        async function toggleLike(commentId, button) {
             if (!currentUser) return;
             
             const commentRef = db.collection('comments').doc(commentId);
             const userId = currentUser.uid;
             
             // Atomically update the array to add or remove the user ID
             await db.runTransaction(async (transaction) => {
                 const doc = await transaction.get(commentRef);
                 if (!doc.exists) {
                     throw "Comment does not exist!";
                 }
                 
                 const likes = doc.data().likes || [];
                 const isCurrentlyLiked = likes.includes(userId);
                 
                 if (isCurrentlyLiked) {
                     // Remove like
                     transaction.update(commentRef, {
                         likes: firebase.firestore.FieldValue.arrayRemove(userId)
                     });
                 } else {
                     // Add like
                     transaction.update(commentRef, {
                         likes: firebase.firestore.FieldValue.arrayUnion(userId)
                     });
                 }
             });
        }


        // --- 4. Utility Functions ---
        
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            let formattedText = div.innerHTML;
            
            // Convert simple formatting: links, **bold**, and line breaks
            formattedText = formattedText.replace(/(https?:\/\/[^\s]+)/g, '<a href="$1" target="_blank">$1</a>'); // Simple link detection
            formattedText = formattedText.replace(/\*\*(.*?)\*\*/g, '<b>$1</b>'); // **bold** to <b>
            formattedText = formattedText.replace(/\n/g, '<br>'); // New lines to <br>
            
            return formattedText;
        }
        
        function formatCommentText(text) {
            return escapeHtml(text);
        }

        // Initialize comments on load
        document.addEventListener('DOMContentLoaded', () => {
            // Initial load is handled by auth.onAuthStateChanged
        });
    </script>
</body>
</html>
