<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Elvion Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Personalized study dashboard for Elvion learners. Track progress, earn achievements, and continue your learning journey." />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Orbitron:wght@700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --cyan: #00ffff;
      --blue: #0090ff;
      --card-bg: rgba(18,26,48,0.96);
      --bg-dark: #0a1128;
      --radius: 17px;
      --text: #e0e0e0;
      --muted: #a3b4c0;
      --white: #fff;
      --border-glow: 0 0 11px var(--cyan), 0 0 24px var(--blue);
      --shadow: 0 4px 22px 0 rgba(0,255,255,0.06);
      --progress-bg: #14348a;
      --progress-fg: var(--cyan);
      --danger: #ff4444;
      --success: #13ff89;
      --accent: #fffde3;
    }
    html, body {
      background: linear-gradient(120deg, #111c2e 48%, #211e2e 100%);
      color: var(--text);
      font-family: 'Inter', sans-serif;
      margin:0; padding:0;
      min-height: 100vh;
      overflow-x: hidden;
    }
    .dashboard-nav {
      display: flex;
      flex-direction: column;
      position: fixed;
      top: 0; left: 0; height: 100vh; width: 210px;
      background: rgba(0,0,32,0.91);
      box-shadow: var(--border-glow);
      padding: 36px 0 15px 0;
      z-index: 9;
    }
    .dashboard-nav .logo {
      text-align: center;
      font-family: 'Orbitron', sans-serif;
      font-weight: 700;
      font-size: 2.0rem;
      color: var(--cyan);
      margin-bottom: 38px;
      text-shadow: var(--border-glow);
      letter-spacing: 2px;
    }
    .nav-link {
      color: var(--text);
      padding: 13px 30px;
      margin-bottom: 6px;
      font-weight: 600;
      font-size: 1.05rem;
      letter-spacing: .7px;
      border-left: 3px solid transparent;
      transition: .18s;
      display: flex;
      align-items: center;
      gap: 13px;
      background: none;
      outline: none;
      cursor: pointer;
      border-radius: 0 31px 31px 0;
      background: none;
    }
    .nav-link.active, .nav-link:hover {
      color: var(--cyan);
      border-left: 3px solid var(--cyan);
      background: rgba(0, 255, 255, 0.035);
      box-shadow: 0 2px 8px 0 var(--cyan);
      text-shadow: 0 0 7px var(--cyan);
    }
    .dashboard-main {
      margin-left: 210px;
      padding: 0 0 35px 0;
      min-height: 100vh;
    }
    .dashboard-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: rgba(0,12,24,0.42);
      box-shadow: 0 2px 18px 0 rgba(0,255,255,0.15);
      padding: 32px 46px 28px 46px;
      border-radius: 0 0 48px 0;
      position: relative;
    }
    .user-greeting {
      font-family: 'Orbitron', sans-serif;
      font-size: 1.7rem;
      color: var(--white);
      text-shadow: var(--border-glow);
      font-weight: bold;
      margin-bottom: 0;
    }
    .study-streak {
      color: var(--cyan);
      font-weight: 600;
      font-size: 1.04rem;
      display: flex;
      align-items: center;
      gap: 7px;
    }
    .dashboard-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(364px, 1fr));
      gap: 32px;
      margin: 46px 36px 22px 36px;
    }
    .card {
      background: var(--card-bg);
      border-radius: var(--radius);
      box-shadow: var(--border-glow), var(--shadow);
      padding: 22px 36px 19px 36px;
      position: relative;
      overflow: hidden;
      min-width: 0;
      min-height: 119px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .card .card-title {
      font-family: 'Orbitron', sans-serif;
      color: var(--cyan);
      font-weight: 700;
      margin-bottom: 7px;
      font-size: 1.19rem;
      letter-spacing: .8px;
    }
    .progress-card {
      display: flex;
      align-items: center;
      gap: 26px;
    }
    .progress-circle {
      width: 90px; height: 90px; border-radius: 50%;
      background: radial-gradient(circle, #1d4451 73%, #2f476a 100%);
      box-shadow: 0 0 22px 0 var(--cyan);
      display: flex; align-items: center; justify-content: center;
      position: relative;
    }
    .progress-circle svg {
      position: absolute; top: 0; left: 0;
    }
    .progress-num {
      color: var(--cyan);
      font-weight: 700; font-size: 2rem;
      text-align: center;
      font-family: 'Orbitron', sans-serif;
      z-index: 2;
    }
    .progress-label {
      color: var(--muted);
      font-size: 1.04em; margin-top: 6px;
      font-weight: 600;
    }
    .badge-list {
      display: flex; flex-wrap: wrap;
      gap: 16px;
      margin-top: 5px;
    }
    .badge {
      border-radius: 50%;
      background: linear-gradient(145deg,#0df0ff 28%,#25aded 94%);
      display: flex; align-items: center; justify-content: center;
      width: 37px; height: 37px;
      box-shadow: 0 0 14px #00ffff90;
      font-size: 1.22em;
      color: var(--bg-dark);
      border: 2.7px solid #70fff7b6;
      font-family: 'Orbitron',sans-serif;
      position: relative;
      transition: transform 0.14s;
      cursor: pointer;
    }
    .badge:hover {
      transform: scale(1.18) rotate(-4deg);
      z-index:2;
    }
    .badge-tooltip {
      display:none;
      position: absolute;
      background: #061232e9;
      color: var(--accent);
      top: 110%; left: 50%;
      transform: translateX(-50%);
      border-radius: 10px;
      padding: 7px 14px;
      font-size: .96em;
      white-space: nowrap;
      box-shadow: var(--border-glow);
      z-index: 999;
      font-family: 'Inter',sans-serif;
    }
    .badge:hover .badge-tooltip {
      display:block;
      animation: fadeTip .29s;
    }
    @keyframes fadeTip {from{opacity:0;transform:translateY(10px);} to{opacity:1;transform:translateY(0);}}
    .course-card-list {
      display: flex; flex-direction: column; gap: 27px;
    }
    .course-card {
      display: flex; align-items: center;
      gap: 30px;
      background: rgba(0,20,40,0.77);
      border-radius: 12px;
      box-shadow: 0 2px 16px #32698c22;
      padding: 17px 14px;
      transition: box-shadow 0.1s;
      min-width: 0;
      position: relative;
    }
    .course-card:hover {
      background: rgba(0,255,255,0.05);
      box-shadow: 0 2px 29px #00cfff99;
    }
    .course-icon {
      font-size: 2.6em;
      color: var(--cyan);
      text-shadow: 0 0 15px var(--cyan);
      width: 52px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .course-info {
      flex: 1 1 40%;
      display: flex; flex-direction: column;
    }
    .course-title {
      font-size: 1.16em;
      font-weight: 700;
      color: var(--white);
      font-family: 'Orbitron',sans-serif;
    }
    .course-progress-bar-bg {
      width: 100%; height: 9px;
      background: var(--progress-bg);
      border-radius: 12px;
      overflow: hidden;
      margin-top: 9px;
      margin-bottom: 3px;
    }
    .course-progress-bar-fg {
      background: var(--progress-fg);
      height: 100%; border-radius: 7px;
      transition: width .27s;
    }
    .course-meta {
      color: var(--cyan);
      font-size: .95em;
      margin-top: 3px;
      letter-spacing: .2px;
    }
    .course-btn {
      background: linear-gradient(95deg,#0ad1f7,#07ddaa 92%);
      color: #03364c;
      font-weight: 700;
      border:none; outline:none;
      border-radius: 7px;
      padding: 8px 21px;
      font-family: 'Orbitron',sans-serif;
      font-size: 1.01em; cursor: pointer;
      box-shadow: 0 0 12px #00ffff95;
      letter-spacing: .4px;
      transition: background .12s, color .11s, transform .11s;
    }
    .course-btn:hover {
      background: #04fff7;
      color: #091d35;
      transform: scale(1.045);
    }
    .suggested-card {
      margin-top: 19px; background: #15131fce;
    }
    .activity-feed {
      list-style: none; padding-left: 0;
      margin: 9px 0 0 0;
      font-size: .98em;
      color: var(--cyan);
    }
    .activity-feed li {
      margin-bottom: 7px;
      border-left: 2.2px solid var(--cyan);
      padding-left: 13px;
      color: var(--text);
    }
    .stats-card {
      display: flex; flex-direction: column; gap: 14px;
    }
    .stats-list {
      display: flex; gap: 29px; flex-wrap: wrap;
      margin-top: 8px;
    }
    .stat-item {
      display: flex; flex-direction: column;
      align-items: center; justify-content: center;
      color: var(--cyan);
      font-weight: 600;
      background: rgba(0,255,255,0.04);
      padding: 8px 18px; border-radius: 11px;
      box-shadow: 0 2px 9px #00baff32;
    }
    .stat-value {
      font-size: 1.19em;
      color: var(--accent);
    }
    .leaderboard-list {
      margin-top: 12px; padding-left: 0; list-style:none;
    }
    .leaderboard-list li {
      color: var(--accent); font-weight: 600; margin-bottom: 4px;
      display: flex; align-items: center; gap: 7px;
    }
    .leaderboard-list li span {
      color: var(--cyan);
      font-size: .97em;
    }

    @media (max-width: 850px) {
      .dashboard-nav { position: static; width: 100vw; height: auto; flex-direction: row; justify-content: space-around; align-items: center; padding: 13px 0; margin-bottom: 19px;}
      .dashboard-main{margin-left:0;}
      .dashboard-header{padding:22px 10vw 18px 10vw;}
      .dashboard-cards{margin:36px 7vw 26px 7vw;}
    }
    @media(max-width:600px){
      .dashboard-header{padding:13px 2vw 14px 2vw;flex-direction:column;align-items:start;}
      .dashboard-cards{grid-template-columns:1fr;margin:0 1vw;}
      .dashboard-nav{padding:10px 0;}
    }
  </style>
</head>
<body>
  <nav class="dashboard-nav">
    <div class="logo">ElvionAI</div>
    <button class="nav-link active"><i class="fa fa-gauge"></i>Dashboard</button>
    <button class="nav-link"><i class="fa fa-book-open-reader"></i>My Courses</button>
    <button class="nav-link"><i class="fa fa-certificate"></i>Achievements</button>
    <button class="nav-link"><i class="fa fa-calendar-day"></i>Schedule</button>
    <button class="nav-link"><i class="fa fa-user"></i>Profile</button>
    <button class="nav-link" id="logoutBtn"><i class="fa fa-right-from-bracket"></i>Log Out</button>
  </nav>
  <main class="dashboard-main">
    <header class="dashboard-header">
      <div>
        <span class="user-greeting" id="userGreeting">Welcome, Learner.</span>
        <div class="study-streak">
          <i class="fa fa-bolt"></i>
          <span id="streakCount">0</span> day streak
        </div>
      </div>
      <div class="study-streak">
        <i class="fa fa-star"></i>
        <span id="totalPoints">0</span> points
      </div>
    </header>

    <section class="dashboard-cards">
      <!-- Progress Overview -->
      <div class="card progress-card">
        <div class="progress-circle">
          <svg width="90" height="90" viewBox="0 0 36 36">
            <path stroke="#0d304a" stroke-width="4" fill="none"
                  d="M18 2.5
                    a 15.5 15.5 0 1 1 0 31
                    a 15.5 15.5 0 1 1 0 -31"/>
            <path id="progressArc" stroke="#00ffff" stroke-width="4.5" fill="none" stroke-linecap="round"
                  d="M18 2.5
                    a 15.5 15.5 0 1 1 0 31
                    a 15.5 15.5 0 1 1 0 -31"/>
          </svg>
          <div class="progress-num" id="overallProgress">0%</div>
        </div>
        <div>
          <div class="card-title">Overall Progress</div>
          <div class="progress-label">Your journey across all active courses</div>
        </div>
      </div>
      <!-- Badges/Achievements -->
      <div class="card">
        <div class="card-title">Badges & Achievements</div>
        <div class="badge-list" id="badgeList">
          <!-- Badges injected here -->
        </div>
      </div>
      <!-- Study Activity/Statistics -->
      <div class="card stats-card">
        <div class="card-title">Study Stats</div>
        <div class="stats-list">
          <div class="stat-item">
            <span class="stat-value" id="weekHours">0</span>
            Hours This Week
          </div>
          <div class="stat-item">
            <span class="stat-value" id="lessonsCompleted">0</span>
            Lessons Completed
          </div>
          <div class="stat-item">
            <span class="stat-value" id="daysActive">0</span>
            Days Active
          </div>
        </div>
        <div style="margin-top:14px;" class="card-title">Recent Activity</div>
        <ul class="activity-feed" id="activityFeed"></ul>
      </div>
      <!-- Current Courses -->
      <div class="card">
        <div class="card-title">Your Courses</div>
        <div class="course-card-list" id="courseList"></div>
        <div class="suggested-card card">
          <div class="card-title" style="font-size:1.09em;">Recommended Next</div>
          <div class="course-card" id="recommendationCard" style="display:none;">
            <div class="course-icon" id="recIcon"><i class="fa fa-lightbulb"></i></div>
            <div class="course-info">
              <div class="course-title" id="recTitle"></div>
              <div class="course-meta" id="recMeta"></div>
            </div>
            <button class="course-btn" id="recBtn">Start Course</button>
          </div>
        </div>
      </div>
      <!-- Leaderboard (optional) -->
      <div class="card">
        <div class="card-title">Leaderboard</div>
        <ul class="leaderboard-list" id="leaderboardList"></ul>
      </div>
    </section>
  </main>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
    import {
      getAuth, onAuthStateChanged, signOut
    } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-auth.js";
    import {
      getFirestore, doc, getDoc, collection, getDocs, query, where
    } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore.js";

    const firebaseConfig = {
      // Your Firebase config
      apiKey: "AIzaSyAyROm0aBGjry6NUfhNM3e0qwPcCDoIqSk",
      authDomain: "elvionai.firebaseapp.com",
      projectId: "elvionai",
      storageBucket: "elvionai.firebasestorage.app",
      messagingSenderId: "161078300830",
      appId: "1:161078300830:web:f460df8591704eb0e96b8f"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    function animateProgress(percent) {
      const radius = 15.5, c = 2 * Math.PI * radius;
      const pct = Math.max(0, Math.min(percent, 100));
      const offset = c - (pct / 100) * c;
      const arc = document.getElementById("progressArc");
      arc.style.strokeDasharray = c;
      arc.style.strokeDashoffset = offset;
      document.getElementById("overallProgress").innerText = pct + "%";
    }

    function renderBadges(badges=[]) {
      const el = document.getElementById("badgeList");
      el.innerHTML = "";
      badges.forEach(b => {
        let icon="fa-trophy";
        let colorClass="success";
        if(b.type === "streak") icon="fa-bolt";
        if(b.type === "lesson") icon="fa-book";
        if(b.type === "quiz") icon="fa-question-circle";
        el.innerHTML += `
          <div class="badge"><i class="fa ${icon}"></i>
            <div class="badge-tooltip">${b.title}<br>${b.desc}</div>
          </div>
        `;
      });
    }

    function renderCourses(courses=[]) {
      const list = document.getElementById("courseList");
      list.innerHTML = "";
      courses.forEach(course => {
        const percent = Math.floor((course.completedLessons || 0) / course.totalLessons * 100);
        list.innerHTML += `
          <div class="course-card">
            <div class="course-icon"><i class="fa ${course.icon || 'fa-book'}"></i></div>
            <div class="course-info">
              <div class="course-title">${course.title}</div>
              <div class="course-progress-bar-bg">
                <div class="course-progress-bar-fg" style="width:${percent}%;"></div>
              </div>
              <div class="course-meta">${percent}% completed · ${course.completedLessons || 0} / ${course.totalLessons} lessons</div>
            </div>
            <button class="course-btn" onclick="window.location.href='course.html?id=${course.id}'">Continue</button>
          </div>
        `;
      });
    }

    function renderFeed(items=[]) {
      const el = document.getElementById("activityFeed");
      el.innerHTML = "";
      items.forEach(item => {
        el.innerHTML += `<li>${item}</li>`;
      });
    }

    function renderStats(stats={}) {
      document.getElementById("weekHours").innerText = stats.hours || 0;
      document.getElementById("lessonsCompleted").innerText = stats.lessons || 0;
      document.getElementById("daysActive").innerText = stats.days || 0;
    }

    function renderLeaderboard(people=[]) {
      let html = "";
      people.forEach((p, i) => {
        html += `<li>
            <span>#${i+1}</span> 
            <span style="color:var(--cyan);font-weight:700;">${p.name}</span> 
            <span>${p.points} pts</span>
          </li>`;
      });
      document.getElementById("leaderboardList").innerHTML = html;
    }

    function renderRecommendation(rec) {
      if(!rec) return;
      document.getElementById("recTitle").innerText = rec.title;
      document.getElementById("recMeta").innerText = rec.shortDesc;
      document.getElementById("recBtn").onclick = ()=>window.location.href=`course.html?id=${rec.id}`;
      document.getElementById("recommendationCard").style.display = "flex";
    }

    // Sample fallback for demo
    const demoCourses = [
      {id: 'c1', title: "Computer Science", completedLessons: 4, totalLessons: 8, icon: "fa-laptop-code"},
      {id: 'c2', title: "English & Literary Studies", completedLessons: 2, totalLessons: 8, icon: "fa-book-open"}
    ];
    const demoBadges = [
      {type: "streak", title: "7 Day Streak", desc: "You've learned 7 days in a row!"},
      {type: "lesson", title: "5 Lessons", desc: "You completed 5 lessons!"},
      {type: "quiz", title: "First Quiz", desc: "You aced your first quiz!"}
    ];
    const demoFeed = [
      "Completed: Introduction to Programming",
      "Achieved 5 Day Streak",
      "Earned badge: First Quiz Winner"
    ];
    const stats = {hours: 4, lessons: 8, days: 14};
    const leaderboard = [
      {name: "Ada Lovelace", points: 930},
      {name: "Alan Turing", points: 805},
      {name: "Grace Hopper", points: 790}
    ];
    const rec = {id:'c3',title:'Mass Communication',shortDesc:'Next up for you: Journalism and digital media skills.'};

    // Firebase live user data
    onAuthStateChanged(auth, async (user) => {
      if (!user) {
        window.location.href = 'enroll.html';
        return;
      }
      document.getElementById("userGreeting").innerText = `Welcome, ${user.displayName || 'Learner'}.`;

      // --- Fetch stats, streak, achievements etc. ---
      // Demo data, replace with Firestore queries below

      // // Example Firestore call for courses:
      // const q = query(collection(db, "courses"), where("userId", "==", user.uid)); 
      // const querySnapshot = await getDocs(q);
      // const courses = [];
      // querySnapshot.forEach(doc => courses.push(doc.data()));
      const courses = demoCourses; 
      const overallPct = Math.round((courses.reduce((a,b)=>(a + (b.completedLessons/b.totalLessons)),0)/courses.length)*100) || 0;

      animateProgress(overallPct);
      renderCourses(courses);
      renderBadges(demoBadges);
      renderLeaderBoard(leaderboard);
      renderFeed(demoFeed);
      renderStats(stats);
      renderRecommendation(rec);

      // Points and streak
      document.getElementById("streakCount").innerText = 7;
      document.getElementById("totalPoints").innerText = 235;
    });

    // Logout
    document.getElementById('logoutBtn').onclick = () => {
      signOut(auth).then(()=>window.location.href="enroll.html");
    };

    // Helper for keyboard navigation (optional enhancement)
    [...document.querySelectorAll('.nav-link')].forEach(btn =>
      btn.onclick = () => {
        document.querySelectorAll('.nav-link').forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
      });
  </script>
</body>
</html>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-J1YTKP10ZX"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date()); 

  gtag('config', 'G-J1YTKP10ZX');
</script>
