<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Course Viewer | Elvion University</title>
  <meta name="description" content="Learn with interactive courses at Elvion University">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Orbitron:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
  <style>
    :root {
      --dark-navy: #00001a;
      --black-bg: #000000;
      --cyan-glow: #00ffff;
      --light-blue-glow: #00aaff;
      --text-color: #e0e0e0;
      --heading-color: #ffffff;
      --gradient-start: #0a1128;
      --gradient-end: #121a30;
      --card-bg: rgba(18, 26, 48, 0.85);
      --border-glow: 0 0 10px var(--cyan-glow), 0 0 20px var(--light-blue-glow);
      --hover-glow: 0 0 15px var(--cyan-glow), 0 0 30px var(--light-blue-glow);
      --button-bg: linear-gradient(45deg, var(--cyan-glow), var(--light-blue-glow));
      --button-text-color: var(--black-bg);
      --star-color: rgba(255, 255, 255, 0.7);
      --sidebar-width: 320px;
      --success-color: #4ade80;
      --warning-color: #fbbf24;
      --error-color: #f87171;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html { scroll-behavior: smooth; }

    body {
      font-family: 'Inter', sans-serif;
      background-color: var(--black-bg);
      color: var(--text-color);
      line-height: 1.7;
      overflow-x: hidden;
      position: relative;
      min-height: 100vh;
    }

    h1, h2, h3, h4, h5, h6 {
      font-family: 'Orbitron', sans-serif;
      color: var(--heading-color);
      margin-top: 0;
    }

    /* Stars Animation */
    #stars-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 0;
      overflow: hidden;
    }

    .star {
      position: absolute;
      background-color: var(--star-color);
      border-radius: 50%;
      opacity: 0;
      animation: twinkle 4s infinite ease-in-out;
    }

    @keyframes twinkle {
      0%, 100% { opacity: 0; transform: scale(0.5); }
      50% { opacity: 1; transform: scale(1); }
    }

    /* Main Layout */
    .course-viewer-container {
      display: flex;
      min-height: 100vh;
      position: relative;
      z-index: 1;
    }

    /* Course Sidebar */
    .course-sidebar {
      width: var(--sidebar-width);
      background: var(--card-bg);
      backdrop-filter: blur(10px);
      border-right: 1px solid rgba(0, 255, 255, 0.2);
      position: fixed;
      height: 100vh;
      overflow-y: auto;
      z-index: 100;
      transition: transform 0.3s ease;
    }
    
    .course-sidebar-header {
      padding: 1.5rem;
      border-bottom: 1px solid rgba(0, 255, 255, 0.1);
    }
    
    .back-btn {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      color: var(--cyan-glow);
      text-decoration: none;
      font-weight: 600;
      padding: 0.8rem;
      border-radius: 8px;
      transition: all 0.3s ease;
      margin-bottom: 1rem;
    }
    
    .back-btn:hover {
      background: rgba(0, 255, 255, 0.1);
    }
    
    .course-info {
      text-align: center;
    }
    
    .course-icon-large {
      font-size: 3rem;
      color: var(--cyan-glow);
      text-shadow: var(--border-glow);
      margin-bottom: 1rem;
    }
    
    .course-title {
      font-size: 1.4rem;
      margin-bottom: 0.5rem;
      color: var(--heading-color);
    }
    
    .course-subtitle {
      font-size: 0.9rem;
      color: var(--text-color);
      opacity: 0.8;
      margin-bottom: 1rem;
    }
    
    .overall-progress {
      background: rgba(0, 0, 0, 0.3);
      border-radius: 10px;
      padding: 1rem;
      margin-bottom: 1rem;
    }
    
    .progress-label {
      font-size: 0.85rem;
      color: var(--text-color);
      margin-bottom: 0.5rem;
    }
    
    .progress-bar-container {
      width: 100%;
      height: 8px;
      background: rgba(0, 255, 255, 0.1);
      border-radius: 10px;
      overflow: hidden;
      margin-bottom: 0.5rem;
    }
    
    .progress-bar-fill {
      height: 100%;
      background: var(--button-bg);
      border-radius: 10px;
      transition: width 0.8s ease;
      box-shadow: 0 0 10px var(--cyan-glow);
    }
    
    .progress-text {
      font-size: 0.85rem;
      color: var(--cyan-glow);
      font-weight: 600;
    }
    
    /* Lessons List */
    .lessons-list {
      padding: 1rem 0;
    }
    
    .lessons-header {
      padding: 0 1.5rem 1rem 1.5rem;
      font-size: 1.1rem;
      color: var(--heading-color);
      border-bottom: 1px solid rgba(0, 255, 255, 0.1);
    }
    
    .lesson-item {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 1rem 1.5rem;
      cursor: pointer;
      transition: all 0.3s ease;
      border-left: 3px solid transparent;
    }
    
    .lesson-item:hover {
      background: rgba(0, 255, 255, 0.05);
    }
    
    .lesson-item.active {
      background: rgba(0, 255, 255, 0.1);
      border-left-color: var(--cyan-glow);
    }
    
    .lesson-item.completed {
      opacity: 0.8;
    }
    
    .lesson-status {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.8rem;
      flex-shrink: 0;
    }
    
    .lesson-status.completed {
      background: var(--success-color);
      color: var(--black-bg);
    }
    
    .lesson-status.current {
      background: var(--cyan-glow);
      color: var(--black-bg);
    }
    
    .lesson-status.locked {
      background: rgba(255, 255, 255, 0.1);
      color: var(--text-color);
    }
    
    .lesson-details {
      flex: 1;
    }
    
    .lesson-title {
      font-size: 0.9rem;
      font-weight: 600;
      color: var(--heading-color);
      margin-bottom: 0.3rem;
    }
    
    .lesson-duration {
      font-size: 0.8rem;
      color: var(--text-color);
      opacity: 0.7;
    }
    
    /* Mobile Menu Toggle */
    .mobile-menu-toggle {
      display: none;
      position: fixed;
      top: 1rem;
      left: 1rem;
      z-index: 101;
      background: var(--card-bg);
      border: 1px solid var(--cyan-glow);
      border-radius: 8px;
      padding: 0.5rem 0.8rem;
      color: var(--cyan-glow);
      cursor: pointer;
      box-shadow: var(--border-glow);
    }
    
    /* Content Area */
    .content-area {
      flex: 1;
      margin-left: var(--sidebar-width);
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }
    
    .content-header {
      background: var(--card-bg);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid rgba(0, 255, 255, 0.1);
      padding: 1.5rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 1rem;
    }
    
    .lesson-info h1 {
      font-size: 1.5rem;
      margin-bottom: 0.5rem;
    }
    
    .lesson-meta {
      display: flex;
      gap: 1.5rem;
      font-size: 0.9rem;
      color: var(--text-color);
    }
    
    .lesson-meta span {
      display: flex;
      align-items: center;
      gap: 0.3rem;
    }
    
    .content-actions {
      display: flex;
      gap: 1rem;
      align-items: center;
    }
    
    .action-btn {
      padding: 0.8rem 1.5rem;
      background: var(--button-bg);
      color: var(--button-text-color);
      border: none;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      font-family: 'Inter', sans-serif;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .action-btn:hover {
      box-shadow: var(--border-glow);
      transform: scale(1.05);
    }
    
    .action-btn.secondary {
      background: transparent;
      border: 2px solid var(--cyan-glow);
      color: var(--cyan-glow);
    }
    
    .action-btn.secondary:hover {
      background: var(--cyan-glow);
      color: var(--black-bg);
    }
    
    .action-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    /* Main Content */
    .main-content {
      flex: 1;
      padding: 2.5rem;
      background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
    }

    .content-card {
      background: var(--card-bg);
      border-radius: 15px;
      padding: 2.5rem;
      box-shadow: var(--border-glow);
      backdrop-filter: blur(5px);
      border: 1px solid rgba(0, 255, 255, 0.1);
      margin-bottom: 2rem;
      max-width: 900px; /* Control content width */
      margin-left: auto;
      margin-right: auto;
    }
    
    .lesson-content {
      line-height: 1.8;
      font-size: 1.1rem;
    }
    
    .lesson-content h2 {
      color: var(--cyan-glow);
      margin: 2rem 0 1rem 0;
      font-size: 1.6rem;
      border-bottom: 1px solid rgba(0, 255, 255, 0.2);
      padding-bottom: 0.5rem;
    }
    
    .lesson-content h3 {
      color: var(--heading-color);
      margin: 1.5rem 0 0.8rem 0;
      font-size: 1.3rem;
    }

    .lesson-content p, .lesson-content li {
        color: var(--text-color);
    }
    
    .lesson-content p {
      margin-bottom: 1.2rem;
    }
    
    .lesson-content ul, .lesson-content ol {
      margin: 1rem 0 1rem 2rem;
    }
    
    .lesson-content li {
      margin-bottom: 0.7rem;
    }
    
    /* Overriding PrismJS theme for better integration */
    .lesson-content code[class*="language-"],
    .lesson-content pre[class*="language-"] {
      color: #f8f8f2;
      font-family: 'Courier New', monospace;
      font-size: 0.95em;
      text-shadow: none;
    }
    
    .lesson-content pre[class*="language-"] {
      padding: 1.5rem;
      margin: 1.5rem 0;
      overflow: auto;
      border-radius: 8px;
      border-left: 4px solid var(--cyan-glow);
      background: #011627; /* A dark blue that fits the theme */
    }

    /* Practical Assignment Box */
    .assignment-box {
        background: rgba(0, 255, 255, 0.05);
        border: 1px solid rgba(0, 255, 255, 0.2);
        border-left: 4px solid var(--cyan-glow);
        padding: 1.5rem;
        margin: 2rem 0;
        border-radius: 8px;
    }
    .assignment-box h3 {
        margin-top: 0;
        color: var(--cyan-glow);
        display: flex;
        align-items: center;
        gap: 0.7rem;
    }
    
    /* Navigation Controls */
    .lesson-navigation {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1.5rem 2rem;
      background: var(--card-bg);
      backdrop-filter: blur(10px);
      border-top: 1px solid rgba(0, 255, 255, 0.1);
    }
    
    .nav-info {
      display: flex;
      align-items: center;
      gap: 1rem;
      font-size: 0.9rem;
      color: var(--text-color);
    }
    
    .lesson-indicator {
      background: rgba(0, 255, 255, 0.1);
      padding: 0.5rem 1rem;
      border-radius: 20px;
      border: 1px solid rgba(0, 255, 255, 0.3);
    }
    
    .nav-buttons {
      display: flex;
      gap: 1rem;
    }
    
    /* Comments Section */
    .comments-section {
        margin-top: 2rem;
    }
    .comments-section h3 {
        color: var(--cyan-glow);
    }
    .comment-box {
        width: 100%;
        background: rgba(0,0,0,0.3);
        border: 1px solid rgba(0,255,255,0.2);
        border-radius: 8px;
        padding: 1rem;
        color: var(--text-color);
        font-family: 'Inter', sans-serif;
        font-size: 1rem;
        min-height: 100px;
        resize: vertical;
        margin-bottom: 1rem;
    }

    /* Modal Styles (Lesson Completion, Final Exam, Certificate) */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.85);
      backdrop-filter: blur(5px);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      padding: 1rem;
    }
    
    .modal-content {
      background: var(--gradient-end);
      padding: 2rem 2.5rem;
      border-radius: 15px;
      text-align: center;
      max-width: 600px;
      width: 100%;
      box-shadow: var(--hover-glow);
      border: 1px solid rgba(0, 255, 255, 0.3);
      max-height: 90vh;
      overflow-y: auto;
    }
    
    .modal-icon {
      font-size: 4rem;
      margin-bottom: 1rem;
    }
    .modal-icon.success { color: var(--success-color); }
    .modal-icon.exam { color: var(--cyan-glow); }
    .modal-icon.certificate { color: var(--warning-color); }
    
    .modal-title {
      font-size: 1.8rem;
      margin-bottom: 1rem;
      color: var(--heading-color);
    }
    
    .modal-message {
      color: var(--text-color);
      margin-bottom: 2rem;
      line-height: 1.6;
    }
    
    .points-earned {
      background: rgba(0, 255, 255, 0.1);
      border: 1px solid rgba(0, 255, 255, 0.3);
      padding: 1rem;
      border-radius: 8px;
      margin-bottom: 2rem;
      color: var(--cyan-glow);
    }

    /* Final Exam Styles */
    #quizContainer {
        text-align: left;
    }
    .quiz-question {
      font-size: 1.2rem;
      color: var(--heading-color);
      margin-bottom: 1.5rem;
    }
    .quiz-options {
      display: grid;
      gap: 1rem;
      margin-bottom: 2rem;
    }
    .quiz-option {
      padding: 1rem 1.5rem;
      background: rgba(0, 0, 0, 0.3);
      border: 2px solid rgba(0, 255, 255, 0.2);
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      color: var(--text-color);
    }
    .quiz-option:hover {
      border-color: var(--cyan-glow);
      background: rgba(0, 255, 255, 0.05);
    }
    .quiz-option.selected {
      border-color: var(--cyan-glow);
      background: rgba(0, 255, 255, 0.1);
      color: var(--cyan-glow);
    }

    /* Certificate Form Styles */
    #certificateForm {
        display: grid;
        gap: 1.5rem;
        text-align: left;
    }
    .form-group {
        display: flex;
        flex-direction: column;
    }
    .form-group label {
        margin-bottom: 0.5rem;
        font-weight: 600;
        color: var(--cyan-glow);
    }
    .form-group input {
        padding: 0.8rem 1rem;
        background: rgba(0,0,0,0.4);
        border: 1px solid rgba(0,255,255,0.3);
        border-radius: 8px;
        color: var(--text-color);
        font-size: 1rem;
    }
    
    /* Loading State */
    .loading-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 50vh;
    }
    
    .loading-spinner {
      width: 60px;
      height: 60px;
      border: 4px solid rgba(0, 255, 255, 0.1);
      border-top-color: var(--cyan-glow);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    .loading-text {
      margin-top: 1rem;
      color: var(--text-color);
      font-size: 1.1rem;
    }
    
    /* Responsive Design */
    @media (max-width: 1100px) {
      .course-sidebar {
        transform: translateX(-100%);
      }
    
      .course-sidebar.active {
        transform: translateX(0);
        box-shadow: 0 0 50px rgba(0,0,0,0.5);
      }
    
      .content-area {
        margin-left: 0;
      }
    
      .mobile-menu-toggle {
        display: block;
      }
    }

    @media (max-width: 768px) {
      .main-content, .content-card {
        padding: 1.5rem;
      }
      .main-content {
        padding-top: 5rem;
      }
      .content-header {
        padding: 1rem;
        flex-direction: column;
        align-items: flex-start;
      }
      .content-actions {
        width: 100%;
        justify-content: stretch;
      }
      .action-btn { flex: 1; justify-content: center; }
      .lesson-navigation {
        padding: 1rem;
        flex-direction: column;
        gap: 1rem;
      }
      .nav-buttons {
        width: 100%;
        justify-content: stretch;
      }
      .nav-buttons .action-btn { flex: 1; }
    }
  </style>
</head>
<body>
  <div id="stars-container"></div>

  <button class="mobile-menu-toggle" id="mobileMenuToggle">
    <i class="fas fa-bars"></i>
  </button>

  <div class="course-viewer-container">
    <aside class="course-sidebar" id="courseSidebar">
      <div class="course-sidebar-header">
        <a href="studyingatelvion.html" class="back-btn">
          <i class="fas fa-arrow-left"></i>
          Back to Dashboard
        </a>
        
        <div class="course-info">
          <i id="courseIconLarge" class="course-icon-large"></i>
          <h2 id="courseTitle" class="course-title">Loading...</h2>
          <p id="courseSubtitle" class="course-subtitle">Please wait...</p>
          
          <div class="overall-progress">
            <div class="progress-label">Overall Progress</div>
            <div class="progress-bar-container">
              <div id="overallProgressBar" class="progress-bar-fill" style="width: 0%"></div>
            </div>
            <div id="overallProgressText" class="progress-text">0% Complete</div>
          </div>
        </div>
      </div>

      <div class="lessons-list">
        <div class="lessons-header">Course Lessons</div>
        <div id="lessonsContainer">
          </div>
      </div>
    </aside>

    <main class="content-area">
      <div class="loading-container" id="loadingContainer">
        <div class="loading-spinner"></div>
        <p class="loading-text">Loading course content...</p>
      </div>

      <header class="content-header" id="contentHeader" style="display: none;">
        <div class="lesson-info">
          <h1 id="lessonTitle">Lesson Title</h1>
          <div class="lesson-meta">
            <span><i class="fas fa-clock"></i> <span id="lessonDuration">...</span></span>
            <span><i class="fas fa-book"></i> Lesson <span id="currentLessonNumber">...</span> of <span id="totalLessons">...</span></span>
            <span><i class="fas fa-star"></i> <span id="lessonPoints">10</span> Points</span>
          </div>
        </div>
        <div class="content-actions">
          <button id="markCompleteBtn" class="action-btn">
            <i class="fas fa-check"></i>
            Mark as Complete
          </button>
        </div>
      </header>

      <section class="main-content" id="mainContent" style="display: none;">
        
        <div class="content-card">
          <div id="lessonContent" class="lesson-content">
            </div>
          <div class="comments-section">
            <h3><i class="fas fa-comments"></i> Leave a Comment or Question</h3>
            <p style="font-size: 0.9rem; opacity: 0.8; margin-bottom: 1rem;">Share your thoughts on this lesson! (Note: This is a visual placeholder)</p>
            <textarea class="comment-box" placeholder="Type your comment here..."></textarea>
            <button class="action-btn secondary">Submit Comment</button>
          </div>
        </div>

        <div id="certificateContainer" class="content-card" style="display:none;">
            <h2><i class="fas fa-award"></i> Claim Your Certificate</h2>
            <p>Congratulations on passing the final exam! You've demonstrated a strong understanding of the material. To receive your Certificate of Completion, please fill out the form below and submit your final year project.</p>
            
            <div class="assignment-box">
                <h3><i class="fas fa-tasks"></i> Final Project Submission</h3>
                <p>As the final step, please complete your course's final project and email it to us. This is a crucial part of demonstrating your practical skills.</p>
                <p><strong>Email your project to:</strong> <a href="mailto:elvionailabs@gmail.com">elvionailabs@gmail.com</a></p>
                <p>You will receive your results and certificate by mail once your project has been reviewed.</p>
            </div>

            <form id="certificateForm" action="https://formspree.io/f/mldrbpwo" method="POST">
                <div class="form-group">
                    <label for="fullName">Full Name (As it should appear on certificate)</label>
                    <input type="text" id="fullName" name="fullName" required>
                </div>
                <div class="form-group">
                    <label for="email">Email Address (Where your certificate will be sent)</label>
                    <input type="email" id="email" name="email" required>
                </div>
                <input type="hidden" name="course" id="formCourseName">
                <input type="hidden" name="finalScore" id="formFinalScore">
                <button type="submit" class="action-btn" style="width: 100%; justify-content: center;">Submit & Claim Certificate</button>
            </form>
        </div>

      </section>

      <nav class="lesson-navigation" id="lessonNavigation" style="display: none;">
        <div class="nav-info">
          <div class="lesson-indicator">
            Lesson <span id="navCurrentLesson">1</span> of <span id="navTotalLessons">8</span>
          </div>
          <span><i class="fas fa-trophy"></i> <span id="totalPointsEarned">0</span> Points Earned</span>
        </div>
        <div class="nav-buttons">
          <button id="prevLessonBtn" class="action-btn secondary">
            <i class="fas fa-chevron-left"></i>
            Previous
          </button>
          <button id="nextLessonBtn" class="action-btn">
            Next
            <i class="fas fa-chevron-right"></i>
          </button>
        </div>
      </nav>
    </main>
  </div>

  <div id="completionModal" class="modal">
    <div class="modal-content">
      <i class="fas fa-trophy modal-icon success"></i>
      <h2 class="modal-title">Lesson Complete!</h2>
      <p class="modal-message">
        Congratulations! You've successfully completed this lesson. Keep up the momentum!
      </p>
      <div class="points-earned">
        <i class="fas fa-star"></i>
        You earned <span id="pointsEarned">10</span> points!
      </div>
      <button id="continueBtn" class="action-btn" style="width: 100%; justify-content: center;">
        Continue to Next Lesson
      </button>
    </div>
  </div>

  <div id="finalExamModal" class="modal">
    <div class="modal-content">
        <i class="fas fa-file-alt modal-icon exam"></i>
        <h2 class="modal-title">Final Exam</h2>
        <p id="examIntro" class="modal-message">You have completed all lessons! Now it's time to test your knowledge with the final exam. You must score at least 70% to pass and unlock your certificate.</p>
        
        <div id="quizContainer">
            </div>

        <div id="examResult" style="display: none;">
          <h3 id="resultTitle"></h3>
          <p id="resultScore"></p>
          <p id="resultMessage"></p>
        </div>

        <button id="submitExamBtn" class="action-btn" style="width: 100%; justify-content: center;">Submit Answers</button>
        <button id="proceedToCertBtn" class="action-btn" style="display:none; width: 100%; justify-content: center;">Proceed to Certificate</button>
        <button id="retryExamBtn" class="action-btn secondary" style="display:none; width: 100%; justify-content: center;">Retry Exam</button>

    </div>
  </div>


  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-auth.js";
    import { getFirestore, doc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore.js";

    // IMPORTANT: Replace with your actual Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyAyROm0aBGjry6NUfhNM3e0qwPcCDoIqSk",
      authDomain: "elvionai.firebaseapp.com",
      projectId: "elvionai",
      storageBucket: "elvionai.firebasestorage.app",
      messagingSenderId: "161078300830",
      appId: "1:161078300830:web:f460df8591704eb0e96b8f"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // --- COURSE DATABASE ---
    const coursesDatabase = {
        'cs101': {
            id: 'cs101',
            title: 'Computer Science',
            description: 'Fundamentals of computing, programming, and algorithms.',
            icon: 'fas fa-laptop-code',
            lessons: [
              { id: 1, title: 'Introduction to Programming', duration: '45 min', content: `<h2>Welcome to Programming!</h2><p>Programming is the art of telling a computer what to do. In this lesson, we'll cover the core concepts that are the foundation of every programming language, from Python to JavaScript.</p><h3>What is an Algorithm?</h3><p>An algorithm is a step-by-step set of instructions for solving a problem. Think of it like a recipe: it has ingredients (input) and a series of steps to produce a result (output).</p><pre><code class="language-js">// A simple algorithm in JavaScript to add two numbers
function add(a, b) {
  return a + b;
}</code></pre><h3>Variables & Data Types</h3><p>Variables are containers for storing data values. Common data types include:</p><ul><li><strong>String:</strong> Text, like "Hello World"</li><li><strong>Integer:</strong> Whole numbers, like 10 or -5</li><li><strong>Boolean:</strong> True or false values</li></ul><div class="assignment-box"><h3><i class="fas fa-pencil-alt"></i> Practical Task</h3><p>Declare three variables in your favorite language: one for your name (a string), one for your age (an integer), and one to indicate if you are a student (a boolean).</p></div>` },
              { id: 2, title: 'Control Structures', duration: '50 min', content: `<h2>Making Decisions in Code</h2><p>Control structures allow your program to make decisions and repeat actions. The two main types are conditional statements and loops.</p><h3>Conditional Statements (If/Else)</h3><p>These structures execute code only if a certain condition is true.</p><pre><code class="language-python">age = 18
if age >= 18:
  print("You are an adult.")
else:
  print("You are a minor.")</code></pre><h3>Loops (For/While)</h3><p>Loops are used to execute a block of code repeatedly.</p><ul><li><strong>For Loop:</strong> Repeats for a specific number of times.</li><li><strong>While Loop:</strong> Repeats as long as a condition is true.</li></ul><pre><code class="language-python"># For loop to print numbers 1 to 5
for i in range(1, 6):
  print(i)</code></pre><div class="assignment-box"><h3><i class="fas fa-pencil-alt"></i> Practical Task</h3><p>Write a program that uses a loop to print all the even numbers from 2 to 20.</p></div>` },
              { id: 3, title: 'Functions', duration: '40 min', content: `<h2>Organizing Code with Functions</h2><p>Functions are reusable blocks of code that perform a specific task. They help make your code modular, organized, and easier to debug.</p><h3>Defining and Calling a Function</h3><p>You define a function with a name and then "call" it when you want to execute its code.</p><pre><code class="language-js">// Defining the function
function greet(name) {
  console.log("Hello, " + name + "!");
}

// Calling the function
greet("Alice"); // Output: Hello, Alice!
greet("Bob");   // Output: Hello, Bob!</code></pre><h3>Return Values</h3><p>Functions can also process data and return a result.</p><pre><code class="language-js">function calculateArea(width, height) {
  return width * height;
}

let area = calculateArea(10, 5); // area is now 50
console.log("The area is: " + area);</code></pre><div class="assignment-box"><h3><i class="fas fa-pencil-alt"></i> Practical Task</h3><p>Create a function that takes a temperature in Celsius and returns the equivalent temperature in Fahrenheit. The formula is: F = (C * 9/5) + 32.</p></div>` },
              { id: 4, title: 'Final Project: Simple Calculator', duration: '90 min', content: `<h2>Project: Build a Simple Calculator</h2><p>For your final project, you will apply everything you've learned to build a simple command-line calculator.</p><h3>Project Requirements</h3><ul><li>The program should ask the user for two numbers.</li><li>It should ask the user for an operation (add, subtract, multiply, divide).</li><li>It should use functions to perform each of the four operations.</li><li>It should display the result to the user.</li></ul><h3>Example Pseudocode</h3><pre><code class="language-text">START
  FUNCTION add(a, b): RETURN a + b
  FUNCTION subtract(a, b): RETURN a - b
  
  PRINT "Enter first number:"
  READ num1
  
  PRINT "Enter second number:"
  READ num2
  
  PRINT "Enter operation (+, -, *, /):"
  READ operation
  
  IF operation == "+":
    result = add(num1, num2)
  ELSE IF ...
  
  PRINT "The result is: " + result
END</code></pre><div class="assignment-box"><h3><i class="fas fa-tasks"></i> Your Assignment</h3><p>Implement the simple calculator in the programming language of your choice. Ensure your code is well-commented and organized into functions. Submit your code file as the final project.</p></div>` },
            ],
            quiz: [
                { q: "What is a variable?", o: ["A reusable block of code", "A container for storing data", "A step-by-step instruction"], a: 1 },
                { q: "Which control structure is best for repeating code a known number of times?", o: ["If/Else", "While Loop", "For Loop"], a: 2 },
                { q: "What is the main purpose of a function?", o: ["To store data values", "To make code reusable and organized", "To stop the program"], a: 1 },
                { q: "What data type would you use to store a user's name?", o: ["Integer", "Boolean", "String"], a: 2 }
            ]
        },
        'art101': {
            id: 'art101',
            title: 'Animation & Digital Arts',
            description: 'Bring stories to life with animation and digital illustration.',
            icon: 'fas fa-palette',
            lessons: [
              { id: 1, title: 'Introduction to Digital Arts', duration: '45 min', content: `<h2>Welcome to the World of Digital Art!</h2><p>Digital art is a modern art form where technology is used as an essential part of the creative process. This can include everything from digital painting in Photoshop to 3D modeling in Blender.</p><h3>Key Tools of the Trade</h3><ul><li><strong>Graphics Tablet:</strong> A device like a Wacom or Huion tablet that lets you draw naturally on a computer.</li><li><strong>Digital Art Software:</strong> Programs like Adobe Photoshop, Procreate (for iPad), Krita (free & open-source), or Blender (for 3D).</li></ul><h3>Pixels vs. Vectors</h3><p>It's crucial to understand the two main types of digital images:</p><ul><li><strong>Raster (Bitmap):</strong> Made of pixels. They lose quality when scaled up (e.g., photos, digital paintings).</li><li><strong>Vector:</strong> Made of mathematical paths. They can be scaled infinitely without losing quality (e.g., logos, icons).</li></ul><div class="assignment-box"><h3><i class="fas fa-pencil-alt"></i> Practical Task</h3><p>Download and install a free digital art program like Krita. Familiarize yourself with the interface: find the brush tool, the eraser, and the color picker. Try drawing a simple shape.</p></div>` },
              { id: 2, title: 'The 12 Principles of Animation', duration: '60 min', content: `<h2>Bringing Drawings to Life</h2><p>Created by Disney animators in the 1930s, the 12 basic principles of animation are the foundation of all animation work. Understanding them is key to making your animations look believable and appealing.</p><h3>Core Principles Explained</h3><ul><li><strong>Squash and Stretch:</strong> Gives a sense of weight and flexibility to objects. Imagine a bouncing ball squashing as it hits the ground and stretching as it falls and rises.</li><li><strong>Timing and Spacing:</strong> Timing refers to the number of frames for an action. Spacing refers to how those frames are positioned. Closer spacing creates slower movement; wider spacing creates faster movement.</li><li><strong>Anticipation:</strong> A preparatory action that signals a major action is about to happen. A character bending their knees before a jump is anticipation.</li></ul><p>We'll cover the other principles (Staging, Follow Through, Arcs, etc.) in more detail, but these three are a great starting point.</p><div class="assignment-box"><h3><i class="fas fa-pencil-alt"></i> Practical Task</h3><p>Find a video of a bouncing ball. Observe how it squashes on impact and stretches in motion. Try to sketch a few keyframes of this action on paper or in your digital art software.</p></div>` },
              { id: 3, title: 'Your First Animation in Blender', duration: '90 min', content: `<h2>Creating a 3D Animation</h2><p>Blender is a powerful, free, and open-source 3D creation suite. We will use it to create a simple animation of a bouncing ball.</p><h3>Step-by-Step Guide</h3><ol><li><strong>Setup:</strong> Open Blender. You'll see a default cube. Delete it (press 'X'). Add a UV Sphere (Shift + A > Mesh > UV Sphere). Add a Plane to act as the ground (Shift + A > Mesh > Plane). Scale the plane up (press 'S' and move the mouse).</li><li><strong>Keyframing:</strong> Move the ball up above the plane. With the ball selected, go to frame 1 in the timeline at the bottom. Press 'I' and select 'Location' to set the first keyframe.</li><li><strong>The Bounce:</strong> Go to frame 10 in the timeline. Move the ball down so it's touching the plane. Press 'I' and select 'Location' again.</li><li><strong>The Rebound:</strong> Go to frame 20. Move the ball back up, but not as high as the start. Press 'I' and select 'Location'.</li><li><strong>Playback:</strong> Set the 'End' frame in the timeline to 20. Press the spacebar to play your animation!</li></ol><div class="assignment-box"><h3><i class="fas fa-pencil-alt"></i> Practical Task</h3><p>Follow the steps above to create your own bouncing ball animation in Blender. Experiment with the timing (moving the keyframes) to change the speed of the bounce.</p></div>` },
              { id: 4, title: 'Final Project: Character Walk Cycle', duration: '120 min', content: `<h2>Project: Animate a Walk Cycle</h2><p>A walk cycle is one of the most fundamental animations to learn. Your final project is to create a simple 2D or 3D character walk cycle.</p><h3>Project Requirements</h3><ul><li>The animation should loop seamlessly.</li><li>It should demonstrate key principles like Timing and Arcs (the character's body should move in natural arcs).</li><li>The four key poses are: Contact, Down, Passing, and Up.</li></ul><h3>Resources</h3><p>There are many great tutorials online for creating walk cycles. A famous resource is "The Animator's Survival Kit" by Richard Williams. Look up "walk cycle key poses" to see visual guides.</p><div class="assignment-box"><h3><i class="fas fa-tasks"></i> Your Assignment</h3><p>Using any software you like (Krita for 2D, Blender for 3D), create a simple character and animate them walking in place. Submit your final animation as a short video file (MP4) or animated GIF.</p></div>` },
            ],
            quiz: [
                { q: "Which image type loses quality when scaled up?", o: ["Vector", "Raster (Bitmap)", "Both"], a: 1 },
                { q: "The principle of 'Squash and Stretch' gives a sense of...?", o: ["Speed", "Weight and Flexibility", "Color"], a: 1 },
                { q: "What is the term for a preparatory action before a main action?", o: ["Timing", "Follow Through", "Anticipation"], a: 2 },
                { q: "Which of these is a popular, free 3D animation software?", o: ["Adobe Photoshop", "Procreate", "Blender"], a: 2 }
            ]
        },
        // ... Add other course objects here following the same detailed structure
    };
    
    let currentUser = null;
    let userData = null;
    let currentCourse = null;
    let currentLessonId = 1;
    let totalLessons = 0;

    // URL Parameters
    const urlParams = new URLSearchParams(window.location.search);
    const courseId = urlParams.get('courseId');
    const lessonParam = urlParams.get('lesson');

    // --- INITIALIZATION ---
    document.addEventListener('DOMContentLoaded', () => {
      // Stars Animation
      const starsContainer = document.getElementById('stars-container');
      const numStars = 100;

      for (let i = 0; i < numStars; i++) {
        const star = document.createElement('div');
        star.className = 'star';
        star.style.width = `${1 + Math.random() * 2}px`;
        star.style.height = star.style.width;
        star.style.left = `${Math.random() * 100}%`;
        star.style.top = `${Math.random() * 100}%`;
        star.style.animationDelay = `${Math.random() * 4}s`;
        starsContainer.appendChild(star);
      }

      // Mobile Menu Toggle
      const mobileMenuToggle = document.getElementById('mobileMenuToggle');
      const courseSidebar = document.getElementById('courseSidebar');
      mobileMenuToggle.addEventListener('click', () => courseSidebar.classList.toggle('active'));
      document.addEventListener('click', (e) => {
        if (window.innerWidth <= 1100 && !courseSidebar.contains(e.target) && !mobileMenuToggle.contains(e.target)) {
          courseSidebar.classList.remove('active');
        }
      });
    });
    
    // Auth State Management
    onAuthStateChanged(auth, async (user) => {
      if (user) {
        currentUser = user;
        await loadUserData();
        await initializeCourseViewer();
      } else {
        // Redirect to a generic sign-up page or the dashboard if login is required
        window.location.href = 'studyingatelvion.html';
      }
    });

    async function loadUserData() {
      try {
        const userDocRef = doc(db, 'users', currentUser.uid);
        const userDoc = await getDoc(userDocRef);
        
        if (userDoc.exists()) {
          userData = userDoc.data();
        } else {
          // If no user data, redirect. User should have been created at sign-up.
          window.location.href = 'studyingatelvion.html';
        }
      } catch (error) {
        console.error('Error loading user data:', error);
      }
    }

    async function initializeCourseViewer() {
      if (!courseId || !coursesDatabase[courseId]) {
        alert('Course not found.');
        window.location.href = 'studyingatelvion.html';
        return;
      }
      
      currentCourse = coursesDatabase[courseId];
      totalLessons = currentCourse.lessons.length;
      currentLessonId = parseInt(lessonParam) || 1;

      // Mock enrollment check if needed, otherwise assume user is enrolled if they have the link
      const enrolledCourse = userData.enrolledCourses?.find(c => c.courseId === courseId) || { progress: 0, completedLessons: [], currentLesson: 1 };
      if (!userData.enrolledCourses?.some(c => c.courseId === courseId)) {
        // Auto-enroll if not already
        if (!userData.enrolledCourses) userData.enrolledCourses = [];
        userData.enrolledCourses.push({
            courseId: courseId,
            progress: 0,
            completedLessons: [],
            currentLesson: 1
        });
        // In a real app, you might want to save this back to the DB immediately
      }

      setupCourseInterface();
      renderLessonsList();
      loadLesson(currentLessonId);
      
      document.getElementById('loadingContainer').style.display = 'none';
      document.getElementById('contentHeader').style.display = 'flex';
      document.getElementById('mainContent').style.display = 'block';
      document.getElementById('lessonNavigation').style.display = 'flex';
    }
    
    // --- UI & CONTENT RENDERING ---
    function setupCourseInterface() {
      document.getElementById('courseIconLarge').className = `course-icon-large ${currentCourse.icon}`;
      document.getElementById('courseTitle').textContent = currentCourse.title;
      document.getElementById('courseSubtitle').textContent = currentCourse.description;
      updateOverallProgress();
    }

    function updateOverallProgress() {
      const enrolledCourse = userData.enrolledCourses?.find(c => c.courseId === courseId) || { progress: 0, completedLessons: [] };
      const progress = enrolledCourse.progress;
      const completedCount = enrolledCourse.completedLessons.length;
      
      document.getElementById('overallProgressBar').style.width = `${progress}%`;
      document.getElementById('overallProgressText').textContent = `${progress}% Complete (${completedCount}/${totalLessons} lessons)`;
      document.getElementById('totalPointsEarned').textContent = userData.totalPoints || 0;
    }

    function renderLessonsList() {
      const container = document.getElementById('lessonsContainer');
      const enrolledCourse = userData.enrolledCourses?.find(c => c.courseId === courseId) || { completedLessons: [], currentLesson: 1 };
      container.innerHTML = '';
      
      currentCourse.lessons.forEach(lesson => {
        const isCompleted = enrolledCourse.completedLessons.includes(lesson.id);
        const isCurrent = lesson.id === currentLessonId;
        // Make all lessons accessible for this simplified version
        const isAccessible = true;

        const lessonItem = document.createElement('div');
        lessonItem.className = `lesson-item ${isCurrent ? 'active' : ''} ${isCompleted ? 'completed' : ''}`;
        
        let statusIcon = isCompleted ? '<i class="fas fa-check"></i>' : (isAccessible ? lesson.id : '<i class="fas fa-lock"></i>');
        let statusClass = isCompleted ? 'completed' : (isCurrent ? 'current' : (isAccessible ? 'current' : 'locked'));
        
        lessonItem.innerHTML = `
          <div class="lesson-status ${statusClass}">${statusIcon}</div>
          <div class="lesson-details">
            <div class="lesson-title">${lesson.title}</div>
            <div class="lesson-duration">${lesson.duration}</div>
          </div>
        `;
        
        if (isAccessible) {
          lessonItem.addEventListener('click', () => loadLesson(lesson.id));
        } else {
          lessonItem.style.cursor = 'not-allowed';
          lessonItem.style.opacity = '0.6';
        }
        container.appendChild(lessonItem);
      });
    }

    function loadLesson(lessonId) {
      const lesson = currentCourse.lessons.find(l => l.id === lessonId);
      if (!lesson) return;
      
      currentLessonId = lessonId;
      const newUrl = new URL(window.location);
      newUrl.searchParams.set('lesson', lessonId);
      window.history.pushState({}, '', newUrl);
      
      // Update header & nav
      document.getElementById('lessonTitle').textContent = lesson.title;
      document.getElementById('lessonDuration').textContent = lesson.duration;
      document.getElementById('currentLessonNumber').textContent = lessonId;
      document.getElementById('totalLessons').textContent = totalLessons;
      document.getElementById('navCurrentLesson').textContent = lessonId;
      document.getElementById('navTotalLessons').textContent = totalLessons;
      
      // Update content & highlight code
      document.getElementById('lessonContent').innerHTML = lesson.content;
      Prism.highlightAll();
      
      // Update buttons
      document.getElementById('prevLessonBtn').disabled = lessonId === 1;
      document.getElementById('nextLessonBtn').disabled = lessonId === totalLessons;
      
      const enrolledCourse = userData.enrolledCourses.find(c => c.courseId === courseId);
      const isCompleted = enrolledCourse.completedLessons.includes(lessonId);
      const markCompleteBtn = document.getElementById('markCompleteBtn');
      
      if (isCompleted) {
        markCompleteBtn.innerHTML = '<i class="fas fa-check-double"></i> Completed';
        markCompleteBtn.disabled = true;
      } else {
        markCompleteBtn.innerHTML = '<i class="fas fa-check"></i> Mark as Complete';
        markCompleteBtn.disabled = false;
      }
      
      renderLessonsList();
      window.scrollTo(0, 0);
      document.getElementById('certificateContainer').style.display = 'none';
      document.getElementById('mainContent').querySelector('.content-card').style.display = 'block';
    }

    // --- USER ACTIONS & LOGIC ---
    async function markLessonComplete() {
      const markCompleteBtn = document.getElementById('markCompleteBtn');
      markCompleteBtn.disabled = true;
      markCompleteBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';

      try {
        const enrolledCourseIndex = userData.enrolledCourses.findIndex(c => c.courseId === courseId);
        const enrolledCourse = userData.enrolledCourses[enrolledCourseIndex];

        if (!enrolledCourse.completedLessons.includes(currentLessonId)) {
          enrolledCourse.completedLessons.push(currentLessonId);
          enrolledCourse.progress = Math.round((enrolledCourse.completedLessons.length / totalLessons) * 100);
          
          userData.totalPoints = (userData.totalPoints || 0) + 10;
          
          await updateDoc(doc(db, 'users', currentUser.uid), {
            enrolledCourses: userData.enrolledCourses,
            totalPoints: userData.totalPoints
          });
          
          updateOverallProgress();
          markCompleteBtn.innerHTML = '<i class="fas fa-check-double"></i> Completed';
          
          if (enrolledCourse.progress < 100) {
            document.getElementById('completionModal').style.display = 'flex';
          } else {
            // Course is complete, trigger final exam
            showFinalExam();
          }
        }
      } catch (error) {
        console.error("Error marking lesson complete: ", error);
        markCompleteBtn.innerHTML = '<i class="fas fa-times"></i> Error';
      }
    }

    // --- FINAL EXAM & CERTIFICATE LOGIC ---
    function showFinalExam() {
        const quizContainer = document.getElementById('quizContainer');
        quizContainer.innerHTML = ''; // Clear previous questions
        
        currentCourse.quiz.forEach((q, index) => {
            let optionsHTML = q.o.map((option, i) => `<div class="quiz-option" data-q-index="${index}" data-o-index="${i}">${option}</div>`).join('');
            quizContainer.innerHTML += `
                <div class="quiz-question">${index + 1}. ${q.q}</div>
                <div class="quiz-options">${optionsHTML}</div>
            `;
        });
        
        document.getElementById('examIntro').style.display = 'block';
        document.getElementById('examResult').style.display = 'none';
        document.getElementById('submitExamBtn').style.display = 'block';
        document.getElementById('proceedToCertBtn').style.display = 'none';
        document.getElementById('retryExamBtn').style.display = 'none';
        
        document.getElementById('finalExamModal').style.display = 'flex';
        
        // Add event listeners to new options
        document.querySelectorAll('.quiz-option').forEach(el => {
            el.addEventListener('click', (e) => {
                const qIndex = e.target.dataset.qIndex;
                // Remove 'selected' from siblings
                document.querySelectorAll(`.quiz-option[data-q-index="${qIndex}"]`).forEach(opt => opt.classList.remove('selected'));
                e.target.classList.add('selected');
            });
        });
    }

    function submitExam() {
        let score = 0;
        currentCourse.quiz.forEach((q, index) => {
            const selectedOption = document.querySelector(`.quiz-option[data-q-index="${index}"].selected`);
            if (selectedOption && parseInt(selectedOption.dataset.oIndex) === q.a) {
                score++;
            }
        });

        const totalQuestions = currentCourse.quiz.length;
        const percentage = Math.round((score / totalQuestions) * 100);

        document.getElementById('quizContainer').style.display = 'none';
        document.getElementById('examIntro').style.display = 'none';
        document.getElementById('examResult').style.display = 'block';
        document.getElementById('submitExamBtn').style.display = 'none';
        
        document.getElementById('resultScore').textContent = `Your Score: ${score} out of ${totalQuestions} (${percentage}%)`;
        
        if (percentage >= 70) {
            document.getElementById('resultTitle').textContent = "Congratulations, you passed!";
            document.getElementById('resultMessage').textContent = "You can now proceed to claim your certificate.";
            document.getElementById('proceedToCertBtn').style.display = 'block';
            document.getElementById('retryExamBtn').style.display = 'none';
            // Store score for the form
            document.getElementById('formFinalScore').value = `${percentage}%`;
        } else {
            document.getElementById('resultTitle').textContent = "More Study Needed";
            document.getElementById('resultMessage').textContent = "Unfortunately, you did not pass the exam. Please review the course materials and try again.";
            document.getElementById('proceedToCertBtn').style.display = 'none';
            document.getElementById('retryExamBtn').style.display = 'block';
        }
    }

    function showCertificateSection() {
        document.getElementById('finalExamModal').style.display = 'none';
        document.getElementById('certificateContainer').style.display = 'block';
        document.getElementById('mainContent').querySelector('.content-card').style.display = 'none';
        document.getElementById('formCourseName').value = currentCourse.title;
        window.scrollTo(0, document.getElementById('certificateContainer').offsetTop);
    }

    // --- EVENT LISTENERS ---
    document.getElementById('markCompleteBtn').addEventListener('click', markLessonComplete);
    document.getElementById('prevLessonBtn').addEventListener('click', () => { if (currentLessonId > 1) loadLesson(currentLessonId - 1) });
    document.getElementById('nextLessonBtn').addEventListener('click', () => { if (currentLessonId < totalLessons) loadLesson(currentLessonId + 1) });
    document.getElementById('continueBtn').addEventListener('click', () => {
      document.getElementById('completionModal').style.display = 'none';
      if (currentLessonId < totalLessons) {
        loadLesson(currentLessonId + 1);
      }
    });

    document.getElementById('submitExamBtn').addEventListener('click', submitExam);
    document.getElementById('retryExamBtn').addEventListener('click', showFinalExam);
    document.getElementById('proceedToCertBtn').addEventListener('click', showCertificateSection);

  </script>
</body>
</html>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-J1YTKP10ZX"></script>
<script>
 window.dataLayer = window.dataLayer || [];
 function gtag(){dataLayer.push(arguments);}
 gtag('js', new Date()); 

 gtag('config', 'G-J1YTKP10ZX');
</script>
