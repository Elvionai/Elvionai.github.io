<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Course Viewer | Elvion University</title>
  <meta name="description" content="Learn with interactive courses at Elvion University">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Orbitron:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --dark-navy: #00001a;
      --black-bg: #000000;
      --cyan-glow: #00ffff;
      --light-blue-glow: #00aaff;
      --text-color: #e0e0e0;
      --heading-color: #ffffff;
      --gradient-start: #0a1128;
      --gradient-end: #121a30;
      --card-bg: rgba(18, 26, 48, 0.85);
      --border-glow: 0 0 10px var(--cyan-glow), 0 0 20px var(--light-blue-glow);
      --hover-glow: 0 0 15px var(--cyan-glow), 0 0 30px var(--light-blue-glow);
      --button-bg: linear-gradient(45deg, var(--cyan-glow), var(--light-blue-glow));
      --button-text-color: var(--black-bg);
      --star-color: rgba(255, 255, 255, 0.7);
      --sidebar-width: 300px;
      --success-color: #4ade80;
      --warning-color: #fbbf24;
      --error-color: #f87171;
      --primary-color: var(--cyan-glow);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html { scroll-behavior: smooth; }

    body {
      font-family: 'Inter', sans-serif;
      background-color: var(--black-bg);
      color: var(--text-color);
      line-height: 1.7;
      overflow-x: hidden;
      position: relative;
      min-height: 100vh;
    }

    h1, h2, h3, h4, h5, h6 {
      font-family: 'Orbitron', sans-serif;
      color: var(--heading-color);
      margin-top: 0;
    }

    /* Stars Animation */
    #stars-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 0;
      overflow: hidden;
    }

    .star {
      position: absolute;
      background-color: var(--star-color);
      border-radius: 50%;
      opacity: 0;
      animation: twinkle 4s infinite ease-in-out;
    }

    @keyframes twinkle {
      0%, 100% { opacity: 0; transform: scale(0.5); }
      50% { opacity: 1; transform: scale(1); }
    }

    /* Main Layout */
    .course-viewer-container {
      display: flex;
      min-height: 100vh;
      position: relative;
      z-index: 1;
    }

    /* Course Sidebar */
    .course-sidebar {
      width: var(--sidebar-width);
      background: var(--card-bg);
      backdrop-filter: blur(10px);
      border-right: 1px solid rgba(0, 255, 255, 0.2);
      position: fixed;
      height: 100vh;
      overflow-y: auto;
      z-index: 100;
      transition: transform 0.3s ease;
    }

    .course-sidebar-header {
      padding: 1.5rem;
      border-bottom: 1px solid rgba(0, 255, 255, 0.1);
    }

    .back-btn {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      color: var(--cyan-glow);
      text-decoration: none;
      font-weight: 600;
      padding: 0.8rem;
      border-radius: 8px;
      transition: all 0.3s ease;
      margin-bottom: 1rem;
    }

    .back-btn:hover {
      background: rgba(0, 255, 255, 0.1);
    }

    .course-info {
      text-align: center;
    }

    .course-icon-large {
      font-size: 3rem;
      color: var(--cyan-glow);
      text-shadow: var(--border-glow);
      margin-bottom: 1rem;
    }

    .course-title {
      font-size: 1.4rem;
      margin-bottom: 0.5rem;
      color: var(--heading-color);
    }

    .course-subtitle {
      font-size: 0.9rem;
      color: var(--text-color);
      opacity: 0.8;
      margin-bottom: 1rem;
    }

    .overall-progress {
      background: rgba(0, 0, 0, 0.3);
      border-radius: 10px;
      padding: 1rem;
      margin-bottom: 1rem;
    }

    .progress-label {
      font-size: 0.85rem;
      color: var(--text-color);
      margin-bottom: 0.5rem;
    }

    .progress-bar-container {
      width: 100%;
      height: 8px;
      background: rgba(0, 255, 255, 0.1);
      border-radius: 10px;
      overflow: hidden;
      margin-bottom: 0.5rem;
    }

    .progress-bar-fill {
      height: 100%;
      background: var(--button-bg);
      border-radius: 10px;
      transition: width 0.8s ease;
      box-shadow: 0 0 10px var(--cyan-glow);
    }

    .progress-text {
      font-size: 0.85rem;
      color: var(--cyan-glow);
      font-weight: 600;
    }

    /* Lessons List */
    .lessons-list {
      padding: 1rem 0;
    }

    .lessons-header {
      padding: 0 1.5rem 1rem 1.5rem;
      font-size: 1.1rem;
      color: var(--heading-color);
      border-bottom: 1px solid rgba(0, 255, 255, 0.1);
    }

    .lesson-item {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 1rem 1.5rem;
      cursor: pointer;
      transition: all 0.3s ease;
      border-left: 3px solid transparent;
    }

    .lesson-item:hover {
      background: rgba(0, 255, 255, 0.05);
    }

    .lesson-item.active {
      background: rgba(0, 255, 255, 0.1);
      border-left-color: var(--cyan-glow);
    }

    .lesson-item.completed {
      opacity: 0.8;
    }

    .lesson-status {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.8rem;
      flex-shrink: 0;
    }

    .lesson-status.completed {
      background: var(--success-color);
      color: var(--black-bg);
    }

    .lesson-status.current {
      background: var(--cyan-glow);
      color: var(--black-bg);
    }

    .lesson-status.locked {
      background: rgba(255, 255, 255, 0.1);
      color: var(--text-color);
    }

    .lesson-details {
      flex: 1;
    }

    .lesson-title {
      font-size: 0.9rem;
      font-weight: 600;
      color: var(--heading-color);
      margin-bottom: 0.3rem;
    }

    .lesson-duration {
      font-size: 0.8rem;
      color: var(--text-color);
      opacity: 0.7;
    }

    /* Mobile Menu Toggle */
    .mobile-menu-toggle {
      display: none;
      position: fixed;
      top: 1rem;
      left: 1rem;
      z-index: 101;
      background: var(--card-bg);
      border: 1px solid var(--cyan-glow);
      border-radius: 8px;
      padding: 0.5rem 0.8rem;
      color: var(--cyan-glow);
      cursor: pointer;
      box-shadow: var(--border-glow);
    }

    /* Content Area */
    .content-area {
      flex: 1;
      margin-left: var(--sidebar-width);
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    .content-header {
      background: var(--card-bg);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid rgba(0, 255, 255, 0.1);
      padding: 1.5rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 1rem;
    }

    .lesson-info h1 {
      font-size: 1.5rem;
      margin-bottom: 0.5rem;
    }

    .lesson-meta {
      display: flex;
      gap: 1.5rem;
      font-size: 0.9rem;
      color: var(--text-color);
    }

    .lesson-meta span {
      display: flex;
      align-items: center;
      gap: 0.3rem;
    }

    .content-actions {
      display: flex;
      gap: 1rem;
      align-items: center;
    }

    .action-btn {
      padding: 0.8rem 1.5rem;
      background: var(--button-bg);
      color: var(--button-text-color);
      border: none;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      font-family: 'Inter', sans-serif;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .action-btn:hover {
      box-shadow: var(--border-glow);
      transform: scale(1.05);
    }

    .action-btn.secondary {
      background: transparent;
      border: 2px solid var(--cyan-glow);
      color: var(--cyan-glow);
    }

    .action-btn.secondary:hover {
      background: var(--cyan-glow);
      color: var(--black-bg);
    }

    .action-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    /* Main Content */
    .main-content {
      flex: 1;
      padding: 2rem;
      background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
    }

    .content-card {
      background: var(--card-bg);
      border-radius: 15px;
      padding: 2rem;
      box-shadow: var(--border-glow);
      backdrop-filter: blur(5px);
      border: 1px solid rgba(0, 255, 255, 0.1);
      margin-bottom: 2rem;
      max-width: 900px; /* Fitting to page constraint */
      margin-left: auto;
      margin-right: auto;
    }

    .lesson-content {
      line-height: 1.8;
      font-size: 1.1rem;
    }

    .lesson-content h2 {
      color: var(--cyan-glow);
      margin: 2rem 0 1rem 0;
      font-size: 1.4rem;
    }

    .lesson-content h3 {
      color: var(--heading-color);
      margin: 1.5rem 0 0.8rem 0;
      font-size: 1.2rem;
    }

    .lesson-content p {
      margin-bottom: 1.2rem;
    }

    .lesson-content ul, .lesson-content ol {
      margin: 1rem 0 1rem 2rem;
    }

    .lesson-content li {
      margin-bottom: 0.5rem;
    }
    
    /* Code block styling for practical examples */
    .lesson-content code {
      background: rgba(0, 255, 255, 0.1);
      padding: 0.2rem 0.5rem;
      border-radius: 4px;
      color: var(--cyan-glow);
      font-family: 'Courier New', monospace;
    }

    .lesson-content pre {
      background: rgba(0, 0, 0, 0.5);
      padding: 1.5rem;
      border-radius: 8px;
      border-left: 4px solid var(--cyan-glow);
      overflow-x: auto;
      margin: 1.5rem 0;
      box-shadow: 0 0 5px rgba(0, 255, 255, 0.3);
      position: relative;
    }

    .lesson-content pre code {
      background: none;
      padding: 0;
      color: var(--text-color);
      display: block;
      white-space: pre-wrap;
      word-break: break-all;
    }

    /* Interactive Code/Markdown Area Simulation */
    .interactive-code-area {
        background: #1e1e2d;
        border: 2px solid var(--primary-color);
        border-radius: 8px;
        padding: 1rem;
        margin: 1.5rem 0;
        box-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
    }
    .interactive-code-area textarea {
        width: 100%;
        min-height: 150px;
        background: transparent;
        color: var(--success-color);
        border: none;
        resize: vertical;
        padding: 0.5rem;
        font-family: 'Courier New', monospace;
        font-size: 1rem;
        outline: none;
    }
    .interactive-code-area .output {
        border-top: 1px dashed rgba(255, 255, 255, 0.2);
        padding-top: 0.5rem;
        color: var(--warning-color);
        font-size: 0.9rem;
        min-height: 30px;
        margin-top: 0.5rem;
    }
    .interactive-code-area .area-header {
        font-size: 0.8rem;
        color: var(--primary-color);
        margin-bottom: 0.5rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }


    /* Video Player Placeholder */
    .media-player {
      width: 100%;
      height: 400px;
      background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 2rem;
      border: 1px solid rgba(0, 255, 255, 0.2);
      max-width: 900px;
      margin-left: auto;
      margin-right: auto;
    }

    .media-placeholder {
      text-align: center;
      color: var(--text-color);
    }

    .media-placeholder i {
      font-size: 4rem;
      color: var(--cyan-glow);
      margin-bottom: 1rem;
      display: block;
    }

    /* Navigation Controls */
    .lesson-navigation {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1.5rem 2rem;
      background: var(--card-bg);
      backdrop-filter: blur(10px);
      border-top: 1px solid rgba(0, 255, 255, 0.1);
    }

    .nav-info {
      display: flex;
      align-items: center;
      gap: 1rem;
      font-size: 0.9rem;
      color: var(--text-color);
    }

    .lesson-indicator {
      background: rgba(0, 255, 255, 0.1);
      padding: 0.5rem 1rem;
      border-radius: 20px;
      border: 1px solid rgba(0, 255, 255, 0.3);
    }

    .nav-buttons {
      display: flex;
      gap: 1rem;
    }

    /* Quiz/Assessment Styles */
    .quiz-container {
      background: var(--card-bg);
      border-radius: 15px;
      padding: 2rem;
      box-shadow: var(--border-glow);
      backdrop-filter: blur(5px);
      border: 1px solid rgba(0, 255, 255, 0.1);
      margin-bottom: 2rem;
      max-width: 900px;
      margin-left: auto;
      margin-right: auto;
    }

    .quiz-question {
      font-size: 1.2rem;
      color: var(--heading-color);
      margin-bottom: 1.5rem;
      border-bottom: 1px solid rgba(0, 255, 255, 0.1);
      padding-bottom: 1rem;
    }

    .quiz-options {
      display: grid;
      gap: 1rem;
      margin-bottom: 2rem;
    }

    .quiz-option {
      padding: 1rem 1.5rem;
      background: rgba(0, 0, 0, 0.3);
      border: 2px solid rgba(0, 255, 255, 0.2);
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease, transform 0.1s ease; /* Added transform for animation */
      color: var(--text-color);
      position: relative;
    }

    .quiz-option:hover {
      border-color: var(--cyan-glow);
      background: rgba(0, 255, 255, 0.05);
      transform: translateY(-2px); /* Slight hover animation */
    }

    .quiz-option.selected {
      border-color: var(--cyan-glow);
      background: rgba(0, 255, 255, 0.1);
      color: var(--cyan-glow);
    }
    
    /* Correct/Incorrect state styling with simple animation */
    .quiz-option.correct {
      border-color: var(--success-color) !important;
      background: rgba(74, 222, 128, 0.1) !important;
      color: var(--success-color) !important;
      animation: flash-correct 0.3s ease-in-out;
    }

    .quiz-option.incorrect {
      border-color: var(--error-color) !important;
      background: rgba(248, 113, 113, 0.1) !important;
      color: var(--error-color) !important;
      animation: shake 0.3s;
    }
    
    .quiz-option.correct::after {
      content: ' (Correct)';
      color: var(--success-color);
      font-weight: bold;
      margin-left: 10px;
    }
    .quiz-option.incorrect::after {
      content: ' (Incorrect)';
      color: var(--error-color);
      font-weight: bold;
      margin-left: 10px;
    }
    
    @keyframes flash-correct {
        0% { opacity: 0.5; }
        100% { opacity: 1; }
    }
    
    @keyframes shake {
        0%, 100% { transform: translateX(0); }
        20%, 60% { transform: translateX(-5px); }
        40%, 80% { transform: translateX(5px); }
    }


    .quiz-feedback {
      padding: 1rem;
      border-radius: 8px;
      margin-top: 1rem;
      display: none;
    }

    .quiz-feedback.correct {
      background: rgba(74, 222, 128, 0.1);
      border: 1px solid rgba(74, 222, 128, 0.3);
      color: var(--success-color);
      display: block;
    }

    .quiz-feedback.incorrect {
      background: rgba(248, 113, 113, 0.1);
      border: 1px solid rgba(248, 113, 113, 0.3);
      color: var(--error-color);
      display: block;
    }
    
    /* Completion Modal Adjustments */
    .completion-modal .completion-icon {
        font-size: 4rem;
        color: var(--success-color);
        text-shadow: 0 0 10px var(--success-color);
        margin-bottom: 1rem;
        animation: pulse 1s infinite alternate;
    }
    
    .completion-modal .points-earned {
        font-size: 1.2rem;
        font-weight: 700;
        color: var(--cyan-glow);
        margin: 1.5rem 0;
        padding: 0.5rem 1rem;
        background: rgba(0, 255, 255, 0.1);
        border-radius: 8px;
        display: inline-block;
        border: 1px solid var(--cyan-glow);
    }
    
    @keyframes pulse {
        from { transform: scale(1); opacity: 0.8; }
        to { transform: scale(1.05); opacity: 1; }
    }


    /* Certificate Form & Final Page Styles */
    .final-page-content {
      max-width: 900px;
      margin: 0 auto;
      text-align: center;
    }
    .certificate-form-card {
      background: var(--card-bg);
      border-radius: 15px;
      padding: 3rem;
      box-shadow: var(--hover-glow);
      border: 1px solid var(--primary-color);
      text-align: left;
      margin-top: 2rem;
    }
    .certificate-form-card h2 {
      color: var(--success-color);
      text-shadow: 0 0 10px var(--success-color);
      margin-bottom: 1.5rem;
    }
    .certificate-form-card label {
      display: block;
      margin-top: 1rem;
      margin-bottom: 0.5rem;
      font-weight: 600;
      color: var(--text-color);
    }
    .certificate-form-card input[type="text"],
    .certificate-form-card input[type="email"] {
      width: 100%;
      padding: 0.8rem;
      border: 2px solid rgba(0, 255, 255, 0.3);
      border-radius: 8px;
      background: rgba(0, 0, 0, 0.3);
      color: var(--text-color);
      font-size: 1rem;
      transition: border-color 0.3s ease;
    }
    .certificate-form-card input:focus {
      border-color: var(--cyan-glow);
      box-shadow: 0 0 5px var(--cyan-glow);
      outline: none;
    }
    .certificate-form-card .submit-btn {
      width: 100%;
      margin-top: 2rem;
    }

    /* Comment Section Styles */
    .comment-section {
        background: rgba(0, 0, 0, 0.3);
        border-radius: 10px;
        padding: 1.5rem;
        margin-top: 2rem;
        border: 1px solid rgba(255, 255, 255, 0.1);
    }
    .comment-section textarea {
        width: 100%;
        min-height: 100px;
        padding: 1rem;
        border-radius: 8px;
        border: 2px solid rgba(0, 255, 255, 0.3);
        background: rgba(0, 0, 0, 0.5);
        color: var(--text-color);
        font-size: 1rem;
        resize: vertical;
        outline: none;
        transition: border-color 0.3s ease;
    }
    .comment-section textarea:focus {
        border-color: var(--cyan-glow);
        box-shadow: 0 0 5px var(--cyan-glow);
    }
    .comment-section .comment-btn {
        margin-top: 1rem;
        padding: 0.6rem 1.2rem;
        font-weight: 500;
        float: right;
    }

    /* Completion Modal */
    .completion-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      backdrop-filter: blur(5px);
    }

    .completion-content {
      background: var(--card-bg);
      padding: 3rem;
      border-radius: 15px;
      text-align: center;
      max-width: 500px;
      box-shadow: var(--hover-glow);
      border: 1px solid rgba(0, 255, 255, 0.3);
    }
    
    /* Loading State */
    .loading-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 50vh;
    }

    .loading-spinner {
      width: 60px;
      height: 60px;
      border: 4px solid rgba(0, 255, 255, 0.1);
      border-top-color: var(--cyan-glow);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .loading-text {
      margin-top: 1rem;
      color: var(--text-color);
      font-size: 1.1rem;
    }

    /* Responsive Design */
    @media (max-width: 992px) {
      .course-sidebar {
        transform: translateX(-100%);
      }

      .course-sidebar.active {
        transform: translateX(0);
      }

      .content-area {
        margin-left: 0;
      }

      .mobile-menu-toggle {
        display: block;
      }

      .main-content {
        padding: 1rem;
        padding-top: 4rem;
      }

      .content-header {
        padding: 1rem;
        flex-direction: column;
        align-items: flex-start;
      }

      .content-actions {
        width: 100%;
        justify-content: stretch;
      }

      .action-btn {
        flex: 1;
        justify-content: center;
      }

      .lesson-navigation {
        padding: 1rem;
        flex-direction: column;
        gap: 1rem;
      }

      .nav-buttons {
        width: 100%;
        justify-content: stretch;
      }

      .nav-buttons .action-btn {
        flex: 1;
      }
    }

    @media (max-width: 768px) {
      .media-player {
        height: 250px;
      }

      .content-card {
        padding: 1.5rem;
      }

      .completion-content {
        margin: 1rem;
        padding: 2rem;
      }

      .quiz-option {
        padding: 0.8rem 1rem;
      }
    }
  </style>
</head>
<body>
  <div id="stars-container"></div>

  <button class="mobile-menu-toggle" id="mobileMenuToggle">
    <i class="fas fa-bars"></i>
  </button>

  <div class="course-viewer-container">
    <aside class="course-sidebar" id="courseSidebar">
      <div class="course-sidebar-header">
        <a href="studyingatelvion.html" class="back-btn">
          <i class="fas fa-arrow-left"></i>
          Back to Dashboard
        </a>
        
        <div class="course-info">
          <i id="courseIconLarge" class="course-icon-large"></i>
          <h2 id="courseTitle" class="course-title">Loading...</h2>
          <p id="courseSubtitle" class="course-subtitle">Please wait...</p>
          
          <div class="overall-progress">
            <div class="progress-label">Overall Progress</div>
            <div class="progress-bar-container">
              <div id="overallProgressBar" class="progress-bar-fill" style="width: 0%"></div>
            </div>
            <div class="progress-text"><span id="overallProgressText">0% Complete</span></div>
            <div class="progress-text" style="margin-top: 0.5rem;"><i class="fas fa-trophy"></i> Total Points: <span id="totalPointsEarnedSidebar">0</span></div>
          </div>
        </div>
      </div>

      <div class="lessons-list">
        <div class="lessons-header">Course Lessons</div>
        <div id="lessonsContainer">
          </div>
      </div>
    </aside>

    <main class="content-area">
      <div class="loading-container" id="loadingContainer">
        <div class="loading-spinner"></div>
        <p class="loading-text">Loading course content...</p>
      </div>

      <header class="content-header" id="contentHeader" style="display: none;">
        <div class="lesson-info">
          <h1 id="lessonTitle">Lesson Title</h1>
          <div class="lesson-meta">
            <span><i class="fas fa-clock"></i> <span id="lessonDuration">45 min</span></span>
            <span><i class="fas fa-book"></i> Lesson <span id="currentLessonNumber">1</span> of <span id="totalLessons">8</span></span>
            <span><i class="fas fa-star"></i> <span id="lessonPoints">10</span> Points</span>
          </div>
        </div>
        <div class="content-actions">
          <button id="markCompleteBtn" class="action-btn" style="display: none;">
            <i class="fas fa-check"></i>
            Mark Complete
          </button>
        </div>
      </header>

      <section class="main-content" id="mainContent" style="display: none;">
        
        <div id="finalCoursePage" style="display: none;" class="final-page-content">
            <h1 style="color: var(--success-color); text-shadow: var(--hover-glow);">Course Completed!</h1>
            <p class="lead" style="margin-bottom: 2rem;">
                Congratulations! You have completed all lessons and earned your GP! The final step is to request your certificate.
            </p>
            
            <div class="overall-progress" style="margin-bottom: 3rem; background: var(--black-bg); border: 2px solid var(--success-color);">
                <div class="progress-label" style="font-size: 1.1rem; color: var(--success-color);">Your Final Course Grade Point (GP)</div>
                <div class="progress-text" style="font-size: 2rem; color: var(--success-color); font-weight: 800;"><span id="finalTotalPoints">0</span> Points</div>
                <p style="font-size: 0.9rem; margin-top: 0.5rem; opacity: 0.8;">(Based on 10 points per successfully completed lesson quiz)</p>
            </div>

            <div class="certificate-form-card">
                <h2>Certificate & Project Submission</h2>
                <p style="margin-bottom: 1.5rem; color: var(--warning-color);">
                    To receive your certificate, please fill in your details below. For courses with a project (e.g., Computer Science, Software Engineering, Visual Arts), please **email your Final Project** (as outlined in the last lesson) to: <strong style="color: var(--cyan-glow);">elvionailabs@gmail.com</strong>.
                </p>
                <form id="certificateForm" action="https://formspree.io/f/mldrbpwo" method="post">
                    <input type="hidden" name="_subject" id="formSubject">
                    <input type="hidden" name="Course Completed" id="completedCourseName">
                    <input type="hidden" name="Total Points Earned" id="formTotalPoints">
                    
                    <label for="fullName">Full Name (for Certificate):</label>
                    <input type="text" id="fullName" name="Full Name" required>

                    <label for="email">Email Address (for delivery):</label>
                    <input type="email" id="email" name="Email" required>

                    <label for="studentId">Elvion Student ID (Optional):</label>
                    <input type="text" id="studentId" name="Student ID">

                    <button type="submit" class="action-btn submit-btn">
                        <i class="fas fa-certificate"></i> Request Certificate
                    </button>
                </form>

                <div class="comment-section">
                    <h4>Feedback & Questions</h4>
                    <form>
                        <textarea placeholder="Share your experience, ask a question, or send a thank you note to Elvion!"></textarea>
                        <button type="submit" class="action-btn comment-btn secondary" style="background: var(--dark-navy); color: var(--cyan-glow);">Submit Feedback</button>
                    </form>
                </div>
            </div>
        </div>

        <div class="media-player" id="mediaPlayer">
          <div class="media-placeholder">
            <i class="fas fa-play-circle"></i>
            <p id="mediaPlaceholderText">Video/Media content coming soon</p>
            <p style="font-size: 0.9rem; opacity: 0.7;">For now, please read the lesson content below</p>
          </div>
        </div>

        <div class="content-card">
          <div id="lessonContent" class="lesson-content">
            </div>
        </div>

        <div id="quizContainer" class="quiz-container" style="display: none;">
          <h3 style="margin-bottom: 1.5rem; color: var(--warning-color);"><i class="fas fa-clipboard-check"></i> Mandatory Quiz: Pass to Proceed</h3>
          <p style="margin-bottom: 2rem; border-bottom: 1px solid rgba(0, 255, 255, 0.1); padding-bottom: 1rem;">
            You must correctly answer all questions below before the 'Next' lesson button is enabled.
          </p>
          <div id="quizQuestions">
            </div>
          <button id="submitQuizBtn" class="action-btn" style="width: 100%; margin-top: 2rem;">
            <i class="fas fa-paper-plane"></i> Submit Answers
          </button>
          <div id="quizResult" style="margin-top: 1rem;"></div>
        </div>
      </section>

      <nav class="lesson-navigation" id="lessonNavigation" style="display: none;">
        <div class="nav-info">
          <div class="lesson-indicator">
            Lesson <span id="navCurrentLesson">1</span> of <span id="navTotalLessons">8</span>
          </div>
          <span><i class="fas fa-trophy"></i> GP: <span id="totalPointsEarnedNav">0</span> Points</span>
        </div>
        <div class="nav-buttons">
          <button id="prevLessonBtn" class="action-btn secondary">
            <i class="fas fa-chevron-left"></i>
            Previous
          </button>
          <button id="nextLessonBtn" class="action-btn">
            Next
            <i class="fas fa-chevron-right"></i>
          </button>
        </div>
      </nav>
    </main>
  </div>

  <div id="completionModal" class="completion-modal">
    <div class="completion-content">
      <i class="fas fa-trophy completion-icon"></i>
      <h2 class="completion-title">Lesson Complete!</h2>
      <p class="completion-message">
        Congratulations! You've successfully completed the quiz and this lesson.
      </p>
      <div class="points-earned">
        <i class="fas fa-star"></i>
        You earned <span id="pointsEarned">10</span> points!
      </div>
      <div style="display: flex; gap: 1rem;">
        <button id="continueBtn" class="action-btn" style="flex: 1;">
          Continue Learning
        </button>
        <button id="backToDashboardBtn" class="action-btn secondary" style="flex: 1;">
          Back to Dashboard
        </button>
      </div>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
    import {
      getAuth,
      onAuthStateChanged
    } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-auth.js";
    import {
      getFirestore,
      doc,
      getDoc,
      updateDoc
    } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAyROm0aBGjry6NUfhNM3e0qwPcCDoIqSk",
      authDomain: "elvionai.firebaseapp.com",
      projectId: "elvionai",
      storageBucket: "elvionai.firebasestorage.app",
      messagingSenderId: "161078300830",
      appId: "1:161078300830:web:f460df8591704eb0e96b8f"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // --- FALLBACK/DEFAULT LESSON & QUIZ FOR NEW COURSES ---
    const defaultLessonContent = `
        <h2>Welcome to Your Course!</h2>
        <p>This is the first lesson of your course. Here you will learn the foundational concepts.</p>
        <p>This course is designed to provide you with a comprehensive, pre-university foundation in your chosen field. Our learning methodology focuses on practical knowledge and critical thinking.</p>
        
        <h3>Elvion University Philosophy</h3>
        <p>Elvion University is dedicated to **providing free, quality pre-degree knowledge and certificates** to empower future students globally. Your commitment to completing this course is your most valuable credential.</p>
        
        <div class="interactive-code-area" style="background: rgba(18, 26, 48, 0.85); border-color: var(--warning-color);">
            <div class="area-header" style="color: var(--warning-color);"><span>Course Focus</span></div>
            <p>Please remember to focus on the core concepts of this subject. You will be tested on the content to ensure you grasp the fundamentals before moving to the next lesson.</p>
        </div>
    `;

    const defaultLesson = { 
      id: 1, 
      title: 'Course Introduction', 
      duration: '40 min', 
      content: defaultLessonContent,
      quiz: [
        { type: 'mcq', question: 'What is the main purpose of Elvion University?', options: ['Awarding accredited degrees', 'Providing free pre-degree knowledge and certificates', 'Replacing traditional universities', 'Offering high-cost private education'], answer: 'Providing free pre-degree knowledge and certificates' },
        { type: 'mcq', question: 'How is student progress measured in this course viewer?', options: ['Monthly Exams', 'Lesson by lesson mandatory quizzes', 'Instructor approval only', 'Number of videos watched'], answer: 'Lesson by lesson mandatory quizzes' },
      ]
    };
    
    // Helper to generate default lessons for other courses
    const generateDefaultLessons = (count, coursePrefix, isProject) => {
        return Array(count).fill(0).map((_, i) => {
            let lessonTitle = `Lesson ${i+1}: Introduction to ${coursePrefix} Concepts`;
            let content = defaultLessonContent.replace(/Welcome!|This is the first lesson/g, `Welcome to ${coursePrefix}!`).replace(/Introduction/g, lessonTitle);
            
            if (i === 0) {
                // Keep the original quiz for the first lesson of a new course
                return {
                    ...defaultLesson,
                    id: i + 1,
                    title: `${coursePrefix} ${lessonTitle}`,
                    content: content,
                };
            }
            
            if (i === count - 1) {
                lessonTitle = isProject ? `Lesson ${i+1}: Final Project / Capstone` : `Lesson ${i+1}: Conclusion & Next Steps`;
                content = `<h2>${lessonTitle}</h2>
                    <p>Congratulations on reaching the final lesson of the ${coursePrefix} course!</p>
                    <p>This course's final requirement is a **Project Submission** (if \`isProject\` is true) or a final reflection. Follow the certificate steps on the next page.</p>
                    ${isProject ? `<p style="color: var(--cyan-glow);">**Project Submission Required:** Please check the last lesson for specific instructions and remember to **email your project to elvionailabs@gmail.com**.</p>` : ''}
                `;
                
                // Final lesson quiz should be specific if it's a project
                const finalQuiz = isProject ? [
                    { type: 'mcq', question: `For the ${coursePrefix} course, what is the final deliverable requirement?`, options: ['A final written exam', 'A Project/Capstone Submission', 'A face-to-face interview', 'A group presentation'], answer: 'A Project/Capstone Submission' },
                    { type: 'text', question: 'What is the email address to which you must submit your project for certificate review? (Enter exactly)', answer: 'elvionailabs@gmail.com' },
                ] : [
                    { type: 'mcq', question: `How many lessons did you complete in the ${coursePrefix} course?`, options: ['1', '5', '8', count.toString()], answer: count.toString() },
                    { type: 'mcq', question: 'What is the next suggested step after completing this course?', options: ['Retake the first lesson', 'Explore another Elvion course or request your certificate', 'Close the browser', 'Nothing'], answer: 'Explore another Elvion course or request your certificate' },
                ];
                
                return {
                    id: i + 1,
                    title: `${coursePrefix} ${lessonTitle}`,
                    duration: `${40 + Math.floor(Math.random() * 20)} min`, // Varied duration
                    content: content,
                    quiz: finalQuiz,
                };
            }
            
            // Simplified, universal quiz for placeholder lessons after the first one
            const simpleQuiz = [
                { type: 'mcq', question: `How many lessons are in the ${coursePrefix} course? (Hint: The answer is in the course metadata)`, options: ['1', '5', '8', count.toString()], answer: count.toString() },
                { type: 'mcq', question: `What is the most important skill for a ${coursePrefix} professional?`, options: ['Memorization', 'Critical Thinking & Problem Solving', 'Speed Reading', 'Ignoring details'], answer: 'Critical Thinking & Problem Solving' },
            ];

            return {
                id: i + 1,
                title: `${coursePrefix} ${lessonTitle}`,
                duration: `${40 + Math.floor(Math.random() * 20)} min`, // Varied duration
                content: content,
                quiz: simpleQuiz,
            };
        });
    };
    
    // --- UPDATED AND EXPANDED COURSE DATABASE (Incorporating all your courses) ---
    const cs101Lessons = [
        { 
            id: 1, 
            title: 'Introduction to Programming', 
            duration: '45 min', 
            content: `
                <h2>Welcome to Programming!</h2>
                <p>Programming is the process of creating a set of instructions that tell a computer how to perform a task. In this lesson, we'll explore the fundamental concepts that form the foundation of all programming languages.</p>
                
                <h3>The Concept of Algorithms</h3>
                <p>An <strong>algorithm</strong> is a step-by-step procedure for solving a problem or accomplishing a task. Think of it as a recipe. A good algorithm is clear, finite, and effective.</p>
                <p><strong>Example: Algorithm to make a cup of tea:</strong></p>
                <ol>
                    <li>Boil water.</li>
                    <li>Put tea bag in cup.</li>
                    <li>Pour boiling water into cup.</li>
                    <li>Wait 3 minutes.</li>
                    <li>Remove tea bag.</li>
                    <li>Add sugar/milk (optional).</li>
                    <li>Serve.</li>
                </ol>

                <h3>Variables and Data Types</h3>
                <p><strong>Variables:</strong> Containers that store data. Every variable has a <strong>data type</strong> that defines what kind of information it holds.</p>
                <ul>
                    <li><code>String</code> (Text): <code class="language-python">name = "Elvion"</code></li>
                    <li><li><code>Integer</code> (Whole Number): <code class="language-python">age = 25</code></li>
                    <li><code>Float</code> (Decimal Number): <code class="language-python">pi = 3.14159</code></li>
                    <li><code>Boolean</code> (True/False): <code class="language-python">is_learning = True</code></li>
                </ul>

                <h3>Your First Program: The Console</h3>
                <p>Let's write a simple Python program to greet a user. The <code class="language-python">print()</code> function displays output to the console.</p>
                <pre><code># Python Example
# Ask the user for their name
user_name = input("Enter your name: ")

# Greet the user
print("Hello, " + user_name + "! Welcome to Elvion University.")</code></pre>
                
                <h3>Practical Example: Code Playground (Simulation)</h3>
                <p>Imagine this is an interactive console. What would the output be if the user enters "Alex"?</p>
                <div class="interactive-code-area">
                    <div class="area-header"><span>Python Interpreter</span></div>
                    <textarea readonly>// User Input: Alex
user_name = input("Enter your name: ")
print("Hello, " + user_name + "! Welcome to Elvion University.")</textarea>
                    <div class="output">Output: Hello, Alex! Welcome to Elvion University.</div>
                </div>
            `,
            quiz: [
                { type: 'mcq', question: 'Which data type stores text, such as a name or address?', options: ['Integer', 'Boolean', 'String', 'Float'], answer: 'String' },
                { type: 'mcq', question: 'In the context of programming, what is an algorithm?', options: ['A type of variable', 'A secret coding language', 'A step-by-step procedure for solving a problem', 'A text editor'], answer: 'A step-by-step procedure for solving a problem' },
            ]
        },
        { 
            id: 2, 
            title: 'Data Structures', 
            duration: '60 min', 
            content: `
                <h2>Understanding Data Structures</h2>
                <p>Data structures are ways of organizing and storing data so it can be accessed and modified efficiently. They are crucial for writing high-performance code.</p>

                <h3>Arrays and Lists</h3>
                <p><strong>Arrays (or Lists in Python):</strong> Ordered collections of items. They allow you to store many values under a single variable name and access them by their <strong>index</strong> (position, starting at 0).</p>
                <pre><code># Python List Example
fruits = ["apple", "banana", "orange", "grape"]
first_fruit = fruits[0]  # first_fruit is "apple"
list_length = len(fruits) # list_length is 4</code></pre>

                <h3>Dictionaries (Hash Maps)</h3>
                <p>Dictionaries store data in <strong>key-value pairs</strong>, offering a much faster way to look up values than searching through a list by index.</p>
                <pre><code># Python Dictionary Example
student = {
    "name": "John Doe",
    "age": 20,
    "grade": "A"
}
student_age = student["age"] # student_age is 20</code></pre>

                <h3>Stacks and Queues</h3>
                <ul>
                    <li><strong>Stack (LIFO - Last In, First Out):</strong> Like a stack of plates. The last plate added is the first one removed. Used for tracking function calls (call stack) and 'undo' features.</li>
                    <li><strong>Queue (FIFO - First In, First Out):</strong> Like a line at a store. The first person in line is the first one served. Used for handling tasks, printing jobs, or data streaming.</li>
                </ul>

                <h3>Practical Example: Using Dictionaries</h3>
                <p>Use the simulated interactive area to think about how you would look up the model of a car.</p>
                <div class="interactive-code-area">
                    <div class="area-header"><span>Python Dictionary Lookup</span></div>
                    <textarea readonly>car = {
    "brand": "Tesla",
    "model": "Model 3",
    "year": 2024
}
print(car["model"])</textarea>
                    <div class="output">Output: Model 3</div>
                </div>
            `,
            quiz: [
                { type: 'mcq', question: 'Which data structure follows the LIFO principle?', options: ['Queue', 'List', 'Stack', 'Dictionary'], answer: 'Stack' },
                { type: 'mcq', question: 'How is data stored in a Dictionary?', options: ['By index number', 'In key-value pairs', 'As a single, long string', 'In a sequential line'], answer: 'In key-value pairs' },
            ]
        },
        { id: 3, title: 'Object-Oriented Programming', duration: '55 min', content: `<h2>Object-Oriented Programming (OOP)</h2><p>OOP organizes code around <strong>objects</strong>, which are instances of <strong>classes</strong> (blueprints). The four pillars are Encapsulation, Inheritance, Polymorphism, and Abstraction.</p>
            <h3>Classes and Objects Example</h3>
            <p>A Car class is the blueprint; a specific red Toyota is an object.</p>
            <pre><code>class Dog:
    def __init__(self, name):
        self.name = name
    def bark(self):
        return f"{self.name} says Woof!"

my_dog = Dog("Buddy")
print(my_dog.bark())</code></pre>
            <h3>Encapsulation</h3>
            <p>Bundling data and methods that operate on the data (like a protective capsule). This hides internal details from the outside world.</p>
            `,
            quiz: [
                { type: 'mcq', question: 'What is a "class" in OOP?', options: ['A value stored in a variable', 'A type of method', 'A blueprint or template for creating objects', 'An abstract concept'], answer: 'A blueprint or template for creating objects' },
                { type: 'mcq', question: 'The principle of hiding implementation details is called:', options: ['Inheritance', 'Polymorphism', 'Encapsulation', 'Abstraction'], answer: 'Encapsulation' },
            ]
        },
        { id: 4, title: 'Database Systems', duration: '50 min', content: `<h2>Introduction to Database Systems</h2><p>Databases manage structured data efficiently. We focus on **Relational Databases** which use tables (rows and columns) and **SQL** (Structured Query Language).</p>
            <h3>Basic SQL Commands</h3>
            <p>The four main operations are CRUD: Create, Read, Update, Delete.</p>
            <pre><code>-- CREATE: Defines the table structure
CREATE TABLE Users (
    UserID INT PRIMARY KEY,
    UserName VARCHAR(50),
    Email VARCHAR(100)
);

-- READ: The most common operation
SELECT UserName, Email FROM Users WHERE UserID = 1;</code></pre>
            <h3>Practical Example: Simple Query</h3>
            <p>Write an SQL query to select all users whose name starts with 'A'.</p>
            <div class="interactive-code-area">
                <div class="area-header"><span>SQL Query Practice</span></div>
                <textarea>// Input your query here...
SELECT * FROM Users WHERE UserName LIKE 'A%';</textarea>
                <div class="output">Result: Query executed successfully.</div>
            </div>
            `,
            quiz: [
                { type: 'mcq', question: 'What language is used to communicate with Relational Databases?', options: ['HTML', 'SQL', 'Python', 'CSS'], answer: 'SQL' },
                { type: 'mcq', question: 'Which SQL command is used to retrieve data from a database?', options: ['INSERT', 'UPDATE', 'SELECT', 'DELETE'], answer: 'SELECT' },
            ]
        },
        { id: 5, title: 'Software Engineering Principles', duration: '60 min', content: `<h2>Software Development Life Cycle (SDLC)</h2><p>The SDLC outlines the stages of software creation: Planning, Design, Implementation, Testing, Deployment, and Maintenance. **Agile** is a popular, iterative methodology.</p>
            <h3>Testing Phases</h3>
            <ul>
                <li><strong>Unit Testing:</strong> Testing individual components/functions.</li>
                <li><strong>Integration Testing:</strong> Testing how components work together.</li>
                <li><strong>User Acceptance Testing (UAT):</strong> Final testing by the actual user to confirm it meets requirements.</li>
            </ul>
            <h3>Version Control (Git)</h3>
            <p>Git tracks changes and allows collaboration. A **commit** is a snapshot of your repository.</p>
            <pre><code>git add .                  # Stage all changes
git commit -m "feat: add user login" # Save a snapshot with a message
git push origin main         # Upload changes to the remote repository</code></pre>
            `,
            quiz: [
                { type: 'mcq', question: 'In the SDLC, which phase involves the client confirming the software meets their needs?', options: ['Implementation', 'Unit Testing', 'Deployment', 'User Acceptance Testing (UAT)'], answer: 'User Acceptance Testing (UAT)' },
                { type: 'mcq', question: 'What is the purpose of a Git "commit"?', options: ['To install a new library', 'To track bugs', 'To save a snapshot of changes to the repository', 'To deploy the application'], answer: 'To save a snapshot of changes to the repository' },
            ]
        },
        { id: 6, title: 'Computer Networks', duration: '50 min', content: `<h2>The OSI Model</h2><p>The OSI model has 7 layers. The **Network Layer** (Layer 3) handles routing and IP addresses, while the **Transport Layer** (Layer 4) handles data delivery (TCP/UDP).</p>
            <h3>IP Addresses and Protocols</h3>
            <p>An **IP address** is a unique identifier for a device. **Protocols** are rules governing communication.</p>
            <pre><code>// Common Protocols
HTTP: Transferring web pages
DNS: Translating domain names (elvion.com) to IP addresses
TCP: Connection-oriented, reliable data transfer</code></pre>
            `,
            quiz: [
                { type: 'mcq', question: 'Which OSI layer is responsible for translating a domain name (like google.com) into an IP address?', options: ['Transport Layer', 'Network Layer', 'Application Layer (via DNS)', 'Physical Layer'], answer: 'Application Layer (via DNS)' },
                { type: 'mcq', question: 'What is the most common use of a TCP (Transmission Control Protocol) connection?', options: ['Unreliable, fast video streaming', 'Connection-oriented, reliable web data transfer', 'Assigning IP addresses automatically', 'Physical cabling'], answer: 'Connection-oriented, reliable web data transfer' },
            ]
        },
        { id: 7, title: 'Artificial Intelligence', duration: '65 min', content: `<h2>Machine Learning and Deep Learning</h2><p><strong>Machine Learning (ML)</strong> is a subset of AI where systems learn from data. **Deep Learning** is a subset of ML using deep neural networks for complex tasks like image recognition and natural language processing.</p>
            <h3>Types of ML</h3>
            <ul>
                <li>**Supervised Learning:** Training with labeled data (e.g., teaching an AI to recognize a cat by showing it labeled pictures of cats).</li>
                <li>**Unsupervised Learning:** Finding hidden patterns in unlabeled data (e.g., grouping customers into segments).</li>
            </ul>
            <h3>Practical Example: Supervised Learning</h3>
            <p>If you feed a model 1000 emails labeled "Spam" and 1000 labeled "Not Spam," what type of learning is that?</p>
            <div class="interactive-code-area">
                <div class="area-header"><span>ML Concept Check</span></div>
                <textarea readonly># Labeled Data -> Prediction
# Example: Spam Filter Training</textarea>
                <div class="output">Concept: Supervised Learning</div>
            </div>
            `,
            quiz: [
                { type: 'mcq', question: 'Which type of Machine Learning uses labeled data for training?', options: ['Reinforcement Learning', 'Deep Learning', 'Unsupervised Learning', 'Supervised Learning'], answer: 'Supervised Learning' },
                { type: 'mcq', question: 'What is the core technology behind Deep Learning?', options: ['Databases', 'HTML', 'Relational Models', 'Deep Neural Networks'], answer: 'Deep Neural Networks' },
            ]
        },
        { id: 8, title: 'Final Year Project', duration: '120 min', content: `<h2>Final Year Project & Degree Path</h2>
            <p class="lead" style="color: var(--warning-color);">This lesson prepares you for your final project, which must be submitted to Elvion to receive your certificate.</p>
            
            <h3>The Project Goal</h3>
            <p>Your goal is to build a complete, functional software solution (web app, mobile app, or data analysis tool) that demonstrates the concepts learned in lessons 1-7.</p>
            
            <h4>Suggested Project Idea: Elvion Simple Messenger</h4>
            <p><strong>Requirements:</strong></p>
            <ul>
                <li>**Data Structure (Lesson 2):** Use a dictionary/hash map to store user profiles (Name, Status).</li>
                <li>**OOP (Lesson 3):** Define a \`User\` class and a \`ChatRoom\` class.</li>
                <li>**Database (Lesson 4):** Use a simulated or real database (like Firebase or SQLite) to store messages.</li>
                <li>**Software Engineering (Lesson 5):** Follow a simple plan-code-test cycle.</li>
            </ul>

            <h3>Submission Guidelines (Crucial)</h3>
            <ol>
                <li><strong>The Code:</strong> The source code (GitHub/Zip file).</li>
                <li><strong>The Documentation:</strong> A 1-page PDF detailing the project goal, technologies used, and a **brief reflection** on what you learned.</li>
            </ol>
            <p style="color: var(--cyan-glow);">**Submit BOTH of these items to: elvionailabs@gmail.com** after filling out the certificate form on the next page.</p>
            `,
            quiz: [
                { type: 'mcq', question: 'What are the two mandatory items to submit for your Final Project?', options: ['A video and a fee', 'The code and a 1-page documentation/reflection', 'Only the code', 'A 100-page thesis'], answer: 'The code and a 1-page documentation/reflection' },
                { type: 'text', question: 'What is the email address to which you must submit your project for certificate review? (Enter exactly)', answer: 'elvionailabs@gmail.com' },
            ]
        }
    ];
    
    // --- NEW SOFTWARE ENGINEERING COURSE CONTENT ---
    const swe101Lessons = [
        {
            id: 1, 
            title: 'Foundations of Software Engineering', 
            duration: '50 min', 
            content: `
                <h2>What is Software Engineering?</h2>
                <p><strong>Software Engineering (SE)</strong> is the systematic approach to the design, development, and maintenance of software. Unlike simple programming, SE focuses on scalability, reliability, and working in a team environment.</p>
                
                <h3>Code vs. Engineering</h3>
                <ul>
                    <li><strong>Programming:</strong> Writing code to solve a specific, immediate problem.</li>
                    <li><strong>Software Engineering:</strong> Applying established engineering principles to build robust, long-lasting, and easily modifiable software products.</li>
                </ul>

                <h3>The Software Development Life Cycle (SDLC)</h3>
                <p>This systematic process ensures quality. The main stages are: **Planning, Analysis, Design, Implementation, Testing, and Deployment/Maintenance.**</p>
                
                <div class="interactive-code-area">
                    <div class="area-header"><span>Core Principles</span></div>
                    <p>Think about a large app like a banking system. What would happen if the planning stage was skipped?</p>
                    <div class="output">Result: Chaos, security flaws, and massive cost overruns.</div>
                </div>
            `,
            quiz: [
                { type: 'mcq', question: 'What is the primary difference between programming and software engineering?', options: ['SE uses C++, programming uses Python', 'SE is systematic and focuses on large-scale products', 'Programming is only for web development', 'There is no difference'], answer: 'SE is systematic and focuses on large-scale products' },
                { type: 'mcq', question: 'Which stage of the SDLC involves deciding on the architecture (e.g., choosing a database)?', options: ['Implementation', 'Analysis', 'Design', 'Testing'], answer: 'Design' },
            ]
        },
        { 
            id: 2, 
            title: 'Agile vs. Waterfall Methodologies', 
            duration: '65 min', 
            content: `
                <h2>Modern Development Methodologies</h2>
                <p>How teams manage the SDLC is crucial. The two most prominent methods are **Waterfall** and **Agile**.</p>
                
                <h3>Waterfall (Traditional)</h3>
                <p>A sequential, linear process where each phase must be completed before the next begins. It's rigid but simple and suitable for small, well-defined projects.</p>
                <p style="color: var(--error-color);">**Drawback:** Difficult to adapt to changes once a phase is complete.</p>

                <h3>Agile (Modern)</h3>
                <p>An iterative and incremental approach that prioritizes flexibility and customer collaboration. Work is done in short cycles (**Sprints** in Scrum).</p>
                <ul>
                    <li>**Scrum:** A framework of Agile using Sprints, daily standups, and product backlogs.</li>
                    <li>**Kanban:** A visual system for managing work, focusing on limiting work in progress.</li>
                </ul>
                <pre><code>// Agile Principle Example:
// Respond to change over following a plan.</code></pre>

                <h3>Practical: Choosing a Method</h3>
                <div class="interactive-code-area">
                    <div class="area-header" style="color: var(--success-color);"><span>Scenario: Unclear Requirements</span></div>
                    <p>If a client's requirements are constantly changing, which methodology is best?</p>
                    <div class="output">Best Method: Agile (Scrum or Kanban)</div>
                </div>
            `,
            quiz: [
                { type: 'mcq', question: 'Which methodology is characterized by short, iterative work cycles called Sprints?', options: ['Waterfall', 'SDLC', 'Scrum (Agile)', 'Sequential'], answer: 'Scrum (Agile)' },
                { type: 'mcq', question: 'What is the main weakness of the Waterfall model?', options: ['It is too fast', 'It is not documented enough', 'It is very rigid and struggles with requirement changes', 'It requires too many programmers'], answer: 'It is very rigid and struggles with requirement changes' },
            ]
        },
        { 
            id: 3, 
            title: 'Requirements and Design Patterns', 
            duration: '50 min', 
            content: `
                <h2>Formalizing Software Needs</h2>
                <p>Requirements gathering is the most critical phase. Requirements are typically categorized as **Functional** (what the system must do) and **Non-Functional** (how the system performs, e.g., speed, security, usability).</p>

                <h3>UML Diagrams</h3>
                <p>The **Unified Modeling Language (UML)** is a standard way to visualize a system's design. A **Use Case Diagram** models the user's interaction with the system.</p>

                <h3>Design Patterns</h3>
                <p>These are reusable solutions to common problems in software design. They are *templates*, not finished designs.</p>
                <ul>
                    <li>**Singleton:** Ensures a class has only one instance and provides a global access point to it (e.g., a central configuration manager).</li>
                    <li>**Factory:** Provides an interface for creating objects in a superclass, but allows subclasses to alter the type of objects that will be created.</li>
                </ul>
            `,
            quiz: [
                { type: 'mcq', question: 'Which type of requirement defines *how* the system should behave (e.g., load time, security)?', options: ['Functional Requirement', 'User Requirement', 'Non-Functional Requirement', 'Business Requirement'], answer: 'Non-Functional Requirement' },
                { type: 'mcq', question: 'The Singleton design pattern is used to ensure:', options: ['A class can be inherited', 'A class can create multiple object types', 'A class has only one instance globally', 'The code is highly abstract'], answer: 'A class has only one instance globally' },
            ]
        },
        { 
            id: 4, 
            title: 'Testing and Quality Assurance', 
            duration: '45 min', 
            content: `
                <h2>Ensuring Software Quality</h2>
                <p>Testing is a continuous process. Quality Assurance (QA) aims to prevent bugs, while Testing aims to find them.</p>

                <h3>Testing Levels (Recap and Deep Dive)</h3>
                <ol>
                    <li>**Unit Testing:** Testing the smallest piece of code (function/method). Crucial for catching early bugs.</li>
                    <li>**Integration Testing:** Testing the flow between two or more integrated modules.</li>
                    <li>**System Testing:** Testing the complete, integrated system to evaluate the system's compliance with the specified requirements.</li>
                    <li>**Acceptance Testing (UAT):** The final test by the customer to ensure the software is ready for deployment.</li>
                </ol>

                <h3>Automated Testing</h3>
                <p>Writing code to test other code. This is a pillar of modern SE, especially in Agile environments, allowing for fast, repeatable checks.</p>
                <pre><code>// Example of a Unit Test in a language like Python/Jest
function test_add_numbers() {
    assert_equals(add(2, 3), 5); // Expected vs. Actual
}</code></pre>
            `,
            quiz: [
                { type: 'mcq', question: 'What is the most fundamental level of testing, focused on individual functions?', options: ['System Testing', 'Integration Testing', 'Unit Testing', 'Acceptance Testing'], answer: 'Unit Testing' },
                { type: 'mcq', question: 'The primary goal of Quality Assurance (QA) is to:', options: ['Fix bugs found by testers', 'Prevent defects from occurring in the first place', 'Deploy the code to production', 'Manage the project schedule'], answer: 'Prevent defects from occurring in the first place' },
            ]
        },
        { 
            id: 5, 
            title: 'Final Project: SE Design Document', 
            duration: '90 min', 
            content: `
                <h2>Software Engineering Capstone</h2>
                <p class="lead" style="color: var(--warning-color);">The final lesson of your Software Engineering course is the **Design Document Project**. This is mandatory for your certificate.</p>
                
                <h3>Project Goal: Create a Design Document</h3>
                <p>Instead of writing code, you will **design** the solution for a small software product (e.g., a simple task manager or a university course registration system). The focus is on the *engineering* process.</p>
                
                <h4>Required Sections in Your Document (PDF or Markdown):</h4>
                <ol>
                    <li>**Requirements:** List at least 5 Functional and 3 Non-Functional Requirements.</li>
                    <li>**Methodology:** State and justify your choice of SDLC methodology (Agile or Waterfall).</li>
                    <li>**Architecture/Design:** Sketch a basic UML Use Case Diagram and name at least two **Design Patterns** you would use, explaining why.</li>
                    <li>**Testing Plan:** Outline the approach for Unit Testing and User Acceptance Testing.</li>
                </ol>

                <h3>Submission Guidelines (Crucial)</h3>
                <p style="color: var(--cyan-glow);">**Submit your Final Design Document to: elvionailabs@gmail.com** after filling out the certificate form on the next page. Use the subject line: "SE101 Final Project: [Your Name]".</p>
            `,
            quiz: [
                { type: 'mcq', question: 'For the SE101 Final Project, what is the required deliverable?', options: ['1000 lines of code', 'A fully tested deployed application', 'A detailed Software Design Document', 'A recorded video presentation'], answer: 'A detailed Software Design Document' },
                { type: 'text', question: 'What is the email address to which you must submit your project for certificate review? (Enter exactly)', answer: 'elvionailabs@gmail.com' },
            ]
        }
    ];

    
    // Assembling all courses
    const allCourses = [
      { id: 'cs101', title: 'Computer Science', description: 'Fundamentals of computing, programming, and algorithms', icon: 'fas fa-laptop-code', totalLessons: 8, estimatedHours: 120, mediaType: 'video', lessons: cs101Lessons },
      // NEW SOFTWARE ENGINEERING COURSE
      { id: 'swe101', title: 'Software Engineering', description: 'Design, develop, and maintain large-scale software systems.', icon: 'fas fa-cogs', totalLessons: 5, estimatedHours: 80, mediaType: 'video', lessons: swe101Lessons },
      // OTHER COURSES WITH GENERATED PLACEHOLDERS
      { id: 'law101', title: 'Law (LLB)', description: 'Comprehensive study of legal principles and practice.', icon: 'fas fa-balance-scale', totalLessons: 6, estimatedHours: 90, mediaType: 'video', lessons: generateDefaultLessons(6, 'LAW', false) },
      { id: 'eng101', title: 'English & Literary Studies', description: 'Study of English language, literature, and critical analysis.', icon: 'fas fa-pen-nib', totalLessons: 4, estimatedHours: 60, mediaType: 'audio', lessons: generateDefaultLessons(4, 'ENG', false) },
      { id: 'his101', title: 'History & Strategic Studies', description: 'World history, Nigerian history, and strategic studies.', icon: 'fas fa-globe-africa', totalLessons: 5, estimatedHours: 75, mediaType: 'audio', lessons: generateDefaultLessons(5, 'HIS', false) },
      { id: 'bus101', title: 'Business Administration', description: 'Principles of management, marketing, finance, and entrepreneurship.', icon: 'fas fa-chart-line', totalLessons: 7, estimatedHours: 100, mediaType: 'audio', lessons: generateDefaultLessons(7, 'BUS', true) },
      { id: 'mass101', title: 'Mass Communication', description: 'Journalism, public relations, broadcasting, and digital media communication.', icon: 'fas fa-bullhorn', totalLessons: 6, estimatedHours: 90, mediaType: 'audio', lessons: generateDefaultLessons(6, 'MASS', false) },
      { id: 'math101', title: 'Mathematics Education', description: 'Methods and strategies for teaching mathematics.', icon: 'fas fa-calculator', totalLessons: 5, estimatedHours: 70, mediaType: 'audio', lessons: generateDefaultLessons(5, 'MATED', false) },
      { id: 'aed101', title: 'Adult Education', description: 'Teaching and learning strategies for adult learners.', icon: 'fas fa-chalkboard-teacher', totalLessons: 4, estimatedHours: 60, mediaType: 'audio', lessons: generateDefaultLessons(4, 'ADULT', false) },
      { 
          id: 'visart101', 
          title: 'Visual Arts & Digital Media', 
          description: 'A study of animation, painting, graphic design, and digital art.', 
          icon: 'fas fa-palette', 
          totalLessons: 6, 
          estimatedHours: 95, 
          mediaType: 'video', 
          lessons: generateDefaultLessons(6, 'VA', true) 
      },
    ];

    let currentUser = null;
    let userData = null;
    let currentCourse = null;
    let currentLesson = 1;
    let totalLessons = 0;
    let quizPassed = false; // New state to track if quiz is passed for navigation

    // URL Parameters
    const urlParams = new URLSearchParams(window.location.search);
    const courseId = urlParams.get('courseId');
    const lessonParam = urlParams.get('lesson');

    // ... (DOM Content Loaded and Star Animation code remains the same)

    // Mobile Menu Toggle
    const mobileMenuToggle = document.getElementById('mobileMenuToggle');
    const courseSidebar = document.getElementById('courseSidebar');

    mobileMenuToggle.addEventListener('click', () => {
      courseSidebar.classList.toggle('active');
    });

    // Close sidebar when clicking outside on mobile
    document.addEventListener('click', (e) => {
      if (window.innerWidth <= 992) {
        if (!courseSidebar.contains(e.target) && !mobileMenuToggle.contains(e.target)) {
          courseSidebar.classList.remove('active');
        }
      }
    });

    // Auth State Management
    onAuthStateChanged(auth, async (user) => {
      if (user) {
        currentUser = user;
        await loadUserData();
        await initializeCourseViewer();
      } else {
        // Redirect to enrollment page if not logged in
        window.location.href = 'enroll.html'; 
      }
    });

    async function loadUserData() {
      try {
        const userDocRef = doc(db, 'users', currentUser.uid);
        const userDoc = await getDoc(userDocRef);
        
        if (userDoc.exists()) {
          userData = userDoc.data();
          // Ensure totalPoints exists for new users
          if (userData.totalPoints === undefined) {
              userData.totalPoints = 0;
              await updateDoc(userDocRef, { totalPoints: 0 });
          }
        } else {
          // Redirect to dashboard (or enrollment flow) if user data is missing
          window.location.href = 'studyingatelvion.html'; 
        }
      } catch (error) {
        console.error('Error loading user data:', error);
        alert('Error loading user data. Please try again.');
      }
    }

    async function initializeCourseViewer() {
      if (!courseId) {
        alert('No course specified');
        window.location.href = 'studyingatelvion.html';
        return;
      }

      currentCourse = findCourseById(courseId);
      if (!currentCourse) {
        alert('Course not found');
        window.location.href = 'studyingatelvion.html';
        return;
      }

      totalLessons = currentCourse.totalLessons;
      currentLesson = parseInt(lessonParam) || 1;

      // Check if user is enrolled
      const enrolledCourse = userData.enrolledCourses?.find(c => c.courseId === courseId);
      if (!enrolledCourse) {
        alert('You are not enrolled in this course');
        window.location.href = 'studyingatelvion.html';
        return;
      }

      setupCourseInterface();
      renderLessonsList();
      loadLesson(currentLesson);
      
      document.getElementById('loadingContainer').style.display = 'none';
      document.getElementById('contentHeader').style.display = 'flex';
      document.getElementById('mainContent').style.display = 'block';
      document.getElementById('lessonNavigation').style.display = 'flex';
    }

    function findCourseById(courseId) {
      return allCourses.find(c => c.id === courseId);
    }

    function setupCourseInterface() {
      document.getElementById('courseIconLarge').className = `course-icon-large ${currentCourse.icon}`;
      document.getElementById('courseTitle').textContent = currentCourse.title;
      document.getElementById('courseSubtitle').textContent = currentCourse.description;
      
      // Populate Certificate Form details
      document.getElementById('formSubject').value = `Certificate Request: ${currentCourse.title}`;
      document.getElementById('completedCourseName').value = currentCourse.title;

      updateOverallProgress();
    }

    function updateOverallProgress() {
      const enrolledCourse = userData.enrolledCourses?.find(c => c.courseId === courseId);
      const progress = enrolledCourse?.progress || 0;
      const completedLessons = enrolledCourse?.completedLessons?.length || 0;
      
      document.getElementById('overallProgressBar').style.width = `${progress}%`;
      document.getElementById('overallProgressText').textContent = `${progress}% Complete (${completedLessons}/${totalLessons} lessons)`;
      
      // Update Total Points for GP (sidebar and nav)
      document.getElementById('totalPointsEarnedSidebar').textContent = userData.totalPoints || 0;
      document.getElementById('totalPointsEarnedNav').textContent = userData.totalPoints || 0;
      document.getElementById('formTotalPoints').value = userData.totalPoints || 0;
      document.getElementById('finalTotalPoints').textContent = userData.totalPoints || 0;
    }

    function renderLessonsList() {
      const container = document.getElementById('lessonsContainer');
      const enrolledCourse = userData.enrolledCourses?.find(c => c.courseId === courseId);
      const completedLessons = enrolledCourse?.completedLessons || [];
      
      container.innerHTML = '';
      
      currentCourse.lessons.forEach((lesson) => {
        const lessonNumber = lesson.id;
        const isCompleted = completedLessons.includes(lessonNumber);
        const isCurrent = lessonNumber === currentLesson;
        const isAccessible = lessonNumber <= (enrolledCourse?.currentLesson || 1);
        
        const lessonItem = document.createElement('div');
        lessonItem.className = `lesson-item ${isCurrent ? 'active' : ''} ${isCompleted ? 'completed' : ''}`;
        
        let statusIcon, statusClass;
        if (isCompleted) {
          statusIcon = '<i class="fas fa-check"></i>';
          statusClass = 'completed';
        } else if (isCurrent) {
          statusIcon = lessonNumber;
          statusClass = 'current';
        } else if (isAccessible) {
          statusIcon = lessonNumber;
          statusClass = ''; // Accessible but not current/completed
        } else {
          statusIcon = '<i class="fas fa-lock"></i>';
          statusClass = 'locked';
        }
        
        lessonItem.innerHTML = `
          <div class="lesson-status ${statusClass}">${statusIcon}</div>
          <div class="lesson-details">
            <div class="lesson-title">${lesson.title}</div>
            <div class="lesson-duration">${lesson.duration}</div>
          </div>
        `;
        
        if (isAccessible) {
          lessonItem.style.cursor = 'pointer';
          lessonItem.addEventListener('click', () => {
            if (lessonNumber !== currentLesson) {
              loadLesson(lessonNumber);
              courseSidebar.classList.remove('active'); // Close on mobile navigation
            }
          });
        } else {
          lessonItem.style.opacity = '0.5';
          lessonItem.style.cursor = 'not-allowed';
        }
        
        container.appendChild(lessonItem);
      });
      
      // Add the final certificate page link
      if (enrolledCourse?.progress === 100) {
          const finalItem = document.createElement('div');
          finalItem.className = `lesson-item ${currentLesson === totalLessons + 1 ? 'active' : ''}`;
          finalItem.style.borderLeftColor = 'var(--success-color)';
          finalItem.innerHTML = `
            <div class="lesson-status completed" style="background: var(--success-color);"><i class="fas fa-certificate"></i></div>
            <div class="lesson-details">
                <div class="lesson-title" style="color: var(--success-color); font-weight: 700;">Final Exam/Certificate</div>
                <div class="lesson-duration">Your Course GP is Ready</div>
            </div>
          `;
          finalItem.style.cursor = 'pointer';
          finalItem.addEventListener('click', () => {
             loadLesson(totalLessons + 1);
             courseSidebar.classList.remove('active'); // Close on mobile navigation
          });
          container.appendChild(finalItem);
      }
    }

    function loadLesson(lessonNumber) {
      currentLesson = lessonNumber;
      quizPassed = false; // Reset quiz state for the new lesson
      
      // Update URL without reloading
      const newUrl = new URL(window.location);
      newUrl.searchParams.set('lesson', lessonNumber);
      window.history.pushState({}, '', newUrl);
      
      // Hide all main content elements first
      document.getElementById('finalCoursePage').style.display = 'none';
      document.getElementById('contentHeader').style.display = 'flex';
      document.getElementById('lessonNavigation').style.display = 'flex';
      const contentCard = document.querySelector('.content-card');
      const quizContainer = document.getElementById('quizContainer');
      const mediaPlayer = document.getElementById('mediaPlayer');
      
      contentCard.style.display = 'block';
      mediaPlayer.style.display = 'flex';
      
      if (currentLesson === totalLessons + 1) {
          // Final Page Logic
          document.getElementById('contentHeader').style.display = 'none';
          document.getElementById('lessonNavigation').style.display = 'none';
          document.getElementById('finalCoursePage').style.display = 'block';
          contentCard.style.display = 'none';
          quizContainer.style.display = 'none';
          mediaPlayer.style.display = 'none';
          
          updateOverallProgress(); // Refresh GP
      } else {
          // Lesson Page Logic
          const lesson = currentCourse.lessons.find(l => l.id === lessonNumber);
          if (!lesson) return;

          // Update header
          document.getElementById('lessonTitle').textContent = lesson.title;
          document.getElementById('lessonDuration').textContent = lesson.duration;
          document.getElementById('currentLessonNumber').textContent = lessonNumber;
          document.getElementById('totalLessons').textContent = totalLessons;
          document.getElementById('lessonPoints').textContent = '10'; 
          document.getElementById('markCompleteBtn').style.display = 'none'; 
          
          // Update navigation
          document.getElementById('navCurrentLesson').textContent = lessonNumber;
          document.getElementById('navTotalLessons').textContent = totalLessons;
          
          // Update content
          document.getElementById('lessonContent').innerHTML = lesson.content;

          // Update media player
          const mediaPlaceholderText = document.getElementById('mediaPlaceholderText');
          if (currentCourse.mediaType === 'audio') {
            mediaPlayer.innerHTML = `
                <audio controls style="width:100%; height: auto; outline:none; border-radius:10px; box-shadow:0 0 8px var(--cyan-glow);">
                    <source src="university/generic_audio.mp3" type="audio/mpeg">
                    Your browser does not support the audio element.
                </audio>
            `;
            mediaPlaceholderText.textContent = 'Audio content for this lesson is available above.';
          } else { 
            mediaPlayer.innerHTML = `
              <div class="media-placeholder">
                <i class="fas fa-play-circle"></i>
                <p id="mediaPlaceholderText">Video content coming soon</p>
                <p style="font-size: 0.9rem; opacity: 0.7;">For now, please read the lesson content below</p>
              </div>
            `;
            mediaPlaceholderText.textContent = 'Video content coming soon';
          }
          
          // Render Quiz
          const enrolledCourse = userData.enrolledCourses?.find(c => c.courseId === courseId);
          const isCompleted = enrolledCourse?.completedLessons?.includes(currentLesson);
          
          if (lesson.quiz) {
            quizContainer.style.display = 'block';
            renderQuiz(lesson.quiz, isCompleted);
          } else {
            quizContainer.style.display = 'none';
          }
      }
      
      // Update navigation buttons and state
      updateNavigationControls();
      
      // Update sidebar
      renderLessonsList();
      
      // Scroll to top
      window.scrollTo(0, 0);
    }

    function updateNavigationControls() {
      const prevBtn = document.getElementById('prevLessonBtn');
      const nextBtn = document.getElementById('nextLessonBtn');
      const enrolledCourse = userData.enrolledCourses?.find(c => c.courseId === courseId);
      const isCompleted = enrolledCourse?.completedLessons?.includes(currentLesson);
      const isCourseFullyCompleted = enrolledCourse?.progress === 100;

      // Previous Button Logic
      prevBtn.disabled = currentLesson <= 1;
      
      // Next Button Logic
      if (currentLesson === totalLessons) {
          nextBtn.textContent = 'Final Exam/Certificate';
          // Enable only if all lessons are completed (progress 100%)
          nextBtn.disabled = !isCourseFullyCompleted && !isCompleted; // Use isCompleted as a fallback if progress hasn't updated immediately
      } else if (currentLesson === totalLessons + 1) {
          // On Final Page, next is always disabled
          nextBtn.textContent = 'Course Completed';
          nextBtn.disabled = true;
      } else if (isCompleted || quizPassed) {
          nextBtn.textContent = 'Next Lesson';
          nextBtn.disabled = false;
      } else {
          nextBtn.textContent = 'Pass Quiz to Unlock';
          nextBtn.disabled = true;
      }
    }
    
    // --- QUIZ LOGIC (Updated to include animation/feedback) ---

    function renderQuiz(quizData, isLessonCompleted) {
        const quizQuestionsContainer = document.getElementById('quizQuestions');
        quizQuestionsContainer.innerHTML = '';
        document.getElementById('quizResult').innerHTML = ''; // Clear result area
        
        // Hide submit button if lesson is already completed
        const submitBtn = document.getElementById('submitQuizBtn');
        submitBtn.style.display = isLessonCompleted ? 'none' : 'block';

        quizData.forEach((q, index) => {
            const questionElement = document.createElement('div');
            questionElement.className = 'quiz-question-wrapper';
            questionElement.style.marginBottom = '2rem'; // Separating questions

            questionElement.innerHTML = `
                <div class="quiz-question">Question ${index + 1}: ${q.question}</div>
                <div class="quiz-options" data-question-index="${index}">
                    ${q.type === 'mcq' ? q.options.map(option => `
                        <div class="quiz-option" data-answer="${option}" ${isLessonCompleted ? 'style="cursor: default;"' : ''}>${option}</div>
                    `).join('') : ''}
                    ${q.type === 'text' ? `
                        <input type="text" class="text-input-answer" placeholder="Type your answer here..." style="width: 100%; padding: 1rem; border-radius: 8px; border: 2px solid rgba(0, 255, 255, 0.3); background: rgba(0, 0, 0, 0.5); color: var(--text-color); font-size: 1rem;" ${isLessonCompleted ? 'disabled' : ''}>
                    ` : ''}
                </div>
            `;
            quizQuestionsContainer.appendChild(questionElement);
        });

        // Add event listeners for MCQ selection only if not completed
        if (!isLessonCompleted) {
            quizQuestionsContainer.querySelectorAll('.quiz-option').forEach(option => {
                option.addEventListener('click', function() {
                    const optionsGroup = this.closest('.quiz-options');
                    // Deselect all others in the group
                    optionsGroup.querySelectorAll('.quiz-option').forEach(opt => opt.classList.remove('selected', 'correct', 'incorrect'));
                    // Select the clicked one
                    this.classList.add('selected');
                });
            });
        } else {
             // If completed, visually mark the correct answer on load
            quizData.forEach((q, index) => {
                if (q.type === 'mcq') {
                    const optionsGroup = document.querySelector(`.quiz-options[data-question-index="${index}"]`);
                    // Mark the correct answer
                    optionsGroup.querySelector(`.quiz-option[data-answer="${q.answer}"]`)?.classList.add('correct');
                } else if (q.type === 'text') {
                     const input = document.querySelector(`.quiz-options[data-question-index="${index}"] .text-input-answer`);
                     input.value = q.answer;
                     input.style.border = `2px solid var(--success-color)`;
                }
            });
             document.getElementById('quizResult').innerHTML = `<div class="quiz-feedback correct"><i class="fas fa-check-circle"></i> **Lesson Already Completed!** You may move to the next lesson.</div>`;
             quizPassed = true;
             updateNavigationControls();
        }
    }

    document.getElementById('submitQuizBtn').addEventListener('click', () => {
        const lesson = currentCourse.lessons.find(l => l.id === currentLesson);
        const quizData = lesson.quiz;
        let allCorrect = true;
        let score = 0;
        
        // Reset and evaluate
        quizData.forEach((q, index) => {
            const optionsGroup = document.querySelector(`.quiz-options[data-question-index="${index}"]`);
            let isCorrect = false;

            if (q.type === 'mcq') {
                const selectedOption = optionsGroup.querySelector('.quiz-option.selected');
                
                // Clear all previous result classes and animation classes first
                optionsGroup.querySelectorAll('.quiz-option').forEach(opt => opt.classList.remove('correct', 'incorrect'));

                if (selectedOption) {
                    if (selectedOption.dataset.answer === q.answer) {
                        isCorrect = true;
                        selectedOption.classList.add('correct');
                    } else {
                        selectedOption.classList.add('incorrect');
                        // Highlight the correct answer
                        optionsGroup.querySelector(`.quiz-option[data-answer="${q.answer}"]`).classList.add('correct');
                    }
                } else {
                    // User did not select an answer, fail and highlight correct answer
                    optionsGroup.querySelector(`.quiz-option[data-answer="${q.answer}"]`)?.classList.add('correct');
                }
            } else if (q.type === 'text') {
                const input = optionsGroup.querySelector('.text-input-answer');
                const userAnswer = input.value.trim().toLowerCase();
                const correctAnswer = q.answer.trim().toLowerCase();
                
                if (userAnswer === correctAnswer) {
                    isCorrect = true;
                    input.style.border = `2px solid var(--success-color)`;
                } else {
                    input.style.border = `2px solid var(--error-color)`;
                    // Note: No easy way to show correct text answer without disrupting the UI, just show error
                }
            }

            if (isCorrect) {
                score++;
            } else {
                allCorrect = false;
            }
        });

        const quizResultElement = document.getElementById('quizResult');
        const totalQuestions = quizData.length;
        
        if (allCorrect) {
            quizResultElement.innerHTML = `
                <div class="quiz-feedback correct">
                    <i class="fas fa-check-circle"></i> **Perfect Score!** You got ${score}/${totalQuestions} correct. Lesson unlocked!
                </div>
            `;
            // All correct! Mark lesson complete and show modal.
            markLessonComplete();
            document.getElementById('submitQuizBtn').style.display = 'none'; // Hide submit after passing
        } else {
            quizResultElement.innerHTML = `
                <div class="quiz-feedback incorrect">
                    <i class="fas fa-times-circle"></i> **Incorrect Answers.** Score: ${score}/${totalQuestions}. Please review the lesson and try again.
                </div>
            `;
            // Disable navigation controls if quiz failed
            quizPassed = false;
            updateNavigationControls();
        }
    });

    // --- END QUIZ LOGIC ---


    // Event Listeners
    document.getElementById('prevLessonBtn').addEventListener('click', () => {
      if (currentLesson === totalLessons + 1) {
          loadLesson(totalLessons); // Back from final page to last lesson
      } else if (currentLesson > 1) {
        loadLesson(currentLesson - 1);
      }
    });

    document.getElementById('nextLessonBtn').addEventListener('click', () => {
      if (currentLesson < totalLessons) {
        // This is only enabled if the lesson is completed/quiz is passed
        loadLesson(currentLesson + 1);
      } else if (currentLesson === totalLessons) {
          // Go to final page (Only enabled if progress is 100)
          const enrolledCourse = userData.enrolledCourses?.find(c => c.courseId === courseId);
          if (enrolledCourse?.progress === 100 || enrolledCourse?.completedLessons?.includes(totalLessons)) {
              loadLesson(currentLesson + 1);
          }
      }
    });

    document.getElementById('continueBtn').addEventListener('click', () => {
      document.getElementById('completionModal').style.display = 'none';
      if (currentLesson < totalLessons) {
        loadLesson(currentLesson + 1);
      } else if (currentLesson === totalLessons) {
          loadLesson(currentLesson + 1); // Go to the final certificate page
      }
    });

    // Corrected Dashboard Redirect
    document.getElementById('backToDashboardBtn').addEventListener('click', () => {
      window.location.href = 'studyingatelvion.html';
    });

    async function markLessonComplete() {
      try {
        const enrolledCourseIndex = userData.enrolledCourses.findIndex(c => c.courseId === courseId);
        if (enrolledCourseIndex === -1) return;
        
        const enrolledCourse = userData.enrolledCourses[enrolledCourseIndex];
        
        // Check for double completion (to prevent point inflation)
        if (enrolledCourse.completedLessons?.includes(currentLesson)) {
            // Already completed, just update session state and show modal
            quizPassed = true; 
            updateNavigationControls();
            document.getElementById('pointsEarned').textContent = '0 (Already earned)';
            document.getElementById('completionModal').style.display = 'flex';
            return;
        }

        // Add to completed lessons
        if (!enrolledCourse.completedLessons) {
            enrolledCourse.completedLessons = [];
        }
        enrolledCourse.completedLessons.push(currentLesson);
        
        // Update current lesson access: currentLesson + 1
        enrolledCourse.currentLesson = Math.max(enrolledCourse.currentLesson || 1, currentLesson + 1);
        
        // Calculate progress
        const completedCount = enrolledCourse.completedLessons.length;
        enrolledCourse.progress = Math.round((completedCount / totalLessons) * 100);
        
        // Update user data: GP/Points logic is here
        userData.enrolledCourses[enrolledCourseIndex] = enrolledCourse;
        userData.completedLessons = (userData.completedLessons || 0) + 1;
        userData.totalPoints = (userData.totalPoints || 0) + 10; // 10 points per lesson
        
        // Save to database
        await updateDoc(doc(db, 'users', currentUser.uid), {
          enrolledCourses: userData.enrolledCourses,
          completedLessons: userData.completedLessons,
          totalPoints: userData.totalPoints
        });
        
        // Update UI
        updateOverallProgress();
        renderLessonsList();
        
        // Mark Quiz as passed for this session
        quizPassed = true; 
        updateNavigationControls();
        
        // Show completion modal
        document.getElementById('pointsEarned').textContent = '10';
        document.getElementById('completionModal').style.display = 'flex';
        
      } catch (error) {
        console.error('Error marking lesson complete:', error);
        alert('Error updating progress. Please try again.');
      }
    }

    // Initialize stars (outside of DOMContentLoaded to be safe with module imports)
    document.addEventListener('DOMContentLoaded', () => {
        const starsContainer = document.getElementById('stars-container');
        const numStars = 100;
        const minSize = 1;
        const maxSize = 3;
        for (let i = 0; i < numStars; i++) {
            const star = document.createElement('div');
            star.className = 'star';
            const size = Math.random() * (maxSize - minSize) + minSize;
            star.style.width = `${size}px`;
            star.style.height = `${size}px`;
            star.style.left = `${Math.random() * 100}%`;
            star.style.top = `${Math.random() * 100}%`;
            star.style.animationDelay = `${Math.random() * 4}s`;
            star.style.animationDuration = `${3 + Math.random() * 2}s`;
            starsContainer.appendChild(star);
        }
    });

  </script>
</body>
  </html>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-J1YTKP10ZX"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date()); 

  gtag('config', 'G-J1YTKP10ZX');
</script>
